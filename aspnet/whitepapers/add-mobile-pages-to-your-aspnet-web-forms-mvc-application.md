---
uid: whitepapers/add-mobile-pages-to-your-aspnet-web-forms-mvc-application
title: '方法: モバイル ページを追加する、ASP.NET Web フォーム/MVC アプリケーション |Microsoft Docs'
author: rick-anderson
description: ここで説明するには、ASP.NET Web フォームからモバイル デバイス用に最適化されたページに提供するさまざまな方法を説明します/MVC アプリケーションでは、し、提案、アーキテクチャとしています.。
ms.author: aspnetcontent
ms.date: 01/20/2011
ms.assetid: 3124f28e-cc32-418a-afe3-519fa56f4c36
msc.legacyurl: /whitepapers/add-mobile-pages-to-your-aspnet-web-forms-mvc-application
msc.type: content
ms.openlocfilehash: 59b81184852a7fe0ad2dcad9718b572a8c756918
ms.sourcegitcommit: b28cd0313af316c051c2ff8549865bff67f2fbb4
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/05/2018
ms.locfileid: "37823356"
---
<a name="how-to-add-mobile-pages-to-your-aspnet-web-forms--mvc-application"></a><span data-ttu-id="1fca8-103">方法: モバイル ページを追加する、ASP.NET Web フォーム/MVC アプリケーション</span><span class="sxs-lookup"><span data-stu-id="1fca8-103">How To: Add Mobile Pages to Your ASP.NET Web Forms / MVC Application</span></span>
====================
> <span data-ttu-id="1fca8-104">**適用されます。**</span><span class="sxs-lookup"><span data-stu-id="1fca8-104">**Applies To**</span></span>
> 
> - <span data-ttu-id="1fca8-105">ASP.NET Web フォームのバージョン 4.0</span><span class="sxs-lookup"><span data-stu-id="1fca8-105">ASP.NET Web Forms version 4.0</span></span>
> - <span data-ttu-id="1fca8-106">ASP.NET MVC version 3.0</span><span class="sxs-lookup"><span data-stu-id="1fca8-106">ASP.NET MVC version 3.0</span></span>
> 
> <span data-ttu-id="1fca8-107">**まとめ**</span><span class="sxs-lookup"><span data-stu-id="1fca8-107">**Summary**</span></span>
> 
> <span data-ttu-id="1fca8-108">ここで説明するには、ASP.NET Web フォームからモバイル デバイス用に最適化されたページに提供するさまざまな方法を説明します。/MVC アプリケーションでは、幅広い種類のデバイスを対象とするときに考慮すべき問題を設計およびアーキテクチャを示します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-108">This How To describes various ways to serve pages optimized for mobile devices from your ASP.NET Web Forms / MVC application, and suggests architectural and design issues to consider when targeting a broad range of devices.</span></span> <span data-ttu-id="1fca8-109">このドキュメントでは、3.5 に ASP.NET 2.0 から ASP.NET モバイル コントロールの旧式である理由と最新の代替手段はいくつかについて説明も説明します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-109">This document also explains why the ASP.NET Mobile Controls from ASP.NET 2.0 to 3.5 are now obsolete, and discusses some modern alternatives.</span></span>


## <a name="contents"></a><span data-ttu-id="1fca8-110">目次</span><span class="sxs-lookup"><span data-stu-id="1fca8-110">Contents</span></span>

- <span data-ttu-id="1fca8-111">概要</span><span class="sxs-lookup"><span data-stu-id="1fca8-111">Overview</span></span>
- <span data-ttu-id="1fca8-112">アーキテクチャ上のオプション</span><span class="sxs-lookup"><span data-stu-id="1fca8-112">Architectural options</span></span>
- <span data-ttu-id="1fca8-113">ブラウザーとデバイスの検出</span><span class="sxs-lookup"><span data-stu-id="1fca8-113">Browser and device detection</span></span>
- <span data-ttu-id="1fca8-114">ASP.NET Web フォーム アプリケーションがモバイル固有のページを表示する方法</span><span class="sxs-lookup"><span data-stu-id="1fca8-114">How ASP.NET Web Forms applications can present mobile-specific pages</span></span>
- <span data-ttu-id="1fca8-115">ASP.NET MVC アプリケーションがモバイル固有のページを表示する方法</span><span class="sxs-lookup"><span data-stu-id="1fca8-115">How ASP.NET MVC applications can present mobile-specific pages</span></span>
- <span data-ttu-id="1fca8-116">その他の技術情報</span><span class="sxs-lookup"><span data-stu-id="1fca8-116">Additional resources</span></span>

<span data-ttu-id="1fca8-117">ASP.NET Web フォームと MVC の両方のこのホワイト ペーパーの手法を示すダウンロード可能なコード サンプルでは、次を参照してください。 [Mobile Apps と ASP.NET を使用したサイト](https://docs.microsoft.com/aspnet/mobile/overview)します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-117">For downloadable code samples demonstrating this white paper's techniques for both ASP.NET Web Forms and MVC, see [Mobile Apps & Sites with ASP.NET](https://docs.microsoft.com/aspnet/mobile/overview).</span></span>

## <a name="overview"></a><span data-ttu-id="1fca8-118">概要</span><span class="sxs-lookup"><span data-stu-id="1fca8-118">Overview</span></span>

<span data-ttu-id="1fca8-119">– スマート フォン、機能のスマート フォンやタブレット – モバイル デバイスは、Web にアクセスするための手段として人気の増加を続けます。</span><span class="sxs-lookup"><span data-stu-id="1fca8-119">Mobile devices – smartphones, feature phones, and tablets – continue to grow in popularity as a means to access the Web.</span></span> <span data-ttu-id="1fca8-120">つまり多くの web 開発者と企業の web 指向がますます重要に訪問者がこれらのデバイスを使用して、優れた閲覧エクスペリエンスを提供します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-120">For many web developers and web-oriented businesses, this means it's increasingly important to provide a great browsing experience for visitors using those devices.</span></span>

### <a name="how-earlier-versions-of-aspnet-supported-mobile-browsers"></a><span data-ttu-id="1fca8-121">サポートされている ASP.NET のモバイル ブラウザーの方法の以前のバージョン</span><span class="sxs-lookup"><span data-stu-id="1fca8-121">How earlier versions of ASP.NET supported mobile browsers</span></span>

<span data-ttu-id="1fca8-122">ASP.NET のバージョン 2.0 を 3.5 に含まれる*ASP.NET モバイル コントロール*: でのモバイル デバイス用のサーバー コントロールのセット、 *System.Web.Mobile.dll*アセンブリと*System.Web.UI.MobileControls*名前空間。</span><span class="sxs-lookup"><span data-stu-id="1fca8-122">ASP.NET versions 2.0 to 3.5 included *ASP.NET Mobile Controls*: a set of server controls for mobile devices in the *System.Web.Mobile.dll* assembly and the *System.Web.UI.MobileControls* namespace.</span></span> <span data-ttu-id="1fca8-123">ASP.NET 4 のアセンブリが掲載されていますが、非推奨とされます。</span><span class="sxs-lookup"><span data-stu-id="1fca8-123">The assembly is still included in ASP.NET 4, but it is deprecated.</span></span> <span data-ttu-id="1fca8-124">開発者は、このホワイト ペーパーで説明したような最新のアプローチに移行することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="1fca8-124">Developers are advised to migrate to more modern approaches, such as those described in this paper.</span></span>

<span data-ttu-id="1fca8-125">なぜ ASP.NET モバイル コントロールは、不使用とマークされている理由は、2005 およびそれ以前の周囲に共通した携帯電話の周囲のデザインを指向することです。</span><span class="sxs-lookup"><span data-stu-id="1fca8-125">The reason why ASP.NET Mobile Controls have been marked as obsolete is that their design is oriented around the mobile phones that were common around 2005 and earlier.</span></span> <span data-ttu-id="1fca8-126">主に、コントロールはその時代 (年号) の WAP ブラウザー (通常の HTML) ではなく、WML または cHTML マークアップを表示するために設計されています。</span><span class="sxs-lookup"><span data-stu-id="1fca8-126">The controls are mainly designed to render WML or cHTML markup (instead of regular HTML) for the WAP browsers of that era.</span></span> <span data-ttu-id="1fca8-127">WAP、cHTML、WML が不要、ほとんどのプロジェクトに関連する HTML がモバイルとデスクトップのブラウザー同様のユビキタス マークアップ言語になるようになりました。</span><span class="sxs-lookup"><span data-stu-id="1fca8-127">But WAP, WML, and cHTML are no longer relevant for most projects, because HTML has now become the ubiquitous markup language for mobile and desktop browsers alike.</span></span>

### <a name="the-challenges-of-supporting-mobile-devices-today"></a><span data-ttu-id="1fca8-128">モバイル デバイスをサポートしている現在の課題</span><span class="sxs-lookup"><span data-stu-id="1fca8-128">The challenges of supporting mobile devices today</span></span>

<span data-ttu-id="1fca8-129">場合でも、モバイル ブラウザーほぼ例外なくなりました HTML、狙いを定める優れたモバイル閲覧エクスペリエンスを作成するときに、多くの課題が直面します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-129">Even though mobile browsers now almost universally support HTML, you will still face many challenges when aiming to create great mobile browsing experiences:</span></span>

- <span data-ttu-id="1fca8-130">***画面サイズ***- モバイル デバイスは、フォームが大幅に異なり、各自の画面は、多くの場合はあまりデスクトップ モニターよりも小さくします。</span><span class="sxs-lookup"><span data-stu-id="1fca8-130">***Screen size*** - Mobile devices vary dramatically in form, and their screens are often much smaller than desktop monitors.</span></span> <span data-ttu-id="1fca8-131">そのため、それらを完全に別のページ レイアウトを設計する必要があります。</span><span class="sxs-lookup"><span data-stu-id="1fca8-131">So, you may need to design completely different page layouts for them.</span></span>
- <span data-ttu-id="1fca8-132">***入力方式***– 一部のデバイスがあるキーパッド、styluses がある、他のユーザーがタッチを使用します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-132">***Input methods*** – Some devices have keypads, some have styluses, others use touch.</span></span> <span data-ttu-id="1fca8-133">複数のナビゲーション メカニズムとデータの入力方法を検討する必要があります。</span><span class="sxs-lookup"><span data-stu-id="1fca8-133">You may need to consider multiple navigation mechanisms and data input methods.</span></span>
- <span data-ttu-id="1fca8-134">***標準への準拠***– 多くのモバイル ブラウザーは、最新の HTML、CSS、または JavaScript の標準をサポートしていません。</span><span class="sxs-lookup"><span data-stu-id="1fca8-134">***Standards compliance*** – Many mobile browsers do not support the latest HTML, CSS, or JavaScript standards.</span></span>
- <span data-ttu-id="1fca8-135">***帯域幅***– 携帯データ ネットワークのパフォーマンスが大きく、変化し、一部のエンドユーザーはメガバイト単位で課金される関税率。</span><span class="sxs-lookup"><span data-stu-id="1fca8-135">***Bandwidth*** – Cellular data network performance varies wildly, and some end users are on tariffs that charge by the megabyte.</span></span>

<span data-ttu-id="1fca8-136">汎用型のソリューションはありません。アプリケーションは、外観し、それにアクセスするデバイスに応じて異なる方法で動作する必要があります。</span><span class="sxs-lookup"><span data-stu-id="1fca8-136">There's no one-size-fits-all solution; your application will have to look and behave differently according to the device accessing it.</span></span> <span data-ttu-id="1fca8-137">によってモバイル デバイスのサポートのレベルを指定、web 開発者向けに大きな問題、「ブラウザー戦争」desktop がこれまでいたよりも指定できます。</span><span class="sxs-lookup"><span data-stu-id="1fca8-137">Depending on what level of mobile support you want, this can be a bigger challenge for web developers than the desktop "browser wars" ever was.</span></span>

<span data-ttu-id="1fca8-138">開発者の多くの場合、最初に、初めてのモバイル ブラウザーのサポートに近づいています考えるなどは、開発者が個人的には多くの場合、所有しているために、おそらく、最新で最も高度なスマート フォン (Windows Phone 7、iPhone、または Android など) をサポートするために重要なのみです。デバイス。</span><span class="sxs-lookup"><span data-stu-id="1fca8-138">Developers approaching mobile browser support for the first time often initially think it's only important to support the latest and most sophisticated smartphones (e.g., Windows Phone 7, iPhone, or Android), perhaps because developers often personally own such devices.</span></span> <span data-ttu-id="1fca8-139">ただし、低コストの電話は非常に人気のある、引き続き、その所有者が携帯電話はブロード バンド接続よりも簡単に取得する場所の国で特に – web の閲覧に使用しないでください。</span><span class="sxs-lookup"><span data-stu-id="1fca8-139">However, cheaper phones are still extremely popular, and their owners do use them to browse the web – especially in countries where mobile phones are easier to get than a broadband connection.</span></span> <span data-ttu-id="1fca8-140">お客様のビジネスがどのようなさまざまな可能性が高い顧客を考慮してサポートするためにデバイスを決定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="1fca8-140">Your business will need to decide what range of devices to support by considering its likely customers.</span></span> <span data-ttu-id="1fca8-141">おそらく性能の低い機能によって、訪問者に対応する必要がありますを映画のチケット予約システムを作成する場合は、高度なスマート フォンをターゲットにのみビジネスの意思決定を行う可能性があります luxury 正常性の spa のオンラインのパンフレットを構築する場合携帯電話です。</span><span class="sxs-lookup"><span data-stu-id="1fca8-141">If you're building an online brochure for a luxury health spa, you might make a business decision only to target advanced smartphones, whereas if you're creating a ticket booking system for a cinema, you probably need to account for visitors with less powerful feature phones.</span></span>

## <a name="architectural-options"></a><span data-ttu-id="1fca8-142">アーキテクチャ上のオプション</span><span class="sxs-lookup"><span data-stu-id="1fca8-142">Architectural options</span></span>

<span data-ttu-id="1fca8-143">ASP.NET Web フォームまたは MVC の特定の技術的な詳細に入る前に、web 開発者に一般にモバイル ブラウザーをサポートするための 3 つの主な使用可能なオプションがあることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="1fca8-143">Before we get to the specific technical details of ASP.NET Web Forms or MVC, note that web developers in general have three main possible options for supporting mobile browsers:</span></span>

1. <span data-ttu-id="1fca8-144">***何もしない –*** 単に標準のデスクトップ指向の web アプリケーションを作成し、期待のレンダリングのモバイル ブラウザーに依存できます。</span><span class="sxs-lookup"><span data-stu-id="1fca8-144">***Do nothing –*** You can simply create a standard, desktop-oriented web application, and rely on mobile browsers to render it acceptably.</span></span> 

    - <span data-ttu-id="1fca8-145">**利点**: 実装および維持 – いいえ付加的な処理を最も安価なオプションです</span><span class="sxs-lookup"><span data-stu-id="1fca8-145">**Advantage**: It's the cheapest option to implement and maintain – no extra work</span></span>
    - <span data-ttu-id="1fca8-146">**欠点**: 最悪のエンド ユーザー エクスペリエンスを提供します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-146">**Disadvantage**: Gives the worst end-user experience:</span></span> 

        - <span data-ttu-id="1fca8-147">最新スマート フォンがデスクトップ ブラウザーと同様、HTML をレンダリングする場合がありますが、ユーザーがズームおよびスクロールを水平方向および垂直に小さな画面で、コンテンツを使用するが強制されます。</span><span class="sxs-lookup"><span data-stu-id="1fca8-147">The latest smartphones may render your HTML just as well as a desktop browser, but users will still be forced to zoom and scroll horizontally and vertically to consume your content on a small screen.</span></span> <span data-ttu-id="1fca8-148">これは、決して最適です。</span><span class="sxs-lookup"><span data-stu-id="1fca8-148">This is far from optimal.</span></span>
        - <span data-ttu-id="1fca8-149">満足のいくように、マークアップを表示するために古いデバイスとスマート フォンの機能があります。</span><span class="sxs-lookup"><span data-stu-id="1fca8-149">Older devices and feature phones may fail to render your markup in a satisfactory way.</span></span>
        - <span data-ttu-id="1fca8-150">(その画面はラップトップほど大きくできます) 最新のタブレット デバイス上でもさまざまな相互作用の規則が適用されます。</span><span class="sxs-lookup"><span data-stu-id="1fca8-150">Even on the latest tablet devices (whose screens can be as big as laptop screens), different interaction rules apply.</span></span> <span data-ttu-id="1fca8-151">タッチ ベースの入力がより大きなボタンで最適に動作し、spread さらに、離れているをリンクし、スライド アウト メニューの上をマウス カーソルを移動する方法はありません。</span><span class="sxs-lookup"><span data-stu-id="1fca8-151">Touch-based input works best with larger buttons and links spread further apart, and there's no way to hover a mouse cursor over a fly-out menu.</span></span>
2. <span data-ttu-id="1fca8-152">***クライアントで問題を解決*–** CSS を慎重に使用すると、[プログレッシブ エンハンスメント](http://en.wikipedia.org/wiki/Progressive_enhancement)マークアップ、スタイル、および実行は任意のブラウザーに適応するスクリプトを作成することができます。</span><span class="sxs-lookup"><span data-stu-id="1fca8-152">***Solve the problem on the client* –** With careful use of CSS and [progressive enhancement](http://en.wikipedia.org/wiki/Progressive_enhancement) you can create markup, styles, and scripts that adapt to whatever browser is running them.</span></span> <span data-ttu-id="1fca8-153">たとえば、 [3 の CSS メディア クエリ](http://www.w3.org/TR/2010/CR-css3-mediaqueries-20100727/)デバイスの画面が選択されたしきい値より狭い幅を 1 つの列のレイアウトにオンにする複数列のレイアウトを作成できます。</span><span class="sxs-lookup"><span data-stu-id="1fca8-153">For example, with [CSS 3 media queries](http://www.w3.org/TR/2010/CR-css3-mediaqueries-20100727/), you could create a multi-column layout that turns into a single column layout on devices whose screens are narrower than a chosen threshold.</span></span> 

    - <span data-ttu-id="1fca8-154">**利点**: に従って、どのような画面や入力の特性がある不明な将来のデバイスの場合でも、使用中の特定のデバイスのレンダリングの最適化</span><span class="sxs-lookup"><span data-stu-id="1fca8-154">**Advantage**: Optimizes rendering for the specific device in use, even for unknown future devices according to whatever screen and input characteristics they have</span></span>
    - <span data-ttu-id="1fca8-155">**利点**: 簡単にすべてのデバイスの種類 – コードや作業の重複を最小限の間でサーバー側ロジックを共有することができます</span><span class="sxs-lookup"><span data-stu-id="1fca8-155">**Advantage**: Easily lets you share server-side logic across all device types – minimal duplication of code or effort</span></span>
    - <span data-ttu-id="1fca8-156">**欠点**: モバイル デバイスが異なるは、デスクトップ デバイスの必要がある本当にモバイル ページには、デスクトップのページから完全に異なるさまざまな情報を表示します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-156">**Disadvantage**: Mobile devices are so different from desktop devices that you may really want your mobile pages to be completely different from your desktop pages, showing different information.</span></span> <span data-ttu-id="1fca8-157">このようなバリエーションが非効率になる可能性や確実に実現することは不可能だけで、CSS を使用方法に一貫性がありませんでした特に考慮すると古いデバイスの解釈 CSS 規則。</span><span class="sxs-lookup"><span data-stu-id="1fca8-157">Such variations can be inefficient or impossible to achieve robustly through CSS alone, especially considering how inconsistently older devices interpret CSS rules.</span></span> <span data-ttu-id="1fca8-158">これは、特に、CSS 3 の属性。</span><span class="sxs-lookup"><span data-stu-id="1fca8-158">This is particularly true of CSS 3 attributes.</span></span>
    - <span data-ttu-id="1fca8-159">**欠点**: さまざまなサーバー側ロジックとワークフローをさまざまなデバイスのサポートを提供しません。</span><span class="sxs-lookup"><span data-stu-id="1fca8-159">**Disadvantage**: Provides no support for varying server-side logic and workflows for different devices.</span></span> <span data-ttu-id="1fca8-160">たとえば、CSS だけを使用してモバイル ユーザーの簡略化されたショッピング カート清算ワークフローを実装することはできません。</span><span class="sxs-lookup"><span data-stu-id="1fca8-160">You can't, for example, implement a simplified shopping cart checkout workflow for mobile users by means of CSS alone.</span></span>
    - <span data-ttu-id="1fca8-161">**欠点**: 非効率的な帯域幅の使用。</span><span class="sxs-lookup"><span data-stu-id="1fca8-161">**Disadvantage**: Inefficient bandwidth use.</span></span> <span data-ttu-id="1fca8-162">サーバーは、ターゲット デバイスはその情報のサブセットのみを使用しても、マークアップと、考えられるすべてのデバイスに適用されるスタイルを送信する必要があります。</span><span class="sxs-lookup"><span data-stu-id="1fca8-162">You server may have to transmit the markup and styles that apply to all possible devices, even though the target device will only use a subset of that information.</span></span>
3. <span data-ttu-id="1fca8-163">***サーバー上の問題を解決*–** サーバーがどのようなデバイスがアクセスすることを知っている場合または入力方式は、その画面サイズなど、デバイスの最小の特性と別のロジックを実行できますが – モバイル デバイスであるかどうかと異なる HTML マークアップを出力します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-163">***Solve the problem on the server* –** If your server knows what device is accessing it – or at least the characteristics of that device, such as its screen size and input method, and whether it's a mobile device – it can run different logic and output different HTML markup.</span></span> 

    - <span data-ttu-id="1fca8-164">**に関する利点:** 最大の柔軟性。</span><span class="sxs-lookup"><span data-stu-id="1fca8-164">**Advantage:** Maximum flexibility.</span></span> <span data-ttu-id="1fca8-165">モバイル向けのサーバー側ロジックを変更または、必要に応じて、デバイスに固有のレイアウトのマークアップを最適化する量に制限はありません。</span><span class="sxs-lookup"><span data-stu-id="1fca8-165">There's no limit to how much you can vary your server-side logic for mobiles or optimize your markup for the desired, device-specific layout.</span></span>
    - <span data-ttu-id="1fca8-166">**に関する利点:** 効率的な帯域幅の使用。</span><span class="sxs-lookup"><span data-stu-id="1fca8-166">**Advantage:** Efficient bandwidth use.</span></span> <span data-ttu-id="1fca8-167">のみ、マークアップとスタイル情報を使用しようとして、ターゲット デバイスに送信する必要があります。</span><span class="sxs-lookup"><span data-stu-id="1fca8-167">You only need to transmit the markup and styling information that the target device is going to use.</span></span>
    - <span data-ttu-id="1fca8-168">**短所:** 強制的作業またはコードの繰り返しにされることがあります (例: ため、Web フォーム ページまたは MVC ビューに似ていますが、若干異なるコピーを作成する)。</span><span class="sxs-lookup"><span data-stu-id="1fca8-168">**Disadvantage:** Sometimes forces repetition of effort or code (e.g., making you create similar but slightly different copies of your Web Forms pages or MVC views).</span></span> <span data-ttu-id="1fca8-169">場所可能な基になる層またはサービスがまだ、して UI コードまたはマークアップの一部に共通のロジックをする要因となりますを複製し、並列で管理し、必要があります。</span><span class="sxs-lookup"><span data-stu-id="1fca8-169">Where possible you will factor out common logic into an underlying layer or service, but still, some parts of your UI code or markup may have to be duplicated and then maintained in parallel.</span></span>
    - <span data-ttu-id="1fca8-170">**短所:** デバイスの検出が容易ではありません。</span><span class="sxs-lookup"><span data-stu-id="1fca8-170">**Disadvantage:** Device detection is not trivial.</span></span> <span data-ttu-id="1fca8-171">リストまたは既知のデバイスの種類とその特性 (ができない可能性がある完全に最新の状態) のデータベースが必要ですし、すべての受信要求を正確に一致する保証はありません。</span><span class="sxs-lookup"><span data-stu-id="1fca8-171">It requires a list or database of known device types and their characteristics (which may not always be perfectly up-to-date) and isn't guaranteed to accurately match every incoming request.</span></span> <span data-ttu-id="1fca8-172">このドキュメントでは、いくつかのオプションとその落とし穴を後で説明します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-172">This document describes some options and their pitfalls later.</span></span>

<span data-ttu-id="1fca8-173">最適な結果を得るには、ほとんどの開発者は、オプション (2) と (3) を結合する必要があるを検索します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-173">To get the best results, most developers find they need to combine options (2) and (3).</span></span> <span data-ttu-id="1fca8-174">サーバー側コードで、データ、ワークフロー、またはマークアップで主な相違点が最も効果的に実装されている一方、若干の違いがスタイルは CSS または偶数の JavaScript を使用して、クライアントで対応最適。</span><span class="sxs-lookup"><span data-stu-id="1fca8-174">Minor stylistic differences are best accommodated on the client using CSS or even JavaScript, whereas major differences in data, workflow, or markup are most effectively implemented in server-side code.</span></span>

### <a name="this-paper-focuses-on-server-side-techniques"></a><span data-ttu-id="1fca8-175">このホワイト ペーパーは、サーバー側の手法</span><span class="sxs-lookup"><span data-stu-id="1fca8-175">This paper focuses on server-side techniques</span></span>

<span data-ttu-id="1fca8-176">ASP.NET Web フォームと MVC が両方のサーバー側では主にテクノロジであるために、このホワイト ペーパーはサーバー側の手法を異なるマークアップとモバイル ブラウザーのロジックを作成するに焦点します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-176">Since ASP.NET Web Forms and MVC are both primarily server-side technologies, this white paper will focus on server-side techniques that let you produce different markup and logic for mobile browsers.</span></span> <span data-ttu-id="1fca8-177">もちろん、任意のクライアント側手法 (たとえば、CSS 3 メディア クエリ、プログレッシブ エンハンスメント JavaScript) を結合することもできますが、ASP.NET 開発よりも web デザインの問題よりです。</span><span class="sxs-lookup"><span data-stu-id="1fca8-177">Of course, you can also combine this with any client-side technique (e.g., CSS 3 media queries, progressive-enhancement JavaScript), but that's more a matter of web design than ASP.NET development.</span></span>

## <a name="browser-and-device-detection"></a><span data-ttu-id="1fca8-178">ブラウザーとデバイスの検出</span><span class="sxs-lookup"><span data-stu-id="1fca8-178">Browser and device detection</span></span>

<span data-ttu-id="1fca8-179">モバイル デバイスをサポートするためのすべてのサーバー側手法のキーの前提条件は、ビジターを使用してどのようなデバイスを把握することです。</span><span class="sxs-lookup"><span data-stu-id="1fca8-179">The key prerequisite for all server-side techniques for supporting mobile devices is to know what device your visitor is using.</span></span> <span data-ttu-id="1fca8-180">実際には、そのデバイスの製造元とモデルの数を知ることを知ることよりも優れています、*特性*のデバイス。</span><span class="sxs-lookup"><span data-stu-id="1fca8-180">In fact, even better than knowing the manufacturer and model number of that device is knowing the *characteristics* of the device.</span></span> <span data-ttu-id="1fca8-181">特性があります。</span><span class="sxs-lookup"><span data-stu-id="1fca8-181">Characteristics may include:</span></span>

- <span data-ttu-id="1fca8-182">モバイル デバイスですか。</span><span class="sxs-lookup"><span data-stu-id="1fca8-182">Is it a mobile device?</span></span>
- <span data-ttu-id="1fca8-183">(マウス/キーボード、タッチ、キーボード、ジョイスティック、) の入力メソッド</span><span class="sxs-lookup"><span data-stu-id="1fca8-183">Input method (mouse/keyboard, touch, keypad, joystick, …)</span></span>
- <span data-ttu-id="1fca8-184">画面のサイズ (物理的にやピクセル単位)</span><span class="sxs-lookup"><span data-stu-id="1fca8-184">Screen size (physically and in pixels)</span></span>
- <span data-ttu-id="1fca8-185">サポートされているメディアおよびデータの形式</span><span class="sxs-lookup"><span data-stu-id="1fca8-185">Supported media and data formats</span></span>
- <span data-ttu-id="1fca8-186">など。</span><span class="sxs-lookup"><span data-stu-id="1fca8-186">Etc.</span></span>

<span data-ttu-id="1fca8-187">モデル番号、特性に基づく意思決定することをお勧めし、するとになります将来のデバイスを処理するために装備します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-187">It's better to make decisions based on characteristics than model number, because then you'll be better equipped to handle future devices.</span></span>

### <a name="using-aspnets-built-in-browser-detection-support"></a><span data-ttu-id="1fca8-188">ASP を使用します。NET の組み込みブラウザー検出のサポート</span><span class="sxs-lookup"><span data-stu-id="1fca8-188">Using ASP.NET's built-in browser detection support</span></span>

<span data-ttu-id="1fca8-189">プロパティを調べることで ASP.NET Web フォームと MVC 開発者が訪問ブラウザーの重要な特性をすぐに検出、 *Request.Browser*オブジェクト。</span><span class="sxs-lookup"><span data-stu-id="1fca8-189">ASP.NET Web Forms and MVC developers can immediately discover important characteristics of a visiting browser by inspecting properties of the *Request.Browser* object.</span></span> <span data-ttu-id="1fca8-190">たとえばを参照してください。</span><span class="sxs-lookup"><span data-stu-id="1fca8-190">For example, see</span></span>

- <span data-ttu-id="1fca8-191">Request.Browser.IsMobileDevice</span><span class="sxs-lookup"><span data-stu-id="1fca8-191">Request.Browser.IsMobileDevice</span></span>
- <span data-ttu-id="1fca8-192">Request.Browser.MobileDeviceManufacturer、Request.Browser.MobileDeviceModel</span><span class="sxs-lookup"><span data-stu-id="1fca8-192">Request.Browser.MobileDeviceManufacturer, Request.Browser.MobileDeviceModel</span></span>
- <span data-ttu-id="1fca8-193">Request.Browser.ScreenPixelsWidth</span><span class="sxs-lookup"><span data-stu-id="1fca8-193">Request.Browser.ScreenPixelsWidth</span></span>
- <span data-ttu-id="1fca8-194">Request.Browser.SupportsXmlHttp</span><span class="sxs-lookup"><span data-stu-id="1fca8-194">Request.Browser.SupportsXmlHttp</span></span>
- <span data-ttu-id="1fca8-195">...参照できます他の多くのユーザー</span><span class="sxs-lookup"><span data-stu-id="1fca8-195">…and many others</span></span>

<span data-ttu-id="1fca8-196">背後では、ASP.NET プラットフォームには、受信が一致する*User-agent* (UA) HTTP ヘッダーをブラウザーの定義 XML ファイルを一連の正規表現を使用します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-196">Behind the scenes, the ASP.NET platform matches the incoming *User-Agent* (UA) HTTP header against regular expressions in a set of Browser Definition XML files.</span></span> <span data-ttu-id="1fca8-197">既定では、プラットフォームには多くの一般的なモバイル デバイスの定義が含まれていて、他のユーザーが認識するカスタムのブラウザー定義ファイルを追加することができます。</span><span class="sxs-lookup"><span data-stu-id="1fca8-197">By default the platform includes definitions for many common mobile devices, and you can add custom Browser Definition files for others you wish to recognize.</span></span> <span data-ttu-id="1fca8-198">詳細については、MSDN のページを参照してください。 [ASP.NET Web サーバー コントロールとブラウザーの機能](https://msdn.microsoft.com/library/x3k2ssx2.aspx)します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-198">For more details, see the MSDN page [ASP.NET Web Server Controls and Browser Capabilities](https://msdn.microsoft.com/library/x3k2ssx2.aspx).</span></span>

### <a name="using-the-wurfl-device-database-via-51degreesmobi-foundation"></a><span data-ttu-id="1fca8-199">51Degrees.mobi Foundation を使用して、WURFL デバイス データベースを使用します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-199">Using the WURFL device database via 51Degrees.mobi Foundation</span></span>

<span data-ttu-id="1fca8-200">ASP の中にします。2 つの主なケースなことができない場合は NET の組み込みブラウザー検出のサポートは、多くのアプリケーションに十分になります。</span><span class="sxs-lookup"><span data-stu-id="1fca8-200">While ASP.NET's built-in browser detection support will be sufficient for many applications, there are two main cases when it might not be enough:</span></span>

- <span data-ttu-id="1fca8-201">***最新のデバイスを認識する***(なし、手動でそれらのブラウザー定義ファイルの作成) します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-201">***You want to recognize the latest devices***(without manually creating Browser Definition files for them).</span></span> <span data-ttu-id="1fca8-202">.NET 4 のブラウザー定義ファイルは最新で、Windows Phone 7、Android フォン、Opera Mobile ブラウザー、または Apple Ipad を認識しないことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="1fca8-202">Note that .NET 4's Browser Definition files are not recent enough to recognize Windows Phone 7, Android phones, Opera Mobile browsers, or Apple iPads.</span></span>
- <span data-ttu-id="1fca8-203">***デバイスの機能についてより詳細な情報が必要な***します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-203">***You need more detailed information about device capabilities***.</span></span> <span data-ttu-id="1fca8-204">デバイスの入力メソッド (タッチ vs キーパッドなど) について知っておく必要がありますか、どのようなオーディオ形式のブラウザーをサポートしています。</span><span class="sxs-lookup"><span data-stu-id="1fca8-204">You may need to know about a device's input method (e.g., touch vs keypad), or what audio formats the browser supports.</span></span> <span data-ttu-id="1fca8-205">この情報は、標準のブラウザー定義ファイルでは使用できません。</span><span class="sxs-lookup"><span data-stu-id="1fca8-205">This information isn't available in the standard Browser Definition files.</span></span>

<span data-ttu-id="1fca8-206">[ *Wireless Universal Resource ファイル*(WURFL) プロジェクト](http://wurfl.sourceforge.net/)より最新の状態と詳細に関する情報を保持使用しているモバイル デバイス今日です。</span><span class="sxs-lookup"><span data-stu-id="1fca8-206">The [*Wireless Universal Resource File* (WURFL) project](http://wurfl.sourceforge.net/) maintains much more up-to-date and detailed information about mobile devices in use today.</span></span>

<span data-ttu-id="1fca8-207">.NET 開発者向けのすばらしいは、その ASP します。NET のブラウザーの検出機能は拡張可能な機能を拡張して、これらの問題を克服することができます。</span><span class="sxs-lookup"><span data-stu-id="1fca8-207">The great news for .NET developers is that ASP.NET's browser detection feature is extensible, so it's possible to enhance it to overcome these problems.</span></span> <span data-ttu-id="1fca8-208">たとえば、オープン ソースを追加することができます[ *51Degrees.mobi Foundation* ](https://github.com/51Degrees/dotNET-Device-Detection)ライブラリをプロジェクトにします。</span><span class="sxs-lookup"><span data-stu-id="1fca8-208">For example, you can add the open source [*51Degrees.mobi Foundation*](https://github.com/51Degrees/dotNET-Device-Detection) library to your project.</span></span> <span data-ttu-id="1fca8-209">これは、ASP.NET IHttpModule またはブラウザー機能のプロバイダー (Web フォームと MVC の両方のアプリケーションで使用可能な)、直接 WURFL のデータを読み取り、ASP にフックします。NET の組み込みブラウザー検出メカニズム。</span><span class="sxs-lookup"><span data-stu-id="1fca8-209">It's an ASP.NET IHttpModule or Browser Capabilities Provider (usable on both Web Forms and MVC applications), that directly reads WURFL data and hooks it into ASP.NET's built-in browser detection mechanism.</span></span> <span data-ttu-id="1fca8-210">モジュールをインストールしたら*Request.Browser*は突然よりずっと正確かつ詳細な情報が含まれます正しくの前に説明したデバイスの多くを認識し (などの機能を一覧表示。追加機能の入力方式など)。</span><span class="sxs-lookup"><span data-stu-id="1fca8-210">Once you've installed the module, *Request.Browser* will suddenly contain a lot more accurate and detailed information: it will correctly recognize many of the devices previously mentioned and list their capabilities (including additional capabilities such as input method).</span></span> <span data-ttu-id="1fca8-211">詳細については、プロジェクトのドキュメントを参照してください。</span><span class="sxs-lookup"><span data-stu-id="1fca8-211">See the project's documentation for more details.</span></span>

## <a name="how-web-forms-applications-can-present-mobile-specific-pages"></a><span data-ttu-id="1fca8-212">Web フォーム アプリケーションがモバイル固有のページを表示する方法</span><span class="sxs-lookup"><span data-stu-id="1fca8-212">How Web Forms applications can present mobile-specific pages</span></span>

<span data-ttu-id="1fca8-213">既定では、次の一般的なモバイル デバイス、新しい Web フォーム アプリケーションを表示する方法に示します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-213">By default, here's how a brand new Web Forms application displays on common mobile devices:</span></span>

![](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/_static/image1.png)

<span data-ttu-id="1fca8-214">明らかに、どちらのレイアウトは非常にモバイル フレンドリ – このページは、縦向きの小さな画面ではなく、規模が大きく、横向きの監視用に設計されました。</span><span class="sxs-lookup"><span data-stu-id="1fca8-214">Clearly, neither layout looks very mobile-friendly – this page was designed for a large, landscape-oriented monitor, not for a small portrait-oriented screen.</span></span> <span data-ttu-id="1fca8-215">それでは何ができることについてでしょうか。</span><span class="sxs-lookup"><span data-stu-id="1fca8-215">So what can you do about it?</span></span>

<span data-ttu-id="1fca8-216">このホワイト ペーパーの前半で説明した、モバイル デバイスの場合、ページを調整するさまざまな方法があります。</span><span class="sxs-lookup"><span data-stu-id="1fca8-216">As discussed earlier in this paper, there are many ways to tailor your pages for mobile devices.</span></span> <span data-ttu-id="1fca8-217">一部のテクニックは、サーバー ベース、他のユーザーがクライアントで実行します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-217">Some techniques are server-based, others run on the client.</span></span>

### <a name="creating-a-mobile-specific-master-page"></a><span data-ttu-id="1fca8-218">モバイル専用のマスター ページを作成します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-218">Creating a mobile-specific master page</span></span>

<span data-ttu-id="1fca8-219">要件に応じて、ことができますを同じ Web フォームを使用して、すべての訪問者が、2 つの異なるマスター ページ: デスクトップの訪問者の 1 つは、モバイル ユーザー用に別の。</span><span class="sxs-lookup"><span data-stu-id="1fca8-219">Depending on your requirements, you may be able to use the same Web Forms for all visitors, but have two separate master pages: one for desktop visitors, another for mobile visitors.</span></span> <span data-ttu-id="1fca8-220">これは、ビューでは、CSS スタイル シート、または任意のページ ロジックを複製することを強制することがなく、モバイル デバイスに合わせて、最上位レベルの HTML マークアップを変更する柔軟ができます。</span><span class="sxs-lookup"><span data-stu-id="1fca8-220">This gives you the flexibility of changing the CSS stylesheet or your top-level HTML markup to suit mobile devices, without forcing you to duplicate any page logic.</span></span>

<span data-ttu-id="1fca8-221">これは、簡単に実行できます。</span><span class="sxs-lookup"><span data-stu-id="1fca8-221">This is easy to do.</span></span> <span data-ttu-id="1fca8-222">たとえば、Web フォームに PreInit ハンドラーに次のようを追加できます。</span><span class="sxs-lookup"><span data-stu-id="1fca8-222">For example, you can add a PreInit handler such as the following to a Web Form:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample1.cs)]

<span data-ttu-id="1fca8-223">ここで、アプリケーションの最上位フォルダーで Mobile.Master と呼ばれるマスター ページを作成し、モバイル デバイスが検出されたときに使用されます。</span><span class="sxs-lookup"><span data-stu-id="1fca8-223">Now, create a master page called Mobile.Master in the top-level folder of your application, and it will be used when a mobile device is detected.</span></span> <span data-ttu-id="1fca8-224">モバイル マスター ページは、必要に応じて、モバイル固有の CSS スタイル シートを参照できます。</span><span class="sxs-lookup"><span data-stu-id="1fca8-224">Your mobile master page can reference a mobile-specific CSS stylesheet if necessary.</span></span> <span data-ttu-id="1fca8-225">デスクトップの訪問者には、引き続き既定のマスター ページ、モバイルの 1 つではありませんが表示されます。</span><span class="sxs-lookup"><span data-stu-id="1fca8-225">Desktop visitors will still see your default master page, not the mobile one.</span></span>

### <a name="creating-independent-mobile-specific-web-forms"></a><span data-ttu-id="1fca8-226">モバイル専用の独立した Web フォームを作成します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-226">Creating independent mobile-specific Web Forms</span></span>

<span data-ttu-id="1fca8-227">柔軟性を最大限に高めるできる場合よりも、さまざまなデバイスの種類別のマスター ページに関係なくアクセスします。</span><span class="sxs-lookup"><span data-stu-id="1fca8-227">For maximum flexibility, you can go much further than just having separate master pages for different device types.</span></span> <span data-ttu-id="1fca8-228">2 つを実装することができます*の Web フォーム ページのセットを完全に分離*1 – モバイルの設定別のデスクトップ ブラウザーを設定する。</span><span class="sxs-lookup"><span data-stu-id="1fca8-228">You can implement two *totally separate sets of Web Forms pages* – one set for desktop browsers, another set for mobiles.</span></span> <span data-ttu-id="1fca8-229">これは最適モバイルの訪問者に非常に異なる情報、またはワークフローを表示する場合です。</span><span class="sxs-lookup"><span data-stu-id="1fca8-229">This works best if you want to present very different information or workflows to mobile visitors.</span></span> <span data-ttu-id="1fca8-230">このセクションの残りの部分では、この方法の詳細について説明します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-230">The rest of this section describes this approach in detail.</span></span>

<span data-ttu-id="1fca8-231">続行する最も簡単な方法は、プロジェクト内で"Mobile"をという名前のサブフォルダーを作成し、モバイル ページを構築する、デスクトップ ブラウザー用に設計された Web フォーム アプリケーションが既にあると仮定すると、します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-231">Assuming you already have a Web Forms application designed for desktop browsers, the easiest way to proceed is to create a subfolder called "Mobile" within your project, and build your mobile pages there.</span></span> <span data-ttu-id="1fca8-232">すべてが同じで、他の Web フォーム アプリケーションを使用する手法を使用して、独自のマスター ページ、スタイル シート、およびページで、全体のサブ サイトを構築できます。</span><span class="sxs-lookup"><span data-stu-id="1fca8-232">You can construct an entire sub-site, with its own master pages, style sheets, and pages, using all the same techniques that you'd use for any other Web Forms application.</span></span> <span data-ttu-id="1fca8-233">モバイルに相当するを生成するために必ずしも*すべて*デスクトップ サイトのページはモバイル閲覧者の機能のサブセットをどのような意味を選択することができます。</span><span class="sxs-lookup"><span data-stu-id="1fca8-233">You don't necessarily need to produce a mobile equivalent for *every* page in your desktop site; you can choose what subset of functionality makes sense for mobile visitors.</span></span>

<span data-ttu-id="1fca8-234">モバイル ページは、共通の静的なリソースを共有できます (イメージ、JavaScript、CSS などのファイル) する場合、通常のページでします。</span><span class="sxs-lookup"><span data-stu-id="1fca8-234">Your mobile pages can share common static resources (such as images, JavaScript, or CSS files) with your regular pages if you wish.</span></span> <span data-ttu-id="1fca8-235">"Mobile"フォルダーがあるため*いない*マークする別のアプリケーションとして (単純な Web フォーム ページのサブフォルダーだけである)、IIS でホストされている場合は共有もまったく同じ構成、セッション データ、およびその他のインフラストラクチャとして、デスクトップのページ。</span><span class="sxs-lookup"><span data-stu-id="1fca8-235">Since your "Mobile" folder will *not* be marked as a separate application when hosted in IIS (it's just a simple subfolder of Web Forms pages), it will also share all the same configuration, Session data, and other infrastructure as your desktop pages.</span></span>

> [!NOTE]
> <span data-ttu-id="1fca8-236">この方法では、通常はコードの一部が重複しているため (モバイル ページは、デスクトップのページをいくつかの類似点を共有する可能性の高い、)、一般的なビジネス ロジックまたはデータ アクセス コード共有の基になる層やサービスに排除することが重要です。</span><span class="sxs-lookup"><span data-stu-id="1fca8-236">Since this approach usually involves some duplication of code (mobile pages are likely to share some similarities with desktop pages), it's important to factor out any common business logic or data access code into a shared underlying layer or service.</span></span> <span data-ttu-id="1fca8-237">それ以外の場合、倍精度浮動小数点の作成と、アプリケーションの保守作業をします。</span><span class="sxs-lookup"><span data-stu-id="1fca8-237">Otherwise, you'll double the effort of creating and maintaining your application.</span></span>


#### <a name="redirecting-mobile-visitors-to-your-mobile-pages"></a><span data-ttu-id="1fca8-238">モバイル ユーザー、モバイル ページにリダイレクトします。</span><span class="sxs-lookup"><span data-stu-id="1fca8-238">Redirecting mobile visitors to your mobile pages</span></span>

<span data-ttu-id="1fca8-239">のみ、モバイル ページをモバイル閲覧者にリダイレクトする便利なことがよくあります、*最初*ので、自身のブラウズ セッションで、自身のセッションですべての要求ではなく) を要求します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-239">It's often convenient to redirect mobile visitors to the mobile pages only on the *first* request in their browsing session (and not on every request in their session), because:</span></span>

- <span data-ttu-id="1fca8-240">希望 –「デスクトップ バージョン」に移動するマスター ページのリンクを配置する場合、デスクトップのページにアクセスするモバイル閲覧者を簡単に許可できます。</span><span class="sxs-lookup"><span data-stu-id="1fca8-240">You can then easily allow mobile visitors to access your desktop pages if they wish – just put a link on your master page that goes to "Desktop version".</span></span> <span data-ttu-id="1fca8-241">訪問者は、それがなくなったため、最初の要求のセッションで、モバイル ページにリダイレクトされません。</span><span class="sxs-lookup"><span data-stu-id="1fca8-241">The visitor won't be redirected back to a mobile page, because it's no longer the first request in their session.</span></span>
- <span data-ttu-id="1fca8-242">(IFRAME では、または特定の Ajax ハンドラーで、サイトのデスクトップとモバイルの両方の部分を表示する一般的な Web フォームがある) 場合などに、サイトのデスクトップおよびモバイルの部分の間で共有するすべての動的リソースの要求が干渉される危険を回避できます。</span><span class="sxs-lookup"><span data-stu-id="1fca8-242">It avoids the risk of interfering with requests for any dynamic resources shared between desktop and mobile parts of your site (e.g., if you have a common Web Form that both desktop and mobile parts of your site display in an IFRAME, or certain Ajax handlers)</span></span>

<span data-ttu-id="1fca8-243">これを行うには、リダイレクト ロジックを配置することができます、**セッション\_開始**メソッド。</span><span class="sxs-lookup"><span data-stu-id="1fca8-243">To do this, you can place your redirection logic in a **Session\_Start** method.</span></span> <span data-ttu-id="1fca8-244">たとえば、Global.asax.cs ファイルに次のメソッドを追加します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-244">For example, add the following method to your Global.asax.cs file:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample2.cs)]

#### <a name="configuring-forms-authentication-to-respect-your-mobile-pages"></a><span data-ttu-id="1fca8-245">モバイル ページを尊重するフォーム認証を構成します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-245">Configuring Forms Authentication to respect your mobile pages</span></span>

<span data-ttu-id="1fca8-246">特定の前提条件と、認証プロセスの中にユーザーをリダイレクトできます場所について、フォーム認証することに注意してください。</span><span class="sxs-lookup"><span data-stu-id="1fca8-246">Note that Forms Authentication makes certain assumptions about where it can redirect visitors during and after the authentication process:</span></span>

- <span data-ttu-id="1fca8-247">ユーザーを認証する場合、フォーム認証にリダイレクトされますにデスクトップまたはモバイル ユーザーいるかどうかに関係なく、デスクトップのログイン ページ (しかの概念がないため、 *1 つ*ログイン URL)。</span><span class="sxs-lookup"><span data-stu-id="1fca8-247">When a user needs to be authenticated, Forms Authentication will redirect them to your desktop login page, regardless of whether they're a desktop or mobile user (because it only has a concept of *one* login URL).</span></span> <span data-ttu-id="1fca8-248">モバイル ユーザーを別のモバイル ログイン ページにリダイレクトするために、デスクトップのログイン ページを強化するために、モバイルのログイン ページを異なる方法でスタイルを設定すると仮定すると、必要があります。</span><span class="sxs-lookup"><span data-stu-id="1fca8-248">Assuming you want to style your mobile login page differently, you need to enhance your desktop login page so that it redirects mobile users to a separate mobile login page.</span></span> <span data-ttu-id="1fca8-249">次のコードを追加するなど、**デスクトップ**ログイン ページのコード ビハインド。</span><span class="sxs-lookup"><span data-stu-id="1fca8-249">For example, add the following code to your **desktop** login page code-behind:</span></span> 

    [!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample3.cs)]
- <span data-ttu-id="1fca8-250">後、ユーザーのログオン成功、フォーム認証は既定でに、デスクトップ ホーム ページにリダイレクト (しかの概念がないため、 *1 つ*既定のページ)。</span><span class="sxs-lookup"><span data-stu-id="1fca8-250">After a user successfully logs in, Forms Authentication will by default redirect them to your desktop home page (because it only has a concept of *one* default page).</span></span> <span data-ttu-id="1fca8-251">成功したログの後にモバイル ホーム ページにリダイレクトするために、モバイルのログイン ページを強化する必要があります。</span><span class="sxs-lookup"><span data-stu-id="1fca8-251">You need to enhance your mobile login page so that it redirects to the mobile home page after a successful log-in.</span></span> <span data-ttu-id="1fca8-252">次のコードを追加するなど、**モバイル**ログイン ページのコード ビハインド。</span><span class="sxs-lookup"><span data-stu-id="1fca8-252">For example, add the following code to your **mobile** login page code-behind:</span></span> 

    [!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample4.cs)]
  
  <span data-ttu-id="1fca8-253">このコードでは、ページに既定のプロジェクト テンプレートのように、LoginUser と呼ばれるログイン サーバー コントロールが前提としています。</span><span class="sxs-lookup"><span data-stu-id="1fca8-253">This code assumes your page has a Login server control called LoginUser, as in the default project template.</span></span>

### <a name="working-with-output-caching"></a><span data-ttu-id="1fca8-254">出力キャッシュの使用</span><span class="sxs-lookup"><span data-stu-id="1fca8-254">Working with Output Caching</span></span>

<span data-ttu-id="1fca8-255">出力キャッシュを使用している場合は、キャッシュされているデスクトップの出力を受信したモバイル ユーザー続く既定のデスクトップのユーザー (その出力をキャッシュする原因と)、特定の URL に移動することでことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="1fca8-255">If you're using output caching, beware that by default it's possible for a desktop user to visit a certain URL (causing its output to be cached), followed by a mobile user who then receives the cached desktop output.</span></span> <span data-ttu-id="1fca8-256">この警告は、デバイスの種類によって、マスター ページのさまざまなまたはデバイスの種類ごとにまったく別の Web フォームを実装しているだけかどうかを適用します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-256">This warning applies whether you're just varying your master page by device type, or implementing totally separate Web Forms per device type.</span></span>

<span data-ttu-id="1fca8-257">問題を避けるためには、訪問者がモバイル デバイスを使用しているかどうかに従ってキャッシュ エントリの変更を ASP.NET に指示できます。</span><span class="sxs-lookup"><span data-stu-id="1fca8-257">To avoid the problem, you can instruct ASP.NET to vary the cache entry according to whether the visitor is using a mobile device.</span></span> <span data-ttu-id="1fca8-258">ページの OutputCache 宣言するよう VaryByCustom パラメーターを追加します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-258">Add a VaryByCustom parameter to your page's OutputCache declaration as follows:</span></span>

[!code-aspx[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample5.aspx)]

<span data-ttu-id="1fca8-259">次に、定義*isMobileDevice* Global.asax.cs ファイルに次のメソッドを追加することでパラメーターを上書きするカスタムのキャッシュとして。</span><span class="sxs-lookup"><span data-stu-id="1fca8-259">Next, define *isMobileDevice* as a custom cache parameter by adding the following method override to your Global.asax.cs file:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample6.cs)]

<span data-ttu-id="1fca8-260">これにより、ページのモバイル訪問者が以前デスクトップ訪問者によって、キャッシュに格納する出力を受信しないことが保証されます。</span><span class="sxs-lookup"><span data-stu-id="1fca8-260">This will ensure that mobile visitors to the page don't receive output previously put into the cache by a desktop visitor.</span></span>

### <a name="a-working-example"></a><span data-ttu-id="1fca8-261">実際の例</span><span class="sxs-lookup"><span data-stu-id="1fca8-261">A working example</span></span>

<span data-ttu-id="1fca8-262">これらの技法の動作を表示するには、ダウンロード[このホワイト ペーパーのコード サンプル](https://docs.microsoft.com/aspnet/mobile/overview)します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-262">To see these techniques in action, download [this white paper's code samples](https://docs.microsoft.com/aspnet/mobile/overview).</span></span> <span data-ttu-id="1fca8-263">Web フォームのサンプル アプリケーションは、一連の Mobile という名前のサブフォルダー内のモバイル専用のページに自動的にモバイル ユーザーをリダイレクトします。</span><span class="sxs-lookup"><span data-stu-id="1fca8-263">The Web Forms sample application automatically redirects mobile users to a set of mobile-specific pages in a subfolder called Mobile.</span></span> <span data-ttu-id="1fca8-264">マークアップとそれらのページのスタイルはより適切に最適化モバイル ブラウザーでは、次のスクリーン ショットからわかるようにします。</span><span class="sxs-lookup"><span data-stu-id="1fca8-264">The markup and styling of those pages is better optimized for mobile browsers, as you can see from the following screenshots:</span></span>

![](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/_static/image2.png)

<span data-ttu-id="1fca8-265">モバイル ブラウザー、マークアップと CSS の最適化の詳細については、「スタイル モバイル ページ モバイル ブラウザーの」このドキュメントの後半のセクションを参照してください。</span><span class="sxs-lookup"><span data-stu-id="1fca8-265">For more tips about optimizing your markup and CSS for mobile browsers, see the section "Styling mobile pages for mobile browsers" later in this document.</span></span>

## <a name="how-aspnet-mvc-applications-can-present-mobile-specific-pages"></a><span data-ttu-id="1fca8-266">ASP.NET MVC アプリケーションがモバイル固有のページを表示する方法</span><span class="sxs-lookup"><span data-stu-id="1fca8-266">How ASP.NET MVC applications can present mobile-specific pages</span></span>

<span data-ttu-id="1fca8-267">モデル-ビュー-コント ローラー パターンが (ビュー) でのプレゼンテーション ロジックから (コント ローラー) でアプリケーション ロジックを分離するため、サーバー側コードでモバイル デバイスのサポートを処理するように、次の方法のいずれかから選択できます。</span><span class="sxs-lookup"><span data-stu-id="1fca8-267">Since the Model-View-Controller pattern decouples application logic (in controllers) from presentation logic (in views), you can choose from any of the following approaches to handling mobile support in server-side code:</span></span>

1. <span data-ttu-id="1fca8-268">***デスクトップとモバイルの両方のブラウザーでは、同じコント ローラーとビューを使用して、、デバイスの種類 * に応じてさまざまな Razor レイアウトとビューをレンダリングします。**</span><span class="sxs-lookup"><span data-stu-id="1fca8-268">***Use the same controllers and views for both desktop and mobile browsers, but render the views with different Razor layouts depending on the device type*.**</span></span> <span data-ttu-id="1fca8-269">このオプションは、すべてのデバイスで同一のデータを表示しているが、単に別の CSS スタイル シートを指定またはモバイルの最上位レベルの HTML 要素をいくつかを変更する場合に最適です。</span><span class="sxs-lookup"><span data-stu-id="1fca8-269">This option works best if you're displaying identical data on all devices, but simply want to supply different CSS stylesheets or change a few top-level HTML elements for mobiles.</span></span>
2. <span data-ttu-id="1fca8-270">***デスクトップとモバイルの両方のブラウザーでは、同じコント ローラーを使用しますが、デバイスの種類に応じて異なるビューをレンダリング***します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-270">***Use the same controllers for both desktop and mobile browsers, but render different views depending on the device type***.</span></span> <span data-ttu-id="1fca8-271">ほぼ同じデータを表示するエンドユーザーのため、同じワークフローを提供する場合、このオプションは最適ですが、使用されているデバイスに合わせて大きく異なる HTML マークアップをレンダリングします。</span><span class="sxs-lookup"><span data-stu-id="1fca8-271">This option works best if you're displaying roughly the same data and providing the same workflows for end users, but want to render very different HTML markup to suit the device being used.</span></span>
3. <span data-ttu-id="1fca8-272">***デスクトップおよびモバイル ブラウザーでは、それぞれ独立したコント ローラーとビューを実装する別の領域を作成 *。**</span><span class="sxs-lookup"><span data-stu-id="1fca8-272">***Create separate areas for desktop and mobile browsers, implementing independent controllers and views for each*.**</span></span> <span data-ttu-id="1fca8-273">このオプションは、非常にさまざまな画面を表示する、さまざまな情報を含むおよび先頭のユーザー、デバイスの種類用に最適化されたさまざまなワークフローを実行している場合に最適です。</span><span class="sxs-lookup"><span data-stu-id="1fca8-273">This option works best if you're displaying very different screens, containing different information and leading the user through different workflows optimized for their device type.</span></span> <span data-ttu-id="1fca8-274">コードのいくつかの繰り返しがありますが、基になるレイヤーやサービスに共通のロジックを切り離すことによって最小化できます。</span><span class="sxs-lookup"><span data-stu-id="1fca8-274">It may mean some repetition of code, but you can minimize that by factoring out common logic into an underlying layer or service.</span></span>

<span data-ttu-id="1fca8-275">使用する場合、**最初**オプションを選択し、Razor レイアウトのみを異なるデバイスの種類あたりは非常に簡単です。</span><span class="sxs-lookup"><span data-stu-id="1fca8-275">If you want to take the **first** option and vary only the Razor layout per device type, it's very easy.</span></span> <span data-ttu-id="1fca8-276">変更するだけ、 \_ViewStart.cshtml ファイルの次のようにします。</span><span class="sxs-lookup"><span data-stu-id="1fca8-276">Just modify your \_ViewStart.cshtml file as follows:</span></span>

[!code-cshtml[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample7.cshtml)]

<span data-ttu-id="1fca8-277">呼ばれるモバイル専用のレイアウトを作成できるようになりました\_ページ構造を持つ LayoutMobile.cshtml と CSS 規則をモバイル デバイス用に最適化します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-277">Now you can create a mobile-specific layout called \_LayoutMobile.cshtml with a page structure and CSS rules optimized for mobile devices.</span></span>

<span data-ttu-id="1fca8-278">使用する場合、 **2 番目**訪問者のデバイスの種類に応じてまったく異なるビューをレンダリング オプションを参照してください[Scott Hanselman のブログの投稿](http://www.hanselman.com/blog/ABetterASPNETMVCMobileDeviceCapabilitiesViewEngine.aspx)します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-278">If you want to take the **second** option render totally different views according to the visitor's device type, see [Scott Hanselman's blog post](http://www.hanselman.com/blog/ABetterASPNETMVCMobileDeviceCapabilitiesViewEngine.aspx).</span></span>

<span data-ttu-id="1fca8-279">このホワイト ペーパーの残りの部分に焦点を当てています、 **3 番目**オプション – 別のコント ローラーを作成する*と*モバイル閲覧者の機能のサブセットが提供される厳密に制御できるようにモバイル デバイスのビュー。</span><span class="sxs-lookup"><span data-stu-id="1fca8-279">The rest of this paper focuses on the **third** option – creating separate controllers *and* views for mobile devices – so you can control exactly what subset of functionality is offered for mobile visitors.</span></span>

### <a name="setting-up-a-mobile-area-within-your-aspnet-mvc-application"></a><span data-ttu-id="1fca8-280">ASP.NET MVC アプリケーション内でのモバイル領域の設定</span><span class="sxs-lookup"><span data-stu-id="1fca8-280">Setting up a Mobile area within your ASP.NET MVC application</span></span>

<span data-ttu-id="1fca8-281">通常の方法で既存の ASP.NET MVC アプリケーションに"Mobile"と呼ばれる部分を追加することができます。 ソリューション エクスプ ローラーでプロジェクト名を右クリックし、追加比べて領域を選択します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-281">You can add an area called "Mobile" to an existing ASP.NET MVC application in the normal way: right-click on your project name in Solution Explorer, then choose Add à Area.</span></span> <span data-ttu-id="1fca8-282">ASP.NET MVC アプリケーション内の他の任意の領域の場合と同様、し、コント ローラーとビューを追加することができます。</span><span class="sxs-lookup"><span data-stu-id="1fca8-282">You can then add controllers and views as you would for any other area within an ASP.NET MVC application.</span></span> <span data-ttu-id="1fca8-283">モバイル閲覧者のホーム ページとして機能するテンプレートを使用すると呼ばれる新しいコント ローラーをモバイルお住まいの地域に例を追加します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-283">For example, add to your Mobile area a new controller called HomeController to act as a homepage for mobile visitors.</span></span>

### <a name="ensuring-the-url-mobile-reaches-the-mobile-homepage"></a><span data-ttu-id="1fca8-284">モバイル ホーム ページ URL/Mobile を確実に到達します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-284">Ensuring the URL /Mobile reaches the mobile homepage</span></span>

<span data-ttu-id="1fca8-285">モバイルお住まいの地域内で HomeController の Index アクションに到達する URL/Mobile を設定する場合は、ルーティングの構成に 2 つの小さな変更を加える必要があります。</span><span class="sxs-lookup"><span data-stu-id="1fca8-285">If you want the URL /Mobile to reach the Index action on HomeController inside your Mobile area, you will need to make two small changes to your routing configuration.</span></span> <span data-ttu-id="1fca8-286">最初に、更新、MobileAreaRegistration クラス テンプレートを使用するが、モバイル領域で、既定のコント ローラーように次のコードに示すように。</span><span class="sxs-lookup"><span data-stu-id="1fca8-286">First, update your MobileAreaRegistration class so that HomeController is the default controller in your Mobile area, as shown in the following code:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample8.cs)]

<span data-ttu-id="1fca8-287">つまりモバイルのホーム ページは今すぐ配置されている/モバイル ホームではなく、/Mobile で"Home"があるため、モバイル ページの既定のコント ローラー名に暗黙的にします。</span><span class="sxs-lookup"><span data-stu-id="1fca8-287">This means the mobile homepage will now be located at /Mobile, rather than /Mobile/Home, because "Home" is now the implicitly default controller name for mobile pages.</span></span>

<span data-ttu-id="1fca8-288">次に、こと、2 つ目のテンプレートを使用するアプリケーション (つまり、モバイルは 1 つだけでなく、既存のデスクトップに 1 つ) に追加すると、しますを解除した場合、通常のデスクトップのホームページに注意してください。</span><span class="sxs-lookup"><span data-stu-id="1fca8-288">Next, note that by adding a second HomeController to your application (i.e., the mobile one, in addition to the existing desktop one), you'll have broken your regular desktop homepage.</span></span> <span data-ttu-id="1fca8-289">これは、エラーで失敗"*'Home' という名前のコント ローラーに一致する複数の種類が見つかりました*"。</span><span class="sxs-lookup"><span data-stu-id="1fca8-289">It will fail with the error "*Multiple types were found that match the controller named 'Home'*".</span></span> <span data-ttu-id="1fca8-290">これを解決するには、あいまいさがあるときに、デスクトップ、HomeController が優先度を行うことを指定する (Global.asax.cs) で、最上位レベルのルーティング構成を更新します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-290">To resolve this, update your top-level routing configuration (in Global.asax.cs) to specify that your desktop HomeController should take priority when there's ambiguity:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample9.cs)]

<span data-ttu-id="1fca8-291">退席中、および URL http:// エラーになるようになりました<em>目的のサイト</em>http://、デスクトップのホーム ページに到達/<em>目的のサイト</em>/mobile/はモバイルのホームページに達します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-291">Now the error will go away, and the URL http://<em>yoursite</em>/ will reach the desktop homepage, and http://<em>yoursite</em>/mobile/ will reach the mobile homepage.</span></span>

### <a name="redirecting-mobile-visitors-to-your-mobile-area"></a><span data-ttu-id="1fca8-292">モバイルお住まいの地域をモバイル閲覧者にリダイレクトします。</span><span class="sxs-lookup"><span data-stu-id="1fca8-292">Redirecting mobile visitors to your mobile area</span></span>

<span data-ttu-id="1fca8-293">多くのさまざまな機能拡張ポイントがある ASP.NET mvc で可能なリダイレクト ロジックを挿入する方法はたくさんありますので。</span><span class="sxs-lookup"><span data-stu-id="1fca8-293">There are many different extensibility points in ASP.NET MVC, so there are many possible ways to inject redirection logic.</span></span> <span data-ttu-id="1fca8-294">1 つの便利なオプションは、属性を作成するフィルターを [RedirectMobileDevicesToMobileArea]、次の条件が満たされた場合、リダイレクトを実行するには。</span><span class="sxs-lookup"><span data-stu-id="1fca8-294">One neat option is to create a filter attribute, [RedirectMobileDevicesToMobileArea], that performs a redirection if the following conditions are met:</span></span>

1. <span data-ttu-id="1fca8-295">ユーザーのセッションでは最初の要求 (つまり、Session.IsNewSession が true)</span><span class="sxs-lookup"><span data-stu-id="1fca8-295">It's the first request in the user's session (i.e., Session.IsNewSession equals true)</span></span>
2. <span data-ttu-id="1fca8-296">モバイル ブラウザーから要求を受信 (つまり、Request.Browser.IsMobileDevice が true)</span><span class="sxs-lookup"><span data-stu-id="1fca8-296">The request comes from a mobile browser (i.e., Request.Browser.IsMobileDevice equals true)</span></span>
3. <span data-ttu-id="1fca8-297">ユーザー、モバイル領域内のリソースが既に要求されていない (つまり、*パス*URL の一部が/Mobile で始まらない)</span><span class="sxs-lookup"><span data-stu-id="1fca8-297">The user is not already requesting a resource in the mobile area (i.e., the *path* part of the URL does not begin with /Mobile)</span></span>

<span data-ttu-id="1fca8-298">このホワイト ペーパーに含まれているダウンロード可能なサンプルには、このロジックの実装が含まれています。</span><span class="sxs-lookup"><span data-stu-id="1fca8-298">The downloadable sample included with this white paper includes an implementation of this logic.</span></span> <span data-ttu-id="1fca8-299">それ以外の場合であればデスクトップ ビジター最初アクセス特定の URL、デスクトップの出力をキャッシュしてに提供し、可能性がありますも出力キャッシュが使用している場合でもに正しく処理できるは、AuthorizeAttribute から派生した、承認フィルターとして実装されます。その後モバイル ユーザーの場合)。</span><span class="sxs-lookup"><span data-stu-id="1fca8-299">It's implemented as an authorization filter, derived from AuthorizeAttribute, which means it can work correctly even if you are using output caching (otherwise, if a desktop visitor first accesses a certain URL, the desktop output might be cached and then served to subsequent mobile visitors).</span></span>

<span data-ttu-id="1fca8-300">フィルターは、いずれも使用できますに特定のコント ローラーとアクションを適用する例。</span><span class="sxs-lookup"><span data-stu-id="1fca8-300">As it's a filter, you can choose either to apply it to specific controllers and actions, e.g.,</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample10.cs)]

<span data-ttu-id="1fca8-301">…</span><span class="sxs-lookup"><span data-stu-id="1fca8-301">…</span></span> <span data-ttu-id="1fca8-302">または、MVC 3 としてすべてのコント ローラーとアクションを適用できます*グローバル フィルター* Global.asax.cs ファイル。</span><span class="sxs-lookup"><span data-stu-id="1fca8-302">or you can apply it to all controllers and actions as an MVC 3 *global filter* in your Global.asax.cs file:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample11.cs)]

<span data-ttu-id="1fca8-303">ダウンロード可能なサンプルでは、モバイルお住まいの地域内の特定の場所にリダイレクトするこの属性のサブクラスを作成する方法も示します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-303">The downloadable sample also demonstrates how you can create subclasses of this attribute that redirect to specific locations within your mobile area.</span></span> <span data-ttu-id="1fca8-304">つまり、たとえば、ことができます。</span><span class="sxs-lookup"><span data-stu-id="1fca8-304">This means, for example, you can:</span></span>

- <span data-ttu-id="1fca8-305">グローバル フィルターを登録に示すように上記モバイルのホーム ページにモバイル閲覧者を既定で送信します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-305">Register a global filter as shown above that sends mobile visitors to the mobile homepage by default.</span></span>
- <span data-ttu-id="1fca8-306">[RedirectMobileDevicesToMobileProductPage] の特殊なフィルターは「製品の表示」アクションを受け取るユーザーが要求したすべての製品ページのモバイル バージョンにモバイル閲覧者にも適用されます。</span><span class="sxs-lookup"><span data-stu-id="1fca8-306">Also apply a special [RedirectMobileDevicesToMobileProductPage] filter to a "view product" action that takes mobile visitors to the mobile version of whatever product page they had requested.</span></span>
- <span data-ttu-id="1fca8-307">フィルターの他の特殊なサブクラスを同等のモバイル ページをモバイル閲覧者にリダイレクトする、特定のアクションにも適用されます。</span><span class="sxs-lookup"><span data-stu-id="1fca8-307">Also apply other special subclasses of the filter to specific actions, redirecting mobile visitors to the equivalent mobile page</span></span>

### <a name="configuring-forms-authentication-to-respect-your-mobile-pages"></a><span data-ttu-id="1fca8-308">モバイル ページを尊重するフォーム認証を構成します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-308">Configuring Forms Authentication to respect your mobile pages</span></span>

<span data-ttu-id="1fca8-309">フォーム認証を使用している場合、ことをユーザーにログインする場合、その自動的にユーザー、URL にリダイレクト 1 つ特定「ログオン」は既定では注意してください **/アカウント/ログオン**します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-309">If you're using Forms Authentication, you should note that when a user needs to log in, it automatically redirects the user to a single specific "log on" URL, which by default is **/Account/LogOn**.</span></span> <span data-ttu-id="1fca8-310">つまり、デスクトップ「ログオン」アクションをモバイル ユーザーをリダイレクトする場合があります。</span><span class="sxs-lookup"><span data-stu-id="1fca8-310">This means that mobile users may be redirected to your desktop "log on" action.</span></span>

<span data-ttu-id="1fca8-311">この問題を回避するには、モバイル ユーザーをもう一度モバイル「ログオン」のアクションにリダイレクトができるように、デスクトップの「ログオン」アクションにロジックを追加します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-311">To avoid this problem, add logic to your desktop "log on" action so that it redirects mobile users again to a mobile "log on" action.</span></span> <span data-ttu-id="1fca8-312">既定の ASP.NET MVC アプリケーション テンプレートを使用している場合は、とおり AccountController のログオン操作を更新します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-312">If you're using the default ASP.NET MVC application template, update AccountController's LogOn action as follows:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample12.cs)]

<span data-ttu-id="1fca8-313">…</span><span class="sxs-lookup"><span data-stu-id="1fca8-313">…</span></span> <span data-ttu-id="1fca8-314">およびモバイルお住まいの地域で AccountController と呼ばれるコント ローラーで適切なモバイル専用「ログオン」アクションを実装します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-314">and then implement a suitable mobile-specific "log on" action on a controller called AccountController in your Mobile area.</span></span>

### <a name="working-with-output-caching"></a><span data-ttu-id="1fca8-315">出力キャッシュの使用</span><span class="sxs-lookup"><span data-stu-id="1fca8-315">Working with Output Caching</span></span>

<span data-ttu-id="1fca8-316">[OutputCache] フィルターを使用している場合は、デバイスの種類によって変化するキャッシュ エントリを強制する必要があります。</span><span class="sxs-lookup"><span data-stu-id="1fca8-316">If you're using the [OutputCache] filter, you must force the cache entry to vary by device type.</span></span> <span data-ttu-id="1fca8-317">たとえば、次のように記述します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-317">For example, write:</span></span>

[!code-javascript[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample13.js)]

<span data-ttu-id="1fca8-318">次に、次のメソッドを Global.asax.cs ファイルに追加します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-318">Then, add the following method to your Global.asax.cs file:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample14.cs)]

<span data-ttu-id="1fca8-319">これにより、ページのモバイル訪問者が以前デスクトップ訪問者によって、キャッシュに格納する出力を受信しないことが保証されます。</span><span class="sxs-lookup"><span data-stu-id="1fca8-319">This will ensure that mobile visitors to the page don't receive output previously put into the cache by a desktop visitor.</span></span>

### <a name="a-working-example"></a><span data-ttu-id="1fca8-320">実際の例</span><span class="sxs-lookup"><span data-stu-id="1fca8-320">A working example</span></span>

<span data-ttu-id="1fca8-321">これらの技法の動作を表示するには、ダウンロード[このホワイト ペーパーのコードには、サンプルが関連付けられている](https://docs.microsoft.com/aspnet/mobile/overview)します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-321">To see these techniques in action, download [this white paper's code associated samples](https://docs.microsoft.com/aspnet/mobile/overview).</span></span> <span data-ttu-id="1fca8-322">サンプルには、上記で説明したメソッドを使用してモバイル デバイスをサポートする強化された ASP.NET MVC 3 (リリース候補) アプリケーションが含まれています。</span><span class="sxs-lookup"><span data-stu-id="1fca8-322">The sample includes an ASP.NET MVC 3 (Release Candidate) application enhanced to support mobile devices using the methods described above.</span></span>

## <a name="further-guidance-and-suggestions"></a><span data-ttu-id="1fca8-323">さらにガイダンスと推奨事項</span><span class="sxs-lookup"><span data-stu-id="1fca8-323">Further guidance and suggestions</span></span>

<span data-ttu-id="1fca8-324">次の説明には、Web フォームと MVC 開発者にとって、このドキュメントで説明する方法を使用している両方が適用されます。</span><span class="sxs-lookup"><span data-stu-id="1fca8-324">The following discussion applies both to Web Forms and MVC developers who are using the techniques covered in this document.</span></span>

### <a name="enhancing-your-redirection-logic-using-51degreesmobi-foundation"></a><span data-ttu-id="1fca8-325">51Degrees.mobi Foundation を使用して、リダイレクト ロジックの強化</span><span class="sxs-lookup"><span data-stu-id="1fca8-325">Enhancing your redirection logic using 51Degrees.mobi Foundation</span></span>

<span data-ttu-id="1fca8-326">このドキュメントに記載するリダイレクト ロジックは、アプリケーションの完全に十分な可能性がありますが、セッションを無効にする必要がある場合は機能しませんか、または特定の要求かどうかはわかりませんので (これらは、セッションを持つことはできません)、cookie を拒否するモバイル ブラウザーでは、そのビジターから最初の 1 つ。</span><span class="sxs-lookup"><span data-stu-id="1fca8-326">The redirection logic shown in this document may be perfectly sufficient for your application, but it won't work if you need to disable sessions, or with mobile browsers that reject cookies (these can't have sessions), because it won't know whether a given request is the first one from that visitor.</span></span>

<span data-ttu-id="1fca8-327">既に、オープン ソース 51Degrees.mobi Foundation ASP の精度が向上する方法について説明しました。NET のブラウザーの検出。</span><span class="sxs-lookup"><span data-stu-id="1fca8-327">You already learned how the open source 51Degrees.mobi Foundation can improve the accuracy of ASP.NET's browser detection.</span></span> <span data-ttu-id="1fca8-328">Web.config で構成されている特定の場所をモバイル閲覧者をリダイレクトする組み込み機能もあります。ASP.NET セッションによってことがなく動作することができます (つまり cookie) 訪問者の HTTP ヘッダーと IP アドレスのハッシュの一時的なログを保存すると、それが認識できるように各要求に指定したビジターから 1 つ目がかどうか。</span><span class="sxs-lookup"><span data-stu-id="1fca8-328">It also has a built-in ability to redirect mobile visitors to specific locations configured in Web.config. It's able to work without depending on ASP.NET Sessions (and hence cookies) by storing a temporary log of hashes of visitors' HTTP headers and IP addresses, so it knows whether or not each request is the first one from a given vistor.</span></span>

<span data-ttu-id="1fca8-329">Web.config ファイルの fiftyOne セクションに追加された次の要素が検出されたモバイル デバイスから、ページへの最初の要求をリダイレクト ~/Mobile/Default.aspx します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-329">The following element added to the fiftyOne section of the web.config file will redirect the first request from a detected mobile device to the page ~/Mobile/Default.aspx.</span></span> <span data-ttu-id="1fca8-330">モバイルのフォルダーの下のページへの要求は*いない*デバイスの種類に関係なく、リダイレクトされます。</span><span class="sxs-lookup"><span data-stu-id="1fca8-330">Any requests to pages under the Mobile folder will *not* be redirected, regardless of device type.</span></span> <span data-ttu-id="1fca8-331">忘れては 20 分間または複数のデバイスの場合は、モバイル デバイスが非アクティブだった期間と、後続の要求はリダイレクトのために新しいものとして扱われます。</span><span class="sxs-lookup"><span data-stu-id="1fca8-331">If the mobile device has been inactive for a period of 20 minutes or more the device will be forgotten and subsequent requests will be treated as new ones for the purposes of redirection.</span></span>

[!code-xml[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample15.xml)]

<span data-ttu-id="1fca8-332">詳細については、次を参照してください。 [51degrees.mobi Foundation ドキュメント](https://github.com/51Degrees/dotNET-Device-Detection)します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-332">For more details, see [51degrees.mobi Foundation documentation](https://github.com/51Degrees/dotNET-Device-Detection).</span></span>

> [!NOTE]
> <span data-ttu-id="1fca8-333">*できます*51Degrees.mobi Foundation のリダイレクトの機能が、ASP.NET MVC アプリケーションではルーティング パラメーターは使用しませんまたは MVC フィルターを設定することによって、プレーンな Url の観点から、リダイレクト構成を定義する必要がありますアクション。</span><span class="sxs-lookup"><span data-stu-id="1fca8-333">You *can* use 51Degrees.mobi Foundation's redirection feature on ASP.NET MVC applications, but you will need to define your redirection configuration in terms of plain URLs, not in terms of routing parameters or by putting MVC filters on actions.</span></span> <span data-ttu-id="1fca8-334">これはためです (この記事の執筆時点) で 51Degrees.mobi Foundation では、フィルターやルーティングは認識しません。</span><span class="sxs-lookup"><span data-stu-id="1fca8-334">This is because (at the time of writing) 51Degrees.mobi Foundation does not recognize filters or routing.</span></span>


### <a name="disabling-transcoders-and-proxy-servers"></a><span data-ttu-id="1fca8-335">トランスコーダーとプロキシ サーバーを無効にします。</span><span class="sxs-lookup"><span data-stu-id="1fca8-335">Disabling Transcoders and Proxy Servers</span></span>

<span data-ttu-id="1fca8-336">モバイルのインターネットへのアプローチでは、2 つの広範な目標があるモバイル ネットワーク オペレーター。</span><span class="sxs-lookup"><span data-stu-id="1fca8-336">Mobile network operators have two broad objectives in their approach to the mobile internet:</span></span>

1. <span data-ttu-id="1fca8-337">できるだけはるかに関連するコンテンツとして指定します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-337">Provide as much relevant content as possible</span></span>
2. <span data-ttu-id="1fca8-338">制限付きの無線ネットワーク帯域幅を共有できる顧客の数を最大化します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-338">Maximize the number of customers who can share the limited radio network bandwidth</span></span>

<span data-ttu-id="1fca8-339">多くの演算子を使用して、ほとんどの web ページは、デスクトップ サイズの大きい画面と固定行高速ブロード バンド接続用に設計された、ため*トランスコーダー*または*プロキシ サーバー* web コンテンツを動的に変更します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-339">Since most web pages were designed for large desktop-sized screens and fast fixed-line broadband connections, many operators use *transcoders* or *proxy servers* that dynamically alter web content.</span></span> <span data-ttu-id="1fca8-340">(特に"フィーチャー フォン用"複雑なレイアウトを処理するために処理能力がない)、小さい画面に合わせて、CSS、HTML マークアップを変更する可能性があり、ページの配信速度を向上させるために (その品質が大幅に軽減)、イメージを再圧縮する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="1fca8-340">They may modify your HTML markup or CSS to suit smaller screens (especially for "feature phones" that lack the processing power to handle complex layouts), and they may recompress your images (significantly reducing their quality) to improve page delivery speeds.</span></span>

<span data-ttu-id="1fca8-341">サイトのモバイルに最適化されたバージョンを生成するために作業を実行する可能性がありますしない場合に干渉すること、さらにネットワーク オペレーター。</span><span class="sxs-lookup"><span data-stu-id="1fca8-341">But if you've taken the effort to produce a mobile-optimized version of your site, you probably don't want the network operator to interfere with it any further.</span></span> <span data-ttu-id="1fca8-342">次の行を追加するには、ページに\_任意の ASP.NET Web フォームでの Load イベント。</span><span class="sxs-lookup"><span data-stu-id="1fca8-342">You can add the following line to the Page\_Load event in any ASP.NET Web Form:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample16.cs)]

<span data-ttu-id="1fca8-343">または、そのコント ローラー上のすべてのアクションに適用されるため、ASP.NET MVC コント ローラーでは、次のメソッドのオーバーライドを追加する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="1fca8-343">Or, for an ASP.NET MVC controller, you could add the following method override so that it applies to all actions on that controller:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample17.cs)]

<span data-ttu-id="1fca8-344">結果の HTTP メッセージは、W3C 準拠トランスコーダーとコンテンツを変更するには、いないプロキシを通知します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-344">The resulting HTTP message informs W3C compliant transcoders and proxies not to alter content.</span></span> <span data-ttu-id="1fca8-345">もちろん、モバイル ネットワーク オペレーターがこのメッセージを尊重する保証はありません。</span><span class="sxs-lookup"><span data-stu-id="1fca8-345">Of course, there is no guarantee that mobile network operators will respect this message.</span></span>

### <a name="styling-mobile-pages-for-mobile-browsers"></a><span data-ttu-id="1fca8-346">モバイル ブラウザー用にモバイル ページのスタイル設定</span><span class="sxs-lookup"><span data-stu-id="1fca8-346">Styling mobile pages for mobile browsers</span></span>

<span data-ttu-id="1fca8-347">すばらしい詳細に説明するには、このドキュメントの対象外のどのような HTML マークアップの作業正しくやどの web 設計手法は、特定のデバイスで使いやすさを最大化です。</span><span class="sxs-lookup"><span data-stu-id="1fca8-347">It's beyond the scope of this document to describe in great detail what kinds of HTML markup work correctly or which web design techniques maximize usability on particular devices.</span></span> <span data-ttu-id="1fca8-348">これがを十分に単純なレイアウトを検索するに用に最適化 mobile サイズの画面では、信頼性の低いを使用せず HTML や CSS のテクニックを配置します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-348">It's up to you to find a sufficiently simple layout, optimized for a mobile-sized screen, without using unreliable HTML or CSS positioning tricks.</span></span> <span data-ttu-id="1fca8-349">ただし、触れて、1 つの重要な手法は、*ビューポート メタ タグ*します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-349">One important technique worth mentioning, however, is the *viewport meta tag*.</span></span>

<span data-ttu-id="1fca8-350">目的のデスクトップ モニターは、残存作業時間表示 web ページで特定最新のモバイル ブラウザー「ビューポート」とも呼ばれる仮想キャンバス上でページのレンダリング (例: 仮想ビューポートは 980 ピクセル幅、iPhone で、既定では、Opera mobile 幅 850 のピクセル) し、画面の物理ピクセルに合わせて、結果のスケール ダウンします。</span><span class="sxs-lookup"><span data-stu-id="1fca8-350">Certain modern mobile browsers, in an effort display web pages meant for desktop monitors, render the page on a virtual canvas, also called "viewport" (e.g., the virtual viewport is 980 pixels wide on iPhone, and 850 pixels wide on Opera Mobile by default) and then scale the result down to fit onto the screen's physical pixels.</span></span> <span data-ttu-id="1fca8-351">ユーザーにズーム インし、そのビューポートの周りをパンします。</span><span class="sxs-lookup"><span data-stu-id="1fca8-351">The user can then zoom in and pan around that viewport.</span></span> <span data-ttu-id="1fca8-352">これには、利点がありますが、ブラウザーで、目的のレイアウト ページを表示できますが、またが、ユーザーにとって便利ですが、ズームとパンを強制的に欠点です。</span><span class="sxs-lookup"><span data-stu-id="1fca8-352">This has the advantage that it lets the browser display the page in its intended layout, but it's also has the disadvantage that it forces zooming and panning, which is inconvenient for the user.</span></span> <span data-ttu-id="1fca8-353">Mobile を設計する場合は、ある幅の狭い画面をデザインする方がよいズームまたは水平方向にスクロールする必要はありません。</span><span class="sxs-lookup"><span data-stu-id="1fca8-353">If you're designing for mobile, it's better to design for a narrow screen so that no zooming or horizontal scrolling is necessary.</span></span>

<span data-ttu-id="1fca8-354">ビューポートは幅は、モバイル ブラウザーに指示する方法は、非標準*ビューポート*メタ タグ。</span><span class="sxs-lookup"><span data-stu-id="1fca8-354">A way to tell the mobile browser how wide the viewport should be is through the nonstandard *viewport* meta tag.</span></span> <span data-ttu-id="1fca8-355">たとえば、次のページの HEAD セクションに追加します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-355">For example, if you add the following to your page's HEAD section,</span></span>

[!code-html[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample18.html)]

<span data-ttu-id="1fca8-356">…</span><span class="sxs-lookup"><span data-stu-id="1fca8-356">…</span></span> <span data-ttu-id="1fca8-357">480 ピクセル全体の仮想キャンバス上でページをレイアウトは、スマート フォンのブラウザーをサポートします。</span><span class="sxs-lookup"><span data-stu-id="1fca8-357">then supporting smartphone browsers will lay out the page on a 480-pixel wide virtual canvas.</span></span> <span data-ttu-id="1fca8-358">これは、HTML 要素は、割合の幅を定義する場合、割合はこの既定のビューポートの幅は 480 ピクセル幅に関して解釈されることを意味します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-358">This means that if your HTML elements define their widths in percentage terms, the percentages will be interpreted with respect to this 480-pixel width, not the default viewport width.</span></span> <span data-ttu-id="1fca8-359">その結果、ユーザーがズームし、パンの水平方向に – 大幅モバイル ブラウジング エクスペリエンスを向上する可能性が低くします。</span><span class="sxs-lookup"><span data-stu-id="1fca8-359">As a result, the user is less likely to have to zoom and pan horizontally – considerably improving the mobile browsing experience.</span></span>

<span data-ttu-id="1fca8-360">ビューポートの幅、デバイスの物理ピクセルと一致する場合は、次を指定できます。</span><span class="sxs-lookup"><span data-stu-id="1fca8-360">If you want the viewport width to match the device's physical pixels, you can specify the following:</span></span>

[!code-html[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample19.html)]

<span data-ttu-id="1fca8-361">これを正しく機能させるには、する必要がありますいない明示的に強制する要素をその幅を超える (などを使用して、*幅*属性または CSS プロパティ)、それ以外の場合、ブラウザーでより大きなビューポートを使用して、関係なくで強制されます。</span><span class="sxs-lookup"><span data-stu-id="1fca8-361">For this to work correctly, you must not explicitly force elements to exceed that width (e.g., using a *width* attribute or CSS property), otherwise the browser will be forced to use a larger viewport regardless.</span></span> <span data-ttu-id="1fca8-362">参照してください:[の詳細については、非標準のビューポート タグ](https://developer.apple.com/library/safari/#documentation/AppleApplications/Reference/SafariHTMLRef/Articles/MetaTags.html)します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-362">See also: [more details about the nonstandard viewport tag](https://developer.apple.com/library/safari/#documentation/AppleApplications/Reference/SafariHTMLRef/Articles/MetaTags.html).</span></span>

<span data-ttu-id="1fca8-363">ほとんどの最新のスマート フォンをサポートして*双方向の向き*: 縦または横モードでは保持できます。</span><span class="sxs-lookup"><span data-stu-id="1fca8-363">Most modern smartphones support *dual orientation*: they can be held in either portrait or landscape mode.</span></span> <span data-ttu-id="1fca8-364">そのためが推測、画面の幅 (ピクセル単位) が重要です。</span><span class="sxs-lookup"><span data-stu-id="1fca8-364">So, it's important not to make assumptions about the screen width in pixels.</span></span> <span data-ttu-id="1fca8-365">でも考えないで、画面の幅が固定されているため、ページ上にあるときに、ユーザーは自分のデバイスを回転再ことができます。</span><span class="sxs-lookup"><span data-stu-id="1fca8-365">Don't even assume that the screen width is fixed, because the user can re-orient their device while they are on your page.</span></span>

<span data-ttu-id="1fca8-366">コンテンツに通知するために、ページ ヘッダーには、次のメタ タグ モバイル向けに最適化された、そのため、変換されませんが、古い Windows Mobile、および Blackberry デバイスを受け入れるも可能性があります。</span><span class="sxs-lookup"><span data-stu-id="1fca8-366">Older Windows Mobile and Blackberry devices may also accept the following meta tags in the page header to inform them content has been optimized for mobile and therefore should not be transformed.</span></span>

[!code-html[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample20.html)]

## <a name="additional-resources"></a><span data-ttu-id="1fca8-367">その他のリソース</span><span class="sxs-lookup"><span data-stu-id="1fca8-367">Additional Resources</span></span>

<span data-ttu-id="1fca8-368">一連のモバイル デバイス エミュレーターやシミュレーターの ASP.NET モバイル web アプリケーションをテストに使用できる、ページをご覧ください。[をテストするための一般的なモバイル デバイスをシミュレート](../mobile/device-simulators.md)します。</span><span class="sxs-lookup"><span data-stu-id="1fca8-368">For a list of mobile device emulators and simulators you can use to test your mobile ASP.NET web application, see the page [Simulate popular mobile devices for testing](../mobile/device-simulators.md).</span></span>

## <a name="credits"></a><span data-ttu-id="1fca8-369">謝辞</span><span class="sxs-lookup"><span data-stu-id="1fca8-369">Credits</span></span>

- <span data-ttu-id="1fca8-370">プライマリ作成者: Steven Sanderson</span><span class="sxs-lookup"><span data-stu-id="1fca8-370">Primary author: Steven Sanderson</span></span>
- <span data-ttu-id="1fca8-371">レビュー担当者]、[追加コンテンツの作成者: James Rosewell、Mikael Söderström、Scott Hanselman、Scott Hunter</span><span class="sxs-lookup"><span data-stu-id="1fca8-371">Reviewers / additional content writers: James Rosewell, Mikael Söderström, Scott Hanselman, Scott Hunter</span></span>
