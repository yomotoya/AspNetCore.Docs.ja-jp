---
uid: web-forms/overview/deployment/advanced-enterprise-web-deployment/taking-web-applications-offline-with-web-deploy
title: Web アプリケーションをオフラインに Web 配置 |Microsoft Docs
author: jrjlee
description: このトピックでは、インターネット インフォメーション サービス (IIS) Web 展開マネージャーを使用して自動展開の期間の web アプリケーションをオフラインする方法について説明しています.
ms.author: riande
ms.date: 05/04/2012
ms.assetid: 3e9f6e7d-8967-4586-94d5-d3a122f12529
msc.legacyurl: /web-forms/overview/deployment/advanced-enterprise-web-deployment/taking-web-applications-offline-with-web-deploy
msc.type: authoredcontent
ms.openlocfilehash: 9b18a48914a74a7fea85278d0e601f6f84376b23
ms.sourcegitcommit: 45ac74e400f9f2b7dbded66297730f6f14a4eb25
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/16/2018
ms.locfileid: "41826496"
---
<a name="taking-web-applications-offline-with-web-deploy"></a><span data-ttu-id="ae5b0-103">Web アプリケーションをオフラインに Web デプロイします。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-103">Taking Web Applications Offline with Web Deploy</span></span>
====================
<span data-ttu-id="ae5b0-104">によって[Jason Lee](https://github.com/jrjlee)</span><span class="sxs-lookup"><span data-stu-id="ae5b0-104">by [Jason Lee](https://github.com/jrjlee)</span></span>

[<span data-ttu-id="ae5b0-105">PDF のダウンロード</span><span class="sxs-lookup"><span data-stu-id="ae5b0-105">Download PDF</span></span>](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> <span data-ttu-id="ae5b0-106">このトピックでは、インターネット インフォメーション サービス (IIS) の Web 配置ツール (Web 配置) を使用して自動展開の期間の web アプリケーションをオフラインする方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-106">This topic describes how to take a web application offline for the duration of an automated deployment using the Internet Information Services (IIS) Web Deployment Tool (Web Deploy).</span></span> <span data-ttu-id="ae5b0-107">Web アプリケーションを参照するユーザーをリダイレクト、*アプリ\_offline.htm*デプロイが完了するまでのファイルします。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-107">Users who browse to the web application are redirected to an *App\_offline.htm* file until the deployment is complete.</span></span>


<span data-ttu-id="ae5b0-108">このトピックでは、一連の Fabrikam, Inc. という架空の会社のエンタープライズ展開の要件に基づいているチュートリアルの一部を形成します。このチュートリアル シリーズは、サンプル ソリューションを使用して&#x2014;、[連絡先マネージャー ソリューション](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;現実的なレベルの ASP.NET MVC 3 アプリケーション、Windows の通信など、複雑な web アプリケーションを表すFoundation (WCF) サービスとデータベース プロジェクト。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-108">This topic forms part of a series of tutorials based around the enterprise deployment requirements of a fictional company named Fabrikam, Inc. This tutorial series uses a sample solution&#x2014;the [Contact Manager solution](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;to represent a web application with a realistic level of complexity, including an ASP.NET MVC 3 application, a Windows Communication Foundation (WCF) service, and a database project.</span></span>

<span data-ttu-id="ae5b0-109">これらのチュートリアルの中核の展開方法が分割のプロジェクト ファイルの方法で説明されているに基づいて[プロジェクト ファイルを理解する](../web-deployment-in-the-enterprise/understanding-the-project-file.md)、によって制御されるビルド プロセスでは、2 つのプロジェクト ファイル&#x2014;1 つを格納しています。すべての変換先の環境と環境固有のビルドと配置の設定を含む 1 つに適用される手順をビルドします。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-109">The deployment method at the heart of these tutorials is based on the split project file approach described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md), in which the build process is controlled by two project files&#x2014;one containing build instructions that apply to every destination environment, and one containing environment-specific build and deployment settings.</span></span> <span data-ttu-id="ae5b0-110">ビルド時に、環境固有のプロジェクト ファイルは、ビルド手順の完全なセットを形成する環境に依存しないプロジェクト ファイルにマージされます。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-110">At build time, the environment-specific project file is merged into the environment-agnostic project file to form a complete set of build instructions.</span></span>

## <a name="task-overview"></a><span data-ttu-id="ae5b0-111">タスクの概要</span><span class="sxs-lookup"><span data-stu-id="ae5b0-111">Task Overview</span></span>

<span data-ttu-id="ae5b0-112">多数のシナリオでは、データベースや web サービスなどの関連コンポーネントを変更するときに、web アプリケーションをオフラインにします。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-112">In a lot of scenarios, you'll want to take a web application offline while you make changes to related components, like databases or web services.</span></span> <span data-ttu-id="ae5b0-113">通常、IIS および ASP.NET では、そのために、という名前のファイルを配置する*アプリ\_offline.htm* IIS web サイトまたは web アプリケーションのルート フォルダーにします。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-113">Typically, in IIS and ASP.NET, you accomplish this by placing a file named *App\_offline.htm* in the root folder of the IIS website or web application.</span></span> <span data-ttu-id="ae5b0-114">*アプリ\_offline.htm*ファイルは、標準の HTML ファイルでありは、通常は、サイトはメンテナンスのため一時的に使用できないことをユーザーに忠告する単純なメッセージが含まれます。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-114">The *App\_offline.htm* file is a standard HTML file and will usually contain a simple message advising the user that the site is temporarily unavailable due to maintenance.</span></span> <span data-ttu-id="ae5b0-115">中に、*アプリ\_offline.htm* web サイトのルート フォルダーにファイルが存在する、IIS がファイルにすべての要求を自動的にリダイレクトされます。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-115">While the *App\_offline.htm* file exists in the root folder of the website, IIS will automatically redirect any requests to the file.</span></span> <span data-ttu-id="ae5b0-116">更新が完了したらを削除する、*アプリ\_offline.htm*ファイルと、web サイトは、通常どおり要求の処理が再開されます。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-116">When you've finished making updates, you remove the *App\_offline.htm* file and the website resumes serving requests as usual.</span></span>

<span data-ttu-id="ae5b0-117">ターゲット環境に自動またはシングル ステップの展開を実行する Web Deploy を使用するときは、追加と削除を組み込むことができます、*アプリ\_offline.htm*展開プロセスにファイル。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-117">When you use Web Deploy to perform automated or single-step deployments to a target environment, you may want to incorporate adding and removing the *App\_offline.htm* file into your deployment process.</span></span> <span data-ttu-id="ae5b0-118">これを行うには、これらの高度なタスクを完了する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-118">To do this, you'll need to complete these high-level tasks:</span></span>

- <span data-ttu-id="ae5b0-119">Microsoft Build Engine (MSBuild) プロジェクト ファイルで使用して MSBuild ターゲットを作成、展開プロセスを制御することをコピー、*アプリ\_offline.htm*任意の展開タスクの前に、移行先サーバーにファイル開始します。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-119">In the Microsoft Build Engine (MSBuild) project file that you use to control the deployment process, create an MSBuild target that copies an *App\_offline.htm* file to the destination server before any deployment tasks begin.</span></span>
- <span data-ttu-id="ae5b0-120">削除する別の MSBuild ターゲットを追加、*アプリ\_offline.htm*すべての展開タスクが完了したら、移行先サーバーからのファイル。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-120">Add another MSBuild target that removes the *App\_offline.htm* file from the destination server when all deployment tasks are complete.</span></span>
- <span data-ttu-id="ae5b0-121">Web アプリケーション プロジェクトで作成、 *. wpp.targets*によりファイル、*アプリ\_offline.htm*ファイルは、Web Deploy が呼び出されたときに、展開パッケージに追加されます。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-121">In the web application project, create a *.wpp.targets* file that ensures that an *App\_offline.htm* file is added to the deployment package when Web Deploy is invoked.</span></span>

<span data-ttu-id="ae5b0-122">このトピックでは、これらの手順を実行する方法を説明します。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-122">This topic will show you how to perform these procedures.</span></span> <span data-ttu-id="ae5b0-123">タスクとこのトピックの「チュートリアルを少なくとも 1 つの web アプリケーション プロジェクトを含むソリューションを既に作成していて、」の説明に従って、展開プロセスを制御するカスタムのプロジェクト ファイルを使用することを想定しています[の Web 展開、。エンタープライズ](../web-deployment-in-the-enterprise/web-deployment-in-the-enterprise.md)します。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-123">The tasks and walkthroughs in this topic assume that you've already created a solution that contains at least one web application project, and that you use a custom project file to control the deployment process as described in [Web Deployment in the Enterprise](../web-deployment-in-the-enterprise/web-deployment-in-the-enterprise.md).</span></span> <span data-ttu-id="ae5b0-124">また、使用することができます、 [Contact Manager](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)サンプル ソリューションのトピックで例を実行します。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-124">Alternatively, you can use the [Contact Manager](../web-deployment-in-the-enterprise/the-contact-manager-solution.md) sample solution to follow the examples in the topic.</span></span>

## <a name="adding-an-appoffline-file-to-a-web-application-project"></a><span data-ttu-id="ae5b0-125">アプリの追加\_オフライン ファイルを Web アプリケーション プロジェクト</span><span class="sxs-lookup"><span data-stu-id="ae5b0-125">Adding an App\_Offline File to a Web Application Project</span></span>

<span data-ttu-id="ae5b0-126">追加する最初のタスクを完了する必要があるは、*アプリ\_オフライン*ファイルを web アプリケーション プロジェクト。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-126">The first task you need to complete is to add an *App\_offline* file to your web application project:</span></span>

- <span data-ttu-id="ae5b0-127">ファイルが、開発プロセスに干渉するを防ぐために (完全にオフラインにするアプリケーションをたくない) を呼び出す必要があります、何か他にも*アプリ\_offline.htm*します。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-127">To prevent the file from interfering with the development process (you don't want your application to be permanently offline), you should call it something other than *App\_offline.htm*.</span></span> <span data-ttu-id="ae5b0-128">たとえば、ファイルを名前*アプリ\_オフライン template.htm*します。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-128">For example, you could name the file *App\_offline-template.htm*.</span></span>
- <span data-ttu-id="ae5b0-129">ファイルとしてデプロイされていることを防ぐためには、ビルド アクションを設定する必要があります**None**します。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-129">To prevent the file from being deployed as-is, you should set the build action to **None**.</span></span>

<span data-ttu-id="ae5b0-130">**アプリを追加する\_オフライン ファイルを web アプリケーション プロジェクト**</span><span class="sxs-lookup"><span data-stu-id="ae5b0-130">**To add an App\_offline file to a web application project**</span></span>

1. <span data-ttu-id="ae5b0-131">Visual Studio 2010 でソリューションを開きます。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-131">Open your solution in Visual Studio 2010.</span></span>
2. <span data-ttu-id="ae5b0-132">**ソリューション エクスプ ローラー**ウィンドウで、web アプリケーション プロジェクトを右クリックし、 をポイント**追加**、 をクリックし、**新しい項目の**します。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-132">In the **Solution Explorer** window, right-click your web application project, point to **Add**, and then click **New Item**.</span></span>
3. <span data-ttu-id="ae5b0-133">**新しい項目の追加**ダイアログ ボックスで、 **HTML ページ**します。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-133">In the **Add New Item** dialog box, select **HTML Page**.</span></span>
4. <span data-ttu-id="ae5b0-134">**名前**ボックスに「**アプリ\_template.htm オフライン** をクリックし、**追加**します。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-134">In the **Name** box, type **App\_offline-template.htm**, and then click **Add**.</span></span>

    ![](taking-web-applications-offline-with-web-deploy/_static/image1.png)
5. <span data-ttu-id="ae5b0-135">アプリケーションが使用できないことをユーザーに通知する簡単な HTML を追加し、ファイルを保存します。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-135">Add some simple HTML to inform users that the application is unavailable, and then save the file.</span></span> <span data-ttu-id="ae5b0-136">サーバー側のタグを含めないでください (たとえば、任意のタグが付いている"asp:")。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-136">Do not include any server-side tags (for example, any tags that are prefixed with "asp:").</span></span> 

    ![](taking-web-applications-offline-with-web-deploy/_static/image2.png)
6. <span data-ttu-id="ae5b0-137">**ソリューション エクスプ ローラー**ウィンドウで、新しいファイルを右クリックし、順にクリックします**プロパティ**します。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-137">In the **Solution Explorer** window, right-click the new file, and then click **Properties**.</span></span>
7. <span data-ttu-id="ae5b0-138">**プロパティ**ウィンドウで、**ビルド アクション**行で、 **None**します。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-138">In the **Properties** window, in the **Build Action** row, select **None**.</span></span>

    ![](taking-web-applications-offline-with-web-deploy/_static/image3.png)

## <a name="deploying-and-deleting-an-appoffline-file"></a><span data-ttu-id="ae5b0-139">展開して、アプリの削除\_オフライン ファイル</span><span class="sxs-lookup"><span data-stu-id="ae5b0-139">Deploying and Deleting an App\_Offline File</span></span>

<span data-ttu-id="ae5b0-140">次の手順では、展開プロセスの開始時、移行先サーバーにファイルをコピーし、最後に削除して、デプロイ ロジックを変更します。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-140">The next step is to modify your deployment logic to copy the file to the destination server at the start of the deployment process and remove it at the end.</span></span>

> [!NOTE]
> <span data-ttu-id="ae5b0-141">次の手順を使用しているカスタム MSBuild プロジェクト ファイルをデプロイ プロセスを制御する」の説明に従って前提としています。[プロジェクト ファイルを理解する](../web-deployment-in-the-enterprise/understanding-the-project-file.md)します。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-141">The next procedure assumes that you're using a custom MSBuild project file to control your deployment process, as described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md).</span></span> <span data-ttu-id="ae5b0-142">Visual Studio から直接デプロイする場合、は、別のアプローチを使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-142">If you're deploying direct from Visual Studio, you'll need to use a different approach.</span></span> <span data-ttu-id="ae5b0-143">Sayed Ibrahim Hashimi で 1 つの方法を説明する[かかる Your Web App オフライン中に公開する方法](http://sedodream.com/2012/01/08/HowToTakeYourWebAppOfflineDuringPublishing.aspx)します。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-143">Sayed Ibrahim Hashimi describes one such approach in [How to Take Your Web App Offline During Publishing](http://sedodream.com/2012/01/08/HowToTakeYourWebAppOfflineDuringPublishing.aspx).</span></span>


<span data-ttu-id="ae5b0-144">展開する、*アプリ\_オフライン*ファイル変換先の IIS の web サイトに MSDeploy.exe を使用して呼び出す必要があります、 [Web Deploy **contentPath**プロバイダー](https://technet.microsoft.com/library/dd569034(WS.10).aspx)します。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-144">To deploy an *App\_offline* file to a destination IIS website, you need to invoke MSDeploy.exe using the [Web Deploy **contentPath** provider](https://technet.microsoft.com/library/dd569034(WS.10).aspx).</span></span> <span data-ttu-id="ae5b0-145">**ContentPath**プロバイダーは、サポートの物理ディレクトリのパスと IIS の web サイトまたはアプリケーションのパスの両方と、Visual Studio プロジェクトのフォルダーと IIS web アプリケーションの間のファイルを同期するための理想的な選択肢になります。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-145">The **contentPath** provider supports both physical directory paths and IIS website or application paths, which makes it the ideal choice for synchronizing a file between a Visual Studio project folder and an IIS web application.</span></span> <span data-ttu-id="ae5b0-146">ファイルを展開するには、MSDeploy コマンドのようにこのする必要があります。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-146">To deploy the file, your MSDeploy command should resemble this:</span></span>


[!code-console[Main](taking-web-applications-offline-with-web-deploy/samples/sample1.cmd)]


<span data-ttu-id="ae5b0-147">展開プロセスの最後に、接続先サイトから、ファイルを削除するには、MSDeploy コマンドのようにこのする必要があります。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-147">To remove the file from the destination site at the end of the deployment process, your MSDeploy command should resemble this:</span></span>


[!code-console[Main](taking-web-applications-offline-with-web-deploy/samples/sample2.cmd)]


<span data-ttu-id="ae5b0-148">ビルドと展開プロセスの一環としてこれらのコマンドを自動化するには、カスタム MSBuild プロジェクト ファイルに統合する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-148">To automate these commands as part of a build and deployment process, you need to integrate them into your custom MSBuild project file.</span></span> <span data-ttu-id="ae5b0-149">次の手順では、これを行う方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-149">The next procedure describes how to do this.</span></span>

<span data-ttu-id="ae5b0-150">**展開し、アプリを削除する\_オフライン ファイル**</span><span class="sxs-lookup"><span data-stu-id="ae5b0-150">**To deploy and delete an App\_offline file**</span></span>

1. <span data-ttu-id="ae5b0-151">Visual Studio 2010 で、デプロイ プロセスを制御する MSBuild プロジェクト ファイルを開きます。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-151">In Visual Studio 2010, open the MSBuild project file that controls your deployment process.</span></span> <span data-ttu-id="ae5b0-152">[Contact Manager](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)サンプル ソリューションでは、これは、 *Publish.proj*ファイル。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-152">In the [Contact Manager](../web-deployment-in-the-enterprise/the-contact-manager-solution.md) sample solution, this is the *Publish.proj* file.</span></span>
2. <span data-ttu-id="ae5b0-153">ルートに**プロジェクト**要素を新規作成**PropertyGroup**の変数を格納する要素、*アプリ\_オフライン*展開。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-153">In the root **Project** element, create a new **PropertyGroup** element to store variables for the *App\_offline* deployment:</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample3.xml)]
3. <span data-ttu-id="ae5b0-154">**ソース ルート**でプロパティが他の場所で定義されている、 *Publish.proj*ファイル。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-154">The **SourceRoot** property is defined elsewhere in the *Publish.proj* file.</span></span> <span data-ttu-id="ae5b0-155">現在のパスを基準とソース コンテンツのルート フォルダーの場所を示します&#x2014;の位置を基準、 *Publish.proj*ファイル。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-155">It indicates the location of the root folder for the source content relative to the current path&#x2014;in other words, relative to the location of the *Publish.proj* file.</span></span>
4. <span data-ttu-id="ae5b0-156">**ContentPath**デプロイする前に、ソース ファイルへの絶対パスを取得する必要があるためプロバイダーは相対ファイル パスを受け入れません。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-156">The **contentPath** provider will not accept relative file paths, so you need to get an absolute path to your source file before you can deploy it.</span></span> <span data-ttu-id="ae5b0-157">使用することができます、 [ConvertToAbsolutePath](https://msdn.microsoft.com/library/bb882668.aspx)これを行うタスクです。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-157">You can use the [ConvertToAbsolutePath](https://msdn.microsoft.com/library/bb882668.aspx) task to do this.</span></span>
5. <span data-ttu-id="ae5b0-158">新しい追加**ターゲット**という名前の要素**GetAppOfflineAbsolutePath**します。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-158">Add a new **Target** element named **GetAppOfflineAbsolutePath**.</span></span> <span data-ttu-id="ae5b0-159">このターゲットを使用して、 **ConvertToAbsolutePath**への絶対パスを取得するタスク、*アプリ\_テンプレート オフライン*プロジェクト フォルダー内のファイル。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-159">Within this target, use the **ConvertToAbsolutePath** task to get an absolute path to the *App\_offline-template* file in your project folder.</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample4.xml)]
6. <span data-ttu-id="ae5b0-160">このターゲットへの相対パスを受け取り、*アプリ\_テンプレート オフライン*プロジェクト フォルダー内のファイルに新しいプロパティを絶対ファイル パスとして保存します。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-160">This target takes the relative path to the *App\_offline-template* file in your project folder and saves it to a new property as an absolute file path.</span></span> <span data-ttu-id="ae5b0-161">**BeforeTargets**属性は、前に実行するには、このターゲットにすることを指定します、 **DeployAppOffline**ターゲットで、次の手順で作成します。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-161">The **BeforeTargets** attribute specifies that you want this target to execute before the **DeployAppOffline** target, which you'll create in the next step.</span></span>
7. <span data-ttu-id="ae5b0-162">という名前の新しいターゲットを追加**DeployAppOffline**します。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-162">Add a new target named **DeployAppOffline**.</span></span> <span data-ttu-id="ae5b0-163">このターゲット内でデプロイする MSDeploy.exe コマンドを呼び出す、*アプリ\_オフライン*ファイル変換先の web サーバーにします。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-163">Within this target, invoke the MSDeploy.exe command that deploys your *App\_offline* file to the destination web server.</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample5.xml)]
8. <span data-ttu-id="ae5b0-164">この例で、 **ContactManagerIisPath**プロパティがプロジェクト ファイルで他の場所で定義されています。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-164">In this example, the **ContactManagerIisPath** property is defined elsewhere in the project file.</span></span> <span data-ttu-id="ae5b0-165">これは、単に、IIS アプリケーション パス、フォームで *[IIS web サイト名]/[アプリケーション名]* します。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-165">This is simply an IIS application path, in the form *[IIS Website Name]/[Application Name]*.</span></span> <span data-ttu-id="ae5b0-166">ターゲットの条件を含めることができますを切り替える、*アプリ\_オフライン*プロパティ値を変更またはコマンド ライン パラメーターを提供することによって展開をオンまたはオフ。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-166">Including a condition in the target enables users to switch the *App\_offline* deployment on or off by changing a property value or providing a command-line parameter.</span></span>
9. <span data-ttu-id="ae5b0-167">という名前の新しいターゲットを追加**DeleteAppOffline**します。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-167">Add a new target named **DeleteAppOffline**.</span></span> <span data-ttu-id="ae5b0-168">このターゲット内で削除する MSDeploy.exe コマンドを呼び出す、*アプリ\_オフライン*送信先の web サーバーからのファイル。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-168">Within this target, invoke the MSDeploy.exe command that removes your *App\_offline* file from the destination web server.</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample6.xml)]
10. <span data-ttu-id="ae5b0-169">最後のタスクでは、プロジェクト ファイルの実行中に適切な時点でこれらの新しいターゲットを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-169">The final task is to invoke these new targets at appropriate points during the execution of your project file.</span></span> <span data-ttu-id="ae5b0-170">これは、さまざまな方法で行うことができます。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-170">You can do this in various ways.</span></span> <span data-ttu-id="ae5b0-171">たとえば、 *Publish.proj*ファイル、 **FullPublishDependsOn**プロパティを実行する必要があるターゲットの一覧を指定しますで注文するときに、 **FullPublish**既定ターゲットが呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-171">For example, in the *Publish.proj* file, the **FullPublishDependsOn** property specifies a list of targets that must be executed in order when the **FullPublish** default target is invoked.</span></span>
11. <span data-ttu-id="ae5b0-172">呼び出す MSBuild プロジェクト ファイルを変更、 **DeployAppOffline**と**DeleteAppOffline**パブリッシュ処理に適切な時点でのターゲット。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-172">Modify your MSBuild project file to invoke the **DeployAppOffline** and **DeleteAppOffline** targets at appropriate points in the publishing process.</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample7.xml)]

<span data-ttu-id="ae5b0-173">カスタム MSBuild プロジェクト ファイルを実行すると、*アプリ\_オフライン*ファイルは、ビルドの成功後すぐに、サーバーに配置されます。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-173">When you run your custom MSBuild project file, the *App\_offline* file will be deployed to the server immediately after a successful build.</span></span> <span data-ttu-id="ae5b0-174">削除されます、サーバーからすべての展開タスクが完了します。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-174">It will then be deleted from the server once all the deployment tasks are complete.</span></span>

## <a name="adding-an-appoffline-file-to-deployment-packages"></a><span data-ttu-id="ae5b0-175">アプリの追加\_の展開パッケージにオフライン ファイル</span><span class="sxs-lookup"><span data-stu-id="ae5b0-175">Adding an App\_Offline File to Deployment Packages</span></span>

<span data-ttu-id="ae5b0-176">デプロイの構成方法に応じて、既存の IIS の転送先にコンテンツ web アプリケーション&#x2014;など、*アプリ\_offline.htm*ファイル&#x2014;web を展開するときに自動的に削除することがあります先にパッケージします。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-176">Depending on how you configure your deployment, any existing content at the destination IIS web application&#x2014;like the *App\_offline.htm* file&#x2014;may be deleted automatically when you deploy a web package to the destination.</span></span> <span data-ttu-id="ae5b0-177">いることを確認する、*アプリ\_offline.htm*ファイルは、デプロイ時間の場所には、さらに、ファイルの先頭に直接展開する web デプロイ パッケージ自体内でファイルを含める必要があります。展開するプロセス。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-177">To ensure that the *App\_offline.htm* file remains in place for the duration of the deployment, you need to include the file within the web deployment package itself in addition to deploying the file directly at the start of the deployment process.</span></span>

- <span data-ttu-id="ae5b0-178">かどうか、このトピックで前のタスクに従った、なりましたね、*アプリ\_offline.htm*ファイルを別のファイル名の下で web アプリケーション プロジェクト (を使用して*アプリ\_オフライン template.htm*) ビルド アクションを設定したが**None**します。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-178">If you've followed the previous tasks in this topic, you'll have added the *App\_offline.htm* file to your web application project under a different filename (we used *App\_offline-template.htm*) and you'll have set the build action to **None**.</span></span> <span data-ttu-id="ae5b0-179">これらの変更は、開発に干渉することと、デバッグからファイルを防ぐために必要です。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-179">These changes are necessary to prevent the file from interfering with development and debugging.</span></span> <span data-ttu-id="ae5b0-180">その結果、いることを確認するパッケージ化プロセスをカスタマイズする必要があります、*アプリ\_offline.htm*ファイルが web デプロイ パッケージに含まれています。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-180">As a result, you need to customize the packaging process to ensure that the *App\_offline.htm* file is included in the web deployment package.</span></span>

<span data-ttu-id="ae5b0-181">Web 発行パイプライン (WPP) という項目一覧を使用して**FilesForPackagingFromProject** web 展開パッケージに含める必要があるファイルの一覧を作成します。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-181">The Web Publishing Pipeline (WPP) uses an item list named **FilesForPackagingFromProject** to build a list of files that should be included in the web deployment package.</span></span> <span data-ttu-id="ae5b0-182">Web パッケージの内容をカスタマイズするには、この一覧に、独自の項目を追加します。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-182">You can customize the contents of your web packages by adding your own items to this list.</span></span> <span data-ttu-id="ae5b0-183">これを行うには、これらの大まかな手順を完了する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-183">To do this, you need to complete these high-level steps:</span></span>

1. <span data-ttu-id="ae5b0-184">という名前のカスタム プロジェクト ファイルを作成する *[プロジェクト名].wpp.targets*プロジェクト ファイルと同じフォルダーにします。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-184">Create a custom project file named *[project name].wpp.targets* in the same folder as your project file.</span></span>

    > [!NOTE]
    > <span data-ttu-id="ae5b0-185">*. Wpp.targets*ファイルは、web アプリケーション プロジェクト ファイルと同じフォルダーに移動する必要がある&#x2014;など*ContactManager.Mvc.csproj*&#x2014;任意のカスタムと同じフォルダー内ではなくプロジェクト ファイルを使用して、ビルドおよび展開プロセスを制御します。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-185">The *.wpp.targets* file needs to go in the same folder as your web application project file&#x2014;for example, *ContactManager.Mvc.csproj*&#x2014;rather than in the same folder as any custom project files you use to control the build and deployment process.</span></span>
2. <span data-ttu-id="ae5b0-186">*. Wpp.targets*ファイルで実行される新しい MSBuild ターゲットを作成する*する前に*、 **CopyAllFilesToSingleFolderForPackage**ターゲット。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-186">In the *.wpp.targets* file, create a new MSBuild target that executes *before* the **CopyAllFilesToSingleFolderForPackage** target.</span></span> <span data-ttu-id="ae5b0-187">これは、パッケージに含める項目の一覧をビルドする WPP ターゲットです。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-187">This is the WPP target that builds a list of things to include in the package.</span></span>
3. <span data-ttu-id="ae5b0-188">新しいターゲットを作成、 **ItemGroup**要素。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-188">In the new target, create an **ItemGroup** element.</span></span>
4. <span data-ttu-id="ae5b0-189">**ItemGroup**要素を追加、 **FilesForPackagingFromProject**を指定し、*アプリ\_offline.htm*ファイル。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-189">In the **ItemGroup** element, add a **FilesForPackagingFromProject** item and specify the *App\_offline.htm* file.</span></span>

<span data-ttu-id="ae5b0-190">*. Wpp.targets*このファイルのようになります。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-190">The *.wpp.targets* file should resemble this:</span></span>


[!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample8.xml)]


<span data-ttu-id="ae5b0-191">この例での重要な点を次に示します。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-191">These are the key points of note in this example:</span></span>

- <span data-ttu-id="ae5b0-192">**BeforeTargets**属性内の直前に実行するかを指定することによって、WPP にこのターゲットの挿入、 **CopyAllFilesToSingleFolderForPackage**ターゲット。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-192">The **BeforeTargets** attribute inserts this target into the WPP by specifying that it should be executed immediately before the **CopyAllFilesToSingleFolderForPackage** target.</span></span>
- <span data-ttu-id="ae5b0-193">**FilesForPackagingFromProject**項目は、 **DestinationRelativePath**からファイルの名前を変更するメタデータ値*アプリ\_オフライン template.htm**アプリ\_offline.htm*ように、一覧に追加されます。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-193">The **FilesForPackagingFromProject** item uses the **DestinationRelativePath** metadata value to rename the file from *App\_offline-template.htm* to *App\_offline.htm* as it's added to the list.</span></span>

<span data-ttu-id="ae5b0-194">次の手順は、これを追加する方法を示します *. wpp.targets*ファイルを web アプリケーション プロジェクト。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-194">The next procedure shows you how to add this *.wpp.targets* file to a web application project.</span></span>

<span data-ttu-id="ae5b0-195">**追加する、です web 展開パッケージに wpp.targets ファイル。**</span><span class="sxs-lookup"><span data-stu-id="ae5b0-195">**To add a .wpp.targets file to a web deployment package**</span></span>

1. <span data-ttu-id="ae5b0-196">Visual Studio 2010 でソリューションを開きます。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-196">Open your solution in Visual Studio 2010.</span></span>
2. <span data-ttu-id="ae5b0-197">**ソリューション エクスプ ローラー**ウィンドウで、web アプリケーションのプロジェクト ノードを右クリックして (たとえば、 **ContactManager.Mvc**)、 をポイント**追加**をクリックして**新しい項目の**します。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-197">In the **Solution Explorer** window, right-click your web application project node (for example, **ContactManager.Mvc**), point to **Add**, and then click **New Item**.</span></span>
3. <span data-ttu-id="ae5b0-198">**新しい項目の追加**ダイアログ ボックスで、 **XML ファイル**テンプレート。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-198">In the **Add New Item** dialog box, select the **XML File** template.</span></span>
4. <span data-ttu-id="ae5b0-199">**名前**ボックスに「 *[プロジェクト名] * * *.wpp.targets** (たとえば、 **ContactManager.Mvc.wpp.targets**) 順にクリックします**追加**.</span><span class="sxs-lookup"><span data-stu-id="ae5b0-199">In the **Name** box, type *[project name]***.wpp.targets** (for example, **ContactManager.Mvc.wpp.targets**), and then click **Add**.</span></span>

    ![](taking-web-applications-offline-with-web-deploy/_static/image4.png)

    > [!NOTE]
    > <span data-ttu-id="ae5b0-200">プロジェクトのルート ノードに新しい項目を追加する場合は、プロジェクト ファイルと同じフォルダーにファイルが作成されます。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-200">If you add a new item to the root node of a project, the file is created in the same folder as the project file.</span></span> <span data-ttu-id="ae5b0-201">これは、Windows エクスプ ローラーでフォルダーを開くことで確認できます。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-201">You can verify this by opening the folder in Windows Explorer.</span></span>
5. <span data-ttu-id="ae5b0-202">ファイルで、前に説明した MSBuild マークアップを追加します。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-202">In the file, add the MSBuild markup described previously.</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample9.xml)]
6. <span data-ttu-id="ae5b0-203">保存して閉じます、 *[プロジェクト名].wpp.targets*ファイル。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-203">Save and close the *[project name].wpp.targets* file.</span></span>

<span data-ttu-id="ae5b0-204">次回ビルドとパッケージ、web アプリケーション プロジェクト、WPP を自動的に検出、 *. wpp.targets*ファイル。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-204">The next time you build and package your web application project, the WPP will automatically detect the *.wpp.targets* file.</span></span> <span data-ttu-id="ae5b0-205">*アプリ\_オフライン template.htm*ファイルとして生成される web デプロイ パッケージに含めるは*アプリ\_offline.htm*します。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-205">The *App\_offline-template.htm* file will be included in the resulting web deployment package as *App\_offline.htm*.</span></span>

> [!NOTE]
> <span data-ttu-id="ae5b0-206">デプロイが失敗した場合、*アプリ\_offline.htm*ファイルが配置に保持され、アプリケーションがオフラインのままにします。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-206">If your deployment fails, the *App\_offline.htm* file will remain in place and your application will remain offline.</span></span> <span data-ttu-id="ae5b0-207">これは、通常、目的の動作です。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-207">This is typically the desired behavior.</span></span> <span data-ttu-id="ae5b0-208">アプリケーションをオンラインに戻す、削除して、*アプリ\_offline.htm* web サーバーからのファイル。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-208">To bring your application back online, you can delete the *App\_offline.htm* file from your web server.</span></span> <span data-ttu-id="ae5b0-209">また、エラーを修正して、展開を成功させるを実行する場合、*アプリ\_offline.htm*ファイルは削除されます。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-209">Alternatively, if you correct any errors and run a successful deployment, the *App\_offline.htm* file will be removed.</span></span>


## <a name="conclusion"></a><span data-ttu-id="ae5b0-210">まとめ</span><span class="sxs-lookup"><span data-stu-id="ae5b0-210">Conclusion</span></span>

<span data-ttu-id="ae5b0-211">このトピックにパブリッシュすることによって、展開の期間の web アプリケーションをオフラインを実行する方法が説明されている、*アプリ\_offline.htm*削除することで、展開プロセスの開始時、移行先サーバーにファイルを開き、終わり。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-211">This topic described how to take a web application offline for the duration of a deployment, by publishing an *App\_offline.htm* file to the destination server at the start of the deployment process and removing it at the end.</span></span> <span data-ttu-id="ae5b0-212">含める方法についても説明、*アプリ\_offline.htm* web 展開パッケージ内のファイル。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-212">It also covered how to include an *App\_offline.htm* file in a web deployment package.</span></span>

## <a name="further-reading"></a><span data-ttu-id="ae5b0-213">関連項目</span><span class="sxs-lookup"><span data-stu-id="ae5b0-213">Further Reading</span></span>

<span data-ttu-id="ae5b0-214">パッケージ化と展開プロセスの詳細については、次を参照してください[のビルドとパッケージ化 Web Application Projects](../web-deployment-in-the-enterprise/building-and-packaging-web-application-projects.md)、 [Web パッケージ展開の構成パラメーター](../web-deployment-in-the-enterprise/configuring-parameters-for-web-package-deployment.md)、および[。Web パッケージを展開する](../web-deployment-in-the-enterprise/deploying-web-packages.md)します。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-214">For more information on the packaging and deployment process, see [Building and Packaging Web Application Projects](../web-deployment-in-the-enterprise/building-and-packaging-web-application-projects.md), [Configuring Parameters for Web Package Deployment](../web-deployment-in-the-enterprise/configuring-parameters-for-web-package-deployment.md), and [Deploying Web Packages](../web-deployment-in-the-enterprise/deploying-web-packages.md).</span></span>

<span data-ttu-id="ae5b0-215">これらのチュートリアルで説明されているカスタム MSBuild プロジェクト ファイル手法を使用して、発行時に、アプリケーションをオフラインに少し異なる方法を使用する必要がありますのではなく、Visual Studio から直接 web アプリケーションを発行する場合プロセスです。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-215">If you publish your web applications directly from Visual Studio, rather than using the custom MSBuild project file approach described in these tutorials, you'll need to use a slightly different approach to take your application offline during the publishing process.</span></span> <span data-ttu-id="ae5b0-216">詳細については、次を参照してください。[発行時に、web アプリをオフラインを実行する](https://go.microsoft.com/?linkid=9805135)(ブログの投稿)。</span><span class="sxs-lookup"><span data-stu-id="ae5b0-216">For more information, see [How to take your web app offline during publishing](https://go.microsoft.com/?linkid=9805135) (blog post).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="ae5b0-217">[前へ](excluding-files-and-folders-from-deployment.md)
> [次へ](running-windows-powershell-scripts-from-msbuild-project-files.md)</span><span class="sxs-lookup"><span data-stu-id="ae5b0-217">[Previous](excluding-files-and-folders-from-deployment.md)
[Next](running-windows-powershell-scripts-from-msbuild-project-files.md)</span></span>
