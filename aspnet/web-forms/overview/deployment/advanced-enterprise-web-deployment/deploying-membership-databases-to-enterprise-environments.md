---
uid: web-forms/overview/deployment/advanced-enterprise-web-deployment/deploying-membership-databases-to-enterprise-environments
title: エンタープライズ環境にメンバーシップ データベースを展開する |Microsoft Docs
author: jrjlee
description: このトピックでは、重要な考慮事項と課題の克服 ASP.NET アプリケーション サービス データベース (の一般的な... をプロビジョニングするときにする必要がありますについて説明します。
ms.author: aspnetcontent
manager: wpickett
ms.date: 05/04/2012
ms.topic: article
ms.assetid: 3cf765df-d311-4f68-a295-c9685ceea830
ms.technology: dotnet-webforms
msc.legacyurl: /web-forms/overview/deployment/advanced-enterprise-web-deployment/deploying-membership-databases-to-enterprise-environments
msc.type: authoredcontent
ms.openlocfilehash: 432951b54fc7cc6b0384dfb4dbd255b16a546e76
ms.sourcegitcommit: 953ff9ea4369f154d6fd0239599279ddd3280009
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/03/2018
ms.locfileid: "37370336"
---
<a name="deploying-membership-databases-to-enterprise-environments"></a><span data-ttu-id="87a9a-103">エンタープライズ環境にメンバーシップ データベースを展開します。</span><span class="sxs-lookup"><span data-stu-id="87a9a-103">Deploying Membership Databases to Enterprise Environments</span></span>
====================
<span data-ttu-id="87a9a-104">によって[Jason Lee](https://github.com/jrjlee)</span><span class="sxs-lookup"><span data-stu-id="87a9a-104">by [Jason Lee](https://github.com/jrjlee)</span></span>

[<span data-ttu-id="87a9a-105">PDF のダウンロード</span><span class="sxs-lookup"><span data-stu-id="87a9a-105">Download PDF</span></span>](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> <span data-ttu-id="87a9a-106">このトピックでは、重要な考慮事項と課題の克服とテスト、ステージング、または実稼働環境では、(より一般的にはメンバーシップ データベースと呼ばれる) データベースのサービスの ASP.NET アプリケーションを準備する必要がありますについて説明します。</span><span class="sxs-lookup"><span data-stu-id="87a9a-106">This topic explains the key considerations and challenges you'll need to overcome when you provision ASP.NET application services databases (more commonly referred to as membership databases) in test, staging, or production environments.</span></span> <span data-ttu-id="87a9a-107">これらの課題を満たすために使用できる方法も説明します。</span><span class="sxs-lookup"><span data-stu-id="87a9a-107">It also describes approaches you can use to meet these challenges.</span></span>


<span data-ttu-id="87a9a-108">このトピックでは、一連の Fabrikam, Inc. という架空の会社のエンタープライズ展開の要件に基づいているチュートリアルの一部を形成します。このチュートリアル シリーズは、サンプル ソリューションを使用して&#x2014;、[連絡先マネージャー ソリューション](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;現実的なレベルの ASP.NET MVC 3 アプリケーション、Windows の通信など、複雑な web アプリケーションを表すFoundation (WCF) サービスとデータベース プロジェクト。</span><span class="sxs-lookup"><span data-stu-id="87a9a-108">This topic forms part of a series of tutorials based around the enterprise deployment requirements of a fictional company named Fabrikam, Inc. This tutorial series uses a sample solution&#x2014;the [Contact Manager solution](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;to represent a web application with a realistic level of complexity, including an ASP.NET MVC 3 application, a Windows Communication Foundation (WCF) service, and a database project.</span></span>

<span data-ttu-id="87a9a-109">これらのチュートリアルの中核の展開方法が分割のプロジェクト ファイルの方法で説明されているに基づいて[プロジェクト ファイルを理解する](../web-deployment-in-the-enterprise/understanding-the-project-file.md)、によって制御されるビルド プロセスでは、2 つのプロジェクト ファイル&#x2014;1 つを格納しています。すべての変換先の環境と環境固有のビルドと配置の設定を含む 1 つに適用される手順をビルドします。</span><span class="sxs-lookup"><span data-stu-id="87a9a-109">The deployment method at the heart of these tutorials is based on the split project file approach described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md), in which the build process is controlled by two project files&#x2014;one containing build instructions that apply to every destination environment, and one containing environment-specific build and deployment settings.</span></span> <span data-ttu-id="87a9a-110">ビルド時に、環境固有のプロジェクト ファイルは、ビルド手順の完全なセットを形成する環境に依存しないプロジェクト ファイルにマージされます。</span><span class="sxs-lookup"><span data-stu-id="87a9a-110">At build time, the environment-specific project file is merged into the environment-agnostic project file to form a complete set of build instructions.</span></span>

## <a name="what-are-the-issues-when-you-deploy-a-membership-database"></a><span data-ttu-id="87a9a-111">メンバーシップ データベースを展開するときに問題は何ですか。</span><span class="sxs-lookup"><span data-stu-id="87a9a-111">What Are the Issues When You Deploy a Membership Database?</span></span>

<span data-ttu-id="87a9a-112">ほとんどの場合、データベースでは、展開戦略を立てるときにまず検討する必要があるがどのようなデータを展開します。</span><span class="sxs-lookup"><span data-stu-id="87a9a-112">In most cases, when you devise a deployment strategy for a database, the first thing you need to consider is what data you want to deploy.</span></span> <span data-ttu-id="87a9a-113">開発またはテスト環境を迅速かつ簡単にテストを容易にするユーザー アカウントのデータを展開する場合があります。</span><span class="sxs-lookup"><span data-stu-id="87a9a-113">In a development or test environment, you might want to deploy user account data to facilitate quick and easy testing.</span></span> <span data-ttu-id="87a9a-114">ステージング環境または運用環境では、多くのユーザー アカウントのデータを展開することはありません。</span><span class="sxs-lookup"><span data-stu-id="87a9a-114">In a staging or production environment, it's very unlikely that you'd want to deploy user account data.</span></span>

<span data-ttu-id="87a9a-115">残念ながら、ASP.NET メンバーシップ データベースは、もっと複雑なを決定するいくつかの特定の課題を導入します。</span><span class="sxs-lookup"><span data-stu-id="87a9a-115">Unfortunately, ASP.NET membership databases introduce some specific challenges that make this decision a lot more complex:</span></span>

- <span data-ttu-id="87a9a-116">スキーマのみのデプロイメントは、非動作状態にメンバーシップ データベースに残ります。</span><span class="sxs-lookup"><span data-stu-id="87a9a-116">A schema-only deployment will leave the membership database in a non-operational state.</span></span> <span data-ttu-id="87a9a-117">これは、メンバーシップ データベースには、一部の構成データが含まれているため (で、 **aspnet\_SchemaVersions**テーブル)、データベースが機能するために必要とします。</span><span class="sxs-lookup"><span data-stu-id="87a9a-117">This is because the membership database includes some configuration data (in the **aspnet\_SchemaVersions** table) that the database requires in order to function.</span></span> <span data-ttu-id="87a9a-118">そのため、ユーザー アカウントのデータを除外するために、メンバーシップ データベースのスキーマのみのデプロイを実行すると、重要な構成データを追加する配置後スクリプトを実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="87a9a-118">As such, if you perform a schema-only deployment of your membership database in order to exclude user account data, you'll need to run a post-deployment script to add the essential configuration data.</span></span>
- <span data-ttu-id="87a9a-119">メンバーシップ データベースの構成方法に応じてメンバーシップ プロバイダーはマシン キーを使用してパスワードを暗号化し、データベース内に格納する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="87a9a-119">Depending on how your membership database is configured, the membership provider may use the machine key to encrypt passwords and store them in the database.</span></span> <span data-ttu-id="87a9a-120">この場合、データベースを展開するすべてのユーザー アカウント データは移行先サーバーで使用できなくなります。</span><span class="sxs-lookup"><span data-stu-id="87a9a-120">In this case, any user account data you deploy with the database will become unusable on the destination server.</span></span> <span data-ttu-id="87a9a-121">このため、ユーザー アカウントのデータを展開するシナリオはサポートではありません。</span><span class="sxs-lookup"><span data-stu-id="87a9a-121">For this reason, deploying user account data is not a supported scenario.</span></span>

## <a name="choosing-a-membership-database-strategy"></a><span data-ttu-id="87a9a-122">メンバーシップ データベース ストラテジの選択</span><span class="sxs-lookup"><span data-stu-id="87a9a-122">Choosing a Membership Database Strategy</span></span>

<span data-ttu-id="87a9a-123">エンタープライズ サーバー環境でメンバーシップ データベースをプロビジョニングする方法を選択すると、次のガイドラインを使用します。</span><span class="sxs-lookup"><span data-stu-id="87a9a-123">Use these guidelines when you choose how to provision a membership database in an enterprise server environment:</span></span>

- <span data-ttu-id="87a9a-124">可能な場合は、メンバーシップ データベースを展開しないでください。</span><span class="sxs-lookup"><span data-stu-id="87a9a-124">Wherever possible, do not deploy membership databases.</span></span> <span data-ttu-id="87a9a-125">代わりに、ターゲット データベースのサーバーでメンバーシップ データベースを手動で作成します。</span><span class="sxs-lookup"><span data-stu-id="87a9a-125">Instead, create the membership database manually on the target database server.</span></span> <span data-ttu-id="87a9a-126">メンバーシップ データベース スキーマをカスタマイズしていない場合だけを作成、新しく situ でを使用して、変換先で、 [ASP.NET SQL Server の登録ツール (aspnet\_regsql.exe)](https://msdn.microsoft.com/library/ms229862(v=vs.100).aspx)します。</span><span class="sxs-lookup"><span data-stu-id="87a9a-126">If you haven't customized your membership database schema, you can simply create a new one in situ at the destination using the [ASP.NET SQL Server Registration Tool (aspnet\_regsql.exe)](https://msdn.microsoft.com/library/ms229862(v=vs.100).aspx).</span></span>
- <span data-ttu-id="87a9a-127">メンバーシップ データベースを展開するオプションがない場合&#x2014;例では、データベース スキーマに大幅な変更を行った場合の&#x2014;ユーザー アカウントのデータを除外する、メンバーシップ データベースのスキーマのみのデプロイを実行する必要があり、必要な構成データを追加する配置後スクリプトを実行します。</span><span class="sxs-lookup"><span data-stu-id="87a9a-127">If you have no option but to deploy a membership database&#x2014;for example, if you've made extensive modifications to the database schema&#x2014;you should perform a schema-only deployment of the membership database, to exclude user account data, and then run a post-deployment script to add any required configuration data.</span></span> <span data-ttu-id="87a9a-128">これらのアプローチで、広範なガイダンスを確認できます[方法: ASP.NET メンバーシップ データベースなしを含むユーザー アカウントをデプロイ](https://msdn.microsoft.com/library/ff361972(v=vs.100).aspx)します。</span><span class="sxs-lookup"><span data-stu-id="87a9a-128">You can find broad guidance on these approaches in [How to: Deploy the ASP.NET Membership Database Without Including User Accounts](https://msdn.microsoft.com/library/ff361972(v=vs.100).aspx).</span></span>

<span data-ttu-id="87a9a-129">注意することが重要 *、メンバーシップ データベースのスキーマが非常に静的なある可能性があります*します。</span><span class="sxs-lookup"><span data-stu-id="87a9a-129">It's important to remember that *the schema of your membership database is likely to be fairly static*.</span></span> <span data-ttu-id="87a9a-130">可能性を定期的にスキーマを更新する必要がありますがない場合でも、メンバーシップ データベースをカスタマイズして&#x2014;web アプリケーションまたはデータベース プロジェクト内のコードと同じ頻度で変更することがないです。</span><span class="sxs-lookup"><span data-stu-id="87a9a-130">Even if you've customized the membership database, it's unlikely that you'll need to update the schema on a regular basis&#x2014;it's not going to change with the same frequency as the code in a web application or a database project.</span></span> <span data-ttu-id="87a9a-131">そのため、自動またはシングル ステップの展開プロセスにメンバーシップ データベースを含める必要はありません。</span><span class="sxs-lookup"><span data-stu-id="87a9a-131">As such, you shouldn't need to include the membership database in any automated or single-step deployment processes.</span></span>

## <a name="using-vsdbcmd-to-update-a-membership-database-schema"></a><span data-ttu-id="87a9a-132">VSDBCMD を使用して、メンバーシップ データベース スキーマを更新するには</span><span class="sxs-lookup"><span data-stu-id="87a9a-132">Using VSDBCMD to Update a Membership Database Schema</span></span>

<span data-ttu-id="87a9a-133">最初のデプロイ後に、メンバーシップ データベースの構造を変更する場合、データベースを再デプロイする (Web 配置) インターネット インフォメーション サービス (IIS) Web 配置ツールを使用する可能性がありますされません。</span><span class="sxs-lookup"><span data-stu-id="87a9a-133">If you modify the structure of your membership database after your first deployment, you may not want to use the Internet Information Services (IIS) Web Deployment Tool (Web Deploy) to redeploy the database.</span></span> <span data-ttu-id="87a9a-134">Web 配置でデータベースのデプロイ機能には、移行先データベース差分更新を実行する機能は含まれません&#x2014;代わりに、Web 配置する必要があります削除し、データベースを再作成します。</span><span class="sxs-lookup"><span data-stu-id="87a9a-134">The database deployment functionality in Web Deploy doesn't include the capability to make differential updates to a destination database&#x2014;instead, Web Deploy must drop and re-create the database.</span></span> <span data-ttu-id="87a9a-135">これは、既存のユーザー アカウントのデータはステージング環境または運用環境で通常は望ましくないが失われることを意味します。</span><span class="sxs-lookup"><span data-stu-id="87a9a-135">This means that you lose any existing user account data, which is typically undesirable in staging or production environments.</span></span>

<span data-ttu-id="87a9a-136">代わりに、VSDBCMD ユーティリティを使用して、転送先データベースのスキーマを更新することです。</span><span class="sxs-lookup"><span data-stu-id="87a9a-136">The alternative is to use the VSDBCMD utility to update the schema of your destination database.</span></span> <span data-ttu-id="87a9a-137">VSDBCMD には、2 つの重要な機能が含まれています。</span><span class="sxs-lookup"><span data-stu-id="87a9a-137">VSDBCMD includes two important capabilities.</span></span> <span data-ttu-id="87a9a-138">まず、.dbschema ファイルに既存のデータベースのスキーマをインポートできます。</span><span class="sxs-lookup"><span data-stu-id="87a9a-138">First, it can import the schema of an existing database into a .dbschema file.</span></span> <span data-ttu-id="87a9a-139">次に、つまりのみ変更があったとき、ターゲット データベースの最新の状態のために必要なすべてのデータが失われないと差分の更新プログラムとして .dbschema ファイルを既存のデータベースにデプロイできます。</span><span class="sxs-lookup"><span data-stu-id="87a9a-139">Second, it can deploy a .dbschema file to an existing database as a differential update, which means that it only makes the changes required to bring the target database up to date and you don't lose any data.</span></span>

<span data-ttu-id="87a9a-140">これらの大まかな手順を使用するにはメンバーシップ データベース スキーマを更新します。</span><span class="sxs-lookup"><span data-stu-id="87a9a-140">You can use these high-level steps to update a membership database schema:</span></span>

1. <span data-ttu-id="87a9a-141">VSDBCMD を使用して、**インポート**ソース メンバーシップ データベースの .dbschema ファイルを生成するアクション。</span><span class="sxs-lookup"><span data-stu-id="87a9a-141">Use the VSDBCMD **Import** action to generate a .dbschema file for your source membership database.</span></span> <span data-ttu-id="87a9a-142">この手順で説明されて[方法: コマンド プロンプトからスキーマをインポート](https://msdn.microsoft.com/library/dd172135.aspx)します。</span><span class="sxs-lookup"><span data-stu-id="87a9a-142">This procedure is described in [How to: Import a Schema from a Command Prompt](https://msdn.microsoft.com/library/dd172135.aspx).</span></span>
2. <span data-ttu-id="87a9a-143">VSDBCMD を使用して、**デプロイ**先メンバーシップ データベースに .dbschema ファイルを展開するアクション。</span><span class="sxs-lookup"><span data-stu-id="87a9a-143">Use the VSDBCMD **Deploy** action to deploy the .dbschema file to your destination membership database.</span></span> <span data-ttu-id="87a9a-144">この手順で説明されて[VSDBCMD のコマンド ライン リファレンス。EXE (展開およびスキーマのインポート)](https://msdn.microsoft.com/library/dd193283.aspx)します。</span><span class="sxs-lookup"><span data-stu-id="87a9a-144">This procedure is described in [Command-Line Reference for VSDBCMD.EXE (Deployment and Schema Import)](https://msdn.microsoft.com/library/dd193283.aspx).</span></span>

## <a name="conclusion"></a><span data-ttu-id="87a9a-145">まとめ</span><span class="sxs-lookup"><span data-stu-id="87a9a-145">Conclusion</span></span>

<span data-ttu-id="87a9a-146">このトピックでは、さまざまなターゲット環境での ASP.NET メンバーシップ データベースをプロビジョニングする必要がある場合に発生する可能性の課題のいくつかについて説明します。</span><span class="sxs-lookup"><span data-stu-id="87a9a-146">This topic described some of the challenges you may face when you need to provision ASP.NET membership databases in various target environments.</span></span> <span data-ttu-id="87a9a-147">具体的には、理由スキーマのみのデプロイメント メンバーシップ データベースは操作不可状態にして、ユーザー アカウントのデータの展開はサポートされていない理由について説明します。</span><span class="sxs-lookup"><span data-stu-id="87a9a-147">In particular, it explained why schema-only deployments will leave the membership database in a non-operational state and why deploying user account data is not supported.</span></span> <span data-ttu-id="87a9a-148">トピックには、プロビジョニング、デプロイ、およびさまざまなシナリオでメンバーシップ データベースを更新する方法のガイダンスも表示されます。</span><span class="sxs-lookup"><span data-stu-id="87a9a-148">The topic also presented guidance on how to provision, deploy, and update membership databases in different scenarios.</span></span>

## <a name="further-reading"></a><span data-ttu-id="87a9a-149">関連項目</span><span class="sxs-lookup"><span data-stu-id="87a9a-149">Further Reading</span></span>

<span data-ttu-id="87a9a-150">詳細なガイダンスと、VSDBCMD を使用する方法の例については、次を参照してください。 [VSDBCMD のコマンド ライン リファレンス。EXE (展開およびスキーマのインポート)](https://msdn.microsoft.com/library/dd193283.aspx)と[方法: コマンド プロンプトからスキーマをインポート](https://msdn.microsoft.com/library/dd172135.aspx)します。</span><span class="sxs-lookup"><span data-stu-id="87a9a-150">For more guidance and examples of how to use VSDBCMD, see [Command-Line Reference for VSDBCMD.EXE (Deployment and Schema Import)](https://msdn.microsoft.com/library/dd193283.aspx) and [How to: Import a Schema from a Command Prompt](https://msdn.microsoft.com/library/dd172135.aspx).</span></span> <span data-ttu-id="87a9a-151">Aspnet の使用の詳細については\_regsql.exe メンバーシップ データベースの作成を参照してください[ASP.NET SQL Server の登録ツール (aspnet\_regsql.exe)](https://msdn.microsoft.com/library/ms229862(v=vs.100).aspx)します。</span><span class="sxs-lookup"><span data-stu-id="87a9a-151">For more information on using aspnet\_regsql.exe to create membership databases, see [ASP.NET SQL Server Registration Tool (aspnet\_regsql.exe)](https://msdn.microsoft.com/library/ms229862(v=vs.100).aspx).</span></span> <span data-ttu-id="87a9a-152">メンバーシップ データベースのデプロイに関する一般的なガイダンスについては、次を参照してください。[方法: ASP.NET メンバーシップ データベースなしを含むユーザー アカウントをデプロイ](https://msdn.microsoft.com/library/ff361972(v=vs.100).aspx)します。</span><span class="sxs-lookup"><span data-stu-id="87a9a-152">For more general guidance on deploying membership databases, see [How to: Deploy the ASP.NET Membership Database Without Including User Accounts](https://msdn.microsoft.com/library/ff361972(v=vs.100).aspx).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="87a9a-153">[前へ](deploying-database-role-memberships-to-test-environments.md)
> [次へ](excluding-files-and-folders-from-deployment.md)</span><span class="sxs-lookup"><span data-stu-id="87a9a-153">[Previous](deploying-database-role-memberships-to-test-environments.md)
[Next](excluding-files-and-folders-from-deployment.md)</span></span>
