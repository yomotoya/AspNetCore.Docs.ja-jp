---
uid: web-forms/overview/deployment/advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments
title: 複数の環境のデータベースの配置をカスタマイズする |Microsoft ドキュメント
author: jrjlee
description: 'このトピックでは、展開プロセスの一部として特定のターゲット環境にデータベースのプロパティを調整する方法について説明します。 注: トピックには、番目が前提としています.'
ms.author: aspnetcontent
manager: wpickett
ms.date: 05/04/2012
ms.topic: article
ms.assetid: a172979a-1318-4318-a9c6-4f9560d26267
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/deployment/advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments
msc.type: authoredcontent
ms.openlocfilehash: 06f22bc9a3068ee5621df62ee5ed1bea06d7e9e6
ms.sourcegitcommit: 6784510cfb589308c3875ccb5113eb31031766b4
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/08/2018
ms.locfileid: "30881358"
---
<a name="customizing-database-deployments-for-multiple-environments"></a><span data-ttu-id="4894a-104">複数の環境のデータベースの展開のカスタマイズ</span><span class="sxs-lookup"><span data-stu-id="4894a-104">Customizing Database Deployments for Multiple Environments</span></span>
====================
<span data-ttu-id="4894a-105">によって[Jason lee 著](https://github.com/jrjlee)</span><span class="sxs-lookup"><span data-stu-id="4894a-105">by [Jason Lee](https://github.com/jrjlee)</span></span>

[<span data-ttu-id="4894a-106">PDF のダウンロード</span><span class="sxs-lookup"><span data-stu-id="4894a-106">Download PDF</span></span>](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> <span data-ttu-id="4894a-107">このトピックでは、展開プロセスの一部として特定のターゲット環境にデータベースのプロパティを調整する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="4894a-107">This topic describes how to tailor the properties of a database to specific target environments as part of the deployment process.</span></span>
> 
> > [!NOTE]
> > <span data-ttu-id="4894a-108">トピックでは、MSBuild.exe と VSDBCMD.exe を使用して、Visual Studio 2010 データベース プロジェクトを配置することを前提としています。</span><span class="sxs-lookup"><span data-stu-id="4894a-108">The topic assumes that you're deploying a Visual Studio 2010 database project using MSBuild.exe and VSDBCMD.exe.</span></span> <span data-ttu-id="4894a-109">この方法を選択する理由の詳細については、次を参照してください。 [、企業内の Web 配置](../web-deployment-in-the-enterprise/web-deployment-in-the-enterprise.md)と[データベース プロジェクトの配置](../web-deployment-in-the-enterprise/deploying-database-projects.md)です。</span><span class="sxs-lookup"><span data-stu-id="4894a-109">For more information on why you might choose this approach, see [Web Deployment in the Enterprise](../web-deployment-in-the-enterprise/web-deployment-in-the-enterprise.md) and [Deploying Database Projects](../web-deployment-in-the-enterprise/deploying-database-projects.md).</span></span>
> 
> 
> <span data-ttu-id="4894a-110">複数の変換先にデータベース プロジェクトを展開するときを多くの場合を各ターゲット環境のデータベースの配置プロパティをカスタマイズします。</span><span class="sxs-lookup"><span data-stu-id="4894a-110">When you deploy a database project to multiple destinations, you'll often want to customize the database deployment properties for each target environment.</span></span> <span data-ttu-id="4894a-111">たとえば、テスト環境では通常を再作成するそれぞれの配置上のデータベース ステージングまたは運用環境で、データを保持するために増分更新を行うよりもずっと可能性の高いでしょうがします。</span><span class="sxs-lookup"><span data-stu-id="4894a-111">For example, in test environments you'd typically recreate the database on every deployment, whereas in staging or production environments you'd be a lot more likely to make incremental updates to preserve your data.</span></span>
> 
> <span data-ttu-id="4894a-112">Visual Studio 2010 データベース プロジェクトでは、展開の設定が展開 (.sqldeployment) の構成ファイル内で格納されます。</span><span class="sxs-lookup"><span data-stu-id="4894a-112">In a Visual Studio 2010 database project, deployment settings are contained within a deployment configuration (.sqldeployment) file.</span></span> <span data-ttu-id="4894a-113">このトピックでは、環境固有の配置構成ファイルを作成し、VSDBCMD パラメーターとして使用する 1 つを指定する方法を示します。</span><span class="sxs-lookup"><span data-stu-id="4894a-113">This topic will show you how to create environment-specific deployment configuration files and specify the one you want to use as a VSDBCMD parameter.</span></span>


<span data-ttu-id="4894a-114">このトピックの Fabrikam, Inc. という架空の会社のエンタープライズ展開の要件に関するチュートリアル シリーズの一部を形成します。このチュートリアルの一連のサンプル ソリューションを使用する&#x2014;、 [Contact Manager ソリューション](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;現実的な ASP.NET MVC 3 アプリケーション、Windows Communication も含め、複雑さのレベルを持つ web アプリケーションを表すFoundation (WCF) サービスとデータベース プロジェクト。</span><span class="sxs-lookup"><span data-stu-id="4894a-114">This topic forms part of a series of tutorials based around the enterprise deployment requirements of a fictional company named Fabrikam, Inc. This tutorial series uses a sample solution&#x2014;the [Contact Manager solution](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;to represent a web application with a realistic level of complexity, including an ASP.NET MVC 3 application, a Windows Communication Foundation (WCF) service, and a database project.</span></span>

<span data-ttu-id="4894a-115">説明されている分割プロジェクト ファイル アプローチに基づいて、これらのチュートリアルの中心に配置メソッド[プロジェクト ファイルを理解する](../web-deployment-in-the-enterprise/understanding-the-project-file.md)、によって制御されるビルド プロセスでは、2 つのプロジェクト ファイル&#x2014;1 つを含む各配置先の環境と環境固有のビルドと配置の設定を含む 1 つに適用される手順をビルドします。</span><span class="sxs-lookup"><span data-stu-id="4894a-115">The deployment method at the heart of these tutorials is based on the split project file approach described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md), in which the build process is controlled by two project files&#x2014;one containing build instructions that apply to every destination environment, and one containing environment-specific build and deployment settings.</span></span> <span data-ttu-id="4894a-116">ビルド時に環境固有のプロジェクト ファイルは、ビルドの手順の完全なセットを形成する環境に依存しないプロジェクト ファイルにマージされます。</span><span class="sxs-lookup"><span data-stu-id="4894a-116">At build time, the environment-specific project file is merged into the environment-agnostic project file to form a complete set of build instructions.</span></span>

## <a name="task-overview"></a><span data-ttu-id="4894a-117">タスクの概要</span><span class="sxs-lookup"><span data-stu-id="4894a-117">Task Overview</span></span>

<span data-ttu-id="4894a-118">このトピックを前提とします。</span><span class="sxs-lookup"><span data-stu-id="4894a-118">This topic assumes that:</span></span>

- <span data-ttu-id="4894a-119">」の説明に従って、ソリューションの配置をプロジェクト ファイルの分割アプローチを使用する[プロジェクト ファイルを理解する](../web-deployment-in-the-enterprise/understanding-the-project-file.md)です。</span><span class="sxs-lookup"><span data-stu-id="4894a-119">You use the split project file approach to solution deployment, as described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md).</span></span>
- <span data-ttu-id="4894a-120">」の説明に従って、データベース プロジェクトを配置するプロジェクト ファイルから VSDBCMD を呼び出す[ビルド プロセスの理解](../web-deployment-in-the-enterprise/understanding-the-build-process.md)です。</span><span class="sxs-lookup"><span data-stu-id="4894a-120">You call VSDBCMD from the project file to deploy your database project, as described in [Understanding the Build Process](../web-deployment-in-the-enterprise/understanding-the-build-process.md).</span></span>

<span data-ttu-id="4894a-121">さまざまなターゲット環境間でデータベースの配置プロパティをサポートする展開システムを作成するには、する必要があります。</span><span class="sxs-lookup"><span data-stu-id="4894a-121">To create a deployment system that supports varying the database deployment properties between target environments, you'll need to:</span></span>

- <span data-ttu-id="4894a-122">各ターゲット環境の展開の構成 (.sqldeployment) ファイルを作成します。</span><span class="sxs-lookup"><span data-stu-id="4894a-122">Create a deployment configuration (.sqldeployment) file for each target environment.</span></span>
- <span data-ttu-id="4894a-123">コマンド ライン スイッチと展開構成ファイルを指定する VSDBCMD コマンドを作成します。</span><span class="sxs-lookup"><span data-stu-id="4894a-123">Create a VSDBCMD command that specifies the deployment configuration file as a command-line switch.</span></span>
- <span data-ttu-id="4894a-124">VSDBCMD オプションは、ターゲット環境に適しているために、Microsoft Build Engine (MSBuild) は、プロジェクト ファイルで VSDBCMD コマンドをパラメーター化します。</span><span class="sxs-lookup"><span data-stu-id="4894a-124">Parameterize the VSDBCMD command in a Microsoft Build Engine (MSBuild) project file, so that the VSDBCMD options are appropriate to the target environment.</span></span>

<span data-ttu-id="4894a-125">このトピックでは、各手順を実行する方法を示します。</span><span class="sxs-lookup"><span data-stu-id="4894a-125">This topic will show you how to perform each of these procedures.</span></span>

## <a name="creating-environment-specific-deployment-configuration-files"></a><span data-ttu-id="4894a-126">環境固有の配置構成ファイルを作成します。</span><span class="sxs-lookup"><span data-stu-id="4894a-126">Creating Environment-Specific Deployment Configuration Files</span></span>

<span data-ttu-id="4894a-127">既定では、データベース プロジェクトがという名前の単一の展開構成ファイルを含む*Database.sqldeployment*です。</span><span class="sxs-lookup"><span data-stu-id="4894a-127">By default, a database project contains a single deployment configuration file named *Database.sqldeployment*.</span></span> <span data-ttu-id="4894a-128">このファイルを開くには、Visual Studio 2010 で、使用可能な各種展開オプションを確認できます。</span><span class="sxs-lookup"><span data-stu-id="4894a-128">If you open this file in Visual Studio 2010, you can see the different deployment options that are available to you:</span></span>

- <span data-ttu-id="4894a-129">**配置の比較の照合順序**です。</span><span class="sxs-lookup"><span data-stu-id="4894a-129">**Deployment comparison collation**.</span></span> <span data-ttu-id="4894a-130">これにより、プロジェクトのデータベースの照合順序を使用するかどうかを選択できます (、*ソース*照合順序) または、移行先サーバーのデータベースの照合順序 (、*ターゲット*照合順序)。</span><span class="sxs-lookup"><span data-stu-id="4894a-130">This lets you choose whether to use the database collation of your project (the *source* collation) or the database collation of your destination server (the *target* collation).</span></span> <span data-ttu-id="4894a-131">ほとんどの場合は、開発用に展開または、環境をテストするときに、ソースの照合順序を使用するします。</span><span class="sxs-lookup"><span data-stu-id="4894a-131">In most cases, you'll want to use the source collation when you deploy to a development or test environment.</span></span> <span data-ttu-id="4894a-132">ステージングまたは運用環境に展開するときに、変更せずに相互運用性の問題を回避するターゲットの照合順序のままにしておく通常します。</span><span class="sxs-lookup"><span data-stu-id="4894a-132">When you deploy to a staging or production environment, you'll usually want to leave the target collation unchanged to avoid any interoperability issues.</span></span>
- <span data-ttu-id="4894a-133">**データベースのプロパティを配置する**です。</span><span class="sxs-lookup"><span data-stu-id="4894a-133">**Deploy database properties**.</span></span> <span data-ttu-id="4894a-134">定義されているデータベースのプロパティを適用するかどうかを選択できます、 *Database.sqlsettings*ファイル。</span><span class="sxs-lookup"><span data-stu-id="4894a-134">This lets you choose whether to apply the database properties, as defined in the *Database.sqlsettings* file.</span></span> <span data-ttu-id="4894a-135">最初にデータベースを展開するときに、データベースのプロパティを展開する必要があります。</span><span class="sxs-lookup"><span data-stu-id="4894a-135">When you deploy a database for the first time, you should deploy the database properties.</span></span> <span data-ttu-id="4894a-136">既存のデータベースを更新する場合は、プロパティの場所に既に存在する必要がありにもう一度配置する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="4894a-136">If you're updating an existing database, the properties should already be in place, and you shouldn't need to deploy them again.</span></span>
- <span data-ttu-id="4894a-137">**常にデータベースを再作成**です。</span><span class="sxs-lookup"><span data-stu-id="4894a-137">**Always re-create database**.</span></span> <span data-ttu-id="4894a-138">これにより展開または増分変更するため、ターゲット データベースに最新の状態、スキーマを使用するたびに、ターゲット データベースを再作成するかどうかを選択できます。</span><span class="sxs-lookup"><span data-stu-id="4894a-138">This lets you choose whether to re-create the target database every time you deploy or make incremental changes to bring the target database up to date with your schema.</span></span> <span data-ttu-id="4894a-139">データベースを再作成すると、既存のデータベース内のデータが失われます。</span><span class="sxs-lookup"><span data-stu-id="4894a-139">If you re-create the database, you'll lose any data in the existing database.</span></span> <span data-ttu-id="4894a-140">そのため、通常この設定の値**false**のステージング環境または実稼働環境に展開します。</span><span class="sxs-lookup"><span data-stu-id="4894a-140">As such, you should usually set this to **false** for deployments to staging or production environments.</span></span>
- <span data-ttu-id="4894a-141">**データの損失が発生する場合に増分配置をブロック**です。</span><span class="sxs-lookup"><span data-stu-id="4894a-141">**Block incremental deployment if data loss might occur**.</span></span> <span data-ttu-id="4894a-142">これにより、データベース スキーマの変更がデータの損失を引き起こす場合は配置を停止するかどうかを選択できます。</span><span class="sxs-lookup"><span data-stu-id="4894a-142">This lets you choose whether deployment should stop if a change to the database schema will cause the loss of data.</span></span> <span data-ttu-id="4894a-143">通常これを設定する**true**介入し、重要なデータを保護する機会を提供する、実稼働環境に配置するためです。</span><span class="sxs-lookup"><span data-stu-id="4894a-143">You typically set this to **true** for a deployment to a production environment, to give you the opportunity to intervene and protect any important data.</span></span> <span data-ttu-id="4894a-144">設定した場合**常にデータベースを再作成**に**false**、この設定には影響はありません。</span><span class="sxs-lookup"><span data-stu-id="4894a-144">If you have set **Always re-create database** to **false**, this setting will have no effect.</span></span>
- <span data-ttu-id="4894a-145">**シングル ユーザー モードで展開を実行する**です。</span><span class="sxs-lookup"><span data-stu-id="4894a-145">**Execute deployment in single-user mode**.</span></span> <span data-ttu-id="4894a-146">これは通常開発またはテスト環境で発生する問題ではありません。</span><span class="sxs-lookup"><span data-stu-id="4894a-146">This is not usually an issue in development or test environments.</span></span> <span data-ttu-id="4894a-147">ただしは通常これを設定する**true**のステージング環境または実稼働環境に展開します。</span><span class="sxs-lookup"><span data-stu-id="4894a-147">However, you should typically set this to **true** for deployments to staging or production environments.</span></span> <span data-ttu-id="4894a-148">これはユーザーが、デプロイは進行中に、データベースに変更を加えることを防ぎます。</span><span class="sxs-lookup"><span data-stu-id="4894a-148">This prevents users from making changes to the database while the deployment is underway.</span></span>
- <span data-ttu-id="4894a-149">**展開する前にデータベースをバックアップする**です。</span><span class="sxs-lookup"><span data-stu-id="4894a-149">**Back up database before deployment**.</span></span> <span data-ttu-id="4894a-150">通常これを設定する**true**データ損失に対する予防策として、実稼働環境への展開します。</span><span class="sxs-lookup"><span data-stu-id="4894a-150">You typically set this to **true** when you deploy to a production environment, as a precaution against data loss.</span></span> <span data-ttu-id="4894a-151">設定することも**true**展開するときに、ステージング環境に、ステージング データベースには、大量のデータが含まれている場合。</span><span class="sxs-lookup"><span data-stu-id="4894a-151">You may also want to set it to **true** when you deploy to a staging environment, if your staging database contains a lot of data.</span></span>
- <span data-ttu-id="4894a-152">**ターゲット データベースにあってデータベース プロジェクトに含まれていないオブジェクトに対して DROP ステートメントを生成**です。</span><span class="sxs-lookup"><span data-stu-id="4894a-152">**Generate DROP statements for objects that are in the target database but that are not in the database project**.</span></span> <span data-ttu-id="4894a-153">ほとんどの場合、これは、データベースの増分変更欠かせない重要な要素です。</span><span class="sxs-lookup"><span data-stu-id="4894a-153">In most cases, this is an integral and essential part of making incremental changes to a database.</span></span> <span data-ttu-id="4894a-154">設定した場合**常にデータベースを再作成**に**false**、この設定には影響はありません。</span><span class="sxs-lookup"><span data-stu-id="4894a-154">If you have set **Always re-create database** to **false**, this setting will have no effect.</span></span>
- <span data-ttu-id="4894a-155">**CLR 型の更新に ALTER ASSEMBLY ステートメントを使用しない**です。</span><span class="sxs-lookup"><span data-stu-id="4894a-155">**Do not use ALTER ASSEMBLY statements to update CLR types**.</span></span> <span data-ttu-id="4894a-156">この設定は、SQL Server が新しいアセンブリ バージョンに共通言語ランタイム (CLR) 型を更新する必要がある方法を決定します。</span><span class="sxs-lookup"><span data-stu-id="4894a-156">This setting determines how SQL Server should update common language runtime (CLR) types to newer assembly versions.</span></span> <span data-ttu-id="4894a-157">これに設定する必要があります**false**ほとんどのシナリオでします。</span><span class="sxs-lookup"><span data-stu-id="4894a-157">This should be set to **false** in most scenarios.</span></span>

<span data-ttu-id="4894a-158">次の表は、別のインストール先の環境の典型的な展開設定を示します。</span><span class="sxs-lookup"><span data-stu-id="4894a-158">This table shows typical deployment settings for different destination environments.</span></span> <span data-ttu-id="4894a-159">ただしの設定は、正確な要件に応じて異なる場合があります。</span><span class="sxs-lookup"><span data-stu-id="4894a-159">However, your settings may be different depending on your exact requirements.</span></span>

|  | <span data-ttu-id="4894a-160">開発/テスト</span><span class="sxs-lookup"><span data-stu-id="4894a-160">Developer/Test</span></span> | <span data-ttu-id="4894a-161">ステージング/統合</span><span class="sxs-lookup"><span data-stu-id="4894a-161">Staging/Integration</span></span> | <span data-ttu-id="4894a-162">実稼働</span><span class="sxs-lookup"><span data-stu-id="4894a-162">Production</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="4894a-163">**配置の比較の照合順序**</span><span class="sxs-lookup"><span data-stu-id="4894a-163">**Deployment comparison collation**</span></span> | <span data-ttu-id="4894a-164">ソース</span><span class="sxs-lookup"><span data-stu-id="4894a-164">Source</span></span> | <span data-ttu-id="4894a-165">ターゲット</span><span class="sxs-lookup"><span data-stu-id="4894a-165">Target</span></span> | <span data-ttu-id="4894a-166">ターゲット</span><span class="sxs-lookup"><span data-stu-id="4894a-166">Target</span></span> |
| <span data-ttu-id="4894a-167">**データベースのプロパティを配置します。**</span><span class="sxs-lookup"><span data-stu-id="4894a-167">**Deploy database properties**</span></span> | <span data-ttu-id="4894a-168">True</span><span class="sxs-lookup"><span data-stu-id="4894a-168">True</span></span> | <span data-ttu-id="4894a-169">最初の時刻のみ</span><span class="sxs-lookup"><span data-stu-id="4894a-169">First time only</span></span> | <span data-ttu-id="4894a-170">最初の時刻のみ</span><span class="sxs-lookup"><span data-stu-id="4894a-170">First time only</span></span> |
| <span data-ttu-id="4894a-171">**常にデータベースを再作成します。**</span><span class="sxs-lookup"><span data-stu-id="4894a-171">**Always re-create database**</span></span> | <span data-ttu-id="4894a-172">True</span><span class="sxs-lookup"><span data-stu-id="4894a-172">True</span></span> | <span data-ttu-id="4894a-173">False</span><span class="sxs-lookup"><span data-stu-id="4894a-173">False</span></span> | <span data-ttu-id="4894a-174">False</span><span class="sxs-lookup"><span data-stu-id="4894a-174">False</span></span> |
| <span data-ttu-id="4894a-175">**データの損失が発生する場合に増分配置をブロックします。**</span><span class="sxs-lookup"><span data-stu-id="4894a-175">**Block incremental deployment if data loss might occur**</span></span> | <span data-ttu-id="4894a-176">False</span><span class="sxs-lookup"><span data-stu-id="4894a-176">False</span></span> | <span data-ttu-id="4894a-177">おそらく</span><span class="sxs-lookup"><span data-stu-id="4894a-177">Maybe</span></span> | <span data-ttu-id="4894a-178">True</span><span class="sxs-lookup"><span data-stu-id="4894a-178">True</span></span> |
| <span data-ttu-id="4894a-179">**シングル ユーザー モードで配置スクリプトを実行します。**</span><span class="sxs-lookup"><span data-stu-id="4894a-179">**Execute deployment script in single-user mode**</span></span> | <span data-ttu-id="4894a-180">False</span><span class="sxs-lookup"><span data-stu-id="4894a-180">False</span></span> | <span data-ttu-id="4894a-181">True</span><span class="sxs-lookup"><span data-stu-id="4894a-181">True</span></span> | <span data-ttu-id="4894a-182">True</span><span class="sxs-lookup"><span data-stu-id="4894a-182">True</span></span> |
| <span data-ttu-id="4894a-183">**展開する前にデータベースをバックアップします。**</span><span class="sxs-lookup"><span data-stu-id="4894a-183">**Back up database before deployment**</span></span> | <span data-ttu-id="4894a-184">False</span><span class="sxs-lookup"><span data-stu-id="4894a-184">False</span></span> | <span data-ttu-id="4894a-185">おそらく</span><span class="sxs-lookup"><span data-stu-id="4894a-185">Maybe</span></span> | <span data-ttu-id="4894a-186">True</span><span class="sxs-lookup"><span data-stu-id="4894a-186">True</span></span> |
| <span data-ttu-id="4894a-187">**ターゲット データベース内にあるオブジェクトに対して DROP ステートメントを生成しますが、データベース プロジェクトに含まれていません。**</span><span class="sxs-lookup"><span data-stu-id="4894a-187">**Generate DROP statements for objects that are in the target database but that are not in the database project**</span></span> | <span data-ttu-id="4894a-188">False</span><span class="sxs-lookup"><span data-stu-id="4894a-188">False</span></span> | <span data-ttu-id="4894a-189">True</span><span class="sxs-lookup"><span data-stu-id="4894a-189">True</span></span> | <span data-ttu-id="4894a-190">True</span><span class="sxs-lookup"><span data-stu-id="4894a-190">True</span></span> |
| <span data-ttu-id="4894a-191">**CLR 型の更新に ALTER ASSEMBLY ステートメントを使用しないでください。**</span><span class="sxs-lookup"><span data-stu-id="4894a-191">**Do not use ALTER ASSEMBLY statements to update CLR types**</span></span> | <span data-ttu-id="4894a-192">False</span><span class="sxs-lookup"><span data-stu-id="4894a-192">False</span></span> | <span data-ttu-id="4894a-193">False</span><span class="sxs-lookup"><span data-stu-id="4894a-193">False</span></span> | <span data-ttu-id="4894a-194">False</span><span class="sxs-lookup"><span data-stu-id="4894a-194">False</span></span> |
  

> [!NOTE]
> <span data-ttu-id="4894a-195">データベースの配置プロパティと環境に関する考慮事項の詳細については、次を参照してください[、概要のデータベース プロジェクトの設定](https://msdn.microsoft.com/library/aa833291(v=VS.100).aspx)、[する方法: 展開の詳細のプロパティを構成する](https://msdn.microsoft.com/library/dd172125.aspx)、 。[ビルドおよび分離開発環境にデータベースを配置](https://msdn.microsoft.com/library/dd193409.aspx)、および[ビルドし、ステージング環境または実稼働環境にデータベースを配置](https://msdn.microsoft.com/library/dd193413.aspx)です。</span><span class="sxs-lookup"><span data-stu-id="4894a-195">For more information on database deployment properties and environment considerations, see [An Overview of Database Project Settings](https://msdn.microsoft.com/library/aa833291(v=VS.100).aspx), [How to: Configure Properties for Deployment Details](https://msdn.microsoft.com/library/dd172125.aspx), [Build and Deploy Database to an Isolated Development Environment](https://msdn.microsoft.com/library/dd193409.aspx), and [Build and Deploy Databases to a Staging or Production Environment](https://msdn.microsoft.com/library/dd193413.aspx).</span></span>


<span data-ttu-id="4894a-196">複数の送信先にデータベース プロジェクトの配置をサポートするには、各ターゲット環境の展開構成ファイルを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="4894a-196">To support the deployment of a database project to multiple destinations, you should create a deployment configuration file for each target environment.</span></span>

<span data-ttu-id="4894a-197">**環境に固有の構成ファイルを作成するには**</span><span class="sxs-lookup"><span data-stu-id="4894a-197">**To create an environment-specific configuration file**</span></span>

1. <span data-ttu-id="4894a-198">Visual Studio 2010 での**ソリューション エクスプ ローラー**  ウィンドウでは、データベース プロジェクトを右クリックし、をクリックして**プロパティ**です。</span><span class="sxs-lookup"><span data-stu-id="4894a-198">In Visual Studio 2010, in the **Solution Explorer** window, right-click your database project, and then click **Properties**.</span></span>
2. <span data-ttu-id="4894a-199">データベース プロジェクトのプロパティ ページで、**展開** タブの 、**展開構成ファイル**行で、をクリックして**新規**です。</span><span class="sxs-lookup"><span data-stu-id="4894a-199">On the database project properties page, on the **Deploy** tab, in the **Deployment configuration file** row, click **New**.</span></span>

    ![](customizing-database-deployments-for-multiple-environments/_static/image1.png)
3. <span data-ttu-id="4894a-200">**新しい配置構成ファイル** ダイアログ ボックスで、ファイルにわかりやすい名前を付けます (たとえば、 **TestEnvironment.sqldeployment**)、をクリックし、**保存**です。</span><span class="sxs-lookup"><span data-stu-id="4894a-200">In the **New Deployment Configuration File** dialog box, give the file a meaningful name (for example, **TestEnvironment.sqldeployment**), and then click **Save**.</span></span>
4. <span data-ttu-id="4894a-201">*[Filename]***.sqldeployment** ページで、展開先の環境の要件に適合する配置プロパティを設定し、ファイルを保存します。</span><span class="sxs-lookup"><span data-stu-id="4894a-201">On the *[Filename]***.sqldeployment** page, set the deployment properties to match the requirements of your destination environment, and then save the file.</span></span>

    ![](customizing-database-deployments-for-multiple-environments/_static/image2.png)
5. <span data-ttu-id="4894a-202">新しいファイルが、データベース プロジェクトのプロパティ フォルダーに追加されたことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="4894a-202">Notice that the new file is added to the Properties folder in your database project.</span></span>

    ![](customizing-database-deployments-for-multiple-environments/_static/image3.png)

## <a name="specifying-the-deployment-configuration-file-in-vsdbcmd"></a><span data-ttu-id="4894a-203">VSDBCMD の展開構成ファイルを指定します。</span><span class="sxs-lookup"><span data-stu-id="4894a-203">Specifying the Deployment Configuration File in VSDBCMD</span></span>

<span data-ttu-id="4894a-204">Visual Studio 2010 内 (デバッグやリリース) などのソリューション構成を使用する場合は、各構成で展開構成ファイルを関連付けることができます。</span><span class="sxs-lookup"><span data-stu-id="4894a-204">When you use solution configurations (like Debug and Release) within Visual Studio 2010, you can associate a deployment configuration file with each configuration.</span></span> <span data-ttu-id="4894a-205">特定の構成をビルドすると、ビルド プロセスには、構成に固有の展開構成ファイルを指す構成固有の配置マニフェスト ファイルが生成されます。</span><span class="sxs-lookup"><span data-stu-id="4894a-205">When you build a particular configuration, the build process generates a configuration-specific deployment manifest file that points to the configuration-specific deployment configuration file.</span></span> <span data-ttu-id="4894a-206">ただし、これらのチュートリアルで説明する展開のアプローチの主な目的の 1 つは、Visual Studio 2010 とソリューション構成を使用せず、展開プロセスを制御する機能できるようにします。</span><span class="sxs-lookup"><span data-stu-id="4894a-206">However, one of the main aims of the approach to deployment described in these tutorials is to give people the ability to control the deployment process without using Visual Studio 2010 and solution configurations.</span></span> <span data-ttu-id="4894a-207">この方法では、ソリューション構成は、ターゲット展開環境に関係なく同じです。</span><span class="sxs-lookup"><span data-stu-id="4894a-207">In this approach, the solution configuration is the same regardless of the target deployment environment.</span></span> <span data-ttu-id="4894a-208">特定の送信先の環境に、データベースの配置を調整するため、展開構成ファイルを指定するのに、VSDBCMD コマンド ライン オプションを使用できます。</span><span class="sxs-lookup"><span data-stu-id="4894a-208">To tailor your database deployment to a specific destination environment, you can use the VSDBCMD command-line options to specify your deployment configuration file.</span></span>

<span data-ttu-id="4894a-209">指定する展開構成ファイル、VSDBCMD を使用して、 **p:/DeploymentConfigurationFile**切り替えるし、ファイルへの完全パスを提供します。</span><span class="sxs-lookup"><span data-stu-id="4894a-209">To specify a deployment configuration file in your VSDBCMD, use the **p:/DeploymentConfigurationFile** switch and provide the full path to your file.</span></span> <span data-ttu-id="4894a-210">これにより、配置マニフェストを識別する展開構成ファイルが上書きされます。</span><span class="sxs-lookup"><span data-stu-id="4894a-210">This will override the deployment configuration file that the deployment manifest identifies.</span></span> <span data-ttu-id="4894a-211">たとえば、展開するこの VSDBCMD コマンドを使用する可能性があります、 **ContactManager**テスト環境へのデータベース。</span><span class="sxs-lookup"><span data-stu-id="4894a-211">For example, you could use this VSDBCMD command to deploy the **ContactManager** database to a test environment:</span></span>


[!code-console[Main](customizing-database-deployments-for-multiple-environments/samples/sample1.cmd)]


> [!NOTE]
> <span data-ttu-id="4894a-212">出力ディレクトリにファイルをコピーするときに、ビルド プロセスに .sqldeployment ファイルを変更ことがありますに注意してください。</span><span class="sxs-lookup"><span data-stu-id="4894a-212">Note that the build process may rename your .sqldeployment file when it copies the file to the output directory.</span></span>


<span data-ttu-id="4894a-213">配置前や配置後 SQL スクリプトでの SQL コマンド変数を使用する場合に、展開で、特定の環境 .sqlcmdvars ファイルを関連付けるには、同様のアプローチを使用できます。</span><span class="sxs-lookup"><span data-stu-id="4894a-213">If you use SQL command variables in your pre-deployment or post-deployment SQL scripts, you can use a similar approach to associate an environment-specific .sqlcmdvars file with your deployment.</span></span> <span data-ttu-id="4894a-214">この場合、使用して、 **p:/SqlCommandVariablesFile** .sqlcmdvars ファイルを識別するスイッチです。</span><span class="sxs-lookup"><span data-stu-id="4894a-214">In this case, you use the **p:/SqlCommandVariablesFile** switch to identify your .sqlcmdvars file.</span></span>

## <a name="running-the-vsdbcmd-command-from-an-msbuild-project-file"></a><span data-ttu-id="4894a-215">MSBuild プロジェクト ファイルから VSDBCMD コマンドを実行しています。</span><span class="sxs-lookup"><span data-stu-id="4894a-215">Running the VSDBCMD Command from an MSBuild Project File</span></span>

<span data-ttu-id="4894a-216">使用して MSBuild プロジェクト ファイルから VSDBCMD コマンドを呼び出すことができます、 **Exec** MSBuild ターゲット内のタスクです。</span><span class="sxs-lookup"><span data-stu-id="4894a-216">You can invoke a VSDBCMD command from an MSBuild project file by using an **Exec** task within an MSBuild target.</span></span> <span data-ttu-id="4894a-217">最も単純な形式には次のようになります。</span><span class="sxs-lookup"><span data-stu-id="4894a-217">In its simplest form, it would look like this:</span></span>


[!code-xml[Main](customizing-database-deployments-for-multiple-environments/samples/sample2.xml)]


- <span data-ttu-id="4894a-218">実際には、プロジェクト ファイルを簡単に読み取るし、再利用します、さまざまなコマンド ライン パラメーターを格納するプロパティを作成します。</span><span class="sxs-lookup"><span data-stu-id="4894a-218">In practice, to make your project files easy to read and reuse, you'll want to create properties to store the various command-line parameters.</span></span> <span data-ttu-id="4894a-219">これにより、環境固有のプロジェクト ファイル内のプロパティ値を提供するか、MSBuild コマンドラインからの既定値をオーバーライドにユーザーが簡単にします。</span><span class="sxs-lookup"><span data-stu-id="4894a-219">This makes it easier for users to provide property values in an environment-specific project file or to override default values from the MSBuild command line.</span></span> <span data-ttu-id="4894a-220">説明されている分割プロジェクト ファイルのアプローチを使用するかどうかは[プロジェクト ファイルを理解する](../web-deployment-in-the-enterprise/understanding-the-project-file.md)、それに応じて、ビルド方法および 2 つのファイルのプロパティを分割する必要があります。</span><span class="sxs-lookup"><span data-stu-id="4894a-220">If you use the split project file approach described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md), you should divide your build instructions and properties between the two files accordingly:</span></span>
- <span data-ttu-id="4894a-221">展開構成ファイル名、データベース接続文字列で、ターゲット データベース名などの環境に固有の設定は、環境固有のプロジェクト ファイルに移動する必要があります。</span><span class="sxs-lookup"><span data-stu-id="4894a-221">Environment-specific settings, like the deployment configuration filename, the database connection string, and the target database name, should go in the environment-specific project file.</span></span>
- <span data-ttu-id="4894a-222">VSDBCMD の実行可能ファイルの場所のように汎用プロパティと共に、VSDBCMD コマンドを実行する MSBuild ターゲットは、ユニバーサル プロジェクト ファイルで移動する必要があります。</span><span class="sxs-lookup"><span data-stu-id="4894a-222">The MSBuild target that runs the VSDBCMD command, together with any universal properties like the location of the VSDBCMD executable, should go in the universal project file.</span></span>

<span data-ttu-id="4894a-223">.Deploymanifest ファイルが作成され、使用するように VSDBCMD を呼び出す前に、データベース プロジェクトをビルドすることも確認する必要があります。</span><span class="sxs-lookup"><span data-stu-id="4894a-223">You should also ensure that you build the database project before you invoke VSDBCMD so that the .deploymanifest file is created and ready to use.</span></span> <span data-ttu-id="4894a-224">トピックでは、この方法の完全な例を確認できます[ビルド プロセスの理解](../web-deployment-in-the-enterprise/understanding-the-build-process.md)を順を追ってするでプロジェクト ファイル、[連絡先のマネージャーのサンプル ソリューション](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)です。</span><span class="sxs-lookup"><span data-stu-id="4894a-224">You can see a full example of this approach in the topic [Understanding the Build Process](../web-deployment-in-the-enterprise/understanding-the-build-process.md), which walks you through the project files in the [Contact Manager sample solution](../web-deployment-in-the-enterprise/the-contact-manager-solution.md).</span></span>

## <a name="conclusion"></a><span data-ttu-id="4894a-225">まとめ</span><span class="sxs-lookup"><span data-stu-id="4894a-225">Conclusion</span></span>

<span data-ttu-id="4894a-226">このトピックでは、MSBuild および VSDBCMD を使用してデータベース プロジェクトを展開するときに、別のインストール先の環境にデータベースのプロパティを調整できる方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="4894a-226">This topic described how you can tailor database properties to different destination environments when you deploy database projects using MSBuild and VSDBCMD.</span></span> <span data-ttu-id="4894a-227">この方法は、エンタープライズ規模の大きい、ソリューションの一部としてデータベース プロジェクトを配置する必要がある場合に便利です。</span><span class="sxs-lookup"><span data-stu-id="4894a-227">This approach is useful when you need to deploy database projects as part of larger, enterprise-scale solutions.</span></span> <span data-ttu-id="4894a-228">これらのソリューションは、セキュリティで保護された開発環境またはテスト環境、ステージング環境または統合プラットフォームでは、および実稼働環境のライブなど、複数の送信先に多くの場合、展開されます。</span><span class="sxs-lookup"><span data-stu-id="4894a-228">These solutions are often deployed to multiple destinations, like sandboxed development or test environments, staging or integration platforms, and production or live environments.</span></span> <span data-ttu-id="4894a-229">通常の各ターゲット環境にデータベースの配置プロパティの一意のセットが必要です。</span><span class="sxs-lookup"><span data-stu-id="4894a-229">Each of these target environments typically requires a unique set of database deployment properties.</span></span>

## <a name="further-reading"></a><span data-ttu-id="4894a-230">関連項目</span><span class="sxs-lookup"><span data-stu-id="4894a-230">Further Reading</span></span>

<span data-ttu-id="4894a-231">VSDBCMD.exe を使用してデータベース プロジェクトを展開する方法の詳細については、次を参照してください。[データベース プロジェクトの配置](../web-deployment-in-the-enterprise/deploying-database-projects.md)です。</span><span class="sxs-lookup"><span data-stu-id="4894a-231">For more information on deploying database projects using VSDBCMD.exe, see [Deploying Database Projects](../web-deployment-in-the-enterprise/deploying-database-projects.md).</span></span> <span data-ttu-id="4894a-232">展開プロセスを制御するカスタム MSBuild プロジェクト ファイルを使用する方法については、次を参照してください。[プロジェクト ファイルを理解する](../web-deployment-in-the-enterprise/understanding-the-project-file.md)と[ビルド プロセスの理解](../web-deployment-in-the-enterprise/understanding-the-build-process.md)です。</span><span class="sxs-lookup"><span data-stu-id="4894a-232">For more information on using custom MSBuild project files to control the deployment process, see [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md) and [Understanding the Build Process](../web-deployment-in-the-enterprise/understanding-the-build-process.md).</span></span>

<span data-ttu-id="4894a-233">MSDN の次の記事では、データベースの配置より一般的なガイダンスを説明します。</span><span class="sxs-lookup"><span data-stu-id="4894a-233">These articles on MSDN provide more general guidance on database deployment:</span></span>

- <span data-ttu-id="4894a-234">[データベース プロジェクトの設定の概要](https://msdn.microsoft.com/library/aa833291(v=VS.100).aspx)</span><span class="sxs-lookup"><span data-stu-id="4894a-234">[An Overview of Database Project Settings](https://msdn.microsoft.com/library/aa833291(v=VS.100).aspx)</span></span>
- [<span data-ttu-id="4894a-235">方法: 展開の詳細のプロパティの構成</span><span class="sxs-lookup"><span data-stu-id="4894a-235">How to: Configure Properties for Deployment Details</span></span>](https://msdn.microsoft.com/library/dd172125.aspx)
- [<span data-ttu-id="4894a-236">ビルドおよび分離開発環境へのデータベースの配置</span><span class="sxs-lookup"><span data-stu-id="4894a-236">Build and Deploy Databases to an Isolated Development Environment</span></span>](https://msdn.microsoft.com/library/dd193409.aspx)
- [<span data-ttu-id="4894a-237">ビルドし、ステージング環境または実稼働環境にデータベースを配置</span><span class="sxs-lookup"><span data-stu-id="4894a-237">Build and Deploy Databases to a Staging or Production Environment</span></span>](https://msdn.microsoft.com/library/dd193413.aspx)

> [!div class="step-by-step"]
> <span data-ttu-id="4894a-238">[前へ](performing-a-what-if-deployment.md)
> [次へ](deploying-database-role-memberships-to-test-environments.md)</span><span class="sxs-lookup"><span data-stu-id="4894a-238">[Previous](performing-a-what-if-deployment.md)
[Next](deploying-database-role-memberships-to-test-environments.md)</span></span>
