---
uid: web-forms/overview/older-versions-security/introduction/forms-authentication-configuration-and-advanced-topics-cs
title: フォーム認証構成と高度なトピック (c#) |Microsoft Docs
author: rick-anderson
description: このチュートリアルはさまざまなフォーム認証の設定を確認し、フォーム要素を使用して変更する方法を参照してください。 これが、詳細なが必要.
ms.author: riande
ms.date: 01/14/2008
ms.assetid: b9c29865-a34e-48bb-92c0-c443a72cb860
msc.legacyurl: /web-forms/overview/older-versions-security/introduction/forms-authentication-configuration-and-advanced-topics-cs
msc.type: authoredcontent
ms.openlocfilehash: 33d9c90aa2798ec7a88acc8ff4e4062efc0701fc
ms.sourcegitcommit: 45ac74e400f9f2b7dbded66297730f6f14a4eb25
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/16/2018
ms.locfileid: "41823819"
---
<a name="forms-authentication-configuration-and-advanced-topics-c"></a><span data-ttu-id="6e0f6-104">フォーム認証構成と高度なトピック (c#)</span><span class="sxs-lookup"><span data-stu-id="6e0f6-104">Forms Authentication Configuration and Advanced Topics (C#)</span></span>
====================
<span data-ttu-id="6e0f6-105">によって[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="6e0f6-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="6e0f6-106">[コードのダウンロード](http://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/ASPNET_Security_Tutorial_03_CS.zip)または[PDF のダウンロード](http://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/aspnet_tutorial03_AuthAdvanced_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="6e0f6-106">[Download Code](http://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/ASPNET_Security_Tutorial_03_CS.zip) or [Download PDF](http://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/aspnet_tutorial03_AuthAdvanced_cs.pdf)</span></span>

> <span data-ttu-id="6e0f6-107">このチュートリアルはさまざまなフォーム認証の設定を確認し、フォーム要素を使用して変更する方法を参照してください。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-107">In this tutorial we will examine the various forms authentication settings and see how to modify them through the forms element.</span></span> <span data-ttu-id="6e0f6-108">(SignIn.aspx Login.aspx ではなく) などのカスタム URL と cookieless フォーム認証チケットでログイン ページを使用して、フォーム認証チケットのタイムアウト値のカスタマイズについて詳しく説明: これはします。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-108">This will entail a detailed look at customizing the forms authentication ticket's timeout value, using a login page with a custom URL (like SignIn.aspx instead of Login.aspx), and cookieless forms authentication tickets.</span></span>


## <a name="introduction"></a><span data-ttu-id="6e0f6-109">はじめに</span><span class="sxs-lookup"><span data-stu-id="6e0f6-109">Introduction</span></span>

<span data-ttu-id="6e0f6-110">[前のチュートリアル](an-overview-of-forms-authentication-cs.md)Web.config での表示 ページでさまざまなログを作成する構成設定を指定することから、ASP.NET アプリケーションでフォーム認証を実装するために必要な手順を説明しました認証および匿名ユーザーのコンテンツです。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-110">In the [previous tutorial](an-overview-of-forms-authentication-cs.md) we looked at the steps necessary for implementing forms authentication in an ASP.NET application, from specifying configuration settings in Web.config to creating a log in page to displaying different content for authenticated and anonymous users.</span></span> <span data-ttu-id="6e0f6-111">Mode 属性を設定して、フォーム認証を使用する web サイトを構成したことを思い出してください、&lt;認証&gt;フォームへの要素。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-111">Recall that we configured the website to use forms authentication by setting the mode attribute of the &lt;authentication&gt; element to Forms.</span></span> <span data-ttu-id="6e0f6-112">&lt;認証&gt;要素には、必要に応じて、&lt;フォーム&gt;子要素で使用されるさまざまなフォーム認証設定を指定できます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-112">The &lt;authentication&gt; element may optionally include a &lt;forms&gt; child element, through which an assortment of forms authentication settings may be specified.</span></span>

<span data-ttu-id="6e0f6-113">このチュートリアルでは、さまざまなフォーム認証設定を確認するを通じてそれらを変更する方法を参照してください、&lt;フォーム&gt;要素。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-113">In this tutorial we will examine the various forms authentication settings and see how to modify them through the &lt;forms&gt; element.</span></span> <span data-ttu-id="6e0f6-114">(SignIn.aspx Login.aspx ではなく) などのカスタム URL と cookieless フォーム認証チケットでログイン ページを使用して、フォーム認証チケットのタイムアウト値のカスタマイズについて詳しく説明: これはします。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-114">This will entail a detailed look at customizing the forms authentication ticket's timeout value, using a login page with a custom URL (like SignIn.aspx instead of Login.aspx), and cookieless forms authentication tickets.</span></span> <span data-ttu-id="6e0f6-115">また、フォーム認証チケットの構成をより詳しく調査し、ASP.NET がチケットのデータが検査および改ざんからセキュリティで保護されたことを確認するには、予防策を参照してください。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-115">We will also examine the makeup of the forms authentication ticket more closely and see the precautions ASP.NET takes to ensure that the ticket's data is secure from inspection and tampering.</span></span> <span data-ttu-id="6e0f6-116">最後に、フォーム認証チケットに余分なユーザー データを格納する方法とカスタム プリンシパル オブジェクトを使用してこのデータをモデル化する方法を紹介します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-116">Finally, we will look at how to store extra user data in the forms authentication ticket and how to model this data through a custom principal object.</span></span>

## <a name="step-1-examining-the-ltformsgt-configuration-settings"></a><span data-ttu-id="6e0f6-117">手順 1: チェック、&lt;フォーム&gt;構成設定</span><span class="sxs-lookup"><span data-stu-id="6e0f6-117">Step 1: Examining the &lt;forms&gt; Configuration Settings</span></span>

<span data-ttu-id="6e0f6-118">Asp.net フォーム認証システムは、アプリケーションごとにカスタマイズ可能な構成設定のいくつかあります。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-118">The forms authentication system in ASP.NET offers a number of configuration settings that can be customized on an application-by-application basis.</span></span> <span data-ttu-id="6e0f6-119">などの設定が含まれます。 フォーム認証の有効期間がチケット。チケット; にどのような保護が適用されます。どのような条件クッキーなしの認証チケットが使用されます。ログイン ページへのパスその他の情報。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-119">This includes settings like: the lifetime of the forms authentication ticket; what sort of protection is applied to the ticket; under what conditions cookieless authentication tickets are used; the path to the login page; and other information.</span></span> <span data-ttu-id="6e0f6-120">既定値を変更するには追加、 [&lt;フォーム&gt;要素](https://msdn.microsoft.com/library/1d3t3c61.aspx)の子として、 [&lt;認証&gt;要素](https://msdn.microsoft.com/library/532aee0e.aspx)、これらのプロパティを指定します。値を XML 属性として、カスタマイズするようになります。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-120">To modify the default values, add a [&lt;forms&gt; element](https://msdn.microsoft.com/library/1d3t3c61.aspx) as a child of the [&lt;authentication&gt; element](https://msdn.microsoft.com/library/532aee0e.aspx), specifying those property values you want to customize as XML attributes like so:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample1.xml)]

<span data-ttu-id="6e0f6-121">表 1 でカスタマイズ可能なプロパティをまとめたものです、&lt;フォーム&gt;要素。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-121">Table 1 summarizes the properties that can be customized through the &lt;forms&gt; element.</span></span> <span data-ttu-id="6e0f6-122">Web.config は、XML ファイルであるため、左の列の属性名は大文字小文字を区別します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-122">Since Web.config is an XML file, the attribute names in the left column are case-sensitive.</span></span>


| <span data-ttu-id="6e0f6-123"><strong>属性</strong></span><span class="sxs-lookup"><span data-stu-id="6e0f6-123"><strong>Attribute</strong></span></span> |                                                                                                                                                                                                                                     <span data-ttu-id="6e0f6-124"><strong>説明</strong></span><span class="sxs-lookup"><span data-stu-id="6e0f6-124"><strong>Description</strong></span></span>                                                                                                                                                                                                                                      |
|----------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         <span data-ttu-id="6e0f6-125">cookie なし</span><span class="sxs-lookup"><span data-stu-id="6e0f6-125">cookieless</span></span>         |                                                                                                                <span data-ttu-id="6e0f6-126">この属性は、URL に埋め込まれていると、cookie にどのような条件下で、認証チケットが格納されているを指定します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-126">This attribute specifies under what conditions the authentication ticket is stored in a cookie versus being embedded in the URL.</span></span> <span data-ttu-id="6e0f6-127">使用可能な値: 既定値です。UseUri;自動検出します。値 (既定)。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-127">Allowable values are: UseCookies; UseUri; AutoDetect; and UseDeviceProfile (the default).</span></span> <span data-ttu-id="6e0f6-128">手順 2 では、さらに詳しくは、この設定を検証します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-128">Step 2 examines this setting in more detail.</span></span>                                                                                                                |
|         <span data-ttu-id="6e0f6-129">defaultUrl</span><span class="sxs-lookup"><span data-stu-id="6e0f6-129">defaultUrl</span></span>         |                                                                                                                                                         <span data-ttu-id="6e0f6-130">ユーザーは、クエリ文字列で指定された RedirectUrl 値がない場合、ログイン ページからサインインした後にリダイレクトされる URL を示します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-130">Indicates the URL that users are redirected to after signing in from the login page if there is no RedirectUrl value specified in the querystring.</span></span> <span data-ttu-id="6e0f6-131">既定値は default.aspx です。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-131">The default value is default.aspx.</span></span>                                                                                                                                                         |
|           <span data-ttu-id="6e0f6-132">ドメイン</span><span class="sxs-lookup"><span data-stu-id="6e0f6-132">domain</span></span>           | <span data-ttu-id="6e0f6-133">Cookie ベースの認証チケットを使用する場合、この設定は、cookie のドメインの値を指定します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-133">When using cookie-based authentication tickets, this setting specifies the cookie's domain value.</span></span> <span data-ttu-id="6e0f6-134">既定値は、発行 (www.yourdomain.com) などがドメインを使用するブラウザーにより空の文字列。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-134">The default value is an empty string, which causes the browser to use the domain from which it was issued (such as www.yourdomain.com).</span></span> <span data-ttu-id="6e0f6-135">クッキーが、この場合、<strong>いない</strong>admin.yourdomain.com などのサブドメインに要求を行う場合に送信されます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-135">In this case, the cookie will <strong>not</strong> be sent when making requests to subdomains, such as admin.yourdomain.com.</span></span> <span data-ttu-id="6e0f6-136">すべてのサブドメインに渡される cookie が必要な場合は、yourdomain.com に設定すると、ドメイン属性をカスタマイズする必要があります。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-136">If you want the cookie to be passed to all subdomains you need to customize the domain attribute setting it to yourdomain.com.</span></span> |
|  <span data-ttu-id="6e0f6-137">enableCrossAppRedirects</span><span class="sxs-lookup"><span data-stu-id="6e0f6-137">enableCrossAppRedirects</span></span>   |                                                                                                                                                                   <span data-ttu-id="6e0f6-138">同じサーバー上の他の web アプリケーションの Url にリダイレクトされたときに、認証されたユーザーが記憶されるかどうかを示すブール値。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-138">A Boolean value indicating whether authenticated users are remembered when redirected to URLs in other web applications on the same server.</span></span> <span data-ttu-id="6e0f6-139">既定値は false です。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-139">The default is false.</span></span>                                                                                                                                                                   |
|          <span data-ttu-id="6e0f6-140">loginUrl</span><span class="sxs-lookup"><span data-stu-id="6e0f6-140">loginUrl</span></span>          |                                                                                                                                                                                                                      <span data-ttu-id="6e0f6-141">ログイン ページの URL。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-141">The URL of the login page.</span></span> <span data-ttu-id="6e0f6-142">既定値は、login.aspx です。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-142">The default value is login.aspx.</span></span>                                                                                                                                                                                                                      |
|            <span data-ttu-id="6e0f6-143">name</span><span class="sxs-lookup"><span data-stu-id="6e0f6-143">name</span></span>            |                                                                                                                                                                                                   <span data-ttu-id="6e0f6-144">Cookie ベースの認証チケット cookie の名前を使用します。 場合、</span><span class="sxs-lookup"><span data-stu-id="6e0f6-144">When using cookie-based authentication tickets, the name of the cookie.</span></span> <span data-ttu-id="6e0f6-145">既定では。ASPXAUTH です。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-145">The default is .ASPXAUTH.</span></span>                                                                                                                                                                                                   |
|            <span data-ttu-id="6e0f6-146">path</span><span class="sxs-lookup"><span data-stu-id="6e0f6-146">path</span></span>            |                                                                             <span data-ttu-id="6e0f6-147">Cookie ベースの認証チケットを使用する場合、この設定は、cookie のパス属性を指定します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-147">When using cookie-based authentication tickets, this setting specifies the cookie's path attribute.</span></span> <span data-ttu-id="6e0f6-148">Path 属性は、開発者は特定のディレクトリ階層のクッキーのスコープを制限できます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-148">The path attribute enables a developer to limit the scope of a cookie to a particular directory hierarchy.</span></span> <span data-ttu-id="6e0f6-149">既定値は、/ドメインへの要求に認証チケットのクッキーを送信するブラウザーに通知します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-149">The default value is /, which informs the browser to send the authentication ticket cookie to any request made to the domain.</span></span>                                                                              |
|         <span data-ttu-id="6e0f6-150">保護</span><span class="sxs-lookup"><span data-stu-id="6e0f6-150">protection</span></span>         |                                                                                                                                            <span data-ttu-id="6e0f6-151">フォーム認証チケットの保護にどのような手法を使用することを示します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-151">Indicates what techniques are used to protect the forms authentication ticket.</span></span> <span data-ttu-id="6e0f6-152">使用可能な値: すべて (既定)。暗号化。None;および検証します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-152">The allowable values are: All (the default); Encryption; None; and Validation.</span></span> <span data-ttu-id="6e0f6-153">これらの設定は、手順 3 で詳しく説明します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-153">These settings are discussed in detail in Step 3.</span></span>                                                                                                                                            |
|         <span data-ttu-id="6e0f6-154">requireSSL</span><span class="sxs-lookup"><span data-stu-id="6e0f6-154">requireSSL</span></span>         |                                                                                                                                                                                <span data-ttu-id="6e0f6-155">認証クッキーを送信する SSL 接続が必要かどうかを示すブール値。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-155">A Boolean value that indicates whether an SSL connection is required to transmit the authentication cookie.</span></span> <span data-ttu-id="6e0f6-156">既定値は false です。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-156">The default value is false.</span></span>                                                                                                                                                                                |
|     <span data-ttu-id="6e0f6-157">slidingExpiration</span><span class="sxs-lookup"><span data-stu-id="6e0f6-157">slidingExpiration</span></span>      |                                                                                                 <span data-ttu-id="6e0f6-158">ユーザーが 1 つのセッション中にサイトを訪問するたびにリセットは、認証 cookie のタイムアウトかどうかを示すブール値。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-158">A Boolean value that indicates whether the authentication cookie's timeout is reset each time the user visits the site during a single session.</span></span> <span data-ttu-id="6e0f6-159">既定値は true です。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-159">The default value is true.</span></span> <span data-ttu-id="6e0f6-160">認証チケットのタイムアウト ポリシーが、指定することで詳細に説明されているチケットのタイムアウト値のセクション。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-160">The authentication ticket timeout policy is discussed in more detail in the Specifying the Ticket's Timeout Value section.</span></span>                                                                                                 |
|          <span data-ttu-id="6e0f6-161">タイムアウト</span><span class="sxs-lookup"><span data-stu-id="6e0f6-161">timeout</span></span>           |                                                                                                                               <span data-ttu-id="6e0f6-162">認証チケットのクッキーの有効期限が切れるまでの分、時間を指定します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-162">Specifies the time, in minutes, after which the authentication ticket cookie expires.</span></span> <span data-ttu-id="6e0f6-163">既定値は、30 です。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-163">The default value is 30.</span></span> <span data-ttu-id="6e0f6-164">認証チケットのタイムアウト ポリシーが、指定することで詳細に説明されているチケットのタイムアウト値のセクション。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-164">The authentication ticket timeout policy is discussed in more detail in the Specifying the Ticket's Timeout Value section.</span></span>                                                                                                                               |

<span data-ttu-id="6e0f6-165">**表 1.**: の A の概要、&lt;フォーム&gt;要素の属性</span><span class="sxs-lookup"><span data-stu-id="6e0f6-165">**Table 1**: A Summary of the &lt;forms&gt; Element's Attributes</span></span>

<span data-ttu-id="6e0f6-166">ASP.NET 2.0 では、既定値を超えるフォーム認証の値は FormsAuthenticationConfiguration クラス、.NET Framework でハード コードされます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-166">In ASP.NET 2.0 and beyond, the default forms authentication values are hard-coded in the FormsAuthenticationConfiguration class in the .NET Framework.</span></span> <span data-ttu-id="6e0f6-167">Web.config ファイルで、アプリケーションによるごとに変更を適用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-167">Any modifications must be applied on an application-by-application basis in the Web.config file.</span></span> <span data-ttu-id="6e0f6-168">一方、ASP.NET 1.x では、フォーム認証の既定値、machine.config ファイルに格納されていた (ありため、machine.config を編集して変更できます)。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-168">This differs from ASP.NET 1.x, where the default forms authentication values were stored in the machine.config file (and could therefore be modified via editing machine.config).</span></span> <span data-ttu-id="6e0f6-169">ASP.NET のトピックで説明することは、1.x では、さまざまなフォーム認証システムの設定がある ASP.NET 2.0 では、異なる既定値の asp.net よりも拡張 1.x します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-169">While on the topic of ASP.NET 1.x, it is worthwhile to mention that a number of the forms authentication system settings have different default values in ASP.NET 2.0 and beyond than in ASP.NET 1.x.</span></span> <span data-ttu-id="6e0f6-170">ASP.NET 1.x 環境からアプリケーションを移行する場合は、これらの違いを意識する必要があります。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-170">If you are migrating your application from an ASP.NET 1.x environment, it is important to be aware of these differences.</span></span> <span data-ttu-id="6e0f6-171">参照してください[、&lt;フォーム&gt;要素のテクニカル ドキュメント](https://msdn.microsoft.com/library/1d3t3c61.aspx)の相違点の一覧についてはします。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-171">Consult [the &lt;forms&gt; element technical documentation](https://msdn.microsoft.com/library/1d3t3c61.aspx) for a list of the differences.</span></span>

> [!NOTE]
> <span data-ttu-id="6e0f6-172">タイムアウト、ドメイン、および、パスなど、いくつかのフォーム認証設定は、結果として得られるフォーム認証チケット cookie の詳細を指定します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-172">Several forms authentication settings, such as the timeout, domain, and path, specify details for the resulting forms authentication ticket cookie.</span></span> <span data-ttu-id="6e0f6-173">Cookie、そのしくみ、およびそのさまざまなプロパティの詳細については、読み取る[この Cookie チュートリアル](http://www.quirksmode.org/js/cookies.html)します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-173">For more information on cookies, how they work, and their various properties, read [this Cookies tutorial](http://www.quirksmode.org/js/cookies.html).</span></span>


### <a name="specifying-the-tickets-timeout-value"></a><span data-ttu-id="6e0f6-174">チケットのタイムアウト値を指定します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-174">Specifying the Ticket's Timeout Value</span></span>

<span data-ttu-id="6e0f6-175">フォーム認証チケットは、id を表すトークンです。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-175">The forms authentication ticket is a token that represents an identity.</span></span> <span data-ttu-id="6e0f6-176">このトークンは、cookie ベースの認証チケットを cookie の形式で保持されているし、要求ごとに web サーバーに送信します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-176">With cookie-based authentication tickets, this token is held in the form of a cookie and sent to the web server on each request.</span></span> <span data-ttu-id="6e0f6-177">トークンを所有しているが基本的には、宣言、私は*username*に既にログインし、ページの訪問者の間でユーザーの id を記憶できるように使用されます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-177">Possession of the token, in essence, declares, I am *username*, I have already logged in, and is used so that a user's identity can be remembered across page visits.</span></span>

<span data-ttu-id="6e0f6-178">フォーム認証チケットだけでなく、ユーザーの id が含まれていますが、整合性と、トークンのセキュリティを確保する情報も含まれます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-178">The forms authentication ticket not only includes the user's identity, but also contains information to help ensure the integrity and security of the token.</span></span> <span data-ttu-id="6e0f6-179">結局のところ、不正なユーザー underhanded 何らかのトークンの正当なエントリを変更したり、偽造のトークンを作成することがほしくありません。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-179">After all, we don't want a nefarious user to be able to create a counterfeit token, or to modify a legit token in some underhanded way.</span></span>

<span data-ttu-id="6e0f6-180">チケットに含まれる情報のような 1 つのビットは、*有効期限*、これは、チケットが無効になった日時。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-180">One such bit of information included in the ticket is an *expiry*, which is the date and time the ticket is no longer valid.</span></span> <span data-ttu-id="6e0f6-181">FormsAuthenticationModule は、認証チケットを検査するたびに、チケットの有効期限がまだ達していないことを保証します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-181">Each time the FormsAuthenticationModule inspects an authentication ticket, it ensures that the ticket's expiry has not yet passed.</span></span> <span data-ttu-id="6e0f6-182">場合は、チケットは無視され、匿名としてユーザーを識別します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-182">If it has, it disregards the ticket and identifies the user as being anonymous.</span></span> <span data-ttu-id="6e0f6-183">このセーフガードは、リプレイ攻撃から保護するのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-183">This safeguard helps protect against replay attacks.</span></span> <span data-ttu-id="6e0f6-184">ない場合は、ハッカーが自分のコンピューターに物理的にアクセスし、cookie を root 化によって、おそらく自分のユーザーの有効な認証チケットのハンズオンを取得することでこの盗難にあった認証チケットを使用してサーバーに要求を送信する可能性があります、有効期限とエントリを取得します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-184">Without an expiry, if a hacker was able to get her hands on a user's valid authentication ticket - perhaps by gaining physical access to their computer and rooting through their cookies - they could send a request to the server with this stolen authentication ticket and gain entry.</span></span> <span data-ttu-id="6e0f6-185">有効期限は、このシナリオを防ぐため、中には、このような攻撃が成功するウィンドウを制限します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-185">While the expiry doesn't prevent this scenario, it does limit the window during which such an attack can succeed.</span></span>

> [!NOTE]
> <span data-ttu-id="6e0f6-186">手順 3 の詳細その他の方法、フォーム認証システムで認証チケットを保護するために使用します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-186">Step 3 details additional techniques used by the forms authentication system to protect the authentication ticket.</span></span>


<span data-ttu-id="6e0f6-187">認証チケットを作成するときに、フォーム認証システムは、タイムアウト設定を参照してその有効期限を決定します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-187">When creating the authentication ticket, the forms authentication system determines its expiry by consulting the timeout setting.</span></span> <span data-ttu-id="6e0f6-188">表 1 では、タイムアウトを 30 分に既定値の設定で説明したようには、フォーム認証チケットの作成時に、その有効期限が、日付と時刻の 30 分後に設定されていることを意味します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-188">As noted in Table 1, the timeout setting defaults to 30 minutes, meaning that when the forms authentication ticket is created its expiry is set to a date and time 30 minutes in the future.</span></span>

<span data-ttu-id="6e0f6-189">有効期限が切れる絶対時刻が将来のフォーム認証チケットの有効期限が切れるを定義します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-189">The expiry defines an absolute time in the future when the forms authentication ticket expires.</span></span> <span data-ttu-id="6e0f6-190">通常は開発者が、ユーザーは、サイトを見直してたびにリセットするスライド式の有効期限を実装します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-190">But usually developers want to implement a sliding expiry, one that is reset every time the user revisits the site.</span></span> <span data-ttu-id="6e0f6-191">この動作は、slidingExpiration 設定によって決定されます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-191">This behavior is determined by the slidingExpiration settings.</span></span> <span data-ttu-id="6e0f6-192">FormsAuthenticationModule は、ユーザーを認証するたびに true (既定値) に設定を更新、チケットの有効期限。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-192">If set to true (the default), each time the FormsAuthenticationModule authenticates a user, it updates the ticket's expiry.</span></span> <span data-ttu-id="6e0f6-193">要求ごとに、有効期限を false に設定が更新されない場合は、チケットを過去の場合、チケットが最初の分のタイムアウト数を正確に有効期限が切れる原因となり作成されます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-193">If set to false, the expiry is not updated on each request, thereby causing the ticket to expire exactly timeout number of minutes past when the ticket was first created.</span></span>

> [!NOTE]
> <span data-ttu-id="6e0f6-194">認証チケットに格納されている有効期限は、絶対日付と 2008 年 8 月 2 日午前 11時 34分のように、時刻の値です。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-194">The expiry stored in the authentication ticket is an absolute date and time value, like August 2, 2008 11:34 AM.</span></span> <span data-ttu-id="6e0f6-195">さらに、日付と時刻は、web サーバーのローカル時間を基準とは。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-195">Moreover, the date and time are relative to the web server's local time.</span></span> <span data-ttu-id="6e0f6-196">この設計の決定には、いくつか興味深い副作用を夏時間 (DST)、(web サーバーが夏時間のタイムが発生したロケールでホストされていると仮定)、1 時間先移動米国の州のクロックであることができます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-196">This design decision can have some interesting side effects around Daylight Saving Time (DST), which is when clocks in the United States are moved ahead one hour (assuming the web server is hosted in a locale where Daylight Saving Time is observed).</span></span> <span data-ttu-id="6e0f6-197">DST の開始時刻の近くの 30 分間の有効期限と ASP.NET web サイトに行われる処理を検討してください (2時 00分 am です)。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-197">Consider what would happen for an ASP.NET website with a 30 minute expiry near the time that DST begins (which is at 2:00 AM).</span></span> <span data-ttu-id="6e0f6-198">訪問者にサインオンし、サイト、2008 年 3 月 11 日の午前 1時 55分を想像してください。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-198">Imagine a visitor signs on to the site on March 11, 2008 at 1:55 AM.</span></span> <span data-ttu-id="6e0f6-199">これにより、2時 25分 AM (30 分後) に、2008 年 3 月 11 日に期限切れになるフォーム認証チケットが生成されます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-199">This would generate a forms authentication ticket that expires at March 11, 2008 at 2:25 AM (30 minutes in the future).</span></span> <span data-ttu-id="6e0f6-200">ただし、2時 00分 AM をロールに、クロック ジャンプ 3時 00分 am DST によりします。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-200">However, once 2:00 AM rolls around, the clock jumps to 3:00 AM because of DST.</span></span> <span data-ttu-id="6e0f6-201">ユーザーには、(3時 01分 AM) にサインインした後に 6 分間に新しいページが読み込まれる、FormsAuthenticationModule は、チケットが有効期限が切れたし、ユーザーをログイン ページにリダイレクトすることを示します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-201">When the user loads a new page six minutes after signing in (at 3:01 AM), the FormsAuthenticationModule notes that the ticket has expired and redirects the user to the login page.</span></span> <span data-ttu-id="6e0f6-202">これと他の認証チケットのタイムアウト奇妙な動作、ほかの回避策の詳細については、Stefan Schackow のコピーを取得します*Professional ASP.NET 2.0 のセキュリティ、メンバーシップ、およびロール管理*(ISBN:。978-0-7645-9698-8)。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-202">For a more thorough discussion on this and other authentication ticket timeout oddities, as well as workarounds, pick up a copy of Stefan Schackow's *Professional ASP.NET 2.0 Security, Membership, and Role Management* (ISBN: 978-0-7645-9698-8).</span></span>


<span data-ttu-id="6e0f6-203">図 1 は、slidingExpiration が false に設定して、タイムアウトが 30 に設定するときにワークフローを示します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-203">Figure 1 illustrates the workflow when slidingExpiration is set to false and timeout is set to 30.</span></span> <span data-ttu-id="6e0f6-204">ログイン時に生成された認証チケットには、有効期限の日付が含まれていて、後続の要求では、この値は更新されていません。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-204">Note that the authentication ticket generated at login contains the expiration date, and this value is not updated on subsequent requests.</span></span> <span data-ttu-id="6e0f6-205">FormsAuthenticationModule では、チケットの期限が切れたことが検出されると、それを破棄し、匿名として、要求を処理します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-205">If the FormsAuthenticationModule finds that the ticket has expired, it discards it and treats the request as anonymous.</span></span>


<span data-ttu-id="6e0f6-206">[![フォーム認証チケットの有効期限と slidingExpiration のグラフィカル表現は false です。](forms-authentication-configuration-and-advanced-topics-cs/_static/image2.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="6e0f6-206">[![A Graphical Representation of the Forms Authentication Ticket's Expiry When slidingExpiration is false](forms-authentication-configuration-and-advanced-topics-cs/_static/image2.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image1.png)</span></span>

<span data-ttu-id="6e0f6-207">**図 01**: A がグラフィカルにフォーム認証チケットの有効期限と slidingExpiration が false ([フルサイズの画像を表示する をクリックします](forms-authentication-configuration-and-advanced-topics-cs/_static/image3.png))。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-207">**Figure 01**: A Graphical Representation of the Forms Authentication Ticket's Expiry When slidingExpiration is false([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image3.png))</span></span>


<span data-ttu-id="6e0f6-208">SlidingExpiration に設定すると、図 2 は、ワークフローを示しています true とタイムアウトが 30 に設定します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-208">Figure 2 shows the workflow when slidingExpiration is set to true and timeout is set to 30.</span></span> <span data-ttu-id="6e0f6-209">(有効期限のないチケット) を使用して認証された要求が受信したときに、その有効期限は、タイムアウト時間 (分)、将来に更新されます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-209">When an authenticated request is received (with a non-expired ticket) its expiry is updated to timeout number of minutes in the future.</span></span>


<span data-ttu-id="6e0f6-210">[![フォーム認証チケットのグラフィカル表現 slidingExpiration が true の場合](forms-authentication-configuration-and-advanced-topics-cs/_static/image5.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="6e0f6-210">[![A Graphical Representation of the Forms Authentication Ticket's When slidingExpiration is true](forms-authentication-configuration-and-advanced-topics-cs/_static/image5.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image4.png)</span></span>

<span data-ttu-id="6e0f6-211">**図 02**: A がグラフィカルにフォーム認証チケットの slidingExpiration が true の場合 ([フルサイズの画像を表示する をクリックします](forms-authentication-configuration-and-advanced-topics-cs/_static/image6.png))。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-211">**Figure 02**: A Graphical Representation of the Forms Authentication Ticket's When slidingExpiration is true  ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image6.png))</span></span>


<span data-ttu-id="6e0f6-212">Cookie ベースの認証チケット (既定値) を使用する場合このディスカッション cookie は、指定された独自の切れことがあるできますので、もう少し複雑になります。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-212">When using cookie-based authentication tickets (the default), this discussion becomes a little more confusing because cookies can also have their own expiries specified.</span></span> <span data-ttu-id="6e0f6-213">Cookie の有効期限 (または欠如) クッキーを破棄する必要があるときに、ブラウザーに指示します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-213">A cookie's expiry (or lack thereof) instructs the browser when the cookie should be destroyed.</span></span> <span data-ttu-id="6e0f6-214">Cookie に有効期限がない場合、ブラウザーがシャット ダウン時に破棄されます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-214">If the cookie lacks an expiry, it is destroyed when the browser shuts down.</span></span> <span data-ttu-id="6e0f6-215">ただし、有効期限が存在する場合は、日まで、cookie がユーザーのコンピューターに格納されていると、有効期限で指定された時間が経過します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-215">If an expiry is present, however, the cookie remains stored on the user's computer until the date and time specified in the expiry has passed.</span></span> <span data-ttu-id="6e0f6-216">ブラウザーで cookie が破棄されると、不要になった web サーバーに送信されます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-216">When a cookie is destroyed by the browser, it is no longer sent to the web server.</span></span> <span data-ttu-id="6e0f6-217">そのため、cookie の破棄は、ユーザーのサイトからのログインに似ています。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-217">Therefore, the destruction of a cookie is analogous to the user logging out of the site.</span></span>

> [!NOTE]
> <span data-ttu-id="6e0f6-218">もちろん、ユーザーは、自分のコンピューターに格納されているすべての cookie を事前に削除できます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-218">Of course, a user may proactively remove any cookies stored on their computer.</span></span> <span data-ttu-id="6e0f6-219">Internet Explorer 7 はツール]、[オプション] に移動し、[閲覧の履歴セクションで [削除] ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-219">In Internet Explorer 7, you would go to Tools, Options, and click the Delete button in the Browsing history section.</span></span> <span data-ttu-id="6e0f6-220">そこから、cookie の削除 ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-220">From there, click the Delete cookies button.</span></span>


<span data-ttu-id="6e0f6-221">フォーム認証システムに渡される値によって、セッション ベースまたは有効期限ベースの cookie を作成し、 *persistCookie*パラメーター。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-221">The forms authentication system creates session-based or expiry-based cookies depending on the value passed in to the *persistCookie* parameter.</span></span> <span data-ttu-id="6e0f6-222">再現率、FormsAuthentication クラスの GetAuthCookie、SetAuthCookie、RedirectFromLoginPage のメソッドが 2 つの入力パラメーターに取る: *username*と*persistCookie*します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-222">Recall that the FormsAuthentication class's GetAuthCookie, SetAuthCookie, and RedirectFromLoginPage methods take in two input parameters: *username* and *persistCookie*.</span></span> <span data-ttu-id="6e0f6-223">前のチュートリアルで作成したログイン ページには、アカウントを記憶 チェック ボックス、永続的なクッキーが作成されたかどうかを決定が含まれています。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-223">The login page we created in the preceding tutorial included a Remember me CheckBox, which determined whether a persistent cookie was created.</span></span> <span data-ttu-id="6e0f6-224">永続的な cookie は、有効期限ベースです。非永続の cookie は、セッション ベースです。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-224">Persistent cookies are expiry-based; non-persistent cookies are session-based.</span></span>

<span data-ttu-id="6e0f6-225">既に説明したタイムアウトと slidingExpiration の概念には、両方のセッションおよび有効期限ベースの cookie に同じが適用されます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-225">The timeout and slidingExpiration concepts already discussed apply the same to both session- and expiry-based cookies.</span></span> <span data-ttu-id="6e0f6-226">実行で 1 つだけの小さな違いがある: を true に設定された slidingTimeout cookie の有効期限ベースを使用する場合、cookie の有効期限のみ更新されます以上の指定した時間の半分が経過しました。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-226">There is only one minor difference in execution: when using expiry-based cookies with slidingTimeout set to true, the cookie's expiry is only updated when more than half of the specified time has elapsed.</span></span>

<span data-ttu-id="6e0f6-227">チケットのスライド式有効期限を使用して、1 時間 (60 分) 後にタイムアウトを実行するため、web サイトの認証チケットのタイムアウト ポリシーを更新してみましょう。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-227">Let's update our website's authentication ticket timeout policies so that tickets timeout after one hour (60 minutes), using a sliding expiration.</span></span> <span data-ttu-id="6e0f6-228">この変更の影響を与える、Web.config ファイルの更新の追加、&lt;フォーム&gt;要素を&lt;認証&gt;を次のマークアップ要素。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-228">To effect this change, update the Web.config file, adding a &lt;forms&gt; element to the &lt;authentication&gt; element with the following markup:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample2.xml)]

### <a name="using-an-login-page-url-other-than-loginaspx"></a><span data-ttu-id="6e0f6-229">Login.aspx 以外のログイン ページの URL を使用します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-229">Using an Login Page URL Other than Login.aspx</span></span>

<span data-ttu-id="6e0f6-230">FormsAuthenticationModule は、ログイン ページに自動的に承認されていないユーザーをリダイレクト、されるので、ログイン ページの url が必要です。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-230">Since the FormsAuthenticationModule automatically redirects unauthorized users to the login page, it needs to know the login page's URL.</span></span> <span data-ttu-id="6e0f6-231">この URL は loginUrl 属性で指定された、&lt;フォーム&gt;要素、既定値は login.aspx です。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-231">This URL is specified by the loginUrl attribute in the &lt;forms&gt; element and defaults to login.aspx.</span></span> <span data-ttu-id="6e0f6-232">既存の web サイト経由で移植する場合は、別の URL、ブックマークを設定および検索エンジンによってインデックスが作成された既にいずれかでログイン ページを既にがあります。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-232">If you are porting over an existing website, you may already have a login page with a different URL, one that has already been bookmarked and indexed by search engines.</span></span> <span data-ttu-id="6e0f6-233">Login.aspx に、既存のログイン ページの名前を変更して、リンクやユーザーのブックマークの重大なではなく代わりに、ログイン ページを指す loginUrl 属性を変更できます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-233">Rather than renaming your existing login page to login.aspx and breaking links and users' bookmarks, you can instead modify the loginUrl attribute to point to your login page.</span></span>

<span data-ttu-id="6e0f6-234">たとえば、ログイン ページが SignIn.aspx をという名前がユーザー ディレクトリに存在していた場合は、~/Users/SignIn.aspx loginUrl 構成設定を指し示すでした次のようにします。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-234">For example, if your login page was named SignIn.aspx and was located in the Users directory, you could point the loginUrl configuration setting to ~/Users/SignIn.aspx like so:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample3.xml)]

<span data-ttu-id="6e0f6-235">カスタム値を指定する必要はありません、現在のアプリケーションは既にには、Login.aspx という名前のログイン ページがあるので、&lt;フォーム&gt;要素。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-235">Since our current application already has a login page named Login.aspx, there's no need to specify a custom value in the &lt;forms&gt; element.</span></span>

## <a name="step-2-using-cookieless-forms-authentication-tickets"></a><span data-ttu-id="6e0f6-236">手順 2: Cookieless フォーム認証チケットを使用します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-236">Step 2: Using Cookieless Forms Authentication Tickets</span></span>

<span data-ttu-id="6e0f6-237">既定では、フォーム認証システムには、その認証チケットをクッキー コレクションに格納したり、サイトにアクセスしてユーザー エージェントに基づく URL に埋め込むかどうかが決定します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-237">By default the forms authentication system determines whether to store its authentication tickets in the cookies collection or embed them in the URL based on the user agent visiting the site.</span></span> <span data-ttu-id="6e0f6-238">メイン ストリームのすべてのデスクトップ ブラウザーなど、Internet Explorer、Firefox、Opera、Safari、およびサポート cookie がないすべてのモバイル デバイスの操作を行います。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-238">All mainstream desktop browsers like Internet Explorer, Firefox, Opera, and Safari, support cookies, but not all mobile devices do.</span></span>

<span data-ttu-id="6e0f6-239">フォーム認証システムによって使用される cookie のポリシーが cookie なしの設定に依存、&lt;フォーム&gt;要素、4 つの値の 1 つ割り当てることができます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-239">The cookie policy used by the forms authentication system depends on the cookieless setting in the &lt;forms&gt; element, which can be assigned one of four values:</span></span>

- <span data-ttu-id="6e0f6-240">既定値には、cookie ベースの認証チケットを常に使用することを指定します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-240">UseCookies - specifies that cookie-based authentication tickets will always be used.</span></span>
- <span data-ttu-id="6e0f6-241">UseUri - は、cookie ベースの認証チケットを使用しないことを示します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-241">UseUri - indicates that cookie-based authentication tickets will never be used.</span></span>
- <span data-ttu-id="6e0f6-242">自動検出 - デバイスのプロファイルは、cookie ベースの認証チケット cookie をサポートしていない場合は使用されません。デバイス プロファイルでは、cookie をサポートする場合、プローブ メカニズムは、cookie が有効になっているかどうかを確認に使用されます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-242">AutoDetect - if the device profile does not support cookies, cookie-based authentication tickets are not used; if the device profile supports cookies, a probing mechanism is used to determine if cookies are enabled.</span></span>
- <span data-ttu-id="6e0f6-243">UseDeviceProfile - 既定では、デバイス プロファイルは、cookie をサポートしている場合にのみ、クッキー ベースの認証チケットを使用します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-243">UseDeviceProfile - the default; uses cookie-based authentication tickets only if the device profile supports cookies.</span></span> <span data-ttu-id="6e0f6-244">プローブのメカニズムは使用されません。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-244">No probing mechanism is used.</span></span>

<span data-ttu-id="6e0f6-245">自動検出と値の設定に依存、*デバイス プロファイル*で cookie を使用するか cookie なしの認証チケットを使用するかどうかを確認します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-245">The AutoDetect and UseDeviceProfile settings rely on a *device profile* in ascertaining whether to use cookie-based or cookieless authentication tickets.</span></span> <span data-ttu-id="6e0f6-246">ASP.NET では、さまざまなデバイスとその機能、cookie をサポートしているかどうか、JavaScript をサポートしているのバージョンなどのデータベースを保持します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-246">ASP.NET maintains a database of various devices and their capabilities, such as whether they support cookies, what version of JavaScript they support, and so on.</span></span> <span data-ttu-id="6e0f6-247">毎回デバイスに送信する web サーバーから web ページを要求する*ユーザー エージェント*デバイスの種類を識別する HTTP ヘッダー。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-247">Each time a device requests a web page from a web server it sends along a *user-agent* HTTP header that identifies the device type.</span></span> <span data-ttu-id="6e0f6-248">ASP.NET には、そのデータベースで指定された対応するプロファイルで指定されたユーザー エージェント文字列に自動的と一致します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-248">ASP.NET automatically matches the supplied user-agent string with the corresponding profile specified in its database.</span></span>

> [!NOTE]
> <span data-ttu-id="6e0f6-249">デバイスの機能には、このデータベースに準拠している複数の XML ファイルに格納されている、[ブラウザー定義ファイルのスキーマ](https://msdn.microsoft.com/library/ms228122.aspx)します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-249">This database of device capabilities is stored in a number of XML files that adhere to the [Browser Definition File schema](https://msdn.microsoft.com/library/ms228122.aspx).</span></span> <span data-ttu-id="6e0f6-250">既定のデバイス プロファイル ファイルは、%windir%\microsoft.net\framework\v2.0.50727\config\browsers に配置されます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-250">The default device profile files are located in %WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG\Browsers.</span></span> <span data-ttu-id="6e0f6-251">アプリケーションのアプリにカスタム ファイルを追加することもできます。\_ブラウザー フォルダー。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-251">You can also add custom files to your application's App\_Browsers folder.</span></span> <span data-ttu-id="6e0f6-252">詳細については、次を参照してください。 [How To: ブラウザーの種類を検出する ASP.NET Web Pages で](https://msdn.microsoft.com/library/3yekbd5b.aspx)します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-252">For more information, see [How To: Detect Browser Types in ASP.NET Web Pages](https://msdn.microsoft.com/library/3yekbd5b.aspx).</span></span>


<span data-ttu-id="6e0f6-253">既定の設定は、値であるため cookieless フォーム認証チケットはプロファイルが cookie がサポートされていないことを報告するデバイスで、サイトがアクセスしたときに使用されます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-253">Because the default setting is UseDeviceProfile, cookieless forms authentication tickets will be used when the site is visited by a device whose profile reports that it does not support cookies.</span></span>

### <a name="encoding-the-authentication-ticket-in-the-url"></a><span data-ttu-id="6e0f6-254">URL の認証チケットのエンコード</span><span class="sxs-lookup"><span data-stu-id="6e0f6-254">Encoding the Authentication Ticket in the URL</span></span>

<span data-ttu-id="6e0f6-255">Cookie は、訪問先デバイスには、それらがサポートしている場合、既定のフォーム認証設定が cookie を使用する理由は、その web サイトへの要求ごとに、ブラウザーからの情報を含めるの自然なメディアです。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-255">Cookies are a natural medium for including information from the browser in each request to a particular website, which is why the default forms authentication settings use cookies if the visiting device supports them.</span></span> <span data-ttu-id="6e0f6-256">Cookie がサポートされていない場合は、クライアントからサーバーに認証チケットを渡すための別の方法が採用されている必要があります。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-256">If cookies are not supported, an alternate means for passing the authentication ticket from the client to the server must be employed.</span></span> <span data-ttu-id="6e0f6-257">Cookie なしの環境で使用される一般的な回避策では、URL で cookie のデータをエンコードします。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-257">A common workaround used in cookieless environments is to encode the cookie data in the URL.</span></span>

<span data-ttu-id="6e0f6-258">URL 内でこのような情報を埋め込むことがどのように表示する最善の方法は、サイトでクッキーなしの認証チケットを使用するされます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-258">The best way to see how such information can be embedded within the URL is to force the site to use cookieless authentication tickets.</span></span> <span data-ttu-id="6e0f6-259">これは、UseUri に cookie なしの構成設定を設定して実行できます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-259">This can be accomplished by setting the cookieless configuration setting to UseUri:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample4.xml)]

<span data-ttu-id="6e0f6-260">この変更を行った場合、ブラウザーを使用してサイトを参照してください。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-260">Once you have made this change, visit the site through a browser.</span></span> <span data-ttu-id="6e0f6-261">匿名ユーザーとしてすると、Url は以前とまったく同じになります。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-261">When visiting as an anonymous user, the URLs will look exactly like they did before.</span></span> <span data-ttu-id="6e0f6-262">たとえば、Default.aspx ページにアクセスすると、ブラウザーのアドレス バーは、次の URL を示しています。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-262">For example, when visiting Default.aspx page my browser's address bar shows the following URL:</span></span>

`http://localhost:2448/ASPNET\_Security\_Tutorial\_03\_CS/default.aspx`

<span data-ttu-id="6e0f6-263">ただし、ログイン時にフォーム認証チケットが URL に埋め込まれます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-263">However, upon logging in, the forms authentication ticket is embedded into the URL.</span></span> <span data-ttu-id="6e0f6-264">たとえば、ログイン ページにアクセスし、Sam としてログインした後、Default.aspx ページに戻るいますが、URL のこの時間は。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-264">For example, after visiting the login page and logging in as Sam, I am returned to the Default.aspx page, but the URL this time is:</span></span>

`http://localhost:2448/ASPNET\_Security\_Tutorial\_03\_CS/(F(jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2))/default.aspx`

<span data-ttu-id="6e0f6-265">URL 内で、フォーム認証チケットが埋め込まれています。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-265">The forms authentication ticket has been embedded within the URL.</span></span> <span data-ttu-id="6e0f6-266">文字列 (F (jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv rfezq0gKadKX0YPZCkA2)、16 進エンコードされた認証チケット情報を表し、cookie に通常格納されている同じデータです。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-266">The string (F(jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2) represents the hex-encoded authentication ticket information, and is the same data that is usually stored within a cookie.</span></span>

<span data-ttu-id="6e0f6-267">クッキーなしの認証チケットさせるためには、システムは、認証チケットのデータを含める ページのすべての Url をエンコードする必要があります、それ以外の場合、認証チケットは、ユーザーがリンクをクリックすると失われます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-267">In order for cookieless authentication tickets to work, the system must encode all URLs on the page to include the authentication ticket data, otherwise the authentication ticket will be lost when the user clicks on a link.</span></span> <span data-ttu-id="6e0f6-268">さいわいにも、この埋め込みロジックは、自動的に実行されます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-268">Thankfully, this embedding logic is performed automatically.</span></span> <span data-ttu-id="6e0f6-269">この機能を示すためには、Default.aspx ページを開き、テキストと NavigateUrl プロパティをテスト用のリンクと SomePage.aspx に設定すると、それぞれ、ハイパーリンク コントロールを追加します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-269">To demonstrate this functionality, open the Default.aspx page and add a HyperLink control, setting its Text and NavigateUrl properties to Test Link and SomePage.aspx, respectively.</span></span> <span data-ttu-id="6e0f6-270">ありませんページ SomePage.aspx という名前のプロジェクトでは関係ありません。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-270">It doesn't matter that there really isn't a page in our project named SomePage.aspx.</span></span>

<span data-ttu-id="6e0f6-271">Default.aspx に変更を保存し、ブラウザーを使用しを参照してください。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-271">Save the changes to Default.aspx and then visit it through a browser.</span></span> <span data-ttu-id="6e0f6-272">フォーム認証チケットが URL に埋め込まれているように、サイトにログオンします。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-272">Log on to the site so that the forms authentication ticket is embedded in the URL.</span></span> <span data-ttu-id="6e0f6-273">次に、Default.aspx からには、テスト用のリンクのリンクをクリックします。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-273">Next, from Default.aspx, click the Test Link link.</span></span> <span data-ttu-id="6e0f6-274">どうなっているのでしょうか。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-274">What happened?</span></span> <span data-ttu-id="6e0f6-275">SomePage.aspx という名前のページが存在しない場合、404 エラーが発生しましたが、いない重要なはここでは。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-275">If no page named SomePage.aspx exists, then a 404 error occurred, but that's not what's important here.</span></span> <span data-ttu-id="6e0f6-276">お使いのブラウザーのアドレス バーに専念します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-276">Instead, focus on the Address bar in your browser.</span></span> <span data-ttu-id="6e0f6-277">URL にフォーム認証チケットに含まれていることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-277">Note that it includes the forms authentication ticket in the URL!</span></span>

`http://localhost:2448/ASPNET\_Security\_Tutorial\_03\_CS/(F(jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2))/SomePage.aspx`

<span data-ttu-id="6e0f6-278">リンク URL SomePage.aspx が認証チケットに含まれている URL に変換が自動的にコードがまったくを記述する必要があるしませんでした。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-278">The URL SomePage.aspx in the link was automatically converted into a URL that included the authentication ticket - we didn't have to write a lick of code!</span></span> <span data-ttu-id="6e0f6-279">フォーム認証チケットで始まらない任意のハイパーリンクの URL を自動的に埋め込まれる`http://`または`/`します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-279">The form authentication ticket will automatically be embedded in the URL for any hyperlinks that do not start with `http://` or `/`.</span></span> <span data-ttu-id="6e0f6-280">Response.Redirect への呼び出しで、ハイパーリンク コントロール、または HTML アンカー要素内にハイパーリンクが表示されるかは関係がありません (つまり、 `<a href="...">...</a>`)。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-280">It doesn't matter if the hyperlink appears in a call to Response.Redirect, in a HyperLink control, or in an anchor HTML element (i.e., `<a href="...">...</a>`).</span></span> <span data-ttu-id="6e0f6-281">URL のようなものでない限り、`http://www.someserver.com/SomePage.aspx`または`/SomePage.aspx`、フォーム認証チケットは、私たちにとって埋め込まれます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-281">As long as the URL isn't something like `http://www.someserver.com/SomePage.aspx` or `/SomePage.aspx`, the forms authentication ticket will be embedded for us.</span></span>

> [!NOTE]
> <span data-ttu-id="6e0f6-282">Cookieless フォーム認証チケットは、cookie ベースの認証チケットとして同じタイムアウト ポリシーに準拠します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-282">Cookieless forms authentication tickets adhere to the same timeout policies as cookie-based authentication tickets.</span></span> <span data-ttu-id="6e0f6-283">ただし、クッキーなしの認証チケットは、認証チケットが URL に直接埋め込まれているために、リプレイ攻撃を受けやすいです。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-283">However, cookieless authentication tickets are more prone to replay attacks since the authentication ticket is embedded directly in the URL.</span></span> <span data-ttu-id="6e0f6-284">Web サイトを訪問、ログイン、および同僚に電子メールで URL を貼り付けますユーザーを想像してください。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-284">Imagine a user who visits a website, logs in, and then pastes the URL in an email to a colleague.</span></span> <span data-ttu-id="6e0f6-285">仕事仲間は、有効期限に達する前にそのリンクをクリックすると、それらとして記録されます電子メールを送信したユーザー。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-285">If the colleague clicks on that link before the expiry is reached, they will be logged in as the user who sent the email!</span></span>


## <a name="step-3-securing-the-authentication-ticket"></a><span data-ttu-id="6e0f6-286">手順 3: 認証チケットをセキュリティで保護します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-286">Step 3: Securing the Authentication Ticket</span></span>

<span data-ttu-id="6e0f6-287">フォーム認証チケットは、ネットワーク経由で送信される cookie のいずれかまたは URL 内で直接埋め込まれました。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-287">The forms authentication ticket is transmitted over the wire either in a cookie or embedded directly within the URL.</span></span> <span data-ttu-id="6e0f6-288">Id の情報に加えて認証チケット含めることができますもユーザー データ (手順 4. で表示されます)。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-288">In addition to identity information, the authentication ticket can also include user data (as we will see in Step 4).</span></span> <span data-ttu-id="6e0f6-289">したがって、これが、チケットのデータが暗号化されている重要なにチケットが変更されていない覗き見とする (さらに) から、フォーム認証システムを保証できます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-289">Consequently, it is important that the ticket's data is encrypted from prying eyes and (even more importantly) that the forms authentication system can guarantee that the ticket was not tampered with.</span></span>

<span data-ttu-id="6e0f6-290">チケットのデータのプライバシーを確保するには、フォーム認証システムは、チケット データを暗号化できます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-290">To ensure the privacy of the ticket's data, the forms authentication system can encrypt the ticket data.</span></span> <span data-ttu-id="6e0f6-291">チケット データを暗号化する障害は、プレーン テキストでネットワーク経由で機密性の高い情報を送信します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-291">Failure to encrypt the ticket data sends potentially sensitive information over the wire in plain-text.</span></span>

<span data-ttu-id="6e0f6-292">チケットの信頼性を保証するために、フォーム認証システムがする必要があります*検証*チケット。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-292">To guarantee a ticket's authenticity, the forms authentication system must *validate* the ticket.</span></span> <span data-ttu-id="6e0f6-293">検証が特定のデータが変更されていないと、によって実現されます。 確保の act、 *[メッセージ認証コード (MAC)](http://en.wikipedia.org/wiki/Message_authentication_code)* します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-293">Validation is the act of ensuring that a particular piece of data has not been modified, and is accomplished via a *[message authentication code (MAC)](http://en.wikipedia.org/wiki/Message_authentication_code)*.</span></span> <span data-ttu-id="6e0f6-294">簡単に言うと、MAC は、(この場合は、チケット) を検証する必要があるデータを識別する情報の一部です。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-294">In a nutshell, the MAC is a small piece of information that identifies the data that needs to be validated (in this case, the ticket).</span></span> <span data-ttu-id="6e0f6-295">MAC で表されるデータが変更された場合、MAC と、データは調和していません。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-295">If the data represented by the MAC is modified, then the MAC and the data will not match up.</span></span> <span data-ttu-id="6e0f6-296">さらに、データを変更して、変更されたデータに対応するため、自分の MAC の生成の両方に、ハッカーの計算が困難です。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-296">Moreover, it is computationally hard for a hacker to both modify the data and generate his own MAC to correspond with the modified data.</span></span>

<span data-ttu-id="6e0f6-297">作成 (または変更) とチケット、フォーム認証システムは、MAC を作成し、チケットのデータにアタッチします。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-297">When creating (or modifying) a ticket, the forms authentication system creates a MAC and attaches it to the ticket's data.</span></span> <span data-ttu-id="6e0f6-298">後続の要求が到着すると、フォーム認証システムは、チケット データの信頼性を検証する、MAC、およびチケットのデータを比較します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-298">When a subsequent request arrives, the forms authentication system compares the MAC and ticket data to validate the authenticity of the ticket data.</span></span> <span data-ttu-id="6e0f6-299">図 3 では、このワークフローがグラフィカルに示しています。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-299">Figure 3 illustrates this workflow graphically.</span></span>


<span data-ttu-id="6e0f6-300">[![MAC により、チケットの信頼性が確保されます。](forms-authentication-configuration-and-advanced-topics-cs/_static/image8.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="6e0f6-300">[![The Ticket's Authenticity is Ensured through a MAC](forms-authentication-configuration-and-advanced-topics-cs/_static/image8.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image7.png)</span></span>

<span data-ttu-id="6e0f6-301">**図 03**MAC により、チケットの信頼性が確保されます ([フルサイズの画像を表示する をクリックします。](forms-authentication-configuration-and-advanced-topics-cs/_static/image9.png))。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-301">**Figure 03**: The Ticket's Authenticity is Ensured through a MAC ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image9.png))</span></span>


<span data-ttu-id="6e0f6-302">認証チケットにどのようなセキュリティ対策が適用されるは、保護設定によって異なります、&lt;フォーム&gt;要素。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-302">What security measures are applied to the authentication ticket depends on the protection setting in the &lt;forms&gt; element.</span></span> <span data-ttu-id="6e0f6-303">保護の設定は、次の 3 つの値のいずれかに割り当てることができます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-303">The protection setting may be assigned to one of the following three values:</span></span>

- <span data-ttu-id="6e0f6-304">すべてのチケットが暗号化されており、デジタル署名されて (既定)。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-304">All - the ticket is both encrypted and digitally signed (the default).</span></span>
- <span data-ttu-id="6e0f6-305">暗号化 - のみの暗号化の適用 - MAC は生成されません。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-305">Encryption - only encryption is applied - no MAC is generated.</span></span>
- <span data-ttu-id="6e0f6-306">暗号化なし - チケットもデジタル署名。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-306">None - the ticket is neither encrypted nor digitally signed.</span></span>
- <span data-ttu-id="6e0f6-307">検証 - MAC が生成されますが、チケット データがプレーン テキストでネットワーク経由で送信されます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-307">Validation - a MAC is generated, but the ticket data is sent over the wire in plain-text.</span></span>

<span data-ttu-id="6e0f6-308">Microsoft では、すべての設定を使用して強くお勧めします。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-308">Microsoft strongly recommends using the All setting.</span></span>

### <a name="setting-the-validation-and-decryption-keys"></a><span data-ttu-id="6e0f6-309">検証と復号化キーの設定</span><span class="sxs-lookup"><span data-stu-id="6e0f6-309">Setting the Validation and Decryption Keys</span></span>

<span data-ttu-id="6e0f6-310">暗号化とハッシュの暗号化、認証チケットを検証し、フォーム認証システムで使用されるアルゴリズムはを通じてカスタマイズ可能な[ &lt;machineKey&gt;要素](https://msdn.microsoft.com/library/w8h3skw9.aspx)Web.config にします。表 2 のアウトライン、 &lt;machineKey&gt;要素の属性とその考えられる値。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-310">The encryption and hashing algorithms used by the forms authentication system to encrypt and validate the authentication ticket are customizable through the [&lt;machineKey&gt; element](https://msdn.microsoft.com/library/w8h3skw9.aspx) in Web.config. Table 2 outlines the &lt;machineKey&gt; element's attributes and their possible values.</span></span>

| <span data-ttu-id="6e0f6-311">**属性**</span><span class="sxs-lookup"><span data-stu-id="6e0f6-311">**Attribute**</span></span> | <span data-ttu-id="6e0f6-312">**説明**</span><span class="sxs-lookup"><span data-stu-id="6e0f6-312">**Description**</span></span> |
| --- | --- |
| <span data-ttu-id="6e0f6-313">復号化</span><span class="sxs-lookup"><span data-stu-id="6e0f6-313">decryption</span></span> | <span data-ttu-id="6e0f6-314">暗号化に使用されるアルゴリズムを示します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-314">Indicates the algorithm used for encryption.</span></span> <span data-ttu-id="6e0f6-315">この属性は次の 4 つの値のいずれかであることができます: - 自動 - 既定では、キー decryptionKey 属性の長さに基づくアルゴリズムを決定します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-315">This attribute can have one of the following four values: - Auto - the default; determines the algorithm based on the length of the decryptionKey attribute.</span></span> <span data-ttu-id="6e0f6-316">-AES - を使用して、 [Advanced Encryption Standard (AES)](http://en.wikipedia.org/wiki/Advanced_Encryption_Standard)アルゴリズム。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-316">- AES - uses the [Advanced Encryption Standard (AES)](http://en.wikipedia.org/wiki/Advanced_Encryption_Standard) algorithm.</span></span> <span data-ttu-id="6e0f6-317">DES - を使用して、[データ暗号化標準 (DES)](http://en.wikipedia.org/wiki/Data_Encryption_Standard)このアルゴリズムは脆弱な計算と見なされます、使用できません。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-317">- DES - uses the [Data Encryption Standard (DES)](http://en.wikipedia.org/wiki/Data_Encryption_Standard) This algorithm is considered computationally weak and should not be used.</span></span> <span data-ttu-id="6e0f6-318">3 - des-を使用して、 [Triple DES](http://en.wikipedia.org/wiki/Triple_DES)アルゴリズムで、3 回、DES アルゴリズムを適用することで動作します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-318">- 3DES - uses the [Triple DES](http://en.wikipedia.org/wiki/Triple_DES) algorithm, which works by applying the DES algorithm three times.</span></span> |
| <span data-ttu-id="6e0f6-319">decryptionKey</span><span class="sxs-lookup"><span data-stu-id="6e0f6-319">decryptionKey</span></span> | <span data-ttu-id="6e0f6-320">暗号化アルゴリズムで使用されるシークレット キー。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-320">The secret key used by the encryption algorithm.</span></span> <span data-ttu-id="6e0f6-321">この値に、(復号化の値に基づく) 適切な長さ、自動生成、またはいずれかの値を使用すると、追加の 16 進数文字列 IsolateApps します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-321">This value must either be a hexadecimal string of the appropriate length (based on the value in decryption), AutoGenerate, or either value appended with,IsolateApps.</span></span> <span data-ttu-id="6e0f6-322">IsolateApps を追加するには、ASP.NET アプリケーションごとに一意の値を使用するように指示します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-322">Adding IsolateApps instructs ASP.NET to use a unique value for each application.</span></span> <span data-ttu-id="6e0f6-323">既定では AutoGenerate, IsolateApps です。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-323">The default is AutoGenerate,IsolateApps.</span></span> |
| <span data-ttu-id="6e0f6-324">検証</span><span class="sxs-lookup"><span data-stu-id="6e0f6-324">validation</span></span> | <span data-ttu-id="6e0f6-325">検証に使用されるアルゴリズムを示します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-325">Indicates the algorithm used for validation.</span></span> <span data-ttu-id="6e0f6-326">この属性は次の 4 つの値のいずれかであることができます: - AES - は、Advanced Encryption Standard (AES) アルゴリズムを使用します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-326">This attribute can have one of the following four values: - AES - uses the Advanced Encryption Standard (AES) algorithm.</span></span> <span data-ttu-id="6e0f6-327">MD5 の使用、[メッセージ ダイジェスト 5 (MD5)](http://en.wikipedia.org/wiki/MD5)アルゴリズム。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-327">- MD5 - uses the [Message-Digest 5 (MD5)](http://en.wikipedia.org/wiki/MD5) algorithm.</span></span> <span data-ttu-id="6e0f6-328">-SHA1 - を使用して、 [SHA1](http://en.wikipedia.org/wiki/Sha1)アルゴリズム (既定)。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-328">- SHA1 - uses the [SHA1](http://en.wikipedia.org/wiki/Sha1) algorithm (the default).</span></span> <span data-ttu-id="6e0f6-329">-3 des、Triple DES アルゴリズムを使用します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-329">- 3DES - uses the Triple DES algorithm.</span></span> |
| <span data-ttu-id="6e0f6-330">validationKey</span><span class="sxs-lookup"><span data-stu-id="6e0f6-330">validationKey</span></span> | <span data-ttu-id="6e0f6-331">検証アルゴリズムで使用されるシークレット キー。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-331">The secret key used by the validation algorithm.</span></span> <span data-ttu-id="6e0f6-332">この値に、(検証の値に基づく) 適切な長さ、自動生成、またはいずれかの値を使用すると、追加の 16 進数文字列 IsolateApps します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-332">This value must either be a hexadecimal string of the appropriate length (based on the value in validation), AutoGenerate, or either value appended with,IsolateApps.</span></span> <span data-ttu-id="6e0f6-333">IsolateApps を追加するには、ASP.NET アプリケーションごとに一意の値を使用するように指示します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-333">Adding IsolateApps instructs ASP.NET to use a unique value for each application.</span></span> <span data-ttu-id="6e0f6-334">既定では AutoGenerate, IsolateApps です。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-334">The default is AutoGenerate,IsolateApps.</span></span> |

<span data-ttu-id="6e0f6-335">**表 2.**: &lt;machineKey&gt;要素の属性</span><span class="sxs-lookup"><span data-stu-id="6e0f6-335">**Table 2**: The &lt;machineKey&gt; Element Attributes</span></span>

<span data-ttu-id="6e0f6-336">暗号化と検証のオプション、およびプロの徹底的に検討して、さまざまなアルゴリズムの欠点は、このチュートリアルの範囲外です。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-336">A thorough discussion of these encryption and validation options, and the pros and cons of the various algorithms, is beyond the scope of this tutorial.</span></span> <span data-ttu-id="6e0f6-337">どのようなキーの長さを使用するガイダンスについては、使用するにはどのような暗号化と検証アルゴリズムを含む、これらの問題で、詳細な検索のこれらのキーの生成を参照する最適な方法と*Professional ASP.NET 2.0 のセキュリティ、メンバーシップ、およびロール管理*.</span><span class="sxs-lookup"><span data-stu-id="6e0f6-337">For an in-depth look at these issues, including guidance on what encryption and validation algorithms to use, what key lengths to use, and how best to generate these keys, refer to *Professional ASP.NET 2.0 Security, Membership, and Role Management*.</span></span>

<span data-ttu-id="6e0f6-338">既定では、暗号化と検証に使用されるキーは、アプリケーションごとに自動的に生成し、これらのキーはローカル セキュリティ機関 (LSA) で格納されます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-338">By default, the keys used for encryption and validation are generated automatically for each application, and these keys are stored in the Local Security Authority (LSA).</span></span> <span data-ttu-id="6e0f6-339">つまり、既定の設定では、web サーバー-web でのサーバーとアプリケーション間ごとに一意のキーが保証されます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-339">In short, the default settings guarantee unique keys on a web server-by-web server and application-by-application basis.</span></span> <span data-ttu-id="6e0f6-340">そのため、この既定の動作は、次の 2 つのシナリオでは機能しません。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-340">Consequently, this default behavior will not work for the two following scenarios:</span></span>

- <span data-ttu-id="6e0f6-341">**Web ファーム**-、 [web ファーム](http://en.wikipedia.org/wiki/Web_farm)シナリオでは、1 つの web アプリケーションが拡張性と冗長性のために複数の web サーバーでホストされています。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-341">**Web Farms** - in a [web farm](http://en.wikipedia.org/wiki/Web_farm) scenario, a single web application is hosted on multiple web servers for purposes of scalability and redundancy.</span></span> <span data-ttu-id="6e0f6-342">各受信要求は、ユーザーのセッションの有効期間は、別のサーバーをさまざまな要求を処理するために使用可能性があることを意味、ファーム内のサーバーにディスパッチされます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-342">Each incoming request is dispatched to a server in the farm, meaning that over the lifetime of a user's session, different servers may be used to handle his various requests.</span></span> <span data-ttu-id="6e0f6-343">その結果、フォーム認証チケットを作成できるように、各サーバーは、同じ暗号化と検証キーを使用する必要があります、暗号化、および 検証済みの 1 つのサーバーの暗号化を解除して、ファーム内の別のサーバーで検証されることができます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-343">Consequently, each server must use the same encryption and validation keys so that the forms authentication ticket created, encrypted, and validated on one server can be decrypted and validated on a different server in the farm.</span></span>
- <span data-ttu-id="6e0f6-344">**アプリケーション チケットの共有をクロス**-1 つの web サーバーは、複数の ASP.NET アプリケーションをホストできます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-344">**Cross Application Ticket Sharing** - a single web server may host multiple ASP.NET applications.</span></span> <span data-ttu-id="6e0f6-345">これらのさまざまなアプリケーションを 1 つのフォーム認証チケットを共有する必要がある場合は、、暗号化と検証キーが一致する必要があります。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-345">If you need for these different applications to share a single forms authentication ticket, it is imperative that their encryption and validation keys match up.</span></span>

<span data-ttu-id="6e0f6-346">Web ファームの設定や、同じサーバー上のアプリケーション間での認証チケットの共有で作業するときは、構成する必要があります、 &lt;machineKey&gt;影響を受けるアプリケーション内の要素をそのキー decryptionKey とキー validationkey キー値に一致。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-346">When working in a web farm setting or sharing authentication tickets across applications on the same server, you will need to configure the &lt;machineKey&gt; element in the affected applications so that their decryptionKey and validationKey values match up.</span></span>

<span data-ttu-id="6e0f6-347">サンプル アプリケーションに適用されますが、上記のシナリオのどちらも、明示的なキー decryptionKey キー validationkey キー値を指定を使用するアルゴリズムを定義もできます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-347">While neither of the above scenarios applies to our sample application, we can still specify explicit decryptionKey and validationKey values and define the algorithms to be used.</span></span> <span data-ttu-id="6e0f6-348">追加、 &lt;machineKey&gt; Web.config ファイルに設定します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-348">Add a &lt;machineKey&gt; setting to the Web.config file:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample5.xml)]

<span data-ttu-id="6e0f6-349">詳細については、チェック アウト[How To: ASP.NET 2.0 の構成の MachineKey](https://msdn.microsoft.com/library/ms998288.aspx)します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-349">For more information check out [How To: Configure MachineKey in ASP.NET 2.0](https://msdn.microsoft.com/library/ms998288.aspx).</span></span>

> [!NOTE]
> <span data-ttu-id="6e0f6-350">キー decryptionKey と validationKey の値から取得されました[Steve Gibson](http://www.grc.com/stevegibson.htm)の[パスワードの完全な web ページ](https://www.grc.com/passwords.htm)、64 のランダムな 16 進数の文字を各ページのアクセス時に生成されます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-350">The decryptionKey and validationKey values were taken from [Steve Gibson](http://www.grc.com/stevegibson.htm)'s [Perfect Passwords web page](https://www.grc.com/passwords.htm), which generates 64 random hexadecimal characters on each page visit.</span></span> <span data-ttu-id="6e0f6-351">これらのキーが、実稼働アプリケーションに入り込んでが発生する可能性を軽減するために、完璧なパスワード ページからランダムに生成されたもので、上記のキーを置換することが推奨されます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-351">To lessen the likelihood of these keys making their way into your production applications, you are encouraged to replace the above keys with randomly generated ones from the Perfect Passwords page.</span></span>


## <a name="step-4-storing-additional-user-data-in-the-ticket"></a><span data-ttu-id="6e0f6-352">手順 4: チケットに追加のユーザー データを格納します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-352">Step 4: Storing Additional User Data in the Ticket</span></span>

<span data-ttu-id="6e0f6-353">多くの web アプリケーションでは、に関する情報を表示またはページの表示に基づく、現在ログオンしているユーザー。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-353">Many web applications display information about or base the page's display on the currently logged on user.</span></span> <span data-ttu-id="6e0f6-354">たとえば、ユーザーの名前と日付のすべてのページの上隅で、最後にログインした web ページを表示する場合があります。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-354">For example, a web page might show the user's name and the date she last logged on in the upper corner of every page.</span></span> <span data-ttu-id="6e0f6-355">フォーム認証チケットには、現在ログオンしているユーザーのユーザー名が格納されますが、ページが、ユーザー ストア - 通常はデータベース - 認証チケットに格納されていない情報を参照に移動する必要がありますその他の情報が必要なときにします。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-355">The forms authentication ticket stores the currently logged on user's username, but when any other information is needed, the page must go to the user store - typically a database - to lookup the information not stored in the authentication ticket.</span></span>

<span data-ttu-id="6e0f6-356">ほんの少しのコードでは、フォーム認証チケットを追加のユーザー情報を保存したことができます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-356">With a little bit of code we can store additional user information in the forms authentication ticket.</span></span> <span data-ttu-id="6e0f6-357">このようなデータを表すことができます、 [FormsAuthenticationTicket クラス](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.aspx)の[UserData プロパティ](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.userdata.aspx)します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-357">Such data can be expressed through the [FormsAuthenticationTicket class](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.aspx)'s [UserData property](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.userdata.aspx).</span></span> <span data-ttu-id="6e0f6-358">これは、少量が一般的に必要なユーザーに関する情報を配置するのに便利な場所です。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-358">This is a useful place to put small amounts of information about the user that is commonly needed.</span></span> <span data-ttu-id="6e0f6-359">UserData プロパティを暗号化され、検証が含まれる一部として、認証チケット cookie のと同様、他のチケットのフィールドで指定された値は、フォーム認証システムの構成に基づいています。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-359">The value specified in the UserData property is included as part of the authentication ticket cookie and, like the other ticket fields, is encrypted and validated based on the forms authentication system's configuration.</span></span> <span data-ttu-id="6e0f6-360">既定では、UserData は空の文字列です。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-360">By default, UserData is an empty string.</span></span>

<span data-ttu-id="6e0f6-361">認証チケットのユーザー データを格納するためには、ユーザーに固有の情報を取得し、チケットをログイン ページでのコードを記述する必要があります。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-361">In order to store user data in the authentication ticket, we need to write a bit of code in the login page that grabs the user-specific information and stores it in the ticket.</span></span> <span data-ttu-id="6e0f6-362">UserData は、文字列型のプロパティであるためにを文字列としてが格納されている、データを正しくシリアル化する必要があります。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-362">Since UserData is a property of type string, the data stored in it must be properly serialized as a string.</span></span> <span data-ttu-id="6e0f6-363">たとえば、ユーザー ストアには、各ユーザーの生年月日と、雇用者の名前が含まれていること、および認証チケットでこれらの 2 つのプロパティ値を保存する必要があるとします。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-363">For example, imagine that our user store included each user's date of birth and the name of their employer, and we wanted to store these two property values in the authentication ticket.</span></span> <span data-ttu-id="6e0f6-364">文字列にこれらの値をシリアル化後に、雇用主名前パイプ (|)、生年月日の文字列のユーザーの日付を連結することによってでした。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-364">We could serialize these values into a string by concatenating the user's date of birth's string with a pipe ( | ), followed by the employer name.</span></span> <span data-ttu-id="6e0f6-365">Northwind Traders に適している、1974 年 8 月 15日でユーザーを割り当てます UserData プロパティ文字列: 1974-08-15 |Northwind Traders します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-365">For a user born on August 15, 1974 that works for Northwind Traders, we would assign the UserData property the string: 1974-08-15|Northwind Traders .</span></span>

<span data-ttu-id="6e0f6-366">チケットに格納されているデータにアクセスする必要があります、たびにこれを現在の要求の所属をグラブして UserData プロパティを逆シリアル化して実行できます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-366">Whenever we need to access the data stored in the ticket, we can do so by grabbing the current request's FormsAuthenticationTicket and deserializing the UserData property.</span></span> <span data-ttu-id="6e0f6-367">生年月日と雇用者名の例の日付の場合は、区切り記号 (|) に基づく 2 つの部分文字列に UserData 文字列を分割します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-367">In the case of the date of birth and employer name example, we would split the UserData string into two substrings based on the delimiter ( | ).</span></span>


<span data-ttu-id="6e0f6-368">[![認証チケットに追加のユーザー情報を格納できます。](forms-authentication-configuration-and-advanced-topics-cs/_static/image11.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="6e0f6-368">[![Additional User Information Can Be Stored in the Authentication Ticket](forms-authentication-configuration-and-advanced-topics-cs/_static/image11.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image10.png)</span></span>

<span data-ttu-id="6e0f6-369">**図 04**: その他のユーザー情報に格納できる認証チケット ([フルサイズの画像を表示する をクリックします](forms-authentication-configuration-and-advanced-topics-cs/_static/image12.png))。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-369">**Figure 04**: Additional User Information Can Be Stored in the Authentication Ticket ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image12.png))</span></span>


### <a name="writing-information-to-userdata"></a><span data-ttu-id="6e0f6-370">UserData 情報を書き込む</span><span class="sxs-lookup"><span data-stu-id="6e0f6-370">Writing Information to UserData</span></span>

<span data-ttu-id="6e0f6-371">残念ながら、フォーム認証チケットをユーザーに固有の情報を追加するは想像のいずれかの単純ではありません。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-371">Unfortunately, adding user-specific information to a forms authentication ticket is not as straightforward as one might expect.</span></span> <span data-ttu-id="6e0f6-372">FormsAuthenticationTicket クラスの UserData プロパティは読み取り専用と、FormsAuthenticationTicket クラスのコンス トラクターでのみ指定できます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-372">The UserData property of the FormsAuthenticationTicket class is read-only and can only be specified through the FormsAuthenticationTicket class constructor.</span></span> <span data-ttu-id="6e0f6-373">また、チケットの他の値を提供する必要がありますをコンス トラクターで UserData プロパティを指定する場合: ユーザー名、発行日、有効期限、およびなど。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-373">When specifying the UserData property in the constructor, we also need to provide the ticket's other values: the username, the issue date, the expiration, and so on.</span></span> <span data-ttu-id="6e0f6-374">前のチュートリアルでは、ログイン ページを作成したときにこれがすべてのクラスによって処理される、FormsAuthentication します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-374">When we created the login page in the preceding tutorial, this was all handled for us by the FormsAuthentication class.</span></span> <span data-ttu-id="6e0f6-375">UserData を所属に追加する際は既に FormsAuthentication クラスによって提供される機能の多くをレプリケートするコードを記述する必要があります。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-375">When adding UserData to the FormsAuthenticationTicket, we will need to write code to replicate much of the functionality already provided by the FormsAuthentication class.</span></span>

<span data-ttu-id="6e0f6-376">認証チケットにユーザーに関する追加情報を記録する Login.aspx ページを更新することで、UserData を操作するために必要なコードを見てみましょう。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-376">Let's explore the necessary code for working with UserData by updating the Login.aspx page to record additional information about the user to the authentication ticket.</span></span> <span data-ttu-id="6e0f6-377">ふり、ユーザー ストアにはでのユーザーが勤務する会社と、そのタイトルに関する情報が含まれていると認証チケットには、この情報をキャプチャします。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-377">Pretend that our user store contains information about the company the user works for and their title, and that we want to capture this information in the authentication ticket.</span></span> <span data-ttu-id="6e0f6-378">次のように、次のコードは、Login.aspx ページのログイン ボタンの Click イベント ハンドラーを更新します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-378">Update the Login.aspx page's LoginButton Click event handler so that the code looks like the following:</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample6.cs)]

<span data-ttu-id="6e0f6-379">一度にこのコードを 1 行ずつステップみましょう。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-379">Let's step through this code one line at a time.</span></span> <span data-ttu-id="6e0f6-380">4 つの文字列配列を定義することで、メソッドを開始します。 ユーザー、パスワード、companyName、および titleAtCompany します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-380">The method starts by defining four string arrays: users, passwords, companyName, and titleAtCompany.</span></span> <span data-ttu-id="6e0f6-381">これらの配列を保持ユーザー名、パスワード、会社名、およびユーザー アカウントのタイトルをシステムでは、これは、3 つ: Scott、Jisun、および Sam です。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-381">These arrays hold the usernames, passwords, company names, and titles for the user accounts in the system, of which there are three: Scott, Jisun, and Sam.</span></span> <span data-ttu-id="6e0f6-382">実際のアプリケーションでこれらの値はハードコードされていません ページのソース コード内のユーザー ストアから照会は。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-382">In a real application, these values would be queried from the user store, not hard-coded in the page's source code.</span></span>

<span data-ttu-id="6e0f6-383">前のチュートリアルで指定された資格情報が有効な場合を単純に呼び出す、次の手順を実行する FormsAuthentication.RedirectFromLoginPage (UserName.Text、RememberMe.Checked)。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-383">In the previous tutorial, if the supplied credentials were valid we simply called FormsAuthentication.RedirectFromLoginPage(UserName.Text, RememberMe.Checked), which performed the following steps:</span></span>

1. <span data-ttu-id="6e0f6-384">フォーム認証チケットの作成</span><span class="sxs-lookup"><span data-stu-id="6e0f6-384">Created the forms authentication ticket</span></span>
2. <span data-ttu-id="6e0f6-385">適切なストアにチケットを作成しました。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-385">Wrote the ticket to the appropriate store.</span></span> <span data-ttu-id="6e0f6-386">Cookie ベースの認証チケットのブラウザーのクッキーのコレクションが使用されます。クッキーなしの認証のチケットの場合は、チケット データは、URL にシリアル化します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-386">For cookies-based authentication tickets, the browser's cookies collection is used; for cookieless authentication tickets, the ticket data is serialized into the URL</span></span>
3. <span data-ttu-id="6e0f6-387">適切なページにユーザーをリダイレクトします。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-387">Redirected the user to the appropriate page</span></span>

<span data-ttu-id="6e0f6-388">次の手順は、上記のコードでレプリケートされます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-388">These steps are replicated in the code above.</span></span> <span data-ttu-id="6e0f6-389">最初に、UserData プロパティは最終的に格納する文字列は、会社名とパイプ文字 (|) では、2 つの値を区切る、タイトルを組み合わせることによって構成です。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-389">First, the string we will eventually store in the UserData property is formed by combining the company name and the title, delimiting the two values with a pipe character ( | ).</span></span>

<span data-ttu-id="6e0f6-390">文字列の userDataString = 文字列。Concat (companyName [i]"|"、titleAtCompany[i]);</span><span class="sxs-lookup"><span data-stu-id="6e0f6-390">string userDataString = string.Concat(companyName[i], "|", titleAtCompany[i]);</span></span>

<span data-ttu-id="6e0f6-391">次に、認証チケットを作成するには、メソッドが呼び出される FormsAuthentication.GetAuthCookie 暗号化構成の設定に従って検証しますおよび HttpCookie オブジェクトに配置されます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-391">Next, the FormsAuthentication.GetAuthCookie method is invoked, which creates the authentication ticket, encrypts and validates it according to the configuration settings, and places it in an HttpCookie object.</span></span>

<span data-ttu-id="6e0f6-392">HttpCookie authCookie = FormsAuthentication.GetAuthCookie (UserName.Text、RememberMe.Checked)。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-392">HttpCookie authCookie = FormsAuthentication.GetAuthCookie(UserName.Text, RememberMe.Checked);</span></span>

<span data-ttu-id="6e0f6-393">クッキー内に埋め込まれて FormAuthenticationTicket を使用するにを FormAuthentication クラスを呼び出す必要[メソッドを復号化](https://msdn.microsoft.com/library/system.web.security.formsauthentication.decrypt.aspx)で cookie の値渡し。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-393">In order to work with the FormAuthenticationTicket embedded within the cookie, we need to call the FormAuthentication class's [Decrypt method](https://msdn.microsoft.com/library/system.web.security.formsauthentication.decrypt.aspx), passing in the cookie value.</span></span>

<span data-ttu-id="6e0f6-394">FormsAuthenticationTicket チケット FormsAuthentication.Decrypt(authCookie.Value); を =</span><span class="sxs-lookup"><span data-stu-id="6e0f6-394">FormsAuthenticationTicket ticket = FormsAuthentication.Decrypt(authCookie.Value);</span></span>

<span data-ttu-id="6e0f6-395">作成し、*新しい*既存 FormsAuthenticationTicket の値に基づいて、FormsAuthenticationTicket インスタンス。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-395">We then create a *new* FormsAuthenticationTicket instance based on the existing FormsAuthenticationTicket's values.</span></span> <span data-ttu-id="6e0f6-396">ただし、この新しいチケットには、ユーザーに固有の情報 (userDataString) が含まれています。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-396">However, this new ticket includes the user-specific information (userDataString).</span></span>

<span data-ttu-id="6e0f6-397">FormsAuthenticationTicket newTicket = 新しい FormsAuthenticationTicket (チケット。チケットのバージョンです。チケットの名前。IssueDate、チケットします。有効期限、チケット。IsPersistent、userDataString)。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-397">FormsAuthenticationTicket newTicket = new FormsAuthenticationTicket(ticket.Version, ticket.Name, ticket.IssueDate, ticket.Expiration, ticket.IsPersistent, userDataString);</span></span>

<span data-ttu-id="6e0f6-398">暗号化 (し検証) を呼び出して新しい FormsAuthenticationTicket インスタンス、[暗号化メソッド](https://msdn.microsoft.com/library/system.web.security.formsauthentication.encrypt.aspx)authCookie にこの暗号化された (および検証済み) のデータを戻すとします。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-398">We then encrypt (and validate) the new FormsAuthenticationTicket instance by calling the [Encrypt method](https://msdn.microsoft.com/library/system.web.security.formsauthentication.encrypt.aspx), and put this encrypted (and validated) data back into authCookie.</span></span>

<span data-ttu-id="6e0f6-399">authCookie.Value FormsAuthentication.Encrypt(newTicket); を =</span><span class="sxs-lookup"><span data-stu-id="6e0f6-399">authCookie.Value = FormsAuthentication.Encrypt(newTicket);</span></span>

<span data-ttu-id="6e0f6-400">最後に、authCookie が Response.Cookies コレクションに追加し、GetRedirectUrl メソッドはユーザーに送信する適切なページを確認します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-400">Finally, authCookie is added to the Response.Cookies collection and the GetRedirectUrl method is called to determine the appropriate page to send the user.</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample7.cs)]

<span data-ttu-id="6e0f6-401">UserData プロパティは読み取り専用と FormsAuthentication クラスがその GetAuthCookie や SetAuthCookie、RedirectFromLoginPage メソッドで UserData 情報を指定するためのメソッドを提供していないため、このコードのすべてが必要です。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-401">All of this code is needed because the UserData property is read-only and the FormsAuthentication class does not provide any methods for specifying UserData information in its GetAuthCookie, SetAuthCookie, or RedirectFromLoginPage methods.</span></span>

> [!NOTE]
> <span data-ttu-id="6e0f6-402">について確認しましたコードでは、cookie ベースの認証チケットのユーザー固有の情報を格納します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-402">The code we just examined stores user-specific information in a cookies-based authentication ticket.</span></span> <span data-ttu-id="6e0f6-403">URL にフォーム認証チケットをシリアル化するクラスは、.NET Framework の内部。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-403">The classes responsible for serializing the forms authentication ticket to the URL are internal to the .NET Framework.</span></span> <span data-ttu-id="6e0f6-404">かいつまんで言う、cookieless フォーム認証チケットのユーザー データを格納することはできません。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-404">Long story short, you cannot store user data in a cookieless forms authentication ticket.</span></span>


### <a name="accessing-the-userdata-information"></a><span data-ttu-id="6e0f6-405">UserData 情報にアクセスします。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-405">Accessing the UserData Information</span></span>

<span data-ttu-id="6e0f6-406">この時点で各ユーザーの会社名とタイトルは、ログインしたときに、フォーム認証チケットの UserData プロパティに格納されます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-406">At this point each user's company name and title is stored in the forms authentication ticket's UserData property when they log in.</span></span> <span data-ttu-id="6e0f6-407">この情報は、ユーザー ストアへのトリップを必要とせず、任意のページで、認証チケットからアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-407">This information can be accessed from the authentication ticket on any page without requiring a trip to the user store.</span></span> <span data-ttu-id="6e0f6-408">UserData プロパティからこの情報を取得する方法を示すためには、更新 Default.aspx、ようこそメッセージは、だけでなく、ユーザーの名前がも各自が勤務する会社とそのタイトルが含まれるようにします。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-408">To illustrate how this information can be retrieved from the UserData property, let's update Default.aspx so that its welcome message includes not only the user's name, but also the company they work for and their title.</span></span>

<span data-ttu-id="6e0f6-409">現時点では、Default.aspx、AuthenticatedMessagePanel パネルの WelcomeBackMessage という名前のラベル コントロールに含まれています。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-409">Currently, Default.aspx contains an AuthenticatedMessagePanel Panel with a Label control named WelcomeBackMessage.</span></span> <span data-ttu-id="6e0f6-410">このパネルは、認証されたユーザーにのみ表示されます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-410">This Panel is only displayed to authenticated users.</span></span> <span data-ttu-id="6e0f6-411">Default.aspx のページのコードを更新\_Load イベント ハンドラーを次のように見えるようにします。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-411">Update the code in Default.aspx's Page\_Load event handler so that it looks like the following:</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample8.cs)]

<span data-ttu-id="6e0f6-412">かどうか Request.IsAuthenticated が true の場合、WelcomeBackMessage のテキストのプロパティは、ようこそに設定されて初めて*username*します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-412">If Request.IsAuthenticated is true, then the WelcomeBackMessage's Text property is first set to Welcome back, *username*.</span></span> <span data-ttu-id="6e0f6-413">次に、//新しい一般プリンシパル プロパティは、基になる FormsAuthenticationTicket アクセスできるように、FormsIdentity オブジェクトにキャストされます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-413">Then, the User.Identity property is cast to a FormsIdentity object so that we can access the underlying FormsAuthenticationTicket.</span></span> <span data-ttu-id="6e0f6-414">所属したらは、会社名とタイトルに UserData プロパティ逆シリアル化します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-414">Once we have the FormsAuthenticationTicket, we deserialize the UserData property into the company name and title.</span></span> <span data-ttu-id="6e0f6-415">これは、パイプ文字の文字列を分割することで実現されます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-415">This is accomplished by splitting the string on the pipe character.</span></span> <span data-ttu-id="6e0f6-416">会社名とタイトルが WelcomeBackMessage ラベルに表示されます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-416">The company name and title are then displayed in the WelcomeBackMessage Label.</span></span>

<span data-ttu-id="6e0f6-417">図 5 は、実行中、この画面のスクリーン ショットを示します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-417">Figure 5 shows a screenshot of this display in action.</span></span> <span data-ttu-id="6e0f6-418">Scott としてログインするには、Scott の会社とタイトルを含むバックへようこそ のメッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-418">Logging in as Scott displays a welcome back message that includes Scott's company and title.</span></span>


<span data-ttu-id="6e0f6-419">[![現在ログインして ユーザーの会社とタイトルが表示されます。](forms-authentication-configuration-and-advanced-topics-cs/_static/image14.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="6e0f6-419">[![The Currently Logged On User's Company and Title are Displayed](forms-authentication-configuration-and-advanced-topics-cs/_static/image14.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image13.png)</span></span>

<span data-ttu-id="6e0f6-420">**図 05**: The 現在にログオンしたユーザーの会社とタイトルが表示されます ([フルサイズの画像を表示する をクリックします](forms-authentication-configuration-and-advanced-topics-cs/_static/image15.png))。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-420">**Figure 05**: The Currently Logged On User's Company and Title are Displayed ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image15.png))</span></span>


> [!NOTE]
> <span data-ttu-id="6e0f6-421">認証チケットの UserData プロパティは、ユーザー ストアのキャッシュとして機能します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-421">The authentication ticket's UserData property serves as a cache for the user store.</span></span> <span data-ttu-id="6e0f6-422">任意のキャッシュのように基になるデータが変更されたときに更新が必要です。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-422">Like any cache, it needs to be updated when the underlying data is modified.</span></span> <span data-ttu-id="6e0f6-423">たとえば、ユーザーが自分のプロファイルを更新できる web ページがある場合、ユーザーが行った変更を反映するように UserData プロパティにキャッシュされているフィールドを更新する必要があります。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-423">For example, if there is a web page from which users can update their profile, the fields cached in the UserData property must be refreshed to reflect the changes made by the user.</span></span>


## <a name="step-5-using-a-custom-principal"></a><span data-ttu-id="6e0f6-424">手順 5: カスタム プリンシパルを使用します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-424">Step 5: Using a Custom Principal</span></span>

<span data-ttu-id="6e0f6-425">受信要求のたびに、FormsAuthenticationModule は、ユーザーを認証しようとします。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-425">On each incoming request the FormsAuthenticationModule attempts to authenticate the user.</span></span> <span data-ttu-id="6e0f6-426">有効期限のない認証チケットが存在する場合、FormsAuthenticationModule は HttpContext.User プロパティを新しい GenericPrincipal オブジェクトに割り当てます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-426">If a non-expired authentication ticket is present, the FormsAuthenticationModule assigns the HttpContext.User property to a new GenericPrincipal object.</span></span> <span data-ttu-id="6e0f6-427">この GenericPrincipal オブジェクトには、フォーム認証チケットへの参照を含む、FormsIdentity 型の Id があります。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-427">This GenericPrincipal object has an Identity of type FormsIdentity, which includes a reference to the forms authentication ticket.</span></span> <span data-ttu-id="6e0f6-428">GenericPrincipal クラスには、IPrincipal を実装するクラスで必要なベア最低限の機能が含まれています - Identity プロパティと、IsInRole メソッドだけがあります。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-428">The GenericPrincipal class contains the bare minimum functionality needed by a class that implements IPrincipal - it just has an Identity property and an IsInRole method.</span></span>

<span data-ttu-id="6e0f6-429">プリンシパル オブジェクトが 2 つの役割: ユーザーが所属するロールを示すと、id 情報を提供します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-429">The principal object has two responsibilities: to indicate what roles the user belongs to and to provide identity information.</span></span> <span data-ttu-id="6e0f6-430">IPrincipal インターフェイスの IsInRole を介して行われます (*roleName*) メソッドと Identity プロパティでは、それぞれします。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-430">This is accomplished through the IPrincipal interface's IsInRole(*roleName*) method and Identity property, respectively.</span></span> <span data-ttu-id="6e0f6-431">GenericPrincipal クラスでは、そのコンス トラクターを使用して指定するロール名の文字列配列を使用できます。その IsInRole (*roleName*) メソッドは単なるかどうかをチェック、渡されたで*roleName*文字列配列内に存在します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-431">The GenericPrincipal class allows for a string array of role names to be specified via its constructor; its IsInRole(*roleName*) method merely checks to see if the passed in *roleName* exists within the string array.</span></span> <span data-ttu-id="6e0f6-432">FormsAuthenticationModule は、GenericPrincipal を作成するときに GenericPrincipal のコンス トラクターに空の文字列配列に渡します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-432">When the FormsAuthenticationModule creates the GenericPrincipal, it passes in an empty string array to the GenericPrincipal's constructor.</span></span> <span data-ttu-id="6e0f6-433">その結果、IsInRole への呼び出しは常に false を返します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-433">Consequently, any call to IsInRole will always return false.</span></span>

<span data-ttu-id="6e0f6-434">GenericPrincipal クラスは、ロールが使用されていないほとんどのフォーム ベースの認証シナリオのニーズを満たします。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-434">The GenericPrincipal class meets the needs for most forms based authentication scenarios where roles are not used.</span></span> <span data-ttu-id="6e0f6-435">既定の役割の処理が十分な場合にカスタム IIdentity オブジェクトをユーザーに関連付ける必要がある場合は、認証ワークフロー中に、カスタム IPrincipal オブジェクトを作成し、HttpContext.User プロパティに割り当てるか。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-435">For those situations where the default role handling is insufficient or when you need to associate a custom IIdentity object with the user, you can create a custom IPrincipal object during the authentication workflow and assign it to the HttpContext.User property.</span></span>

> [!NOTE]
> <span data-ttu-id="6e0f6-436">わかるとおり今後のチュートリアルでは、時に ASP します。NET の役割のフレームワークが有効になっている型のカスタム プリンシパル オブジェクトを作成します[RolePrincipal](https://msdn.microsoft.com/library/system.web.security.roleprincipal.aspx)とフォーム認証が作成した GenericPrincipal オブジェクトが上書きされます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-436">As we will see in future tutorials, when ASP.NET's Roles framework is enabled it creates a custom principal object of type [RolePrincipal](https://msdn.microsoft.com/library/system.web.security.roleprincipal.aspx) and overwrites the forms authentication-created GenericPrincipal object.</span></span> <span data-ttu-id="6e0f6-437">これは、プリンシパルの IsInRole メソッドの役割のフレームワークの API を使用したインターフェイスをカスタマイズするためにします。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-437">It does this in order to customize the principal's IsInRole method to interface with the Roles framework's API.</span></span>


<span data-ttu-id="6e0f6-438">私たちがいないに関して自分たちの役割を持つまだため唯一の理由がこの時点で、カスタム プリンシパルを作成するためになりますが、プリンシパルにカスタム IIdentity オブジェクトに関連付けることでしょう。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-438">Since we have not concerned ourselves with roles yet, the only reason we would have for creating a custom principal at this juncture would be to associate a custom IIdentity object to the principal.</span></span> <span data-ttu-id="6e0f6-439">手順 4 でユーザーの会社名とそのタイトルで特定の認証チケットの UserData プロパティに追加のユーザー情報を格納しました。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-439">In Step 4 we looked at storing additional user information in the authentication ticket's UserData property, in particular the user's company name and their title.</span></span> <span data-ttu-id="6e0f6-440">ただし、UserData 情報は、認証チケットを使用してアクセスおよびとしてシリアル化された文字列、つまり、チケットに格納されているユーザー情報を表示するときにいつでも必要がある UserData プロパティを解析し、のみのみです。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-440">However, the UserData information is only accessible through the authentication ticket and only then as a serialized string, meaning that anytime we want to view the user information stored in the ticket we need to parse the UserData property.</span></span>

<span data-ttu-id="6e0f6-441">IIdentity を実装し、CompanyName とタイトルのプロパティを含むクラスを作成して、開発者エクスペリエンスを向上させます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-441">We can improve the developer experience by creating a class that implements IIdentity and includes CompanyName and Title properties.</span></span> <span data-ttu-id="6e0f6-442">そうすることは、開発者が、現在ログオンしているユーザーの会社名にアクセスできるし、UserData プロパティを解析する方法を理解するために必要なタイトルなし CompanyName とタイトルのプロパティを直接使用します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-442">That way, a developer can access the currently logged on user's company name and title directly through the CompanyName and Title properties without needed to know how to parse the UserData property.</span></span>

### <a name="creating-the-custom-identity-and-principal-classes"></a><span data-ttu-id="6e0f6-443">カスタム Id およびプリンシパル クラスを作成します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-443">Creating the Custom Identity and Principal Classes</span></span>

<span data-ttu-id="6e0f6-444">このチュートリアルでは、アプリでみましょうカスタム プリンシパルと id オブジェクトを作成\_コード フォルダー。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-444">For this tutorial, let's create the custom principal and identity objects in the App\_Code folder.</span></span> <span data-ttu-id="6e0f6-445">アプリを追加して開始\_コード フォルダーをプロジェクトに、ソリューション エクスプ ローラーでプロジェクト名を右クリックして - ASP.NET フォルダーの追加オプションを選択、およびアプリの選択\_コード。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-445">Start by adding an App\_Code folder to your project - right-click on the project name in Solution Explorer, select the Add ASP.NET Folder option, and choose App\_Code.</span></span> <span data-ttu-id="6e0f6-446">アプリ\_コード フォルダーは、web サイト固有のクラス ファイルを保持する特殊な ASP.NET フォルダーです。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-446">The App\_Code folder is a special ASP.NET folder that holds class files specific to the website.</span></span>

> [!NOTE]
> <span data-ttu-id="6e0f6-447">アプリ\_コード フォルダーは、web サイト プロジェクト モデルを使用してプロジェクトを管理する場合にのみ使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-447">The App\_Code folder should only be used when managing your project through the Website Project Model.</span></span> <span data-ttu-id="6e0f6-448">使用する場合、 [Web アプリケーション プロジェクト モデル](https://msdn.microsoft.com/asp.net/Aa336618.aspx)、標準的なフォルダーを作成し、クラスを追加します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-448">If you are using the [Web Application Project Model](https://msdn.microsoft.com/asp.net/Aa336618.aspx), create a standard folder and add the classes to that.</span></span> <span data-ttu-id="6e0f6-449">たとえば、クラスをという名前の新しいフォルダーを追加し、コードがありますに配置するでした。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-449">For example, you could add a new folder named Classes, and place your code there.</span></span>


<span data-ttu-id="6e0f6-450">次に、2 つの新しいクラス ファイルをアプリに追加\_CustomPrincipal.cs という名前のコードのフォルダー、1 つの名前付き CustomIdentity.cs および 1 つ。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-450">Next, add two new class files to the App\_Code folder, one named CustomIdentity.cs and one named CustomPrincipal.cs.</span></span>


<span data-ttu-id="6e0f6-451">[![CustomIdentity と CustomPrincipal クラスをプロジェクトに追加します。](forms-authentication-configuration-and-advanced-topics-cs/_static/image17.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="6e0f6-451">[![Add the CustomIdentity and CustomPrincipal Classes to Your Project](forms-authentication-configuration-and-advanced-topics-cs/_static/image17.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image16.png)</span></span>

<span data-ttu-id="6e0f6-452">**図 06**: CustomIdentity と CustomPrincipal クラスをプロジェクトに追加 ([フルサイズの画像を表示する をクリックします](forms-authentication-configuration-and-advanced-topics-cs/_static/image18.png))。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-452">**Figure 06**: Add the CustomIdentity and CustomPrincipal Classes to Your Project ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image18.png))</span></span>


<span data-ttu-id="6e0f6-453">CustomIdentity クラスは、AuthenticationType、IsAuthenticated、および名前のプロパティを定義する IIdentity インターフェイスを実装する責任を負います。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-453">The CustomIdentity class is responsible for implementing the IIdentity interface, which defines the AuthenticationType, IsAuthenticated, and Name properties.</span></span> <span data-ttu-id="6e0f6-454">これらの必要なプロパティだけでなく私たちは、基になるフォーム認証チケットだけでなく、ユーザーの会社名とタイトルのプロパティを公開します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-454">In addition to those required properties, we are interested in exposing the underlying forms authentication ticket as well as properties for the user's company name and title.</span></span> <span data-ttu-id="6e0f6-455">CustomIdentity クラスには、次のコードを入力します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-455">Enter the following code into the CustomIdentity class.</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample9.cs)]

<span data-ttu-id="6e0f6-456">クラスに所属メンバー変数が含まれることに注意してください (\_チケット) コンス トラクターを通じてこのチケット情報を渡す必要があるとします。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-456">Note that the class includes a FormsAuthenticationTicket member variable (\_ticket) and that this ticket information must be supplied through the constructor.</span></span> <span data-ttu-id="6e0f6-457">このチケット データは id の名前を返すときに使用します。CompanyName とタイトルのプロパティの値を返す、UserData プロパティが解析されます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-457">This ticket data is used in returning the identity's Name; its UserData property is parsed to return the values for the CompanyName and Title properties.</span></span>

<span data-ttu-id="6e0f6-458">次に、CustomPrincipal クラスを作成します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-458">Next, create the CustomPrincipal class.</span></span> <span data-ttu-id="6e0f6-459">CustomPrincipal クラスのコンス トラクターが; CustomIdentity オブジェクトのみを受け入れるため、これは問題ありませんロールでこの時点で、その IsInRole メソッドは、常に false を返します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-459">Since we are not concerned with roles at this juncture, the CustomPrincipal class's constructor accepts only a CustomIdentity object; its IsInRole method always returns false.</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample10.cs)]

### <a name="assigning-a-customprincipal-object-to-the-incoming-requests-security-context"></a><span data-ttu-id="6e0f6-460">受信要求のセキュリティ コンテキストに CustomPrincipal オブジェクトを割り当てる</span><span class="sxs-lookup"><span data-stu-id="6e0f6-460">Assigning a CustomPrincipal Object to the Incoming Request's Security Context</span></span>

<span data-ttu-id="6e0f6-461">カスタム id を使用するカスタム プリンシパル クラスと同様に、CompanyName とタイトルのプロパティを含める既定 IIdentity の仕様を拡張するクラスがあるようになりました。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-461">We now have a class that extends the default IIdentity specification to include CompanyName and Title properties, as well as a custom principal class that uses the custom identity.</span></span> <span data-ttu-id="6e0f6-462">ASP.NET パイプラインにステップ インする準備がお受信要求のセキュリティ コンテキストに、カスタム プリンシパル オブジェクトを割り当てます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-462">We are ready to step into the ASP.NET pipeline and assign our custom principal object to the incoming request's security context.</span></span>

<span data-ttu-id="6e0f6-463">ASP.NET パイプラインは、受信要求を受け取り、ステップの数を処理します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-463">The ASP.NET pipeline takes an incoming request and processes it through a number of steps.</span></span> <span data-ttu-id="6e0f6-464">各手順で、特定イベントが発生する、開発者は ASP.NET 処理パイプラインをタップし、ライフ サイクルの特定の時点で、要求を変更できるようにします。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-464">At each step, a particular event is raised, making it possible for developers to tap into the ASP.NET pipeline and modify the request at certain points in its lifecycle.</span></span> <span data-ttu-id="6e0f6-465">FormsAuthenticationModule は、発生させる ASP.NET などの待機、 [AuthenticateRequest イベント](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx)、この時点で、認証チケットを受信要求を検査します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-465">The FormsAuthenticationModule, for example, waits for ASP.NET to raise the [AuthenticateRequest event](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx), at which point it inspects the incoming request for an authentication ticket.</span></span> <span data-ttu-id="6e0f6-466">認証チケットが見つかった場合は、GenericPrincipal オブジェクトが作成され、HttpContext.User プロパティに割り当てられます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-466">If an authentication ticket is found, a GenericPrincipal object is created and assigned to the HttpContext.User property.</span></span>

<span data-ttu-id="6e0f6-467">AuthenticateRequest イベント後に ASP.NET パイプラインを発生させます、 [PostAuthenticateRequest イベント](https://msdn.microsoft.com/library/system.web.httpapplication.postauthenticaterequest.aspx)のインスタンスと FormsAuthenticationModule によって作成された GenericPrincipal オブジェクトを置換できますが、などの CustomPrincipal オブジェクト。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-467">After the AuthenticateRequest event, the ASP.NET pipeline raises the [PostAuthenticateRequest event](https://msdn.microsoft.com/library/system.web.httpapplication.postauthenticaterequest.aspx), which is where we can replace the GenericPrincipal object created by the FormsAuthenticationModule with an instance of our CustomPrincipal object.</span></span> <span data-ttu-id="6e0f6-468">図 7 は、このワークフローを示しています。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-468">Figure 7 depicts this workflow.</span></span>


<span data-ttu-id="6e0f6-469">[![GenericPrincipal は、CustomPrincipal PostAuthenticationRequest イベントに置き換え](forms-authentication-configuration-and-advanced-topics-cs/_static/image20.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="6e0f6-469">[![The GenericPrincipal is Replaced by a CustomPrincipal in the PostAuthenticationRequest Event](forms-authentication-configuration-and-advanced-topics-cs/_static/image20.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image19.png)</span></span>

<span data-ttu-id="6e0f6-470">**図 07**:、GenericPrincipal は、CustomPrincipal PostAuthenticationRequest イベントに置き換え ([フルサイズの画像を表示する をクリックします](forms-authentication-configuration-and-advanced-topics-cs/_static/image21.png))。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-470">**Figure 07**: The GenericPrincipal is Replaced by a CustomPrincipal in the PostAuthenticationRequest Event ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image21.png))</span></span>


<span data-ttu-id="6e0f6-471">コードを実行するには、ASP.NET パイプライン イベントに応答するためには、Global.asax で適切なイベント ハンドラーを作成しますか、独自の HTTP モジュールを作成します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-471">In order to execute code in response to an ASP.NET pipeline event, we can either create the appropriate event handler in Global.asax or create our own HTTP Module.</span></span> <span data-ttu-id="6e0f6-472">このチュートリアルには、Global.asax でイベント ハンドラーを作成しましょう。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-472">For this tutorial let's create the event handler in Global.asax.</span></span> <span data-ttu-id="6e0f6-473">Global.asax を web サイトに追加することで開始します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-473">Start by adding Global.asax to your website.</span></span> <span data-ttu-id="6e0f6-474">ソリューション エクスプ ローラーでプロジェクト名を右クリックし、Global.asax という、グローバル アプリケーション クラスの種類のアイテムを追加します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-474">Right-click on the project name in Solution Explorer and add an item of type Global Application Class named Global.asax.</span></span>


<span data-ttu-id="6e0f6-475">[![Global.asax ファイル、web サイトを追加します。](forms-authentication-configuration-and-advanced-topics-cs/_static/image23.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="6e0f6-475">[![Add a Global.asax File to Your Website](forms-authentication-configuration-and-advanced-topics-cs/_static/image23.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image22.png)</span></span>

<span data-ttu-id="6e0f6-476">**図 08**: Global.asax ファイルを web サイトに追加 ([フルサイズの画像を表示する をクリックします](forms-authentication-configuration-and-advanced-topics-cs/_static/image24.png))。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-476">**Figure 08**: Add a Global.asax File to Your Website ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image24.png))</span></span>


<span data-ttu-id="6e0f6-477">Global.asax の既定のテンプレートには、さまざまな開始日の終了を含む、ASP.NET パイプライン イベントのイベント ハンドラーが含まれています。 と[エラー イベント](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx)、他のユーザーの間で。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-477">The default Global.asax template includes event handlers for a number of the ASP.NET pipeline events, including the Start, End and [Error event](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx), among others.</span></span> <span data-ttu-id="6e0f6-478">自由にこれらのイベント ハンドラーを削除するようにこのアプリケーションの必要ことはありません。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-478">Feel free to remove these event handlers, as we do not need them for this application.</span></span> <span data-ttu-id="6e0f6-479">ここでは、イベントは PostAuthenticateRequest です。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-479">The event we are interested in is PostAuthenticateRequest.</span></span> <span data-ttu-id="6e0f6-480">そのマークアップは、次のようになりますので、Global.asax ファイルを更新します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-480">Update your Global.asax file so its markup looks similar to the following:</span></span>

[!code-aspx[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample11.aspx)]

<span data-ttu-id="6e0f6-481">アプリケーション\_OnPostAuthenticateRequest メソッドの実行のたびに、ASP.NET ランタイムは、受信した各ページ要求では、1 回、PostAuthenticateRequest イベントを発生させます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-481">The Application\_OnPostAuthenticateRequest method executes each time the ASP.NET runtime raises the PostAuthenticateRequest event, which happens once on each incoming page request.</span></span> <span data-ttu-id="6e0f6-482">イベント ハンドラーは、ユーザーが認証され、フォーム認証によって認証されたかどうかにどうかを確認して開始します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-482">The event handler starts by checking to see if the user is authenticated and was authenticated via forms authentication.</span></span> <span data-ttu-id="6e0f6-483">そうである場合は、新しい CustomIdentity オブジェクトが作成され、現在の要求の認証チケットをコンス トラクターに渡されます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-483">If so, a new CustomIdentity object is created and passed the current request's authentication ticket in its constructor.</span></span> <span data-ttu-id="6e0f6-484">次に、CustomPrincipal オブジェクトが作成され、作成したばかりの CustomIdentity オブジェクトをそのコンス トラクターに渡されました。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-484">Following that, a CustomPrincipal object is created and passed the just-created CustomIdentity object in its constructor.</span></span> <span data-ttu-id="6e0f6-485">最後に、現在の要求のセキュリティ コンテキストは、新しく作成された CustomPrincipal オブジェクトに割り当てられます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-485">Finally, the current request's security context is assigned to the newly created CustomPrincipal object.</span></span>

<span data-ttu-id="6e0f6-486">-要求のセキュリティ コンテキストと、などの CustomPrincipal オブジェクトの関連付け - 最後の手順が 2 つのプロパティをプリンシパルを割り当てることに注意してください: HttpContext.User と Thread.CurrentPrincipal します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-486">Note that the last step - associating the CustomPrincipal object with the request's security context - assigns the principal to two properties: HttpContext.User and Thread.CurrentPrincipal.</span></span> <span data-ttu-id="6e0f6-487">ASP.NET でのセキュリティ コンテキストの処理方法により、これら 2 つの割り当ては必要があります。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-487">These two assignments are necessary because of the way security contexts are handled in ASP.NET.</span></span> <span data-ttu-id="6e0f6-488">.NET Framework は、各実行中のスレッドをセキュリティ コンテキストを関連付けますこの情報は IPrincipal オブジェクトとして、[スレッド オブジェクト](https://msdn.microsoft.com/library/system.threading.thread.aspx)の[CurrentPrincipal プロパティ](https://msdn.microsoft.com/library/system.threading.thread.currentcontext.aspx)します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-488">The .NET Framework associates a security context with each running thread; this information is available as an IPrincipal object through the [Thread object](https://msdn.microsoft.com/library/system.threading.thread.aspx)'s [CurrentPrincipal property](https://msdn.microsoft.com/library/system.threading.thread.currentcontext.aspx).</span></span> <span data-ttu-id="6e0f6-489">ASP.NET には、独自のセキュリティ コンテキスト情報 (HttpContext.User) は、混乱を招くです。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-489">What is a confusing is that ASP.NET has its own security context information (HttpContext.User).</span></span>

<span data-ttu-id="6e0f6-490">セキュリティ コンテキストを決定するときに Thread.CurrentPrincipal プロパティを調べて特定のシナリオで他のシナリオでは、HttpContext.User が使用されます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-490">In certain scenarios, the Thread.CurrentPrincipal property is examined when determining the security context; in other scenarios, HttpContext.User is used.</span></span> <span data-ttu-id="6e0f6-491">たとえば、.NET の開発者は宣言によってどのようなユーザーの状態を許可するセキュリティ機能があるまたはロールのクラスのインスタンスを作成または特定のメソッドを呼び出すことができます (を参照してください[ビジネス レイヤーを使用してデータを承認規則の追加PrincipalPermissionAttributes](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx))。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-491">For example, there are security features in .NET that allow developers to declaratively state what users or roles can instantiate a class or invoke specific methods (see [Adding Authorization Rules to Business and Data Layers Using PrincipalPermissionAttributes](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx)).</span></span> <span data-ttu-id="6e0f6-492">実際には、下には、これらの宣言型の手法は、Thread.CurrentPrincipal プロパティを使用してセキュリティ コンテキストを決定します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-492">Underneath the covers, these declarative techniques determine the security context via the Thread.CurrentPrincipal property.</span></span>

<span data-ttu-id="6e0f6-493">他のシナリオでは、HttpContext.User プロパティが使用されます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-493">In other scenarios, the HttpContext.User property is used.</span></span> <span data-ttu-id="6e0f6-494">たとえば、前のチュートリアルでは、現在ログオンしているユーザーのユーザー名を表示するこのプロパティを使いました。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-494">For example, in the previous tutorial we used this property to display the currently logged on user's username.</span></span> <span data-ttu-id="6e0f6-495">明らかに、次は Thread.CurrentPrincipal と HttpContext.User プロパティでセキュリティ コンテキスト情報が一致します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-495">Clearly, then, it is imperative that the security context information in the Thread.CurrentPrincipal and HttpContext.User properties match up.</span></span>

<span data-ttu-id="6e0f6-496">ASP.NET ランタイムは、私たちにとって、これらのプロパティ値を自動的に反映されます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-496">The ASP.NET runtime automatically syncs these property values for us.</span></span> <span data-ttu-id="6e0f6-497">ただし、この同期は、AuthenticateRequest イベント後に発生しますが、*する前に*PostAuthenticateRequest イベント。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-497">However, this synchronization occurs after the AuthenticateRequest event, but *before* the PostAuthenticateRequest event.</span></span> <span data-ttu-id="6e0f6-498">その結果、PostAuthenticateRequest イベントでカスタム プリンシパルを追加するときにあるものを Thread.CurrentPrincipal ではそう Thread.CurrentPrincipal を手動で割り当てる必要があり、HttpContext.User が同期されます。参照してください[Context.User vs します。Thread.CurrentPrincipal](http://leastprivilege.com/2005/11/23/context-user-vs-thread-currentprincipal/)の詳細については、この問題にします。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-498">Consequently, when adding a custom principal in the PostAuthenticateRequest event we need to be certain to manually assign the Thread.CurrentPrincipal or else Thread.CurrentPrincipal and HttpContext.User will be out of sync. See [Context.User vs. Thread.CurrentPrincipal](http://leastprivilege.com/2005/11/23/context-user-vs-thread-currentprincipal/) for a more detailed discussion on this issue.</span></span>

### <a name="accessing-the-companyname-and-title-properties"></a><span data-ttu-id="6e0f6-499">CompanyName とタイトルのプロパティにアクセスします。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-499">Accessing the CompanyName and Title Properties</span></span>

<span data-ttu-id="6e0f6-500">要求が到着して、ASP.NET エンジンをアプリケーションにディスパッチされますたびに\_Global.asax で OnPostAuthenticateRequest イベント ハンドラーが起動されます。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-500">Whenever a request arrives and is dispatched to the ASP.NET engine, the Application\_OnPostAuthenticateRequest event handler in Global.asax will fire.</span></span> <span data-ttu-id="6e0f6-501">要求が、FormsAuthenticationModule で正常に認証されている場合、イベント ハンドラーは、フォーム認証チケットに基づく CustomIdentity オブジェクトに新しい CustomPrincipal オブジェクトを作成します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-501">If the request has been successfully authenticated by the FormsAuthenticationModule, the event handler will create a new CustomPrincipal object with a CustomIdentity object based on the forms authentication ticket.</span></span> <span data-ttu-id="6e0f6-502">このロジックで、現在ログオンしているユーザーの会社名とタイトルに関する情報へのアクセスは、非常に簡単です。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-502">With this logic in place, accessing information about the currently logged on user's company name and title is incredibly straightforward.</span></span>

<span data-ttu-id="6e0f6-503">ページに戻る\_フォーム認証チケットを取得し、ユーザーの会社名とタイトルを表示するには、UserData プロパティを解析するコードが作成した手順 4. で、Default.aspx の Load イベント ハンドラー。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-503">Return to the Page\_Load event handler in Default.aspx, where in Step 4 we wrote code to retrieve the form authentication ticket and parse the UserData property in order to display the user's company name and title.</span></span> <span data-ttu-id="6e0f6-504">使用を今すぐ CustomPrincipal および CustomIdentity オブジェクトでは、チケットの UserData プロパティから値を解析する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-504">With the CustomPrincipal and CustomIdentity objects in use now, there's no need to parse the values out of the ticket's UserData property.</span></span> <span data-ttu-id="6e0f6-505">代わりに、単に CustomIdentity オブジェクトへの参照を取得し、CompanyName とタイトルのプロパティを使用します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-505">Instead, simply get a reference to the CustomIdentity object and use its CompanyName and Title properties:</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample12.cs)]

## <a name="summary"></a><span data-ttu-id="6e0f6-506">まとめ</span><span class="sxs-lookup"><span data-stu-id="6e0f6-506">Summary</span></span>

<span data-ttu-id="6e0f6-507">このチュートリアルでは、Web.config を使用して、フォーム認証システムの設定をカスタマイズする方法について確認しました。認証チケットの有効期限の処理方法と、暗号化と検証の保護を使用してチケットを検査および変更から保護する方法について説明しました。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-507">In this tutorial we examined how to customize the forms authentication system's settings via Web.config. We looked at how the authentication ticket's expiration is handled and how the encryption and validation safeguards are used to protect the ticket from inspection and modification.</span></span> <span data-ttu-id="6e0f6-508">最後に、認証チケットの UserData プロパティを使用してチケット自体に追加のユーザー情報とカスタム プリンシパルと id オブジェクトを使用して、複数の開発者向けの方法でこの情報を公開する方法を格納するについて説明します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-508">Finally, we discussed using the authentication ticket's UserData property to store additional user information in the ticket itself, and how to use custom principal and identity objects to expose this information in a more developer-friendly manner.</span></span>

<span data-ttu-id="6e0f6-509">このチュートリアルでは、asp.net フォーム認証、調査を終了します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-509">This tutorial concludes our examination of forms authentication in ASP.NET.</span></span> <span data-ttu-id="6e0f6-510">次のチュートリアルでは、メンバーシップ フレームワークに旅を開始します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-510">The next tutorial starts our journey into the Membership framework.</span></span>

<span data-ttu-id="6e0f6-511">満足のプログラミングです。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-511">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="6e0f6-512">関連項目</span><span class="sxs-lookup"><span data-stu-id="6e0f6-512">Further Reading</span></span>

<span data-ttu-id="6e0f6-513">このチュートリアルで説明したトピックの詳細については、次の情報を参照してください。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-513">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="6e0f6-514">フォーム認証の詳細に分析します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-514">Dissecting Forms Authentication</span></span>](http://aspnet.4guysfromrolla.com/articles/072005-1.aspx)
- [<span data-ttu-id="6e0f6-515">ASP.NET 2.0 でのフォーム認証について説明します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-515">Explained: Forms Authentication in ASP.NET 2.0</span></span>](https://msdn.microsoft.com/library/aa480476.aspx)
- [<span data-ttu-id="6e0f6-516">方法: ASP.NET 2.0 でフォーム認証を保護します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-516">How To: Protect Forms Authentication in ASP.NET 2.0</span></span>](https://msdn.microsoft.com/library/ms998310.aspx)
- <span data-ttu-id="6e0f6-517">[Professional ASP.NET 2.0 のセキュリティ、メンバーシップ、およびロール管理](http://www.wrox.com/WileyCDA/WroxTitle/productCd-0764596985.html)(ISBN: 978-0-7645-9698-8)</span><span class="sxs-lookup"><span data-stu-id="6e0f6-517">[Professional ASP.NET 2.0 Security, Membership, and Role Management](http://www.wrox.com/WileyCDA/WroxTitle/productCd-0764596985.html) (ISBN: 978-0-7645-9698-8)</span></span>
- [<span data-ttu-id="6e0f6-518">ログイン コントロールをセキュリティで保護します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-518">Securing Login Controls</span></span>](https://msdn.microsoft.com/library/ms178346.aspx)
- [<span data-ttu-id="6e0f6-519">&lt;認証&gt;要素</span><span class="sxs-lookup"><span data-stu-id="6e0f6-519">The &lt;authentication&gt; Element</span></span>](https://msdn.microsoft.com/library/532aee0e.aspx)
- [<span data-ttu-id="6e0f6-520">&lt;フォーム&gt;要素&lt;認証&gt;</span><span class="sxs-lookup"><span data-stu-id="6e0f6-520">The &lt;forms&gt; Element for &lt;authentication&gt;</span></span>](https://msdn.microsoft.com/library/1d3t3c61.aspx)
- [<span data-ttu-id="6e0f6-521">&lt;MachineKey&gt;要素</span><span class="sxs-lookup"><span data-stu-id="6e0f6-521">The &lt;machineKey&gt; Element</span></span>](https://msdn.microsoft.com/library/w8h3skw9.aspx)
- [<span data-ttu-id="6e0f6-522">フォーム認証チケット Cookie を理解します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-522">Understanding the Forms Authentication Ticket and Cookie</span></span>](https://support.microsoft.com/kb/910443)

### <a name="video-training-on-topics-contained-in-this-tutorial"></a><span data-ttu-id="6e0f6-523">このチュートリアルに含まれるトピックのビデオ トレーニング</span><span class="sxs-lookup"><span data-stu-id="6e0f6-523">Video Training on Topics Contained in this Tutorial</span></span>

- [<span data-ttu-id="6e0f6-524">フォーム認証プロパティを変更する方法</span><span class="sxs-lookup"><span data-stu-id="6e0f6-524">How to Change the Forms Authentication Properties</span></span>](../../../videos/authentication/how-to-change-the-forms-authentication-properties.md)
- [<span data-ttu-id="6e0f6-525">ASP.NET アプリケーションで Cookie なしの認証をセットアップおよび使用する方法</span><span class="sxs-lookup"><span data-stu-id="6e0f6-525">How to Setup and Use Cookie-less Authentication in an ASP.NET Application</span></span>](../../../videos/authentication/how-to-setup-and-use-cookie-less-authentication-in-an-aspnet-application.md)
- [<span data-ttu-id="6e0f6-526">ASP フォーム ログイン再配置</span><span class="sxs-lookup"><span data-stu-id="6e0f6-526">ASP Forms Login Relocation</span></span>](../../../videos/authentication/asp-forms-login-relocation.md)
- [<span data-ttu-id="6e0f6-527">フォーム ログイン カスタム キー構成</span><span class="sxs-lookup"><span data-stu-id="6e0f6-527">Forms Login Custom Key Configuration</span></span>](../../../videos/authentication/forms-login-custom-key-configuration.md)
- [<span data-ttu-id="6e0f6-528">認証方法にカスタム データを追加する</span><span class="sxs-lookup"><span data-stu-id="6e0f6-528">Add Custom Data to the Authentication Method</span></span>](../../../videos/authentication/add-custom-data-to-the-authentication-method.md)
- [<span data-ttu-id="6e0f6-529">カスタム プリンシパル オブジェクトを使用する</span><span class="sxs-lookup"><span data-stu-id="6e0f6-529">Use Custom Principal Objects</span></span>](../../../videos/authentication/use-custom-principal-objects.md)

### <a name="about-the-author"></a><span data-ttu-id="6e0f6-530">執筆者紹介</span><span class="sxs-lookup"><span data-stu-id="6e0f6-530">About the Author</span></span>

<span data-ttu-id="6e0f6-531">Scott Mitchell、複数の受け取ります書籍の著者と、4GuysFromRolla.com の創設者では、1998 年から、Microsoft Web テクノロジに取り組んできました。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-531">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="6e0f6-532">Scott は、フリーのコンサルタント、トレーナー、およびライターとして動作します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-532">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="6e0f6-533">最新の著書は *[Sams 教える自分で ASP.NET 2.0 24 時間以内に](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)* します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-533">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="6e0f6-534">Scott に到達できる[ mitchell@4guysfromrolla.com ](mailto:mitchell@4guysfromrolla.com)または彼のブログ[ http://ScottOnWriting.NET](http://scottonwriting.net/)します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-534">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="6e0f6-535">特別なに感謝します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-535">Special Thanks To</span></span>

<span data-ttu-id="6e0f6-536">このチュートリアル シリーズは、多くの便利なレビュー担当者によってレビューされました。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-536">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="6e0f6-537">このチュートリアルでは、潜在顧客レビュー担当者は、Alicja Maziarz でした。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-537">Lead reviewer for this tutorial was Alicja Maziarz.</span></span> <span data-ttu-id="6e0f6-538">今後、MSDN の記事を確認したいですか。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-538">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="6e0f6-539">場合は、筆者に[ mitchell@4GuysFromRolla.com](mailto:mitchell@4guysfromrolla.com)します。</span><span class="sxs-lookup"><span data-stu-id="6e0f6-539">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4guysfromrolla.com).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="6e0f6-540">[前へ](an-overview-of-forms-authentication-cs.md)
> [次へ](security-basics-and-asp-net-support-vb.md)</span><span class="sxs-lookup"><span data-stu-id="6e0f6-540">[Previous](an-overview-of-forms-authentication-cs.md)
[Next](security-basics-and-asp-net-support-vb.md)</span></span>
