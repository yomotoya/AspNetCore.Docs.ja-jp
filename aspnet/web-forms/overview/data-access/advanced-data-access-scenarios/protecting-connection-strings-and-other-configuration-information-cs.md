---
uid: web-forms/overview/data-access/advanced-data-access-scenarios/protecting-connection-strings-and-other-configuration-information-cs
title: 接続文字列とその他の構成情報 (c#) を保護する |Microsoft Docs
author: rick-anderson
description: ASP.NET アプリケーションは、通常、構成情報を Web.config ファイルに格納します。 この情報の一部は小文字が区別し、保護を保証します。 によって定義.
ms.author: riande
ms.date: 08/03/2007
ms.assetid: ad8dd396-30f7-4abe-ac02-a0b84422e5be
msc.legacyurl: /web-forms/overview/data-access/advanced-data-access-scenarios/protecting-connection-strings-and-other-configuration-information-cs
msc.type: authoredcontent
ms.openlocfilehash: 61ac52ffe28762ce0cf8892621343f71e73a9ca7
ms.sourcegitcommit: 45ac74e400f9f2b7dbded66297730f6f14a4eb25
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/16/2018
ms.locfileid: "41828806"
---
<a name="protecting-connection-strings-and-other-configuration-information-c"></a><span data-ttu-id="a5089-105">接続文字列とその他の構成情報 (c#) を保護します。</span><span class="sxs-lookup"><span data-stu-id="a5089-105">Protecting Connection Strings and Other Configuration Information (C#)</span></span>
====================
<span data-ttu-id="a5089-106">によって[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="a5089-106">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="a5089-107">[コードのダウンロード](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_73_CS.zip)または[PDF のダウンロード](protecting-connection-strings-and-other-configuration-information-cs/_static/datatutorial73cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="a5089-107">[Download Code](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_73_CS.zip) or [Download PDF](protecting-connection-strings-and-other-configuration-information-cs/_static/datatutorial73cs1.pdf)</span></span>

> <span data-ttu-id="a5089-108">ASP.NET アプリケーションは、通常、構成情報を Web.config ファイルに格納します。</span><span class="sxs-lookup"><span data-stu-id="a5089-108">An ASP.NET application typically stores configuration information in a Web.config file.</span></span> <span data-ttu-id="a5089-109">この情報の一部は小文字が区別し、保護を保証します。</span><span class="sxs-lookup"><span data-stu-id="a5089-109">Some of this information is sensitive and warrants protection.</span></span> <span data-ttu-id="a5089-110">既定でこのファイルは発生しません Web サイトの訪問者が、管理者や、ハッカー可能性があります Web サーバーのファイル システムにアクセスし、ファイルの内容を表示します。</span><span class="sxs-lookup"><span data-stu-id="a5089-110">By default this file will not be served to a Web site visitor, but an administrator or a hacker may gain access to the Web server's file system and view the contents of the file.</span></span> <span data-ttu-id="a5089-111">このチュートリアルでは ASP.NET 2.0 では、Web.config ファイルのセクションを暗号化して機密情報を保護することを説明します。</span><span class="sxs-lookup"><span data-stu-id="a5089-111">In this tutorial we learn that ASP.NET 2.0 allows us to protect sensitive information by encrypting sections of the Web.config file.</span></span>


## <a name="introduction"></a><span data-ttu-id="a5089-112">はじめに</span><span class="sxs-lookup"><span data-stu-id="a5089-112">Introduction</span></span>

<span data-ttu-id="a5089-113">ASP.NET アプリケーションの構成情報がよくという XML ファイルに格納されている`Web.config`します。</span><span class="sxs-lookup"><span data-stu-id="a5089-113">Configuration information for ASP.NET applications is commonly stored in an XML file named `Web.config`.</span></span> <span data-ttu-id="a5089-114">これらのチュートリアルの過程で更新した、`Web.config`いくつかの時間。</span><span class="sxs-lookup"><span data-stu-id="a5089-114">Over the course of these tutorials we have updated the `Web.config` a handful of times.</span></span> <span data-ttu-id="a5089-115">作成するときに、`Northwind`で型指定されたデータセット、[最初のチュートリアル](../introduction/creating-a-data-access-layer-cs.md)、たとえば、接続文字列情報を自動的に追加されたに`Web.config`で、`<connectionStrings>`セクション。</span><span class="sxs-lookup"><span data-stu-id="a5089-115">When creating the `Northwind` Typed DataSet in the [first tutorial](../introduction/creating-a-data-access-layer-cs.md), for example, connection string information was automatically added to `Web.config` in the `<connectionStrings>` section.</span></span> <span data-ttu-id="a5089-116">後の「、[マスター ページとサイト ナビゲーション](../introduction/master-pages-and-site-navigation-cs.md)チュートリアルでは、手動で更新しました`Web.config`を追加する、`<pages>`要素は、すべてのプロジェクト内の ASP.NET ページを使用することを示す、`DataWebControls`テーマ。</span><span class="sxs-lookup"><span data-stu-id="a5089-116">Later, in the [Master Pages and Site Navigation](../introduction/master-pages-and-site-navigation-cs.md) tutorial, we manually updated `Web.config`, adding a `<pages>` element indicating that all of the ASP.NET pages in our project should use the `DataWebControls` Theme.</span></span>

<span data-ttu-id="a5089-117">`Web.config` 、接続文字列などの機密データを含めることができますが重要ですがの内容`Web.config`安全で承認されていないビューアーから非表示を保持します。</span><span class="sxs-lookup"><span data-stu-id="a5089-117">Since `Web.config` may contain sensitive data such as connection strings, it is important that the contents of `Web.config` be kept safe and hidden from unauthorized viewers.</span></span> <span data-ttu-id="a5089-118">既定では、任意の HTTP の要求を持つファイルに、`.config`拡張機能は、返す ASP.NET エンジンによって処理されます、*この種類のページが提供されない*図 1 に表示されるメッセージ。</span><span class="sxs-lookup"><span data-stu-id="a5089-118">By default, any HTTP request to a file with the `.config` extension is handled by the ASP.NET engine, which returns the *This type of page is not served* message shown in Figure 1.</span></span> <span data-ttu-id="a5089-119">つまり、訪問者を表示できない、 `Web.config` s の内容を入力するだけでファイル http://www.YourServer.com/Web.config ブラウザーのアドレス バーにします。</span><span class="sxs-lookup"><span data-stu-id="a5089-119">This means that visitors cannot view your `Web.config` file s contents by simply entering http://www.YourServer.com/Web.config into their browser s Address bar.</span></span>


<span data-ttu-id="a5089-120">[![Web.config で、ブラウザーを返します。 ページのこの型にアクセスして、メッセージは処理されません。](protecting-connection-strings-and-other-configuration-information-cs/_static/image2.png)](protecting-connection-strings-and-other-configuration-information-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="a5089-120">[![Visiting Web.config Through a Browser Returns a This type of page is not served Message](protecting-connection-strings-and-other-configuration-information-cs/_static/image2.png)](protecting-connection-strings-and-other-configuration-information-cs/_static/image1.png)</span></span>

<span data-ttu-id="a5089-121">**図 1**: 訪問`Web.config`を通じて、ブラウザーを返しますページの種類、このメッセージは提供されませんが ([フルサイズの画像を表示する をクリックします。](protecting-connection-strings-and-other-configuration-information-cs/_static/image3.png))。</span><span class="sxs-lookup"><span data-stu-id="a5089-121">**Figure 1**: Visiting `Web.config` Through a Browser Returns a This type of page is not served Message ([Click to view full-size image](protecting-connection-strings-and-other-configuration-information-cs/_static/image3.png))</span></span>


<span data-ttu-id="a5089-122">しかし、攻撃者を使用して表示するその他のいくつかの悪用を検索することができない場合、`Web.config`ファイルの内容を s でしょうか。</span><span class="sxs-lookup"><span data-stu-id="a5089-122">But what if an attacker is able to find some other exploit that allows her to view your `Web.config` file s contents?</span></span> <span data-ttu-id="a5089-123">攻撃者何がこの情報を使用し、内の機密情報の保護を強化する手順を実行できる`Web.config`でしょうか。</span><span class="sxs-lookup"><span data-stu-id="a5089-123">What could an attacker do with this information, and what steps can be taken to further protect the sensitive information within `Web.config`?</span></span> <span data-ttu-id="a5089-124">ほとんどのセクションでさいわい、`Web.config`機密情報は含まれません。</span><span class="sxs-lookup"><span data-stu-id="a5089-124">Fortunately, most sections in `Web.config` do not contain sensitive information.</span></span> <span data-ttu-id="a5089-125">ASP.NET ページによって使用されるテーマの既定の名前がわかっている場合に、攻撃者が利用するどのような損害ことができますか。</span><span class="sxs-lookup"><span data-stu-id="a5089-125">What harm can an attacker perpetrate if they know the name of the default Theme used by your ASP.NET pages?</span></span>

<span data-ttu-id="a5089-126">特定`Web.config`セクションでには、ただし、接続文字列、ユーザー名、パスワード、サーバー名、暗号化キー、およびなどを含めることがある機密情報が含まれています。</span><span class="sxs-lookup"><span data-stu-id="a5089-126">Certain `Web.config` sections, however, contain sensitive information that may include connection strings, user names, passwords, server names, encryption keys, and so forth.</span></span> <span data-ttu-id="a5089-127">この情報は、次でよく見られる`Web.config`セクション。</span><span class="sxs-lookup"><span data-stu-id="a5089-127">This information is typically found in the following `Web.config` sections:</span></span>

- `<appSettings>`
- `<connectionStrings>`
- `<identity>`
- `<sessionState>`

<span data-ttu-id="a5089-128">このチュートリアルでは、このような機密性の高い構成情報を保護するための手法に注目します。</span><span class="sxs-lookup"><span data-stu-id="a5089-128">In this tutorial we will look at techniques for protecting such sensitive configuration information.</span></span> <span data-ttu-id="a5089-129">、わかるとおり、.NET Framework version 2.0 を簡単に選択した構成セクションではプログラムで暗号化と復号化できる保護された構成システムが含まれています。</span><span class="sxs-lookup"><span data-stu-id="a5089-129">As we will see, the .NET Framework version 2.0 includes a protected configurations system that makes programmatically encrypting and decrypting selected configuration sections a breeze.</span></span>

> [!NOTE]
> <span data-ttu-id="a5089-130">このチュートリアルの最後に、ASP.NET アプリケーションからデータベースに接続するための Microsoft s の推奨事項を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a5089-130">This tutorial concludes with a look at Microsoft s recommendations for connecting to a database from an ASP.NET application.</span></span> <span data-ttu-id="a5089-131">接続文字列を暗号化するには、安全な方法でデータベースに接続していることを確認して、システムを強化することができます。</span><span class="sxs-lookup"><span data-stu-id="a5089-131">In addition to encrypting your connection strings, you can help harden your system by ensuring that you are connecting to the database in a secure fashion.</span></span>


## <a name="step-1-exploring-aspnet-20-s-protected-configuration-options"></a><span data-ttu-id="a5089-132">手順 1: ASP.NET 2.0 の探索の保護の構成オプション</span><span class="sxs-lookup"><span data-stu-id="a5089-132">Step 1: Exploring ASP.NET 2.0 s Protected Configuration Options</span></span>

<span data-ttu-id="a5089-133">ASP.NET 2.0 には、構成情報を暗号化および暗号化の保護された構成システムが含まれています。</span><span class="sxs-lookup"><span data-stu-id="a5089-133">ASP.NET 2.0 includes a protected configuration system for encrypting and decrypting configuration information.</span></span> <span data-ttu-id="a5089-134">これには、プログラムでの暗号化または構成情報を復号化に使用できる .NET Framework にはメソッドが含まれます。</span><span class="sxs-lookup"><span data-stu-id="a5089-134">This includes methods in the .NET Framework that can be used to programmatically encrypt or decrypt configuration information.</span></span> <span data-ttu-id="a5089-135">保護された構成システムを使用して、[プロバイダー モデル](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx)開発者はどのような暗号化実装の使用を選択することができます。</span><span class="sxs-lookup"><span data-stu-id="a5089-135">The protected configuration system uses the [provider model](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx), which allows developers to choose what cryptographic implementation is used.</span></span>

<span data-ttu-id="a5089-136">.NET Framework では、2 つの保護構成プロバイダーが付属しています。</span><span class="sxs-lookup"><span data-stu-id="a5089-136">The .NET Framework ships with two protected configuration providers:</span></span>

- <span data-ttu-id="a5089-137">[`RSAProtectedConfigurationProvider`](https://msdn.microsoft.com/library/system.configuration.rsaprotectedconfigurationprovider.aspx) -は、非対称[RSA アルゴリズム](http://en.wikipedia.org/wiki/Rsa)暗号化と復号化します。</span><span class="sxs-lookup"><span data-stu-id="a5089-137">[`RSAProtectedConfigurationProvider`](https://msdn.microsoft.com/library/system.configuration.rsaprotectedconfigurationprovider.aspx) - uses the asymmetric [RSA algorithm](http://en.wikipedia.org/wiki/Rsa) for encryption and decryption.</span></span>
- <span data-ttu-id="a5089-138">[`DPAPIProtectedConfigurationProvider`](https://msdn.microsoft.com/system.configuration.dpapiprotectedconfigurationprovider.aspx) Windows を使用して[データ保護 API (DPAPI)](https://msdn.microsoft.com/library/ms995355.aspx)暗号化と復号化します。</span><span class="sxs-lookup"><span data-stu-id="a5089-138">[`DPAPIProtectedConfigurationProvider`](https://msdn.microsoft.com/system.configuration.dpapiprotectedconfigurationprovider.aspx) - uses the Windows [Data Protection API (DPAPI)](https://msdn.microsoft.com/library/ms995355.aspx) for encryption and decryption.</span></span>

<span data-ttu-id="a5089-139">保護された構成システムは、プロバイダーの設計パターンを実装するためを独自の保護構成プロバイダーを作成し、アプリケーションに組み込むことです。</span><span class="sxs-lookup"><span data-stu-id="a5089-139">Since the protected configuration system implements the provider design pattern, it is possible to create your own protected configuration provider and plug it into your application.</span></span> <span data-ttu-id="a5089-140">参照してください[保護構成プロバイダーを実装する](https://msdn.microsoft.com/library/wfc2t3az(VS.80).aspx)このプロセスの詳細についてはします。</span><span class="sxs-lookup"><span data-stu-id="a5089-140">See [Implementing a Protected Configuration Provider](https://msdn.microsoft.com/library/wfc2t3az(VS.80).aspx) for more information on this process.</span></span>

<span data-ttu-id="a5089-141">RSA および DPAPI プロバイダー キーを暗号化と復号化ルーチンを使用して、コンピューター、またはユーザー レベルでこれらのキーを格納することができます。</span><span class="sxs-lookup"><span data-stu-id="a5089-141">The RSA and DPAPI providers use keys for their encryption and decryption routines, and these keys can be stored at the machine- or user-level.</span></span> <span data-ttu-id="a5089-142">マシン レベル キーは、独自の専用サーバーでは、web アプリケーションが実行されているシナリオに最適ですか、共有する必要があるサーバーで複数のアプリケーションがあるかどうかは、情報を暗号化します。</span><span class="sxs-lookup"><span data-stu-id="a5089-142">Machine-level keys are ideal for scenarios where the web application runs on its own dedicated server or if there are multiple applications on a server that need to share encrypted information.</span></span> <span data-ttu-id="a5089-143">ユーザー レベルのキーは、場所、同じサーバー上の他のアプリケーションで必要があります、アプリケーション s 保護の構成セクションを復号化できません。 共有のホスト環境でより安全なオプションです。</span><span class="sxs-lookup"><span data-stu-id="a5089-143">User-level keys are a more secure option in shared hosting environments where other applications on the same server should not be able to decrypt your application s protected configuration sections.</span></span>

<span data-ttu-id="a5089-144">このチュートリアルでは、DPAPI プロバイダーとマシン レベル キーには、例を使用します。</span><span class="sxs-lookup"><span data-stu-id="a5089-144">In this tutorial our examples will use the DPAPI provider and machine-level keys.</span></span> <span data-ttu-id="a5089-145">具体的には、暗号化するに注目するは、`<connectionStrings>`セクション`Web.config`、保護された構成システムは、ほとんどすべての暗号化に使用できますが、`Web.config`セクション。</span><span class="sxs-lookup"><span data-stu-id="a5089-145">Specifically, we will look at encrypting the `<connectionStrings>` section in `Web.config`, although the protected configuration system can be used to encrypt most any `Web.config` section.</span></span> <span data-ttu-id="a5089-146">ユーザー レベルのキーを使用する RSA プロバイダーを使用してでは、このチュートリアルの最後に、それ以上の測定値のセクションでリソースを参照してください。</span><span class="sxs-lookup"><span data-stu-id="a5089-146">For information on using user-level keys or using the RSA provider, consult the resources in the Further Readings section at the end of this tutorial.</span></span>

> [!NOTE]
> <span data-ttu-id="a5089-147">`RSAProtectedConfigurationProvider`と`DPAPIProtectedConfigurationProvider`にプロバイダーが登録されている、`machine.config`プロバイダーの名前を含むファイル`RsaProtectedConfigurationProvider`と`DataProtectionConfigurationProvider`、それぞれします。</span><span class="sxs-lookup"><span data-stu-id="a5089-147">The `RSAProtectedConfigurationProvider` and `DPAPIProtectedConfigurationProvider` providers are registered in the `machine.config` file with the provider names `RsaProtectedConfigurationProvider` and `DataProtectionConfigurationProvider`, respectively.</span></span> <span data-ttu-id="a5089-148">暗号化または適切なプロバイダー名を指定する必要があります。 構成情報を暗号化解除 (`RsaProtectedConfigurationProvider`または`DataProtectionConfigurationProvider`) 実際の型名ではなく (`RSAProtectedConfigurationProvider`と`DPAPIProtectedConfigurationProvider`)。</span><span class="sxs-lookup"><span data-stu-id="a5089-148">When encrypting or decrypting configuration information we will need to supply the appropriate provider name (`RsaProtectedConfigurationProvider` or `DataProtectionConfigurationProvider`) rather than the actual type name (`RSAProtectedConfigurationProvider` and `DPAPIProtectedConfigurationProvider`).</span></span> <span data-ttu-id="a5089-149">検索することができます、`machine.config`ファイル、`$WINDOWS$\Microsoft.NET\Framework\version\CONFIG`フォルダー。</span><span class="sxs-lookup"><span data-stu-id="a5089-149">You can find the `machine.config` file in the `$WINDOWS$\Microsoft.NET\Framework\version\CONFIG` folder.</span></span>


## <a name="step-2-programmatically-encrypting-and-decrypting-configuration-sections"></a><span data-ttu-id="a5089-150">手順 2: をプログラムで暗号化し、構成セクションを復号化</span><span class="sxs-lookup"><span data-stu-id="a5089-150">Step 2: Programmatically Encrypting and Decrypting Configuration Sections</span></span>

<span data-ttu-id="a5089-151">数行のコードでは、暗号化または指定したプロバイダーを使用して特定の構成セクションを復号化できます。</span><span class="sxs-lookup"><span data-stu-id="a5089-151">With a few lines of code we can encrypt or decrypt a particular configuration section using a specified provider.</span></span> <span data-ttu-id="a5089-152">コードでわかるとおり、だけで済みますをプログラムで、適切な構成セクションを参照を呼び出すその`ProtectSection`または`UnprotectSection`メソッド、および、呼び出し、`Save`メソッドの変更を保持します。</span><span class="sxs-lookup"><span data-stu-id="a5089-152">The code, as we will see shortly, simply needs to programmatically reference the appropriate configuration section, call its `ProtectSection` or `UnprotectSection` method, and then call the `Save` method to persist the changes.</span></span> <span data-ttu-id="a5089-153">さらに、.NET Framework には、暗号化および構成情報を復号化できる便利なコマンド ライン ユーティリティが含まれています。</span><span class="sxs-lookup"><span data-stu-id="a5089-153">Moreover, the .NET Framework includes a helpful command line utility that can encrypt and decrypt configuration information.</span></span> <span data-ttu-id="a5089-154">手順 3 では、このコマンド ライン ユーティリティを紹介します。</span><span class="sxs-lookup"><span data-stu-id="a5089-154">We will explore this command line utility in Step 3.</span></span>

<span data-ttu-id="a5089-155">プログラムによる保護の構成情報を示すためには、let s は暗号化および復号化するボタンを含む ASP.NET ページを作成、`<connectionStrings>`セクション`Web.config`します。</span><span class="sxs-lookup"><span data-stu-id="a5089-155">To illustrate programmatically protecting configuration information, let s create an ASP.NET page that includes buttons for encrypting and decrypting the `<connectionStrings>` section in `Web.config`.</span></span>

<span data-ttu-id="a5089-156">開いて開始、`EncryptingConfigSections.aspx`ページで、`AdvancedDAL`フォルダー。</span><span class="sxs-lookup"><span data-stu-id="a5089-156">Start by opening the `EncryptingConfigSections.aspx` page in the `AdvancedDAL` folder.</span></span> <span data-ttu-id="a5089-157">TextBox コントロールをドラッグして、デザイナーの設定には、ツールボックスからその`ID`プロパティを`WebConfigContents`その`TextMode`プロパティを`MultiLine`とその`Width`と`Rows`95%、15、プロパティそれぞれします。</span><span class="sxs-lookup"><span data-stu-id="a5089-157">Drag a TextBox control from the Toolbox onto the Designer, setting its `ID` property to `WebConfigContents`, its `TextMode` property to `MultiLine`, and its `Width` and `Rows` properties to 95% and 15, respectively.</span></span> <span data-ttu-id="a5089-158">このテキスト ボックス コントロールの内容が表示されます`Web.config`かどうか、コンテンツは暗号化されているかをすばやく確認することができます。</span><span class="sxs-lookup"><span data-stu-id="a5089-158">This TextBox control will display the contents of `Web.config` allowing us to quickly see if the contents are encrypted or not.</span></span> <span data-ttu-id="a5089-159">もちろん、実際のアプリケーションではしないの内容を表示する`Web.config`します。</span><span class="sxs-lookup"><span data-stu-id="a5089-159">Of course, in a real application you would never want to display the contents of `Web.config`.</span></span>

<span data-ttu-id="a5089-160">テキスト ボックスに、下にある、という名前の 2 つのボタン コントロールを追加`EncryptConnStrings`と`DecryptConnStrings`します。</span><span class="sxs-lookup"><span data-stu-id="a5089-160">Beneath the TextBox, add two Button controls named `EncryptConnStrings` and `DecryptConnStrings`.</span></span> <span data-ttu-id="a5089-161">接続文字列の暗号化および復号化の接続文字列にそのテキスト プロパティを設定します。</span><span class="sxs-lookup"><span data-stu-id="a5089-161">Set their Text properties to Encrypt Connection Strings and Decrypt Connection Strings .</span></span>

<span data-ttu-id="a5089-162">この時点で、画面は図 2 のようなはずです。</span><span class="sxs-lookup"><span data-stu-id="a5089-162">At this point your screen should look similar to Figure 2.</span></span>


<span data-ttu-id="a5089-163">[![テキスト ボックスと 2 つのボタンの Web コントロールをページに追加します。](protecting-connection-strings-and-other-configuration-information-cs/_static/image5.png)](protecting-connection-strings-and-other-configuration-information-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="a5089-163">[![Add a TextBox and Two Button Web Controls to the Page](protecting-connection-strings-and-other-configuration-information-cs/_static/image5.png)](protecting-connection-strings-and-other-configuration-information-cs/_static/image4.png)</span></span>

<span data-ttu-id="a5089-164">**図 2**: テキスト ボックスと 2 つのボタンの Web コントロールをページに追加 ([フルサイズの画像を表示する をクリックします](protecting-connection-strings-and-other-configuration-information-cs/_static/image6.png))。</span><span class="sxs-lookup"><span data-stu-id="a5089-164">**Figure 2**: Add a TextBox and Two Button Web Controls to the Page ([Click to view full-size image](protecting-connection-strings-and-other-configuration-information-cs/_static/image6.png))</span></span>


<span data-ttu-id="a5089-165">次に、読み込んでの内容を表示するコードを記述する必要があります`Web.config`で、`WebConfigContents`テキスト ボックスに、ページが最初に読み込まれます。</span><span class="sxs-lookup"><span data-stu-id="a5089-165">Next, we need to write code that loads and displays the contents of `Web.config` in the `WebConfigContents` TextBox when the page is first loaded.</span></span> <span data-ttu-id="a5089-166">ページの分離コード クラスには、次のコードを追加します。</span><span class="sxs-lookup"><span data-stu-id="a5089-166">Add the following code to the page s code-behind class.</span></span> <span data-ttu-id="a5089-167">このコードでは、という名前のメソッドを追加します`DisplayWebConfig`からそれを呼び出すと、`Page_Load`イベント ハンドラーと`Page.IsPostBack`は`false`:。</span><span class="sxs-lookup"><span data-stu-id="a5089-167">This code adds a method named `DisplayWebConfig` and calls it from the `Page_Load` event handler when `Page.IsPostBack` is `false`:</span></span>


[!code-csharp[Main](protecting-connection-strings-and-other-configuration-information-cs/samples/sample1.cs)]

<span data-ttu-id="a5089-168">`DisplayWebConfig`メソッドは、 [ `File`クラス](https://msdn.microsoft.com/library/system.io.file.aspx)にアプリケーションを開きます`Web.config`ファイル、 [ `StreamReader`クラス](https://msdn.microsoft.com/library/system.io.streamreader.aspx)文字列であり、にその内容を読み取る[`Path`クラス](https://msdn.microsoft.com/library/system.io.path.aspx)への物理パスを生成する、`Web.config`ファイル。</span><span class="sxs-lookup"><span data-stu-id="a5089-168">The `DisplayWebConfig` method uses the [`File` class](https://msdn.microsoft.com/library/system.io.file.aspx) to open the application s `Web.config` file, the [`StreamReader` class](https://msdn.microsoft.com/library/system.io.streamreader.aspx) to read its contents into a string, and the [`Path` class](https://msdn.microsoft.com/library/system.io.path.aspx) to generate the physical path to the `Web.config` file.</span></span> <span data-ttu-id="a5089-169">これら 3 つのクラスは、すべてで、 [ `System.IO`名前空間](https://msdn.microsoft.com/library/system.io.aspx)します。</span><span class="sxs-lookup"><span data-stu-id="a5089-169">These three classes are all found in the [`System.IO` namespace](https://msdn.microsoft.com/library/system.io.aspx).</span></span> <span data-ttu-id="a5089-170">その結果、追加する必要がありますには、 `using` `System.IO` 、分離コード クラスか、または、これらのクラス名をプレフィックスの先頭にステートメント`System.IO.`します。</span><span class="sxs-lookup"><span data-stu-id="a5089-170">Consequently, you will need to add a `using` `System.IO` statement to the top of the code-behind class or, alternatively, prefix these class names with `System.IO.` .</span></span>

<span data-ttu-id="a5089-171">次に、2 つのボタン コントロールのイベント ハンドラーを追加する必要があります`Click`イベントの暗号化し、復号化に必要なコードを追加し、`<connectionStrings>`セクションでは、DPAPI プロバイダー マシン レベル キーを使用します。</span><span class="sxs-lookup"><span data-stu-id="a5089-171">Next, we need to add event handlers for the two Button controls `Click` events and add the necessary code to encrypt and decrypt the `<connectionStrings>` section using a machine-level key with the DPAPI provider.</span></span> <span data-ttu-id="a5089-172">デザイナーでは、各追加ボタンをダブルクリックして、`Click`分離コード内のイベント ハンドラー クラスを次のコードを追加。</span><span class="sxs-lookup"><span data-stu-id="a5089-172">From the Designer, double-click each of the Buttons to add a `Click` event handler in the code-behind class and then add the following code:</span></span>


[!code-csharp[Main](protecting-connection-strings-and-other-configuration-information-cs/samples/sample2.cs)]

<span data-ttu-id="a5089-173">2 つのイベント ハンドラーで使用するコードとほぼ同じです。</span><span class="sxs-lookup"><span data-stu-id="a5089-173">The code used in the two event handlers is nearly identical.</span></span> <span data-ttu-id="a5089-174">現在のアプリケーションの情報を取得することで開始するには両方`Web.config`ファイルを使用して、 [ `WebConfigurationManager`クラス](https://msdn.microsoft.com/library/system.web.configuration.webconfigurationmanager.aspx)s [ `OpenWebConfiguration`メソッド](https://msdn.microsoft.com/library/system.web.configuration.webconfigurationmanager.openwebconfiguration.aspx)します。</span><span class="sxs-lookup"><span data-stu-id="a5089-174">They both start by getting information about the current application s `Web.config` file via the [`WebConfigurationManager` class](https://msdn.microsoft.com/library/system.web.configuration.webconfigurationmanager.aspx) s [`OpenWebConfiguration` method](https://msdn.microsoft.com/library/system.web.configuration.webconfigurationmanager.openwebconfiguration.aspx).</span></span> <span data-ttu-id="a5089-175">このメソッドは、指定された仮想パスの web 構成ファイルを返します。</span><span class="sxs-lookup"><span data-stu-id="a5089-175">This method returns the web configuration file for the specified virtual path.</span></span> <span data-ttu-id="a5089-176">次に、`Web.config`ファイル %s`<connectionStrings>`セクションにはによってアクセス、 [ `Configuration`クラス](https://msdn.microsoft.com/library/system.configuration.configuration.aspx)s [ `GetSection(sectionName)`メソッド](https://msdn.microsoft.com/library/system.configuration.configuration.getsection.aspx)、返された、 [ `ConfigurationSection` ](https://msdn.microsoft.com/library/system.configuration.configurationsection.aspx)オブジェクト。</span><span class="sxs-lookup"><span data-stu-id="a5089-176">Next, the `Web.config` file s `<connectionStrings>` section is accessed via the [`Configuration` class](https://msdn.microsoft.com/library/system.configuration.configuration.aspx) s [`GetSection(sectionName)` method](https://msdn.microsoft.com/library/system.configuration.configuration.getsection.aspx), which returns a [`ConfigurationSection`](https://msdn.microsoft.com/library/system.configuration.configurationsection.aspx) object.</span></span>

<span data-ttu-id="a5089-177">`ConfigurationSection`オブジェクトが含まれています、 [ `SectionInformation`プロパティ](https://msdn.microsoft.com/library/system.configuration.configurationsection.sectioninformation.aspx)追加情報および構成セクションに関する機能を提供します。</span><span class="sxs-lookup"><span data-stu-id="a5089-177">The `ConfigurationSection` object includes a [`SectionInformation` property](https://msdn.microsoft.com/library/system.configuration.configurationsection.sectioninformation.aspx) that provides additional information and functionality regarding the configuration section.</span></span> <span data-ttu-id="a5089-178">上のコードとを確認して構成セクションを暗号化するかどうかを決定できます、`SectionInformation`プロパティの`IsProtected`プロパティ。</span><span class="sxs-lookup"><span data-stu-id="a5089-178">As the code above shows, we can determine whether the configuration section is encrypted by checking the `SectionInformation` property s `IsProtected` property.</span></span> <span data-ttu-id="a5089-179">セクションを暗号化またはを使用して復号化、さらに、`SectionInformation`プロパティ %s`ProtectSection(provider)`と`UnprotectSection`メソッド。</span><span class="sxs-lookup"><span data-stu-id="a5089-179">Moreover, the section can be encrypted or decrypted via the `SectionInformation` property s `ProtectSection(provider)` and `UnprotectSection` methods.</span></span>

<span data-ttu-id="a5089-180">`ProtectSection(provider)`メソッドは暗号化に使用する保護された構成プロバイダーの名前を指定する文字列を入力として受け取ります。</span><span class="sxs-lookup"><span data-stu-id="a5089-180">The `ProtectSection(provider)` method accepts as input a string specifying the name of the protected configuration provider to use when encrypting.</span></span> <span data-ttu-id="a5089-181">`EncryptConnString`ボタン s のイベント ハンドラーに DataProtectionConfigurationProvider を渡して、`ProtectSection(provider)`メソッド DPAPI プロバイダーが使用されるようにします。</span><span class="sxs-lookup"><span data-stu-id="a5089-181">In the `EncryptConnString` Button s event handler we pass DataProtectionConfigurationProvider into the `ProtectSection(provider)` method so that the DPAPI provider is used.</span></span> <span data-ttu-id="a5089-182">`UnprotectSection`メソッドはプロバイダー構成セクションの暗号化に使用されたために必要としないある入力パラメーターを確認できます。</span><span class="sxs-lookup"><span data-stu-id="a5089-182">The `UnprotectSection` method can determine the provider that was used to encrypt the configuration section and therefore does not require any input parameters.</span></span>

<span data-ttu-id="a5089-183">呼び出した後、`ProtectSection(provider)`または`UnprotectSection`メソッドを呼び出す必要があります、`Configuration`オブジェクト[`Save`メソッド](https://msdn.microsoft.com/library/system.configuration.configuration.save.aspx)変更を確定します。</span><span class="sxs-lookup"><span data-stu-id="a5089-183">After calling the `ProtectSection(provider)` or `UnprotectSection` method, you must call the `Configuration` object s [`Save` method](https://msdn.microsoft.com/library/system.configuration.configuration.save.aspx) to persist the changes.</span></span> <span data-ttu-id="a5089-184">呼び出して、変更を保存し、構成情報が暗号化または復号化された`DisplayWebConfig`を読み込む、更新された`Web.config`TextBox コントロールに内容。</span><span class="sxs-lookup"><span data-stu-id="a5089-184">Once the configuration information has been encrypted or decrypted and the changes saved, we call `DisplayWebConfig` to load the updated `Web.config` contents into the TextBox control.</span></span>

<span data-ttu-id="a5089-185">上記のコードを入力するとテストを参照してください、`EncryptingConfigSections.aspx`ページがブラウザーを使用します。</span><span class="sxs-lookup"><span data-stu-id="a5089-185">Once you have entered the above code, test it by visiting the `EncryptingConfigSections.aspx` page through a browser.</span></span> <span data-ttu-id="a5089-186">内容を一覧表示されたページを表示する必要があります最初に`Web.config`で、`<connectionStrings>`セクションがプレーン テキストで表示されます (図 3 を参照してください)。</span><span class="sxs-lookup"><span data-stu-id="a5089-186">You should initially see a page that lists the contents of `Web.config` with the `<connectionStrings>` section displayed in plain-text (see Figure 3).</span></span>


<span data-ttu-id="a5089-187">[![テキスト ボックスと 2 つのボタンの Web コントロールをページに追加します。](protecting-connection-strings-and-other-configuration-information-cs/_static/image8.png)](protecting-connection-strings-and-other-configuration-information-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="a5089-187">[![Add a TextBox and Two Button Web Controls to the Page](protecting-connection-strings-and-other-configuration-information-cs/_static/image8.png)](protecting-connection-strings-and-other-configuration-information-cs/_static/image7.png)</span></span>

<span data-ttu-id="a5089-188">**図 3**: テキスト ボックスと 2 つのボタンの Web コントロールをページに追加 ([フルサイズの画像を表示する をクリックします](protecting-connection-strings-and-other-configuration-information-cs/_static/image9.png))。</span><span class="sxs-lookup"><span data-stu-id="a5089-188">**Figure 3**: Add a TextBox and Two Button Web Controls to the Page ([Click to view full-size image](protecting-connection-strings-and-other-configuration-information-cs/_static/image9.png))</span></span>


<span data-ttu-id="a5089-189">接続文字列の暗号化 ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="a5089-189">Now click the Encrypt Connection Strings button.</span></span> <span data-ttu-id="a5089-190">返されたマークアップが投稿された要求の検証が有効になっている場合、 `WebConfigContents` TextBox が生成されます、 `HttpRequestValidationException`、可能性のある危険なメッセージを表示する`Request.Form`クライアントからの値が検出されました。</span><span class="sxs-lookup"><span data-stu-id="a5089-190">If request validation is enabled, the markup posted back from the `WebConfigContents` TextBox will produce an `HttpRequestValidationException`, which displays the message, A potentially dangerous `Request.Form` value was detected from the client.</span></span> <span data-ttu-id="a5089-191">要求の検証は、ASP.NET 2.0 では既定で有効に、エンコードされていない HTML を含むポストバックとは、スクリプト インジェクション攻撃を防ぐために設計されています。</span><span class="sxs-lookup"><span data-stu-id="a5089-191">Request validation, which is enabled by default in ASP.NET 2.0, prohibits postbacks that include un-encoded HTML and is designed to help prevent script-injection attacks.</span></span> <span data-ttu-id="a5089-192">このチェックは、ページ、またはアプリケーション レベルでを無効にすることができます。</span><span class="sxs-lookup"><span data-stu-id="a5089-192">This check can be disabled at the page- or application-level.</span></span> <span data-ttu-id="a5089-193">このページを無効に、設定、`ValidateRequest`設定`false`で、`@Page`ディレクティブ。</span><span class="sxs-lookup"><span data-stu-id="a5089-193">To turn it off for this page, set the `ValidateRequest` setting to `false` in the `@Page` directive.</span></span> <span data-ttu-id="a5089-194">`@Page`ディレクティブがページの宣言型マークアップの上部にあるが見つかりました。</span><span class="sxs-lookup"><span data-stu-id="a5089-194">The `@Page` directive is found at the top of the page s declarative markup.</span></span>


[!code-aspx[Main](protecting-connection-strings-and-other-configuration-information-cs/samples/sample3.aspx)]

<span data-ttu-id="a5089-195">要求の検証は、目的の詳細については方法で、ページ レベルとアプリケーション レベル、方法についても HTML マークアップをエンコードと無効にするを参照してください[要求の検証 - スクリプト攻撃の防止](../../../../whitepapers/request-validation.md)します。</span><span class="sxs-lookup"><span data-stu-id="a5089-195">For more information on request validation, its purpose, how to disable it at the page- and application-level, as well as how to HTML encode markup, see [Request Validation - Preventing Script Attacks](../../../../whitepapers/request-validation.md).</span></span>

<span data-ttu-id="a5089-196">ページの要求の検証を無効にした後、接続文字列の暗号化 ボタンをクリックすると、もう一度お試しください。</span><span class="sxs-lookup"><span data-stu-id="a5089-196">After disabling request validation for the page, try clicking the Encrypt Connection Strings button again.</span></span> <span data-ttu-id="a5089-197">構成ファイルのアクセス、ポストバックのおよびその`<connectionStrings>`セクション DPAPI プロバイダーを使用して暗号化します。</span><span class="sxs-lookup"><span data-stu-id="a5089-197">On postback, the configuration file will be accessed and its `<connectionStrings>` section encrypted using the DPAPI provider.</span></span> <span data-ttu-id="a5089-198">テキスト ボックスが、新しい表示を更新し`Web.config`コンテンツ。</span><span class="sxs-lookup"><span data-stu-id="a5089-198">The TextBox is then updated to display the new `Web.config` content.</span></span> <span data-ttu-id="a5089-199">図 4 に示すよう、`<connectionStrings>`情報が暗号化されています。</span><span class="sxs-lookup"><span data-stu-id="a5089-199">As Figure 4 shows, the `<connectionStrings>` information is now encrypted.</span></span>


<span data-ttu-id="a5089-200">[![クリックすると、暗号化接続文字列 ボタンは暗号化、 &lt;connectionString&gt;セクション](protecting-connection-strings-and-other-configuration-information-cs/_static/image11.png)](protecting-connection-strings-and-other-configuration-information-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="a5089-200">[![Clicking the Encrypt Connection Strings Button Encrypts the &lt;connectionString&gt; Section](protecting-connection-strings-and-other-configuration-information-cs/_static/image11.png)](protecting-connection-strings-and-other-configuration-information-cs/_static/image10.png)</span></span>

<span data-ttu-id="a5089-201">**図 4**: クリックすると、暗号化接続文字列 ボタンは暗号化、`<connectionString>`セクション ([フルサイズの画像を表示する をクリックします](protecting-connection-strings-and-other-configuration-information-cs/_static/image12.png))。</span><span class="sxs-lookup"><span data-stu-id="a5089-201">**Figure 4**: Clicking the Encrypt Connection Strings Button Encrypts the `<connectionString>` Section ([Click to view full-size image](protecting-connection-strings-and-other-configuration-information-cs/_static/image12.png))</span></span>


<span data-ttu-id="a5089-202">暗号化された`<connectionStrings>`でコンテンツの一部ですが、自分のコンピューターで生成されたセクションの次に、`<CipherData>`簡潔にするための要素が削除されました。</span><span class="sxs-lookup"><span data-stu-id="a5089-202">The encrypted `<connectionStrings>` section generated on my computer follows, although some of the content in the `<CipherData>` element has been removed for brevity:</span></span>


[!code-xml[Main](protecting-connection-strings-and-other-configuration-information-cs/samples/sample4.xml)]

> [!NOTE]
> <span data-ttu-id="a5089-203">`<connectionStrings>`要素の暗号化を実行するために使用するプロバイダーを指定します (`DataProtectionConfigurationProvider`)。</span><span class="sxs-lookup"><span data-stu-id="a5089-203">The `<connectionStrings>` element specifies the provider used to perform the encryption (`DataProtectionConfigurationProvider`).</span></span> <span data-ttu-id="a5089-204">この情報によって使用されます、`UnprotectSection`メソッド、接続文字列の暗号化を解除 ボタンがクリックされたとき。</span><span class="sxs-lookup"><span data-stu-id="a5089-204">This information is used by the `UnprotectSection` method when the Decrypt Connection Strings button is clicked.</span></span>


<span data-ttu-id="a5089-205">接続文字列の情報にアクセスするときに`Web.config`- かによって、コードの記述、SqlDataSource コントロールから、または、型指定されたデータセットを Tableadapter から自動生成されたコード - は、自動的に暗号化解除します。</span><span class="sxs-lookup"><span data-stu-id="a5089-205">When the connection string information is accessed from `Web.config` - either by code we write, from a SqlDataSource control, or the auto-generated code from the TableAdapters in our Typed DataSets - it is automatically decrypted.</span></span> <span data-ttu-id="a5089-206">つまり余分なコードまたは暗号化、復号化するためのロジックを追加する必要はありません`<connectionString>`セクション。</span><span class="sxs-lookup"><span data-stu-id="a5089-206">In short, we do not need to add any extra code or logic to decrypt the encrypted `<connectionString>` section.</span></span> <span data-ttu-id="a5089-207">これを示すために、基本レポートのセクションから単純な表示チュートリアルなど、この時点でアクセス前のチュートリアルのいずれか (`~/BasicReporting/SimpleDisplay.aspx`)。</span><span class="sxs-lookup"><span data-stu-id="a5089-207">To demonstrate this, visit one of the earlier tutorials at this time, such as the Simple Display tutorial from the Basic Reporting section (`~/BasicReporting/SimpleDisplay.aspx`).</span></span> <span data-ttu-id="a5089-208">図 5 に示すよう、チュートリアルはとってい、ASP.NET ページで、暗号化された接続文字列情報の自動的に暗号化解除することを示すとおりに動作します。</span><span class="sxs-lookup"><span data-stu-id="a5089-208">As Figure 5 shows, the tutorial works exactly as we would expect it, indicating that the encrypted connection string information is being automatically decrypted by the ASP.NET page.</span></span>


<span data-ttu-id="a5089-209">[![データ アクセス層には、接続文字列情報を自動的に復号化します](protecting-connection-strings-and-other-configuration-information-cs/_static/image14.png)](protecting-connection-strings-and-other-configuration-information-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="a5089-209">[![The Data Access Layer Automatically Decrypts the Connection String Information](protecting-connection-strings-and-other-configuration-information-cs/_static/image14.png)](protecting-connection-strings-and-other-configuration-information-cs/_static/image13.png)</span></span>

<span data-ttu-id="a5089-210">**図 5**: データ アクセス層には、接続文字列情報を自動的に復号化します ([フルサイズの画像を表示する をクリックします](protecting-connection-strings-and-other-configuration-information-cs/_static/image15.png))。</span><span class="sxs-lookup"><span data-stu-id="a5089-210">**Figure 5**: The Data Access Layer Automatically Decrypts the Connection String Information ([Click to view full-size image](protecting-connection-strings-and-other-configuration-information-cs/_static/image15.png))</span></span>


<span data-ttu-id="a5089-211">元に戻す、`<connectionStrings>`戻るをプレーン テキスト形式のセクションで、接続文字列の暗号化を解除 ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="a5089-211">To revert the `<connectionStrings>` section back to its plain-text representation, click the Decrypt Connection Strings button.</span></span> <span data-ttu-id="a5089-212">ポストバックの内の接続文字列を表示する必要があります`Web.config`プレーン テキストでします。</span><span class="sxs-lookup"><span data-stu-id="a5089-212">On postback you should see the connection strings in `Web.config` in plain-text.</span></span> <span data-ttu-id="a5089-213">この時点で、画面に最初にこのページ (図 3 参照) にアクセスしたときと同じようになります。</span><span class="sxs-lookup"><span data-stu-id="a5089-213">At this point your screen should look like it did when first visiting this page (see in Figure 3).</span></span>

## <a name="step-3-encrypting-configuration-sections-usingaspnetregiisexe"></a><span data-ttu-id="a5089-214">手順 3: を使用して構成セクションを暗号化します。`aspnet_regiis.exe`</span><span class="sxs-lookup"><span data-stu-id="a5089-214">Step 3: Encrypting Configuration Sections Using`aspnet_regiis.exe`</span></span>

<span data-ttu-id="a5089-215">.NET Framework には、さまざまなコマンド ライン ツールが含まれています、`$WINDOWS$\Microsoft.NET\Framework\version\`フォルダー。</span><span class="sxs-lookup"><span data-stu-id="a5089-215">The .NET Framework includes a variety of command line tools in the `$WINDOWS$\Microsoft.NET\Framework\version\` folder.</span></span> <span data-ttu-id="a5089-216">[を使用して SQL キャッシュ依存関係](../caching-data/using-sql-cache-dependencies-cs.md)チュートリアルでは、たとえば、ところを使用して、 `aspnet_regsql.exe` SQL キャッシュ依存関係のために必要なインフラストラクチャを追加するコマンド ライン ツール。</span><span class="sxs-lookup"><span data-stu-id="a5089-216">In the [Using SQL Cache Dependencies](../caching-data/using-sql-cache-dependencies-cs.md) tutorial, for instance, we looked at using the `aspnet_regsql.exe` command line tool to add the infrastructure necessary for SQL cache dependencies.</span></span> <span data-ttu-id="a5089-217">このフォルダー内の別の便利なコマンド ライン ツールは、 [ASP.NET IIS 登録ツール (`aspnet_regiis.exe`)](https://msdn.microsoft.com/library/k6h9cz8h(VS.80).aspx)します。</span><span class="sxs-lookup"><span data-stu-id="a5089-217">Another useful command line tool in this folder is the [ASP.NET IIS Registration tool (`aspnet_regiis.exe`)](https://msdn.microsoft.com/library/k6h9cz8h(VS.80).aspx).</span></span> <span data-ttu-id="a5089-218">その名前が示すように、ASP.NET IIS 登録ツールは Microsoft の専門性の高い Web サーバー、IIS と ASP.NET 2.0 アプリケーションを登録する主に使用します。</span><span class="sxs-lookup"><span data-stu-id="a5089-218">As its name implies, the ASP.NET IIS Registration tool is primarily used to register an ASP.NET 2.0 application with Microsoft s professional-grade Web server, IIS.</span></span> <span data-ttu-id="a5089-219">IIS に関連する機能だけでなく、ASP.NET IIS 登録ツールこともできますを暗号化またはで指定した構成セクションを復号化する`Web.config`します。</span><span class="sxs-lookup"><span data-stu-id="a5089-219">In addition to its IIS-related features, the ASP.NET IIS Registration tool can also be used to encrypt or decrypt specified configuration sections in `Web.config`.</span></span>

<span data-ttu-id="a5089-220">次のステートメントで構成セクションを暗号化するために使用する一般的な構文を示しています、`aspnet_regiis.exe`コマンド ライン ツール。</span><span class="sxs-lookup"><span data-stu-id="a5089-220">The following statement shows the general syntax used to encrypt a configuration section with the `aspnet_regiis.exe` command line tool:</span></span>


[!code-console[Main](protecting-connection-strings-and-other-configuration-information-cs/samples/sample5.cmd)]

<span data-ttu-id="a5089-221">*セクション*構成セクション (connectionStrings) などの暗号化には、*物理\_ディレクトリ*、web アプリケーションのルート ディレクトリへの完全な物理パスと*プロバイダー* (DataProtectionConfigurationProvider) などを使用する保護された構成プロバイダーの名前を指定します。</span><span class="sxs-lookup"><span data-stu-id="a5089-221">*section* is the configuration section to encrypt (like connectionStrings ), the *physical\_directory* is the full, physical path to the web application s root directory, and *provider* is the name of the protected configuration provider to use (such as DataProtectionConfigurationProvider ).</span></span> <span data-ttu-id="a5089-222">または、web アプリケーションが IIS に登録されている場合は、次の構文を使用して物理パスではなく仮想パスを入力できます。</span><span class="sxs-lookup"><span data-stu-id="a5089-222">Alternatively, if the web application is registered in IIS you can enter the virtual path instead of the physical path using the following syntax:</span></span>


[!code-console[Main](protecting-connection-strings-and-other-configuration-information-cs/samples/sample6.cmd)]

<span data-ttu-id="a5089-223">次`aspnet_regiis.exe`例暗号化、`<connectionStrings>`マシン レベル キーで DPAPI プロバイダーを使用してセクションします。</span><span class="sxs-lookup"><span data-stu-id="a5089-223">The following `aspnet_regiis.exe` example encrypts the `<connectionStrings>` section using the DPAPI provider with a machine-level key:</span></span>


[!code-console[Main](protecting-connection-strings-and-other-configuration-information-cs/samples/sample7.cmd)]

<span data-ttu-id="a5089-224">同様に、`aspnet_regiis.exe`構成セクションを復号化するコマンド ライン ツールを使用できます。</span><span class="sxs-lookup"><span data-stu-id="a5089-224">Similarly, the `aspnet_regiis.exe` command line tool can be used to decrypt configuration sections.</span></span> <span data-ttu-id="a5089-225">使用する代わりに、`-pef`スイッチを使用して`-pdf`(またはその代わりに`-pe`を使用して、 `-pd`)。</span><span class="sxs-lookup"><span data-stu-id="a5089-225">Instead of using the `-pef` switch, use `-pdf` (or instead of `-pe`, use `-pd`).</span></span> <span data-ttu-id="a5089-226">また、復号化するときに、プロバイダー名は必要ないことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="a5089-226">Also, note that the provider name is not necessary when decrypting.</span></span>


[!code-console[Main](protecting-connection-strings-and-other-configuration-information-cs/samples/sample8.cmd)]

> [!NOTE]
> <span data-ttu-id="a5089-227">実行する必要がありますコンピューターに固有のキーを使用して DPAPI プロバイダーを使用しているため`aspnet_regiis.exe`元となる web ページの処理が同じコンピューターから。</span><span class="sxs-lookup"><span data-stu-id="a5089-227">Since we are using the DPAPI provider, which uses keys specific to the computer, you must run `aspnet_regiis.exe` from the same machine from which the web pages are being served.</span></span> <span data-ttu-id="a5089-228">たとえば、実稼働サーバーに暗号化された Web.config ファイルをアップロードして、ローカル開発用コンピューターからこのコマンド ライン プログラムを実行する場合、実稼働サーバーできなくが暗号化の後に、接続文字列情報を復号化するには開発用コンピューターに固有のキーを使用します。</span><span class="sxs-lookup"><span data-stu-id="a5089-228">For example, if you run this command line program from your local development machine and then upload the encrypted Web.config file to the production server, the production server will not be able to decrypt the connection string information since it was encrypted using keys specific to your development machine.</span></span> <span data-ttu-id="a5089-229">RSA プロバイダーは別のコンピューターに RSA キーをエクスポートすることは、この制限がありません。</span><span class="sxs-lookup"><span data-stu-id="a5089-229">The RSA provider does not have this limitation as it is possible to export the RSA keys to another machine.</span></span>


## <a name="understanding-database-authentication-options"></a><span data-ttu-id="a5089-230">データベース認証オプションの理解</span><span class="sxs-lookup"><span data-stu-id="a5089-230">Understanding Database Authentication Options</span></span>

<span data-ttu-id="a5089-231">任意のアプリケーションを発行する前に`SELECT`、 `INSERT`、 `UPDATE`、または`DELETE`Microsoft SQL Server データベースに対するクエリは最初に、要求元を識別する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a5089-231">Before any application can issue `SELECT`, `INSERT`, `UPDATE`, or `DELETE` queries to a Microsoft SQL Server database, the database first must identify the requestor.</span></span> <span data-ttu-id="a5089-232">このプロセスと呼ばれる*認証*し SQL Server 認証の 2 つのメソッドを提供します。</span><span class="sxs-lookup"><span data-stu-id="a5089-232">This process is known as *authentication* and SQL Server provides two methods of authentication:</span></span>

- <span data-ttu-id="a5089-233">**Windows 認証**-アプリケーションが実行されているプロセスは、データベースとの通信に使用します。</span><span class="sxs-lookup"><span data-stu-id="a5089-233">**Windows Authentication** - the process under which the application is running is used to communicate with the database.</span></span> <span data-ttu-id="a5089-234">Visual Studio 2005 の ASP.NET 開発サーバーを使用して ASP.NET アプリケーションを実行するときに、ASP.NET アプリケーションは、現在ログオンしているユーザーの id を想定しています。</span><span class="sxs-lookup"><span data-stu-id="a5089-234">When running an ASP.NET application through Visual Studio 2005 s ASP.NET Development Server, the ASP.NET application assumes the identity of the currently logged on user.</span></span> <span data-ttu-id="a5089-235">ASP.NET アプリケーションで Microsoft インターネット インフォメーション サーバー (IIS) で ASP.NET アプリケーションは、通常のある id`domainName``\MachineName`または`domainName``\NETWORK SERVICE`、これをカスタマイズできます。</span><span class="sxs-lookup"><span data-stu-id="a5089-235">For ASP.NET applications on Microsoft Internet Information Server (IIS), ASP.NET applications usually assume the identity of `domainName``\MachineName` or `domainName``\NETWORK SERVICE`, although this can be customized.</span></span>
- <span data-ttu-id="a5089-236">**SQL 認証**-ユーザーの ID とパスワードの値は、認証の資格情報として指定されます。</span><span class="sxs-lookup"><span data-stu-id="a5089-236">**SQL Authentication** - a user ID and password values are supplied as credentials for authentication.</span></span> <span data-ttu-id="a5089-237">SQL 認証では、ユーザー ID とパスワードは、接続文字列で提供されます。</span><span class="sxs-lookup"><span data-stu-id="a5089-237">With SQL authentication, the user ID and password are provided in the connection string.</span></span>

<span data-ttu-id="a5089-238">Windows 認証はより安全なであるために、SQL 認証をお勧めします。</span><span class="sxs-lookup"><span data-stu-id="a5089-238">Windows authentication is preferred over SQL authentication because it is more secure.</span></span> <span data-ttu-id="a5089-239">Windows 認証を使用した接続文字列は、ユーザー名とパスワードから解放して、web サーバーとデータベース サーバー 2 台のコンピューターに存在する場合、資格情報は、プレーン テキストでネットワーク経由では送信されません。</span><span class="sxs-lookup"><span data-stu-id="a5089-239">With Windows authentication the connection string is free from a username and password and if the web server and database server reside on two different machines, the credentials are not sent over the network in plain-text.</span></span> <span data-ttu-id="a5089-240">SQL 認証では、ただし、認証資格情報は、接続文字列でハードコーディングされて、プレーン テキストで、データベース サーバーに web サーバーから送信されます。</span><span class="sxs-lookup"><span data-stu-id="a5089-240">With SQL authentication, however, the authentication credentials are hard-coded in the connection string and are transmitted from the web server to the database server in plain-text.</span></span>

<span data-ttu-id="a5089-241">これらのチュートリアルでは、Windows 認証を使用しています。</span><span class="sxs-lookup"><span data-stu-id="a5089-241">These tutorials have used Windows authentication.</span></span> <span data-ttu-id="a5089-242">認証モードは、接続文字列の検査で使用されていることがわかります。</span><span class="sxs-lookup"><span data-stu-id="a5089-242">You can tell what authentication mode is being used by inspecting the connection string.</span></span> <span data-ttu-id="a5089-243">内の接続文字列`Web.config`チュートリアル務めています。</span><span class="sxs-lookup"><span data-stu-id="a5089-243">The connection string in `Web.config` for our tutorials has been:</span></span>

`Data Source=.\SQLEXPRESS; AttachDbFilename=|DataDirectory|\NORTHWND.MDF; Integrated Security=True; User Instance=True`

<span data-ttu-id="a5089-244">Integrated Security = True とユーザー名とパスワードの欠如は、Windows 認証が使用されていることを示します。</span><span class="sxs-lookup"><span data-stu-id="a5089-244">The Integrated Security=True and lack of a username and password indicate that Windows authentication is being used.</span></span> <span data-ttu-id="a5089-245">用語の信頼された接続文字列をいくつかの接続で = [はい] または統合セキュリティ = SSPI が統合セキュリティの代わりに使用される = true の場合、3 つすべての Windows 認証の使用が。</span><span class="sxs-lookup"><span data-stu-id="a5089-245">In some connection strings the term Trusted Connection=Yes or Integrated Security=SSPI is used instead of Integrated Security=True, but all three indicate the use of Windows authentication.</span></span>

<span data-ttu-id="a5089-246">次の例では、SQL 認証を使用する接続文字列を示します。</span><span class="sxs-lookup"><span data-stu-id="a5089-246">The following example shows a connection string that uses SQL authentication.</span></span> <span data-ttu-id="a5089-247">接続文字列内に埋め込まれた資格情報に注意してください。</span><span class="sxs-lookup"><span data-stu-id="a5089-247">Note the credentials embedded within the connection string:</span></span>

`Server=serverName; Database=Northwind; uid=userID; pwd=password`

<span data-ttu-id="a5089-248">攻撃者が、アプリケーションの s を表示できることを想像してみてください`Web.config`ファイル。</span><span class="sxs-lookup"><span data-stu-id="a5089-248">Imagine that an attacker is able to view your application s `Web.config` file.</span></span> <span data-ttu-id="a5089-249">SQL 認証を使用して、インターネット経由でアクセス可能なデータベースに接続する場合、攻撃者は、SQL Management studio または独自の web サイトの ASP.NET ページから、データベースに接続するこの接続文字列を使用できます。</span><span class="sxs-lookup"><span data-stu-id="a5089-249">If you use SQL authentication to connect to a database that is accessible over the Internet, the attacker can use this connection string to connect to your database through SQL Management Studio or from ASP.NET pages on their own website.</span></span> <span data-ttu-id="a5089-250">この脅威を軽減するでの接続文字列情報を暗号化`Web.config`保護された構成システムを使用します。</span><span class="sxs-lookup"><span data-stu-id="a5089-250">To help mitigate this threat, encrypt the connection string information in `Web.config` using the protected configuration system.</span></span>

> [!NOTE]
> <span data-ttu-id="a5089-251">SQL Server で利用可能な認証のさまざまな種類の詳細については、次を参照してください。 [Building Secure ASP.NET Applications: 認証、承認、およびセキュリティ保護された通信](https://msdn.microsoft.com/library/aa302392.aspx)します。</span><span class="sxs-lookup"><span data-stu-id="a5089-251">For more information on the different types of authentication available in SQL Server, see [Building Secure ASP.NET Applications: Authentication, Authorization, and Secure Communication](https://msdn.microsoft.com/library/aa302392.aspx).</span></span> <span data-ttu-id="a5089-252">さらに接続文字列例については、Windows と SQL 認証の構文の違いを示すを参照してください[ConnectionStrings.com](http://www.connectionstrings.com/)します。</span><span class="sxs-lookup"><span data-stu-id="a5089-252">For further connection string examples illustrating the differences between Windows and SQL authentication syntax, refer to [ConnectionStrings.com](http://www.connectionstrings.com/).</span></span>


## <a name="summary"></a><span data-ttu-id="a5089-253">まとめ</span><span class="sxs-lookup"><span data-stu-id="a5089-253">Summary</span></span>

<span data-ttu-id="a5089-254">既定では、ファイルを`.config`ASP.NET アプリケーションの拡張機能は、ブラウザーからアクセスできません。</span><span class="sxs-lookup"><span data-stu-id="a5089-254">By default, files with a `.config` extension in an ASP.NET application cannot be accessed through a browser.</span></span> <span data-ttu-id="a5089-255">データベース接続文字列、ユーザー名やパスワードなどの機密情報が含まれてし、可能性がありますがあるために、この種のファイルは返されません。</span><span class="sxs-lookup"><span data-stu-id="a5089-255">These types of files are not returned because they may contain sensitive information, such as database connection strings, usernames and passwords, and so on.</span></span> <span data-ttu-id="a5089-256">.NET 2.0 で保護された構成システムは、さらに指定した構成セクションを暗号化するようにすることで機密情報を保護します。</span><span class="sxs-lookup"><span data-stu-id="a5089-256">The protected configuration system in .NET 2.0 helps further protect sensitive information by allowing specified configuration sections to be encrypted.</span></span> <span data-ttu-id="a5089-257">2 つの組み込みの保護された構成プロバイダーがあります。 1 つは、RSA アルゴリズムと、Windows データ保護 API (DPAPI) を使用する 1 つを使用します。</span><span class="sxs-lookup"><span data-stu-id="a5089-257">There are two built-in protected configuration providers: one that uses the RSA algorithm and one that uses the Windows Data Protection API (DPAPI).</span></span>

<span data-ttu-id="a5089-258">このチュートリアルでは、暗号化し、DPAPI プロバイダーを使用して構成設定の暗号化を解除する方法について説明しました。</span><span class="sxs-lookup"><span data-stu-id="a5089-258">In this tutorial we looked at how to encrypt and decrypt configuration settings using the DPAPI provider.</span></span> <span data-ttu-id="a5089-259">これには、手順 2. で説明したように、プログラムによって、およびによって、`aspnet_regiis.exe`コマンド ライン ツールは、手順 3 で説明されています。</span><span class="sxs-lookup"><span data-stu-id="a5089-259">This can be accomplished both programmatically, as we saw in Step 2, as well as through the `aspnet_regiis.exe` command line tool, which was covered in Step 3.</span></span> <span data-ttu-id="a5089-260">ユーザー レベルのキーを使用してまたは RSA プロバイダーの代わりに使用する方法の詳細については、関連項目」セクション内のリソースを参照してください。</span><span class="sxs-lookup"><span data-stu-id="a5089-260">For more information on using user-level keys or using the RSA provider instead, see the resources in the Further Reading section.</span></span>

<span data-ttu-id="a5089-261">満足のプログラミングです。</span><span class="sxs-lookup"><span data-stu-id="a5089-261">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="a5089-262">関連項目</span><span class="sxs-lookup"><span data-stu-id="a5089-262">Further Reading</span></span>

<span data-ttu-id="a5089-263">このチュートリアルで説明したトピックの詳細については、次の情報を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a5089-263">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="a5089-264">セキュリティで保護された ASP.NET アプリケーションの構築: 認証、承認、およびセキュリティで保護された通信</span><span class="sxs-lookup"><span data-stu-id="a5089-264">Building Secure ASP.NET Application: Authentication, Authorization, and Secure Communication</span></span>](https://msdn.microsoft.com/library/aa302392.aspx)
- [<span data-ttu-id="a5089-265">ASP.NET 2.0 の構成情報の暗号化アプリケーション</span><span class="sxs-lookup"><span data-stu-id="a5089-265">Encrypting Configuration Information in ASP.NET 2.0 Applications</span></span>](http://aspnet.4guysfromrolla.com/articles/021506-1.aspx)
- [<span data-ttu-id="a5089-266">暗号化`Web.config`ASP.NET 2.0 内の値</span><span class="sxs-lookup"><span data-stu-id="a5089-266">Encrypting `Web.config` Values in ASP.NET 2.0</span></span>](https://weblogs.asp.net/scottgu/archive/2006/01/09/434893.aspx)
- [<span data-ttu-id="a5089-267">方法: ASP.NET 2.0 の構成セクションを暗号化する DPAPI を使用します。</span><span class="sxs-lookup"><span data-stu-id="a5089-267">How To: Encrypt Configuration Sections in ASP.NET 2.0 Using DPAPI</span></span>](https://msdn.microsoft.com/library/ms998280.aspx)
- [<span data-ttu-id="a5089-268">方法: ASP.NET 2.0 の構成セクションを暗号化する RSA を使用して</span><span class="sxs-lookup"><span data-stu-id="a5089-268">How To: Encrypt Configuration Sections in ASP.NET 2.0 Using RSA</span></span>](https://msdn.microsoft.com/library/ms998283.aspx)
- [<span data-ttu-id="a5089-269">.NET 2.0 の構成 API</span><span class="sxs-lookup"><span data-stu-id="a5089-269">The Configuration API in .NET 2.0</span></span>](http://www.odetocode.com/Articles/418.aspx)
- [<span data-ttu-id="a5089-270">Windows データ保護</span><span class="sxs-lookup"><span data-stu-id="a5089-270">Windows Data Protection</span></span>](https://msdn.microsoft.com/library/ms995355.aspx)

## <a name="about-the-author"></a><span data-ttu-id="a5089-271">執筆者紹介</span><span class="sxs-lookup"><span data-stu-id="a5089-271">About the Author</span></span>

<span data-ttu-id="a5089-272">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)、7 つ受け取りますブックおよびの創設者の著者[4GuysFromRolla.com](http://www.4guysfromrolla.com)、Microsoft Web テクノロジと 1998 年から携わっています。</span><span class="sxs-lookup"><span data-stu-id="a5089-272">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="a5089-273">Scott は、フリーのコンサルタント、トレーナー、およびライターとして動作します。</span><span class="sxs-lookup"><span data-stu-id="a5089-273">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="a5089-274">最新の著書は[ *Sams 教える自分で ASP.NET 2.0 24 時間以内に*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)します。</span><span class="sxs-lookup"><span data-stu-id="a5089-274">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="a5089-275">彼に到達できる[mitchell@4GuysFromRolla.comします。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="a5089-275">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="a5089-276">彼のブログにあるでまたは[ http://ScottOnWriting.NET](http://ScottOnWriting.NET)します。</span><span class="sxs-lookup"><span data-stu-id="a5089-276">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="a5089-277">特別なに感謝します。</span><span class="sxs-lookup"><span data-stu-id="a5089-277">Special Thanks To</span></span>

<span data-ttu-id="a5089-278">このチュートリアル シリーズは、多くの便利なレビュー担当者によってレビューされました。</span><span class="sxs-lookup"><span data-stu-id="a5089-278">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="a5089-279">このチュートリアルでは、潜在顧客レビュー担当者は、Teresa Murphy および Randy Schmidt でした。</span><span class="sxs-lookup"><span data-stu-id="a5089-279">Lead reviewers for this tutorial were Teresa Murphy and Randy Schmidt.</span></span> <span data-ttu-id="a5089-280">今後、MSDN の記事を確認したいですか。</span><span class="sxs-lookup"><span data-stu-id="a5089-280">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="a5089-281">場合は、筆者に[mitchell@4GuysFromRolla.comします。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="a5089-281">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="a5089-282">[前へ](configuring-the-data-access-layer-s-connection-and-command-level-settings-cs.md)
> [次へ](debugging-stored-procedures-cs.md)</span><span class="sxs-lookup"><span data-stu-id="a5089-282">[Previous](configuring-the-data-access-layer-s-connection-and-command-level-settings-cs.md)
[Next](debugging-stored-procedures-cs.md)</span></span>
