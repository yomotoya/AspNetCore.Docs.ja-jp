---
uid: web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/performing-batch-updates-vb
title: バッチ更新 (VB) を実行する |Microsoft Docs
author: rick-anderson
description: 完全に編集を作成する方法について説明します DataList ですべての項目が編集モードとで、[すべて更新] ボタンをクリックして保存できる値を持つ、.
ms.author: aspnetcontent
manager: wpickett
ms.date: 10/30/2006
ms.topic: article
ms.assetid: 8dac22a7-91de-4e3b-888f-a4c438b03851
ms.technology: dotnet-webforms
msc.legacyurl: /web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/performing-batch-updates-vb
msc.type: authoredcontent
ms.openlocfilehash: a877bcc5b26965d59065aa17959643b66a5c4484
ms.sourcegitcommit: 953ff9ea4369f154d6fd0239599279ddd3280009
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/03/2018
ms.locfileid: "37388496"
---
<a name="performing-batch-updates-vb"></a><span data-ttu-id="5c78a-103">バッチ更新 (VB) を実行します。</span><span class="sxs-lookup"><span data-stu-id="5c78a-103">Performing Batch Updates (VB)</span></span>
====================
<span data-ttu-id="5c78a-104">によって[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="5c78a-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="5c78a-105">[サンプル アプリをダウンロード](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_37_VB.exe)または[PDF のダウンロード](performing-batch-updates-vb/_static/datatutorial37vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="5c78a-105">[Download Sample App](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_37_VB.exe) or [Download PDF](performing-batch-updates-vb/_static/datatutorial37vb1.pdf)</span></span>

> <span data-ttu-id="5c78a-106">完全に編集を作成する方法について説明します DataList ですべての項目が編集モードと ページの すべて更新 ボタンをクリックして値を保存できます。</span><span class="sxs-lookup"><span data-stu-id="5c78a-106">Learn how to create a fully-editable DataList where all of its items are in edit mode and whose values can be saved by clicking an "Update All" button on the page.</span></span>


## <a name="introduction"></a><span data-ttu-id="5c78a-107">はじめに</span><span class="sxs-lookup"><span data-stu-id="5c78a-107">Introduction</span></span>

<span data-ttu-id="5c78a-108">[前のチュートリアル](an-overview-of-editing-and-deleting-data-in-the-datalist-vb.md)アイテム レベル DataList を作成する方法について確認しました。</span><span class="sxs-lookup"><span data-stu-id="5c78a-108">In the [preceding tutorial](an-overview-of-editing-and-deleting-data-in-the-datalist-vb.md) we examined how to create an item-level DataList.</span></span> <span data-ttu-id="5c78a-109">編集可能な標準の GridView、DataList 内の各項目に含まれるように編集ボタンで、クリックされると、項目の編集可能になります。</span><span class="sxs-lookup"><span data-stu-id="5c78a-109">Like the standard editable GridView, each item in the DataList included an Edit button that, when clicked, would make the item editable.</span></span> <span data-ttu-id="5c78a-110">この項目のレベルも随時更新のみがデータの編集の動作、中に特定のユース ケース シナリオには多くのレコードを編集するユーザーが必要です。</span><span class="sxs-lookup"><span data-stu-id="5c78a-110">While this item-level editing works well for data that is only updated occasionally, certain use case scenarios require the user to edit many records.</span></span> <span data-ttu-id="5c78a-111">ユーザーが数十個のレコードを編集する必要があるし、編集 をクリックして、自分の変更を行い、1 つの更新 をクリックしてしなければ、クリックしての量は、生産性を妨げられることができます。</span><span class="sxs-lookup"><span data-stu-id="5c78a-111">If a user needs to edit dozens of records and is forced to click Edit, make their changes, and click Update for each one, the amount of clicking can hamper her productivity.</span></span> <span data-ttu-id="5c78a-112">DataList で完全に編集を提供することですより適切なオプションでは、このような状況では、1 つの where*すべて*その項目の編集モードでページ上のすべての更新ボタンをクリックして値を編集できますが (図 1 参照)。</span><span class="sxs-lookup"><span data-stu-id="5c78a-112">In such situations, a better option is to provide a fully-editable DataList, one where *all* of its items are in edit mode and whose values can be edited by clicking an Update All button on the page (see Figure 1).</span></span>


<span data-ttu-id="5c78a-113">[![完全に編集可能な DataList 内の各項目を変更できます。](performing-batch-updates-vb/_static/image2.png)](performing-batch-updates-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="5c78a-113">[![Each Item in a Fully Editable DataList can be Modified](performing-batch-updates-vb/_static/image2.png)](performing-batch-updates-vb/_static/image1.png)</span></span>

<span data-ttu-id="5c78a-114">**図 1**: 完全に編集可能な DataList で各項目を変更できます ([フルサイズの画像を表示する をクリックします](performing-batch-updates-vb/_static/image3.png))。</span><span class="sxs-lookup"><span data-stu-id="5c78a-114">**Figure 1**: Each Item in a Fully Editable DataList can be Modified ([Click to view full-size image](performing-batch-updates-vb/_static/image3.png))</span></span>


<span data-ttu-id="5c78a-115">このチュートリアルでは完全に編集可能な DataList を使用して仕入先のアドレス情報を更新するユーザーを有効にする方法を説明します。</span><span class="sxs-lookup"><span data-stu-id="5c78a-115">In this tutorial we'll examine how to enable users to update suppliers address information using a fully editable DataList.</span></span>

## <a name="step-1-create-the-editable-user-interface-in-the-datalist-s-itemtemplate"></a><span data-ttu-id="5c78a-116">手順 1: DataList s itemtemplate の編集可能なユーザー インターフェイスを作成します。</span><span class="sxs-lookup"><span data-stu-id="5c78a-116">Step 1: Create the Editable User Interface in the DataList s ItemTemplate</span></span>

<span data-ttu-id="5c78a-117">前のチュートリアルで、標準的なアイテム レベルの編集可能な DataList を作成すること使用されている 2 つのテンプレート。</span><span class="sxs-lookup"><span data-stu-id="5c78a-117">In the preceding tutorial, where we creating a standard, item-level editable DataList, we used two templates:</span></span>

- <span data-ttu-id="5c78a-118">`ItemTemplate` 読み取り専用のユーザー インターフェイス (各製品の名前と価格を表示するためのラベルの Web コントロール) が含まれています。</span><span class="sxs-lookup"><span data-stu-id="5c78a-118">`ItemTemplate` contained the read-only user interface (the Label Web controls for displaying each product s name and price).</span></span>
- <span data-ttu-id="5c78a-119">`EditItemTemplate` 編集モードのユーザー インターフェイス (2 つの TextBox Web コントロール) が含まれています。</span><span class="sxs-lookup"><span data-stu-id="5c78a-119">`EditItemTemplate` contained the edit mode user interface (the two TextBox Web controls).</span></span>

<span data-ttu-id="5c78a-120">DataList s`EditItemIndex`プロパティではどのような`DataListItem`(ある場合) を使用して、表示、`EditItemTemplate`します。</span><span class="sxs-lookup"><span data-stu-id="5c78a-120">The DataList s `EditItemIndex` property dictates what `DataListItem` (if any) is rendered using the `EditItemTemplate`.</span></span> <span data-ttu-id="5c78a-121">具体的には、`DataListItem`が`ItemIndex`値に一致する DataList s`EditItemIndex`を使用してプロパティを表示、`EditItemTemplate`します。</span><span class="sxs-lookup"><span data-stu-id="5c78a-121">In particular, the `DataListItem` whose `ItemIndex` value matches the DataList s `EditItemIndex` property is rendered using the `EditItemTemplate`.</span></span> <span data-ttu-id="5c78a-122">このモデルでは、完全に編集可能な DataList を作成するときに、時間が間隔が 1 つだけの項目を編集できる場合に機能します。</span><span class="sxs-lookup"><span data-stu-id="5c78a-122">This model works well when only one item can be edited at a time, but falls apart when creating a fully-editable DataList.</span></span>

<span data-ttu-id="5c78a-123">DataList で完全に編集可能にする*すべて*の`DataListItem`編集可能なインターフェイスを使用して表示します。</span><span class="sxs-lookup"><span data-stu-id="5c78a-123">For a fully editable DataList, we want *all* of the `DataListItem` s to render using the editable interface.</span></span> <span data-ttu-id="5c78a-124">これを実現する最も簡単な方法で編集可能なインターフェイスの定義には、`ItemTemplate`します。</span><span class="sxs-lookup"><span data-stu-id="5c78a-124">The simplest way to accomplish this is to define the editable interface in the `ItemTemplate`.</span></span> <span data-ttu-id="5c78a-125">仕入先のアドレス情報を変更するため、編集可能なインターフェイスには、アドレス、市区町村、および国の値のテキストとし、テキスト ボックスと業者の名前が含まれています。</span><span class="sxs-lookup"><span data-stu-id="5c78a-125">For modifying the suppliers address information, the editable interface contains the supplier name as text and then TextBoxes for the address, city, and country values.</span></span>

<span data-ttu-id="5c78a-126">開いて開始、`BatchUpdate.aspx`ページで、DataList コントロールを追加し、設定、`ID`プロパティを`Suppliers`します。</span><span class="sxs-lookup"><span data-stu-id="5c78a-126">Start by opening the `BatchUpdate.aspx` page, add a DataList control, and set its `ID` property to `Suppliers`.</span></span> <span data-ttu-id="5c78a-127">という名前の新しい ObjectDataSource コントロールを追加することを選択、DataList s のスマート タグから`SuppliersDataSource`します。</span><span class="sxs-lookup"><span data-stu-id="5c78a-127">From the DataList s smart tag, opt to add a new ObjectDataSource control named `SuppliersDataSource`.</span></span>


<span data-ttu-id="5c78a-128">[![SuppliersDataSource という名前の新しい ObjectDataSource を作成します。](performing-batch-updates-vb/_static/image5.png)](performing-batch-updates-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="5c78a-128">[![Create a New ObjectDataSource Named SuppliersDataSource](performing-batch-updates-vb/_static/image5.png)](performing-batch-updates-vb/_static/image4.png)</span></span>

<span data-ttu-id="5c78a-129">**図 2**: 名前付き新しい ObjectDataSource 作成`SuppliersDataSource`([フルサイズの画像を表示する をクリックします](performing-batch-updates-vb/_static/image6.png))。</span><span class="sxs-lookup"><span data-stu-id="5c78a-129">**Figure 2**: Create a New ObjectDataSource Named `SuppliersDataSource` ([Click to view full-size image](performing-batch-updates-vb/_static/image6.png))</span></span>


<span data-ttu-id="5c78a-130">構成を使用してデータを取得する ObjectDataSource、`SuppliersBLL`クラスの`GetSuppliers()`メソッド (図 3 を参照してください)。</span><span class="sxs-lookup"><span data-stu-id="5c78a-130">Configure the ObjectDataSource to retrieve data using the `SuppliersBLL` class s `GetSuppliers()` method (see Figure 3).</span></span> <span data-ttu-id="5c78a-131">前のチュートリアルではなく、ObjectDataSource を仕入先情報の更新と同様、ビジネス ロジック層を直接操作を行います。 します。</span><span class="sxs-lookup"><span data-stu-id="5c78a-131">As with the preceding tutorial, rather than updating the supplier information through the ObjectDataSource, we'll work directly with the Business Logic Layer.</span></span> <span data-ttu-id="5c78a-132">そのため、更新プログラム] タブで [(なし) ドロップダウン リストを設定 (図 4 参照)。</span><span class="sxs-lookup"><span data-stu-id="5c78a-132">Therefore, set the drop-down list to (None) in the UPDATE tab (see Figure 4).</span></span>


<span data-ttu-id="5c78a-133">[![GetSuppliers() メソッドを使用して仕入先情報を取得します。](performing-batch-updates-vb/_static/image8.png)](performing-batch-updates-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="5c78a-133">[![Retrieve Supplier Information Using the GetSuppliers() Method](performing-batch-updates-vb/_static/image8.png)](performing-batch-updates-vb/_static/image7.png)</span></span>

<span data-ttu-id="5c78a-134">**図 3**: 取得仕入先情報を使用して、`GetSuppliers()`メソッド ([フルサイズの画像を表示する をクリックします](performing-batch-updates-vb/_static/image9.png))。</span><span class="sxs-lookup"><span data-stu-id="5c78a-134">**Figure 3**: Retrieve Supplier Information Using the `GetSuppliers()` Method ([Click to view full-size image](performing-batch-updates-vb/_static/image9.png))</span></span>


<span data-ttu-id="5c78a-135">[![更新プログラム タブで、ドロップダウン リストを (なし) を設定します。](performing-batch-updates-vb/_static/image11.png)](performing-batch-updates-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="5c78a-135">[![Set the Drop-Down List to (None) in the UPDATE Tab](performing-batch-updates-vb/_static/image11.png)](performing-batch-updates-vb/_static/image10.png)</span></span>

<span data-ttu-id="5c78a-136">**図 4**: (None) にドロップダウン リストを更新 タブで設定 ([フルサイズの画像を表示する をクリックします](performing-batch-updates-vb/_static/image12.png))。</span><span class="sxs-lookup"><span data-stu-id="5c78a-136">**Figure 4**: Set the Drop-Down List to (None) in the UPDATE Tab ([Click to view full-size image](performing-batch-updates-vb/_static/image12.png))</span></span>


<span data-ttu-id="5c78a-137">ウィザードを完了すると、Visual Studio を自動的に生成 DataList の`ItemTemplate`Label Web コントロール内のデータ ソースによって返される各データ フィールドの表示にします。</span><span class="sxs-lookup"><span data-stu-id="5c78a-137">After completing the wizard, Visual Studio automatically generates the DataList s `ItemTemplate` to display each data field returned by the data source in a Label Web control.</span></span> <span data-ttu-id="5c78a-138">代わりに、編集用のインターフェイスを提供するように、このテンプレートを変更する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5c78a-138">We need to modify this template so that it provides the editing interface instead.</span></span> <span data-ttu-id="5c78a-139">`ItemTemplate` DataList s のスマート タグからのテンプレートの編集オプションを使用して、デザイナー、または宣言型構文を通じて直接カスタマイズできます。</span><span class="sxs-lookup"><span data-stu-id="5c78a-139">The `ItemTemplate` can be customized through the Designer using the Edit Templates option from the DataList s smart tag or directly through the declarative syntax.</span></span>

<span data-ttu-id="5c78a-140">テキスト、として、サプライヤーの名前を表示しますが、仕入先の住所や市区町村、国の値のテキスト ボックスが含まれています編集インターフェイスを作成する時間がかかります。</span><span class="sxs-lookup"><span data-stu-id="5c78a-140">Take a moment to create an editing interface that displays the supplier s name as text, but includes TextBoxes for the supplier s address, city, and country values.</span></span> <span data-ttu-id="5c78a-141">これらの変更を加えたら、ページの宣言構文は次のようなになります。</span><span class="sxs-lookup"><span data-stu-id="5c78a-141">After making these changes, your page s declarative syntax should look similar to the following:</span></span>


[!code-aspx[Main](performing-batch-updates-vb/samples/sample1.aspx)]

> [!NOTE]
> <span data-ttu-id="5c78a-142">このチュートリアルとに、このチュートリアルでは、DataList にも、そのビュー ステートを有効になっている必要があります。</span><span class="sxs-lookup"><span data-stu-id="5c78a-142">As with the preceding tutorial, the DataList in this tutorial must have its view state enabled.</span></span>


<span data-ttu-id="5c78a-143">`ItemTemplate`は 2 つの新しい CSS クラスを使用して`SupplierPropertyLabel`と`SupplierPropertyValue`に追加されましたが、`Styles.css`クラスし、同じスタイル設定を使用するように構成、`ProductPropertyLabel`と`ProductPropertyValue`CSS クラス。</span><span class="sxs-lookup"><span data-stu-id="5c78a-143">In the `ItemTemplate` I m using two new CSS classes, `SupplierPropertyLabel` and `SupplierPropertyValue`, which have been added to the `Styles.css` class and configured to use the same style settings as the `ProductPropertyLabel` and `ProductPropertyValue` CSS classes.</span></span>


[!code-css[Main](performing-batch-updates-vb/samples/sample2.css)]

<span data-ttu-id="5c78a-144">これらの変更を行った後は、ブラウザーからこのページを参照してください。</span><span class="sxs-lookup"><span data-stu-id="5c78a-144">After making these changes, visit this page through a browser.</span></span> <span data-ttu-id="5c78a-145">図 5 に示すよう各 DataList 項目はテキストとして仕入先の名前を表示し、アドレス、市区町村、国を表示するテキスト ボックスを使用します。</span><span class="sxs-lookup"><span data-stu-id="5c78a-145">As Figure 5 shows, each DataList item displays the supplier name as text and uses TextBoxes to display the address, city, and country.</span></span>


<span data-ttu-id="5c78a-146">[![各仕入先、DataList では編集可能なです。](performing-batch-updates-vb/_static/image14.png)](performing-batch-updates-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="5c78a-146">[![Each Supplier in the DataList is Editable](performing-batch-updates-vb/_static/image14.png)](performing-batch-updates-vb/_static/image13.png)</span></span>

<span data-ttu-id="5c78a-147">**図 5**: DataList で各仕入先が編集可能な ([フルサイズの画像を表示する をクリックします](performing-batch-updates-vb/_static/image15.png))。</span><span class="sxs-lookup"><span data-stu-id="5c78a-147">**Figure 5**: Each Supplier in the DataList is Editable ([Click to view full-size image](performing-batch-updates-vb/_static/image15.png))</span></span>


## <a name="step-2-adding-an-update-all-button"></a><span data-ttu-id="5c78a-148">手順 2: すべてのボタンの更新プログラムの追加</span><span class="sxs-lookup"><span data-stu-id="5c78a-148">Step 2: Adding an Update All Button</span></span>

<span data-ttu-id="5c78a-149">図 5 には、各業者は、そのアドレス、市区町村、およびテキスト ボックスに表示される国のフィールドには、現在はありません更新ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="5c78a-149">While each supplier in Figure 5 has its address, city, and country fields displayed in a TextBox, there currently is no Update button available.</span></span> <span data-ttu-id="5c78a-150">項目ごとの Update ボタンではなくで完全に編集可能なデータリストが通常すべて更新ボタンを 1 つページで、クリックすると、更新*すべて*DataList 内のレコード。</span><span class="sxs-lookup"><span data-stu-id="5c78a-150">Rather than having an Update button per item, with fully editable DataLists there is typically a single Update All button on the page that, when clicked, updates *all* of the records in the DataList.</span></span> <span data-ttu-id="5c78a-151">このチュートリアルでは、s (ただし、いずれかのボタンをクリックすると、同じ効果がありますが)、-、ページの上部にあるいずれかと、下部にあるいずれかの 2 つのすべて更新ボタンを追加できます。</span><span class="sxs-lookup"><span data-stu-id="5c78a-151">For this tutorial, let s add two Update All buttons - one at the top of the page and one at the bottom (although clicking either button will have the same effect).</span></span>

<span data-ttu-id="5c78a-152">DataList とセットの上ボタン Web コントロールを追加することにより、その`ID`プロパティを`UpdateAll1`します。</span><span class="sxs-lookup"><span data-stu-id="5c78a-152">Start by adding a Button Web control above the DataList and set its `ID` property to `UpdateAll1`.</span></span> <span data-ttu-id="5c78a-153">次に、設定、DataList、下にある 2 つ目のボタンの Web コントロールを追加、`ID`に`UpdateAll2`します。</span><span class="sxs-lookup"><span data-stu-id="5c78a-153">Next, add the second Button Web control beneath the DataList, setting its `ID` to `UpdateAll2`.</span></span> <span data-ttu-id="5c78a-154">設定、`Text`すべて更新する 2 つのボタンのプロパティ。</span><span class="sxs-lookup"><span data-stu-id="5c78a-154">Set the `Text` properties for the two Buttons to Update All.</span></span> <span data-ttu-id="5c78a-155">最後に、2 つのボタン イベント ハンドラーを作成`Click`イベント。</span><span class="sxs-lookup"><span data-stu-id="5c78a-155">Lastly, create event handlers for both Buttons `Click` events.</span></span> <span data-ttu-id="5c78a-156">3 番目のメソッドにそのロジックをリファクタリングする let s の各イベント ハンドラーで更新ロジックを複製するのではなく`UpdateAllSupplierAddresses`、イベント ハンドラーをこの 3 つ目のメソッドを呼び出すだけです。</span><span class="sxs-lookup"><span data-stu-id="5c78a-156">Rather than duplicating the update logic in each of the event handlers, let s refactor that logic to a third method, `UpdateAllSupplierAddresses`, having the event handlers simply invoking this third method.</span></span>


[!code-vb[Main](performing-batch-updates-vb/samples/sample3.vb)]

<span data-ttu-id="5c78a-157">図 6 は、更新プログラムのすべてのボタンを追加した後に、ページを示します。</span><span class="sxs-lookup"><span data-stu-id="5c78a-157">Figure 6 shows the page after the Update All buttons have been added.</span></span>


<span data-ttu-id="5c78a-158">[![2 つの更新プログラムすべてのボタンがページに追加されました](performing-batch-updates-vb/_static/image17.png)](performing-batch-updates-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="5c78a-158">[![Two Update All Buttons have been Added to the Page](performing-batch-updates-vb/_static/image17.png)](performing-batch-updates-vb/_static/image16.png)</span></span>

<span data-ttu-id="5c78a-159">**図 6**: 2 つの更新プログラムすべてのボタンがページに追加されました ([フルサイズの画像を表示する をクリックします](performing-batch-updates-vb/_static/image18.png))。</span><span class="sxs-lookup"><span data-stu-id="5c78a-159">**Figure 6**: Two Update All Buttons have been Added to the Page ([Click to view full-size image](performing-batch-updates-vb/_static/image18.png))</span></span>


## <a name="step-3-updating-all-of-the-suppliers-address-information"></a><span data-ttu-id="5c78a-160">手順 3: すべての仕入先のアドレス情報を更新しています</span><span class="sxs-lookup"><span data-stu-id="5c78a-160">Step 3: Updating All of the Suppliers Address Information</span></span>

<span data-ttu-id="5c78a-161">すべての編集インターフェイスを表示する DataList s のアイテムと、すべての更新ボタンを追加するとすべてそのままは、バッチ更新を実行するコードを記述は。</span><span class="sxs-lookup"><span data-stu-id="5c78a-161">With all of the DataList s items displaying the editing interface and with the addition of the Update All buttons, all that remains is writing the code to perform the batch update.</span></span> <span data-ttu-id="5c78a-162">具体的には、DataList の項目と呼び出しをループする必要があります、`SuppliersBLL`クラスの`UpdateSupplierAddress`それぞれのメソッド。</span><span class="sxs-lookup"><span data-stu-id="5c78a-162">Specifically, we need to loop through the DataList s items and call the `SuppliersBLL` class s `UpdateSupplierAddress` method for each one.</span></span>

<span data-ttu-id="5c78a-163">コレクション`DataListItem`DataList s を介してアクセスできるよう、DataList、その構成をインスタンス化[`Items`プロパティ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.items.aspx)します。</span><span class="sxs-lookup"><span data-stu-id="5c78a-163">The collection of `DataListItem` instances that makeup the DataList can be accessed via the DataList s [`Items` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.items.aspx).</span></span> <span data-ttu-id="5c78a-164">参照を`DataListItem`、対応するを取得できます`SupplierID`から、`DataKeys`コレクションとプログラムでテキスト ボックスに Web コントロールの内の参照、`ItemTemplate`次のコードに示すように。</span><span class="sxs-lookup"><span data-stu-id="5c78a-164">With a reference to a `DataListItem`, we can grab the corresponding `SupplierID` from the `DataKeys` collection and programmatically reference the TextBox Web controls within the `ItemTemplate` as the following code illustrates:</span></span>


[!code-vb[Main](performing-batch-updates-vb/samples/sample4.vb)]

<span data-ttu-id="5c78a-165">いずれかの更新プログラムのすべてのボタンをクリックすると、`UpdateAllSupplierAddresses`メソッドは、それぞれを反復処理`DataListItem`で、 `Suppliers` DataList、および呼び出し、`SuppliersBLL`クラスの`UpdateSupplierAddress`メソッドは、対応する値を渡します。</span><span class="sxs-lookup"><span data-stu-id="5c78a-165">When the user clicks one of the Update All buttons, the `UpdateAllSupplierAddresses` method iterates through each `DataListItem` in the `Suppliers` DataList and calls the `SuppliersBLL` class s `UpdateSupplierAddress` method, passing in the corresponding values.</span></span> <span data-ttu-id="5c78a-166">アドレス、市区町村、国のパスの入力以外の値は、の値`Nothing`に`UpdateSupplierAddress`(空白文字列の場合) ではなく、データベースになる`NULL`の基になるレコードのフィールド。</span><span class="sxs-lookup"><span data-stu-id="5c78a-166">A non-entered value for address, city, or country passes is a value of `Nothing` to `UpdateSupplierAddress` (rather than a blank string), which results in a database `NULL` for the underlying record s fields.</span></span>

> [!NOTE]
> <span data-ttu-id="5c78a-167">拡張機能としてバッチ更新が実行された後に、いくつかの確認メッセージを提供するページに状態ラベル Web コントロールを追加します。</span><span class="sxs-lookup"><span data-stu-id="5c78a-167">As an enhancement, you may want to add a status Label Web control to the page that provides some confirmation message after the batch update is performed.</span></span>


## <a name="updating-only-those-addresses-that-have-been-modified"></a><span data-ttu-id="5c78a-168">変更されたアドレスのみを更新しています</span><span class="sxs-lookup"><span data-stu-id="5c78a-168">Updating Only Those Addresses That Have Been Modified</span></span>

<span data-ttu-id="5c78a-169">このチュートリアルの呼び出しに使用されるバッチ更新アルゴリズム、`UpdateSupplierAddress`メソッド*すべて*自分の住所情報が変更されているかどうかに関係なく、DataList で業者にします。</span><span class="sxs-lookup"><span data-stu-id="5c78a-169">The batch update algorithm used for this tutorial calls the `UpdateSupplierAddress` method for *every* supplier in the DataList, regardless of whether their address information has been changed.</span></span> <span data-ttu-id="5c78a-170">このような blind 更新は t は、通常、パフォーマンスの問題、発生する可能性余分なレコード re 監査するが、データベース テーブルに変更された場合。</span><span class="sxs-lookup"><span data-stu-id="5c78a-170">While such blind updates aren t usually a performance issue, they can lead to superfluous records if you re auditing changes to the database table.</span></span> <span data-ttu-id="5c78a-171">たとえば、すべてを記録するトリガーを使用する`UPDATE`s、`Suppliers`監査テーブル、ユーザーは、ユーザーがいずれかを行われるかどうかに関係なく、システムで、各仕入先の新しい監査レコードを作成するがすべて更新 ボタンをクリックするたびに変更します。</span><span class="sxs-lookup"><span data-stu-id="5c78a-171">For example, if you use triggers to record all `UPDATE` s to the `Suppliers` table to an auditing table, every time a user clicks the Update All button a new audit record will be created for each supplier in the system, regardless of whether the user made any changes.</span></span>

<span data-ttu-id="5c78a-172">ADO.NET DataTable、DataAdapter クラスは、のみ、変更、削除、および新しいレコードがデータベース通信では、結果をバッチ更新をサポートするために設計されています。</span><span class="sxs-lookup"><span data-stu-id="5c78a-172">The ADO.NET DataTable and DataAdapter classes are designed to support batch updates where only modified, deleted, and new records results in any database communication.</span></span> <span data-ttu-id="5c78a-173">データ テーブルの各行が、 [ `RowState`プロパティ](https://msdn.microsoft.com/library/system.data.datarow.rowstate.aspx)行がから、変更、削除、DataTable に追加されたまたはままかどうかを示します。</span><span class="sxs-lookup"><span data-stu-id="5c78a-173">Each row in the DataTable has a [`RowState` property](https://msdn.microsoft.com/library/system.data.datarow.rowstate.aspx) that indicates whether the row has been added to the DataTable, deleted from it, modified, or remains unchanged.</span></span> <span data-ttu-id="5c78a-174">DataTable の内容が最初に表示されたら、すべての行が変更されていないマークされます。</span><span class="sxs-lookup"><span data-stu-id="5c78a-174">When a DataTable is initially populated, all rows are marked unchanged.</span></span> <span data-ttu-id="5c78a-175">任意の行の列の値を変更すると、変更済みとして、行がマークされます。</span><span class="sxs-lookup"><span data-stu-id="5c78a-175">Changing the value of any of the row s columns marks the row as modified.</span></span>

<span data-ttu-id="5c78a-176">`SuppliersBLL`クラスに 1 つの仕入先のレコードの最初の読み込み、指定した仕入先のアドレス情報を更新しました、`SuppliersDataTable`し、設定、 `Address`、 `City`、および`Country`次のコードを使用して列の値。</span><span class="sxs-lookup"><span data-stu-id="5c78a-176">In the `SuppliersBLL` class we update the specified supplier s address information by first reading in the single supplier record into a `SuppliersDataTable` and then set the `Address`, `City`, and `Country` column values using the following code:</span></span>


[!code-vb[Main](performing-batch-updates-vb/samples/sample5.vb)]

<span data-ttu-id="5c78a-177">このコードは、単純では、渡されたアドレス、市区町村、および国の値に割り当てます、`SuppliersRow`で、`SuppliersDataTable`値が変更されたかどうかに関係なく。</span><span class="sxs-lookup"><span data-stu-id="5c78a-177">This code naively assigns the passed-in address, city, and country values to the `SuppliersRow` in the `SuppliersDataTable` regardless of whether or not the values have changed.</span></span> <span data-ttu-id="5c78a-178">これらの変更により、 `SuppliersRow` s`RowState`プロパティを変更済みとしてマークされます。</span><span class="sxs-lookup"><span data-stu-id="5c78a-178">These modifications cause the `SuppliersRow` s `RowState` property to be marked as modified.</span></span> <span data-ttu-id="5c78a-179">ときにデータ アクセス層 s`Update`メソッドが呼び出されると、認識する、`SupplierRow`変更されており、したがって送信、`UPDATE`データベースにコマンド。</span><span class="sxs-lookup"><span data-stu-id="5c78a-179">When the Data Access Layer s `Update` method is called, it sees that the `SupplierRow` has been modified and therefore sends an `UPDATE` command to the database.</span></span>

<span data-ttu-id="5c78a-180">しかし、これらとは異なる場合のみ、渡されたアドレス、市区町村、および国の値を割り当てるには、このメソッドにコードを追加しました、 `SuppliersRow` s の既存の値。</span><span class="sxs-lookup"><span data-stu-id="5c78a-180">Imagine, however, that we added code to this method to only assign the passed-in address, city, and country values if they differ from the `SuppliersRow` s existing values.</span></span> <span data-ttu-id="5c78a-181">アドレス、市区町村、国が同じである既存のデータとしてのケースでは変更されない、 `SupplierRow` s`RowState`としてマークされている左を unchanged に指定します。</span><span class="sxs-lookup"><span data-stu-id="5c78a-181">In the case where the address, city, and country are the same as the existing data, no changes will be made and the `SupplierRow` s `RowState` will be left marked as unchanged.</span></span> <span data-ttu-id="5c78a-182">最終的な結果がいるときに DAL s`Update`メソッドが呼び出されると、データベースの呼び出しは行われませんので、`SuppliersRow`が変更されていません。</span><span class="sxs-lookup"><span data-stu-id="5c78a-182">The net result is that when the DAL s `Update` method is called, no database call will be made because the `SuppliersRow` has not been modified.</span></span>

<span data-ttu-id="5c78a-183">この変更を適用するには、渡されたアドレス、市区町村、国の値を次のコードを無条件に割り当てることがステートメントに置き換えます。</span><span class="sxs-lookup"><span data-stu-id="5c78a-183">To enact this change, replace the statements that blindly assign the passed-in address, city, and country values with the following code:</span></span>


[!code-vb[Main](performing-batch-updates-vb/samples/sample6.vb)]

<span data-ttu-id="5c78a-184">この追加コード、DAL s`Update`メソッド送信、`UPDATE`ステートメントはそのアドレスに関連する値が変更されたレコードだけをデータベースにします。</span><span class="sxs-lookup"><span data-stu-id="5c78a-184">With this added code, the DAL s `Update` method sends an `UPDATE` statement to the database for only those records whose address-related values have changed.</span></span>

<span data-ttu-id="5c78a-185">または、でしたの渡されたアドレス フィールドと、データベースのデータとの違いがあるかどうかを追跡し、なしを使用する必要がある場合は、DAL の呼び出しをバイパス単に`Update`メソッド。</span><span class="sxs-lookup"><span data-stu-id="5c78a-185">Alternatively, we could keep track of whether there are any differences between the passed-in address fields and the database data and, if there are none, simply bypass the call to the DAL s `Update` method.</span></span> <span data-ttu-id="5c78a-186">このアプローチは DB のダイレクト メソッドは t が渡されるため、メソッドを直接、DB を使用する場合にも、`SuppliersRow`インスタンスを`RowState`データベース呼び出しが実際に必要かどうかを判断するチェックすることができます。</span><span class="sxs-lookup"><span data-stu-id="5c78a-186">This approach works well if you re using the DB direct method, since the DB direct method isn t passed a `SuppliersRow` instance whose `RowState` can be checked to determine whether a database call is actually needed.</span></span>

> [!NOTE]
> <span data-ttu-id="5c78a-187">毎回、`UpdateSupplierAddress`メソッドが呼び出される、更新されたレコードに関する情報を取得、データベースへの呼び出しが確立します。</span><span class="sxs-lookup"><span data-stu-id="5c78a-187">Each time the `UpdateSupplierAddress` method is invoked, a call is made to the database to retrieve information about the updated record.</span></span> <span data-ttu-id="5c78a-188">次に、データに変更がある場合は、テーブルの行を更新するデータベースへの別の呼び出しが行われます。</span><span class="sxs-lookup"><span data-stu-id="5c78a-188">Then, if there are any changes in data, another call to the database is made to update the table row.</span></span> <span data-ttu-id="5c78a-189">作成して最適化されますが、このワークフロー、`UpdateSupplierAddress`を受け取るメソッド オーバー ロードを`EmployeesDataTable`を持つインスタンス*すべて*からの変更の`BatchUpdate.aspx`ページ。</span><span class="sxs-lookup"><span data-stu-id="5c78a-189">This workflow could be optimized by creating an `UpdateSupplierAddress` method overload that accepts an `EmployeesDataTable` instance that has *all* of the changes from the `BatchUpdate.aspx` page.</span></span> <span data-ttu-id="5c78a-190">データベースに 1 回の呼び出しは、すべてのレコードの取得を行う可能性がありますし、`Suppliers`テーブル。</span><span class="sxs-lookup"><span data-stu-id="5c78a-190">Then, it could make one call to the database to get all of the records from the `Suppliers` table.</span></span> <span data-ttu-id="5c78a-191">2 つの結果セットを列挙し、でき、変更が発生したレコードのみを更新できませんできます。</span><span class="sxs-lookup"><span data-stu-id="5c78a-191">The two resultsets could then be enumerated and only those records where changes have occurred could be updated.</span></span>


## <a name="summary"></a><span data-ttu-id="5c78a-192">まとめ</span><span class="sxs-lookup"><span data-stu-id="5c78a-192">Summary</span></span>

<span data-ttu-id="5c78a-193">このチュートリアルでは、完全に編集可能な DataList でを複数の仕入先のアドレス情報をすばやく変更するユーザーを作成する方法を説明しました。</span><span class="sxs-lookup"><span data-stu-id="5c78a-193">In this tutorial we saw how to create a fully editable DataList, allowing a user to quickly modify the address information for multiple suppliers.</span></span> <span data-ttu-id="5c78a-194">S DataList の編集インターフェイス仕入先の住所や市区町村、国の値のテキスト ボックスに Web コントロールを定義することで開始した`ItemTemplate`します。</span><span class="sxs-lookup"><span data-stu-id="5c78a-194">We started by defining the editing interface a TextBox Web control for the supplier s address, city, and country values in the DataList s `ItemTemplate`.</span></span> <span data-ttu-id="5c78a-195">次に、上と下、DataList の更新プログラムのすべてのボタンを追加します。</span><span class="sxs-lookup"><span data-stu-id="5c78a-195">Next, we added Update All buttons above and below the DataList.</span></span> <span data-ttu-id="5c78a-196">ユーザーが自分の変更を行って更新プログラムのすべてのボタンのいずれかをクリックした後、 `DataListItem` s が列挙されると呼び出しを`SuppliersBLL`クラスの`UpdateSupplierAddress`メソッドが呼び出さ。</span><span class="sxs-lookup"><span data-stu-id="5c78a-196">After a user has made his changes and clicked one of the Update All buttons, the `DataListItem` s are enumerated and a call to the `SuppliersBLL` class s `UpdateSupplierAddress` method is made.</span></span>

<span data-ttu-id="5c78a-197">満足のプログラミングです。</span><span class="sxs-lookup"><span data-stu-id="5c78a-197">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="5c78a-198">執筆者紹介</span><span class="sxs-lookup"><span data-stu-id="5c78a-198">About the Author</span></span>

<span data-ttu-id="5c78a-199">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)、7 つ受け取りますブックおよびの創設者の著者[4GuysFromRolla.com](http://www.4guysfromrolla.com)、Microsoft Web テクノロジと 1998 年から携わっています。</span><span class="sxs-lookup"><span data-stu-id="5c78a-199">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="5c78a-200">Scott は、フリーのコンサルタント、トレーナー、およびライターとして動作します。</span><span class="sxs-lookup"><span data-stu-id="5c78a-200">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="5c78a-201">最新の著書は[ *Sams 教える自分で ASP.NET 2.0 24 時間以内に*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)します。</span><span class="sxs-lookup"><span data-stu-id="5c78a-201">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="5c78a-202">彼に到達できる[mitchell@4GuysFromRolla.comします。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="5c78a-202">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="5c78a-203">彼のブログにあるでまたは[ http://ScottOnWriting.NET](http://ScottOnWriting.NET)します。</span><span class="sxs-lookup"><span data-stu-id="5c78a-203">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="5c78a-204">特別なに感謝します。</span><span class="sxs-lookup"><span data-stu-id="5c78a-204">Special Thanks To</span></span>

<span data-ttu-id="5c78a-205">このチュートリアル シリーズは、多くの便利なレビュー担当者によってレビューされました。</span><span class="sxs-lookup"><span data-stu-id="5c78a-205">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="5c78a-206">このチュートリアルでは、潜在顧客レビュー担当者は、Zack Jones、Ken Pespisa でした。</span><span class="sxs-lookup"><span data-stu-id="5c78a-206">Lead reviewers for this tutorial were Zack Jones and Ken Pespisa.</span></span> <span data-ttu-id="5c78a-207">今後、MSDN の記事を確認したいですか。</span><span class="sxs-lookup"><span data-stu-id="5c78a-207">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="5c78a-208">場合は、筆者に[mitchell@4GuysFromRolla.comします。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="5c78a-208">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="5c78a-209">[前へ](an-overview-of-editing-and-deleting-data-in-the-datalist-vb.md)
> [次へ](handling-bll-and-dal-level-exceptions-vb.md)</span><span class="sxs-lookup"><span data-stu-id="5c78a-209">[Previous](an-overview-of-editing-and-deleting-data-in-the-datalist-vb.md)
[Next](handling-bll-and-dal-level-exceptions-vb.md)</span></span>
