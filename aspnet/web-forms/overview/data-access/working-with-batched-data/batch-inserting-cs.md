---
uid: web-forms/overview/data-access/working-with-batched-data/batch-inserting-cs
title: バッチを挿入する (c#) |Microsoft Docs
author: rick-anderson
description: 1 回の操作で複数のデータベース レコードを挿入する方法について説明します。 ユーザー インターフェイス レイヤーは、複数の n を入力するユーザーを許可する GridView を拡張しています.
ms.author: aspnetcontent
ms.date: 06/26/2007
ms.assetid: cf025e08-48fc-4385-b176-8610aa7b5565
msc.legacyurl: /web-forms/overview/data-access/working-with-batched-data/batch-inserting-cs
msc.type: authoredcontent
ms.openlocfilehash: 9979a991935d97ef7c3b2ac62666da318b95d063
ms.sourcegitcommit: b28cd0313af316c051c2ff8549865bff67f2fbb4
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/05/2018
ms.locfileid: "37829060"
---
<a name="batch-inserting-c"></a><span data-ttu-id="ec6c9-104">バッチを挿入する (c#)</span><span class="sxs-lookup"><span data-stu-id="ec6c9-104">Batch Inserting (C#)</span></span>
====================
<span data-ttu-id="ec6c9-105">によって[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="ec6c9-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="ec6c9-106">[コードのダウンロード](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_66_CS.zip)または[PDF のダウンロード](batch-inserting-cs/_static/datatutorial66cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="ec6c9-106">[Download Code](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_66_CS.zip) or [Download PDF](batch-inserting-cs/_static/datatutorial66cs1.pdf)</span></span>

> <span data-ttu-id="ec6c9-107">1 回の操作で複数のデータベース レコードを挿入する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-107">Learn how to insert multiple database records in a single operation.</span></span> <span data-ttu-id="ec6c9-108">ユーザー インターフェイス レイヤーは、複数の新しいレコードを入力するユーザーを許可する GridView を拡張します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-108">In the User Interface Layer we extend the GridView to allow the user to enter multiple new records.</span></span> <span data-ttu-id="ec6c9-109">データ アクセス層は、すべての挿入が成功に、すべての挿入をロールバック、トランザクション内で複数の挿入操作をラップします。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-109">In the Data Access Layer we wrap the multiple Insert operations within a transaction to ensure that all insertions succeed or all insertions are rolled back.</span></span>


## <a name="introduction"></a><span data-ttu-id="ec6c9-110">はじめに</span><span class="sxs-lookup"><span data-stu-id="ec6c9-110">Introduction</span></span>

<span data-ttu-id="ec6c9-111">[バッチ更新](batch-updating-cs.md)チュートリアルは複数のレコードが編集可能なインターフェイスを表示する GridView コントロールのカスタマイズについて説明しました。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-111">In the [Batch Updating](batch-updating-cs.md) tutorial we looked at customizing the GridView control to present an interface where multiple records were editable.</span></span> <span data-ttu-id="ec6c9-112">ページにアクセスするユーザーは、一連の変更を行うし、次に、1 つのボタンのクリックでは、バッチ更新を実行可能性があります。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-112">The user visiting the page could make a series of changes and then, with a single button click, perform a batch update.</span></span> <span data-ttu-id="ec6c9-113">ユーザーが通常 1 つの go の複数のレコードを更新の場合、このようなインターフェイスが数えきれないほどのクリックを保存できます既定値と比較した場合、キーボードのマウスのコンテキストの切り替え行ごとに探索された最初の編集機能、 [、。挿入、更新、および削除するデータの概要](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md)チュートリアル。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-113">For situations where users commonly update many records in one go, such an interface can save countless clicks and keyboard-to-mouse context switches when compared to the default per-row editing features that were first explored back in the [An Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md) tutorial.</span></span>

<span data-ttu-id="ec6c9-114">この概念は、レコードを追加するときにも適用できます。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-114">This concept can also be applied when adding records.</span></span> <span data-ttu-id="ec6c9-115">Imagine をここで Northwind traders よく出荷から受け取る特定のカテゴリの製品が多数存在する仕入先。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-115">Imagine that here at Northwind Traders we commonly receive shipments from suppliers that contain a number of products for a particular category.</span></span> <span data-ttu-id="ec6c9-116">たとえば、6 つの異なる見落とさなくなるとコーヒー製品の出荷東京 Traders から受け取る可能性があります。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-116">As an example, we might receive a shipment of six different tea and coffee products from Tokyo Traders.</span></span> <span data-ttu-id="ec6c9-117">多くの同じ値を何度も選択する必要がある DetailsView コントロールで一度に 1 つの 6 つの製品を入力すると場合、: 同じカテゴリ (飲み物) を同じ製造元 (東京 Traders) を選択する必要があります、同じ値 (が廃止されましたFalse の場合) と同じ順序の値 (0) の単位。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-117">If a user enters the six products one at a time through a DetailsView control, they will have to choose many of the same values over and over again: they will need to choose the same category (Beverages), the same supplier (Tokyo Traders), the same discontinued value (False), and the same units on order value (0).</span></span> <span data-ttu-id="ec6c9-118">この反復的なデータのエントリは、のみ、時間がかかるではありませんはエラーを起こしやすくなります。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-118">This repetitive data entry is not only time consuming, but is prone to errors.</span></span>

<span data-ttu-id="ec6c9-119">簡単な作業では、業者とカテゴリ 1 回、一連の製品名および単位の価格を入力し、データベースに新しい製品を追加するためのボタンをクリックして、ユーザーができるようにするインターフェイスの挿入のバッチを作成できます (図 1 参照)。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-119">With a little work we can create a batch inserting interface that enables the user to choose the supplier and category once, enter a series of product names and unit prices, and then click a button to add the new products to the database (see Figure 1).</span></span> <span data-ttu-id="ec6c9-120">各製品が追加されるため、その`ProductName`と`UnitPrice`データ フィールドには、テキスト ボックスに入力された値が割り当てられているときにその`CategoryID`と`SupplierID`上位 fo フォームでの Dropdownlist の値に値が割り当てられます。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-120">As each product is added, its `ProductName` and `UnitPrice` data fields are assigned the values entered in the TextBoxes, while its `CategoryID` and `SupplierID` values are assigned the values from the DropDownLists at the top fo the form.</span></span> <span data-ttu-id="ec6c9-121">`Discontinued`と`UnitsOnOrder`値のハードコード値に設定されます`false`と 0 で、それぞれします。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-121">The `Discontinued` and `UnitsOnOrder` values are set to the hard-coded values of `false` and 0, respectively.</span></span>


<span data-ttu-id="ec6c9-122">[![バッチ挿入インターフェイス](batch-inserting-cs/_static/image2.png)](batch-inserting-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="ec6c9-122">[![The Batch Inserting Interface](batch-inserting-cs/_static/image2.png)](batch-inserting-cs/_static/image1.png)</span></span>

<span data-ttu-id="ec6c9-123">**図 1**:、バッチを挿入するインターフェイス ([フルサイズの画像を表示する をクリックします](batch-inserting-cs/_static/image3.png))。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-123">**Figure 1**: The Batch Inserting Interface ([Click to view full-size image](batch-inserting-cs/_static/image3.png))</span></span>


<span data-ttu-id="ec6c9-124">このチュートリアルでは図 1 に示すインターフェイスを挿入するバッチを実装するページを作成します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-124">In this tutorial we will create a page that implements the batch inserting interface shown in Figure 1.</span></span> <span data-ttu-id="ec6c9-125">として前の 2 つのチュートリアルでは、私たちがラップして、挿入に原子性が確保のトランザクションのスコープ内でいます。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-125">As with the previous two tutorials, we will wrap the insertions within the scope of a transaction to ensure atomicity.</span></span> <span data-ttu-id="ec6c9-126">Let s を始めましょう。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-126">Let s get started!</span></span>

## <a name="step-1-creating-the-display-interface"></a><span data-ttu-id="ec6c9-127">手順 1: 表示インターフェイスの作成</span><span class="sxs-lookup"><span data-stu-id="ec6c9-127">Step 1: Creating the Display Interface</span></span>

<span data-ttu-id="ec6c9-128">このチュートリアルは、2 つのリージョンに分割された 1 つのページから構成されます。 表示領域と挿入のリージョン。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-128">This tutorial will consist of a single page that is divided into two regions: a display region and an inserting region.</span></span> <span data-ttu-id="ec6c9-129">表示インターフェイスは、この手順で作成する、GridView で、製品が表示され、製品出荷を処理するというタイトルのボタンが含まれています。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-129">The display interface, which we'll create in this step, shows the products in a GridView and includes a button titled Process Product Shipment.</span></span> <span data-ttu-id="ec6c9-130">このボタンがクリックされたときに表示インターフェイスは、図 1 には、挿入インターフェイスに置き換えられます。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-130">When this button is clicked, the display interface is replaced with the inserting interface, which is shown in Figure 1.</span></span> <span data-ttu-id="ec6c9-131">出荷から商品の追加後、表示のインターフェイスを返します。 または、[キャンセル] ボタンがクリックされました。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-131">The display interface returns after the Add Products from Shipment or Cancel buttons are clicked.</span></span> <span data-ttu-id="ec6c9-132">手順 2. で挿入のインターフェイスを作成します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-132">We'll create the inserting interface in Step 2.</span></span>

<span data-ttu-id="ec6c9-133">内に一度にうちの 1 つだけが表示されて、2 つのインターフェイスを持つページを作成するときにする各インターフェイスが通常に配置されます、[パネルの Web コントロール](http://www.w3schools.com/aspnet/control_panel.asp)、他のコントロールのコンテナーとして機能します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-133">When creating a page that has two interfaces, only one of which is visible at a time, each interface typically is placed within a [Panel Web control](http://www.w3schools.com/aspnet/control_panel.asp), which serves as a container for other controls.</span></span> <span data-ttu-id="ec6c9-134">したがって、このページでは、インターフェイスごとに 2 つのパネル コントロール 1 つがあります。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-134">Therefore, our page will have two Panel controls one for each interface.</span></span>

<span data-ttu-id="ec6c9-135">開いて開始、`BatchInsert.aspx`ページで、`BatchData`フォルダーと、ツールボックスからデザイナーにドラッグ パネル (図 2 参照)。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-135">Start by opening the `BatchInsert.aspx` page in the `BatchData` folder and drag a Panel from the Toolbox onto the Designer (see Figure 2).</span></span> <span data-ttu-id="ec6c9-136">設定パネル s`ID`プロパティを`DisplayInterface`します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-136">Set the Panel s `ID` property to `DisplayInterface`.</span></span> <span data-ttu-id="ec6c9-137">パネルをデザイナーに追加するときにその`Height`と`Width`プロパティがそれぞれの「50 px」と 125px、に設定されます。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-137">When adding the Panel to the Designer, its `Height` and `Width` properties are set to 50px and 125px, respectively.</span></span> <span data-ttu-id="ec6c9-138">[プロパティ] ウィンドウからこれらのプロパティ値をクリアします。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-138">Clear out these property values from the Properties window.</span></span>


<span data-ttu-id="ec6c9-139">[![ツールボックスからデザイナーにパネルをドラッグします。](batch-inserting-cs/_static/image5.png)](batch-inserting-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="ec6c9-139">[![Drag a Panel from the Toolbox onto the Designer](batch-inserting-cs/_static/image5.png)](batch-inserting-cs/_static/image4.png)</span></span>

<span data-ttu-id="ec6c9-140">**図 2**: パネルをツールボックスからデザイナーにドラッグします ([フルサイズの画像を表示する をクリックします](batch-inserting-cs/_static/image6.png))。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-140">**Figure 2**: Drag a Panel from the Toolbox onto the Designer ([Click to view full-size image](batch-inserting-cs/_static/image6.png))</span></span>


<span data-ttu-id="ec6c9-141">次に、ボタンと GridView コントロールをパネルにドラッグします。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-141">Next, drag a Button and GridView control into the Panel.</span></span> <span data-ttu-id="ec6c9-142">設定ボタン s`ID`プロパティを`ProcessShipment`とその`Text`製品出荷を処理するプロパティ。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-142">Set the Button s `ID` property to `ProcessShipment` and its `Text` property to Process Product Shipment.</span></span> <span data-ttu-id="ec6c9-143">GridView s 設定`ID`プロパティを`ProductsGrid`し、スマート タグ、という名前の新しい ObjectDataSource にバインドする`ProductsDataSource`します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-143">Set the GridView s `ID` property to `ProductsGrid` and, from its smart tag, bind it to a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="ec6c9-144">構成からそのデータをプルする ObjectDataSource、`ProductsBLL`クラスの`GetProducts`メソッド。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-144">Configure the ObjectDataSource to pull its data from the `ProductsBLL` class s `GetProducts` method.</span></span> <span data-ttu-id="ec6c9-145">この GridView を使用して、データを表示してのみ、いるので、UPDATE、INSERT でドロップダウン リストを設定し、(None) にタブを削除します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-145">Since this GridView is used only to display data, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None).</span></span> <span data-ttu-id="ec6c9-146">データ ソース構成ウィザードを完了するには、[完了] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-146">Click Finish to complete the Configure Data Source wizard.</span></span>


<span data-ttu-id="ec6c9-147">[![ProductsBLL クラスの GetProducts メソッドから返されるデータを表示します。](batch-inserting-cs/_static/image8.png)](batch-inserting-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="ec6c9-147">[![Display the Data Returned from the ProductsBLL Class s GetProducts Method](batch-inserting-cs/_static/image8.png)](batch-inserting-cs/_static/image7.png)</span></span>

<span data-ttu-id="ec6c9-148">**図 3**: から返されたデータを表示、`ProductsBLL`クラス s`GetProducts`メソッド ([フルサイズの画像を表示する をクリックします](batch-inserting-cs/_static/image9.png))。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-148">**Figure 3**: Display the Data Returned from the `ProductsBLL` Class s `GetProducts` Method ([Click to view full-size image](batch-inserting-cs/_static/image9.png))</span></span>


<span data-ttu-id="ec6c9-149">[![UPDATE、INSERT でドロップダウン リストを設定し、(なし) タブを削除します。](batch-inserting-cs/_static/image11.png)](batch-inserting-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="ec6c9-149">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None)](batch-inserting-cs/_static/image11.png)](batch-inserting-cs/_static/image10.png)</span></span>

<span data-ttu-id="ec6c9-150">**図 4**: (None) に、UPDATE、INSERT、および削除のタブで、ドロップダウン リストを設定 ([フルサイズの画像を表示する をクリックします](batch-inserting-cs/_static/image12.png))。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-150">**Figure 4**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None) ([Click to view full-size image](batch-inserting-cs/_static/image12.png))</span></span>


<span data-ttu-id="ec6c9-151">ObjectDataSource ウィザードの完了後は、Visual Studio は BoundFields と製品のデータ フィールドの CheckBoxField を追加します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-151">After completing the ObjectDataSource wizard, Visual Studio will add BoundFields and a CheckBoxField for the product data fields.</span></span> <span data-ttu-id="ec6c9-152">削除以外のすべて、 `ProductName`、 `CategoryName`、 `SupplierName`、 `UnitPrice`、および`Discontinued`フィールド。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-152">Remove all but the `ProductName`, `CategoryName`, `SupplierName`, `UnitPrice`, and `Discontinued` fields.</span></span> <span data-ttu-id="ec6c9-153">自由に見た目をカスタマイズできます。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-153">Feel free to make any aesthetic customizations.</span></span> <span data-ttu-id="ec6c9-154">書式を設定することにしました、`UnitPrice`を通貨値としてフィールド、フィールドの順序を変更して、フィールドのいくつかの名前を変更`HeaderText`値。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-154">I decided to format the `UnitPrice` field as a currency value, reordered the fields, and renamed several of the fields `HeaderText` values.</span></span> <span data-ttu-id="ec6c9-155">ページングと並べ替えを GridView s のスマート タグのページングを有効にして並べ替えを有効にするチェック ボックスをチェックしてサポートを含める GridView 構成もできます。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-155">Also configure the GridView to include paging and sorting support by checking the Enable Paging and Enable Sorting checkboxes in the GridView s smart tag.</span></span>

<span data-ttu-id="ec6c9-156">パネル、ボタン、GridView、ObjectDataSource コントロールを追加して、GridView のフィールドをカスタマイズすると、ページ、宣言型マークアップを次のようになります。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-156">After adding the Panel, Button, GridView, and ObjectDataSource controls and customizing the GridView s fields, your page s declarative markup should look similar to the following:</span></span>


[!code-aspx[Main](batch-inserting-cs/samples/sample1.aspx)]

<span data-ttu-id="ec6c9-157">開始タグと終了内のボタンや GridView マークアップが表示される`<asp:Panel>`タグ。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-157">Note that the markup for the Button and GridView appear within the opening and closing `<asp:Panel>` tags.</span></span> <span data-ttu-id="ec6c9-158">これらのコントロール内にあるため、`DisplayInterface`パネルで非表示にできますパネル s を設定するだけで`Visible`プロパティを`false`します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-158">Since these controls are within the `DisplayInterface` Panel, we can hide them by simply setting the Panel s `Visible` property to `false`.</span></span> <span data-ttu-id="ec6c9-159">手順 3 は、s パネルをプログラムで変更`Visible`ボタンへの応答のプロパティは、他の非表示中に 1 つのインターフェイスを表示する をクリックします。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-159">Step 3 looks at programmatically changing the Panel s `Visible` property in response to a button click to show one interface while hiding the other.</span></span>

<span data-ttu-id="ec6c9-160">ブラウザーから進行状況を表示する時間がかかります。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-160">Take a moment to view our progress through a browser.</span></span> <span data-ttu-id="ec6c9-161">図 5 に示すよう、一度に 10 個の製品を一覧表示する GridView 上に製品の出荷を処理するボタンが表示されます。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-161">As Figure 5 shows, you should see a Process Product Shipment button above a GridView that lists the products ten at a time.</span></span>


<span data-ttu-id="ec6c9-162">[![GridView、製品と並べ替えとページング機能を提供しています](batch-inserting-cs/_static/image14.png)](batch-inserting-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="ec6c9-162">[![The GridView Lists the Products and Offers Sorting and Paging Capabilities](batch-inserting-cs/_static/image14.png)](batch-inserting-cs/_static/image13.png)</span></span>

<span data-ttu-id="ec6c9-163">**図 5**: GridView には、製品とは、並べ替えとページング機能が一覧表示されます ([フルサイズの画像を表示する をクリックします](batch-inserting-cs/_static/image15.png))。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-163">**Figure 5**: The GridView Lists the Products and Offers Sorting and Paging Capabilities ([Click to view full-size image](batch-inserting-cs/_static/image15.png))</span></span>


## <a name="step-2-creating-the-inserting-interface"></a><span data-ttu-id="ec6c9-164">手順 2: 挿入のインターフェイスを作成します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-164">Step 2: Creating the Inserting Interface</span></span>

<span data-ttu-id="ec6c9-165">完全な表示のインターフェイスで、挿入を作成する準備ができたらインターフェイスです。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-165">With the display interface complete, we re ready to create the inserting interface.</span></span> <span data-ttu-id="ec6c9-166">このチュートリアルでは、挿入インターフェイスは、1 つの仕入先、カテゴリ値の入力を要求し、最大 5 つの製品名と価格の単位の値を入力するユーザーを作成して使用できます。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-166">For this tutorial, let s create an inserting interface that prompts for a single supplier and category value and then allows the user to enter up to five product names and unit price values.</span></span> <span data-ttu-id="ec6c9-167">このインターフェイスは、ユーザーは 1 ~ 5 の新製品すべてを同じ category と supplier、共有が一意の製品の名前と価格を追加できます。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-167">With this interface, the user can add one to five new products that all share the same category and supplier, but have unique product names and prices.</span></span>

<span data-ttu-id="ec6c9-168">ツールボックスから、デザイナーの既存の下に配置することにパネルをドラッグして開始`DisplayInterface`パネル。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-168">Start by dragging a Panel from the Toolbox onto the Designer, placing it beneath the existing `DisplayInterface` Panel.</span></span> <span data-ttu-id="ec6c9-169">設定、`ID`このプロパティは、パネルを新しく追加された`InsertingInterface`設定とその`Visible`プロパティを`false`します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-169">Set the `ID` property of this newly added Panel to `InsertingInterface` and set its `Visible` property to `false`.</span></span> <span data-ttu-id="ec6c9-170">設定するコードを追加します、`InsertingInterface`パネル s`Visible`プロパティを`true`手順 3. でします。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-170">We'll add code that sets the `InsertingInterface` Panel s `Visible` property to `true` in Step 3.</span></span> <span data-ttu-id="ec6c9-171">S パネルもクリア`Height`と`Width`プロパティの値。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-171">Also clear out the Panel s `Height` and `Width` property values.</span></span>

<span data-ttu-id="ec6c9-172">次に、図 1 に示す挿入インターフェイスを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-172">Next, we need to create the inserting interface that was shown back in Figure 1.</span></span> <span data-ttu-id="ec6c9-173">このインターフェイスは、さまざまな HTML の手法で作成できますが、非常に簡単です 1 つを使用します。 4 列、7 行のテーブル。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-173">This interface can be created through a variety of HTML techniques, but we will use a fairly straightforward one: a four-column, seven-row table.</span></span>

> [!NOTE]
> <span data-ttu-id="ec6c9-174">HTML マークアップを入力するときに`<table>`ソース ビューを使用する場合は、要素。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-174">When entering markup for HTML `<table>` elements, I prefer to use the Source view.</span></span> <span data-ttu-id="ec6c9-175">Visual Studio に追加するためのツールはありますが`<table>`デザイナーを介して要素は、デザイナーがすべてを挿入するもかまわないの聞か`style`をマークアップに設定します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-175">While Visual Studio does have tools for adding `<table>` elements through the Designer, the Designer seems all too willing to inject unasked for `style` settings into the markup.</span></span> <span data-ttu-id="ec6c9-176">作成したところ、`<table>`マークアップは、通常はデザイナーに戻り、Web コントロールを追加し、そのプロパティを設定します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-176">Once I have created the `<table>` markup, I usually return to the Designer to add the Web controls and set their properties.</span></span> <span data-ttu-id="ec6c9-177">事前に決められた列と行を含むテーブルを作成するときに、静的な HTML を使いたいなく[テーブル Web コントロール](https://msdn.microsoft.com/library/system.web.ui.webcontrols.table.aspx)テーブル Web コントロール内にある Web コントロールにアクセスできるだけを使用しているため、`FindControl("controlID")`パターン。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-177">When creating tables with pre-determined columns and rows I prefer using static HTML rather than the [Table Web control](https://msdn.microsoft.com/library/system.web.ui.webcontrols.table.aspx) because any Web controls placed within a Table Web control can only be accessed using the `FindControl("controlID")` pattern.</span></span> <span data-ttu-id="ec6c9-178">テーブル Web コントロールをプログラムで構築するため、テーブル (いくつかのデータベースまたはユーザーが指定した条件に基づく行または列を持つもの) に動的に規模のテーブル Web コントロールを使用するには、ただし。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-178">I do, however, use Table Web controls for dynamically-sized tables (ones whose rows or columns are based on some database or user-specified criteria), since the Table Web control can be constructed programmatically.</span></span>


<span data-ttu-id="ec6c9-179">内で次のマークアップを入力、`<asp:Panel>`のタグ、`InsertingInterface`パネル。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-179">Enter the following markup within the `<asp:Panel>` tags of the `InsertingInterface` Panel:</span></span>


[!code-html[Main](batch-inserting-cs/samples/sample2.html)]

<span data-ttu-id="ec6c9-180">これは、`<table>`マークアップでは、すべての Web コントロールは含まれませんまだ、それらを一時的に追加します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-180">This `<table>` markup does not include any Web controls yet, we'll add those momentarily.</span></span> <span data-ttu-id="ec6c9-181">各に注意してください`<tr>`要素に CSS クラスの特定の設定が含まれています:`BatchInsertHeaderRow`業者とカテゴリ Dropdownlist はどこで; ヘッダー行`BatchInsertFooterRow`出荷およびキャンセル ボタンから追加の製品はどこで; フッター行を交互に`BatchInsertRow`と`BatchInsertAlternatingRow`の TextBox コントロールの価格の製品と単位を含む行の値。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-181">Note that each `<tr>` element contains a particular CSS class setting: `BatchInsertHeaderRow` for the header row where the supplier and category DropDownLists will go; `BatchInsertFooterRow` for the footer row where the Add Products from Shipment and Cancel Buttons will go; and alternating `BatchInsertRow` and `BatchInsertAlternatingRow` values for the rows that will contain the product and unit price TextBox controls.</span></span> <span data-ttu-id="ec6c9-182">私の対応する CSS クラスを作成したら、 `Styles.css` GridView および DetailsView ような外観の挿入のインターフェイスを提供するファイルがこれらのチュートリアル全体で使用を制御します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-182">I ve created corresponding CSS classes in the `Styles.css` file to give the inserting interface an appearance similar to the GridView and DetailsView controls we ve used throughout these tutorials.</span></span> <span data-ttu-id="ec6c9-183">これらの CSS クラスは、以下に示します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-183">These CSS classes are shown below.</span></span>


[!code-css[Main](batch-inserting-cs/samples/sample3.css)]

<span data-ttu-id="ec6c9-184">このマークアップを入力すると、デザイン ビューに戻ります。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-184">With this markup entered, return to the Design view.</span></span> <span data-ttu-id="ec6c9-185">これは、`<table>`図 6 に示すように、デザイナーで、4 つの列と 7 行がテーブルとして表示する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-185">This `<table>` should show as a four-column, seven-row table in the Designer, as Figure 6 illustrates.</span></span>


<span data-ttu-id="ec6c9-186">[![挿入するインターフェイスの構成の 4 つの列、7 行のテーブル](batch-inserting-cs/_static/image17.png)](batch-inserting-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="ec6c9-186">[![The Inserting Interface is Composed of a Four-Column, Seven-Row Table](batch-inserting-cs/_static/image17.png)](batch-inserting-cs/_static/image16.png)</span></span>

<span data-ttu-id="ec6c9-187">**図 6**: で構成される挿入のインターフェイスを 4 つの列、7 行のテーブルの ([フルサイズの画像を表示する をクリックします](batch-inserting-cs/_static/image18.png))。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-187">**Figure 6**: The Inserting Interface is Composed of a Four-Column, Seven-Row Table ([Click to view full-size image](batch-inserting-cs/_static/image18.png))</span></span>


<span data-ttu-id="ec6c9-188">挿入インターフェイスに Web コントロールを追加今すぐ再準備が整いました。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-188">We re now ready to add the Web controls to the inserting interface.</span></span> <span data-ttu-id="ec6c9-189">2 つの Dropdownlist をツールボックスから、サプライヤーとカテゴリのいずれかのいずれかのテーブルに適切なセルにドラッグします。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-189">Drag two DropDownLists from the Toolbox into the appropriate cells in the table one for the supplier and one for the category.</span></span>

<span data-ttu-id="ec6c9-190">サプライヤー DropDownList s 設定`ID`プロパティを`Suppliers`という名前の新しい ObjectDataSource にバインド`SuppliersDataSource`します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-190">Set the supplier DropDownList s `ID` property to `Suppliers` and bind it to a new ObjectDataSource named `SuppliersDataSource`.</span></span> <span data-ttu-id="ec6c9-191">構成からそのデータを取得する新しい ObjectDataSource、`SuppliersBLL`クラスの`GetSuppliers`メソッドと、更新プログラムを (なし) s のドロップダウン リストをタブします。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-191">Configure the new ObjectDataSource to retrieve its data from the `SuppliersBLL` class s `GetSuppliers` method and set the UPDATE tab s drop-down list to (None).</span></span> <span data-ttu-id="ec6c9-192">ウィザードを完了するには、[完了] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-192">Click Finish to complete the wizard.</span></span>


<span data-ttu-id="ec6c9-193">[![ObjectDataSource SuppliersBLL クラスの GetSuppliers メソッドを使用して構成します。](batch-inserting-cs/_static/image20.png)](batch-inserting-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="ec6c9-193">[![Configure the ObjectDataSource to Use the SuppliersBLL Class s GetSuppliers Method](batch-inserting-cs/_static/image20.png)](batch-inserting-cs/_static/image19.png)</span></span>

<span data-ttu-id="ec6c9-194">**図 7**: 構成に使用する ObjectDataSource、`SuppliersBLL`クラス s`GetSuppliers`メソッド ([フルサイズの画像を表示する をクリックします](batch-inserting-cs/_static/image21.png))。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-194">**Figure 7**: Configure the ObjectDataSource to Use the `SuppliersBLL` Class s `GetSuppliers` Method ([Click to view full-size image](batch-inserting-cs/_static/image21.png))</span></span>


<span data-ttu-id="ec6c9-195">`Suppliers` DropDownList の表示、`CompanyName`データ フィールドと使用、`SupplierID`のデータがフィールドとしてその`ListItem`の値。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-195">Have the `Suppliers` DropDownList display the `CompanyName` data field and use the `SupplierID` data field as its `ListItem` s values.</span></span>


<span data-ttu-id="ec6c9-196">[![CompanyName データ フィールドの表示し、SupplierID を値として使用します。](batch-inserting-cs/_static/image23.png)](batch-inserting-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="ec6c9-196">[![Display the CompanyName Data Field and Use SupplierID as the Value](batch-inserting-cs/_static/image23.png)](batch-inserting-cs/_static/image22.png)</span></span>

<span data-ttu-id="ec6c9-197">**図 8**: 表示、`CompanyName`データ フィールドと使用`SupplierID`値として ([フルサイズの画像を表示する をクリックします](batch-inserting-cs/_static/image24.png))。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-197">**Figure 8**: Display the `CompanyName` Data Field and Use `SupplierID` as the Value ([Click to view full-size image](batch-inserting-cs/_static/image24.png))</span></span>


<span data-ttu-id="ec6c9-198">名前を 2 つ目の DropDownList`Categories`という名前の新しい ObjectDataSource にバインド`CategoriesDataSource`します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-198">Name the second DropDownList `Categories` and bind it to a new ObjectDataSource named `CategoriesDataSource`.</span></span> <span data-ttu-id="ec6c9-199">構成、 `CategoriesDataSource` ObjectDataSource を使用する、`CategoriesBLL`クラスの`GetCategories`ウィザードを完了する 完了 で、メソッド、セットのドロップダウン リストの一覧を (なし) の UPDATE および DELETE のタブをクリックします。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-199">Configure the `CategoriesDataSource` ObjectDataSource to use the `CategoriesBLL` class s `GetCategories` method; set the drop-down lists in the UPDATE and DELETE tabs to (None) and click Finish to complete the wizard.</span></span> <span data-ttu-id="ec6c9-200">最後に、DropDownList 表示がある、`CategoryName`データ フィールドと使用、`CategoryID`値として。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-200">Finally, have the DropDownList display the `CategoryName` data field and use the `CategoryID` as the value.</span></span>

<span data-ttu-id="ec6c9-201">これら 2 つの Dropdownlist を追加し、適切に構成された ObjectDataSources にバインドした後、画面は図 9 のようなります。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-201">After these two DropDownLists have been added and bound to appropriately configured ObjectDataSources, your screen should look similar to Figure 9.</span></span>


<span data-ttu-id="ec6c9-202">[![ヘッダー行は、サプライヤーとカテゴリの Dropdownlist を含む](batch-inserting-cs/_static/image26.png)](batch-inserting-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="ec6c9-202">[![The Header Row Now Contains the Suppliers and Categories DropDownLists](batch-inserting-cs/_static/image26.png)](batch-inserting-cs/_static/image25.png)</span></span>

<span data-ttu-id="ec6c9-203">**図 9**:、ヘッダー行に、`Suppliers`と`Categories`Dropdownlist ([フルサイズの画像を表示する をクリックします](batch-inserting-cs/_static/image27.png))。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-203">**Figure 9**: The Header Row Now Contains the `Suppliers` and `Categories` DropDownLists ([Click to view full-size image](batch-inserting-cs/_static/image27.png))</span></span>


<span data-ttu-id="ec6c9-204">これで、新しい各製品の価格と名前を収集するテキスト ボックスを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-204">We now need to create the TextBoxes to collect the name and price for each new product.</span></span> <span data-ttu-id="ec6c9-205">ツールボックスからデザイナーにそれぞれの 5 つの製品名と価格の行の TextBox コントロールをドラッグします。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-205">Drag a TextBox control from the Toolbox onto the Designer for each of the five product name and price rows.</span></span> <span data-ttu-id="ec6c9-206">設定、`ID`にテキスト ボックスのプロパティ`ProductName1`、 `UnitPrice1`、 `ProductName2`、 `UnitPrice2`、 `ProductName3`、`UnitPrice3`など。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-206">Set the `ID` properties of the TextBoxes to `ProductName1`, `UnitPrice1`, `ProductName2`, `UnitPrice2`, `ProductName3`, `UnitPrice3`, and so on.</span></span>

<span data-ttu-id="ec6c9-207">それぞれの単位価格を設定するテキスト ボックスの後、CompareValidator を追加、`ControlToValidate`プロパティを適切な`ID`します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-207">Add a CompareValidator after each of the unit price TextBoxes, setting the `ControlToValidate` property to the appropriate `ID`.</span></span> <span data-ttu-id="ec6c9-208">設定も、`Operator`プロパティを`GreaterThanEqual`、`ValueToCompare`を 0 にし、`Type`に`Currency`します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-208">Also set the `Operator` property to `GreaterThanEqual`, `ValueToCompare` to 0, and `Type` to `Currency`.</span></span> <span data-ttu-id="ec6c9-209">これらの設定に CompareValidator、価格を入力した場合、有効な通貨値である 0 以上であることを確認するように指示します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-209">These settings instruct the CompareValidator to ensure that the price, if entered, is a valid currency value that is greater than or equal to zero.</span></span> <span data-ttu-id="ec6c9-210">設定、`Text`プロパティを\*、および`ErrorMessage`価格より大きいまたは 0 と等しくする必要があります。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-210">Set the `Text` property to \*, and `ErrorMessage` to The price must be greater than or equal to zero.</span></span> <span data-ttu-id="ec6c9-211">また、通貨記号を省略してください。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-211">Also, please omit any currency symbols.</span></span>

> [!NOTE]
> <span data-ttu-id="ec6c9-212">挿入インターフェイスには含まれません、RequiredFieldValidator コントロール場合でも、`ProductName`フィールドに、`Products`データベース テーブルが許可しない`NULL`値。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-212">The inserting interface does not include any RequiredFieldValidator controls, even though the `ProductName` field in the `Products` database table does not allow `NULL` values.</span></span> <span data-ttu-id="ec6c9-213">これは、ユーザーが最大 5 つの製品を入力できるたいからです。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-213">This is because we want to let the user enter up to five products.</span></span> <span data-ttu-id="ec6c9-214">たとえば、最初の 3 つの行を製品名および単価を提供する場合、ユーザーは、最後の 2 つの行を空白のまま d だけ追加 3 つの新しい製品システムに。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-214">For example, if the user were to provide the product name and unit price for the first three rows, leaving the last two rows blank, we d just add three new products to the system.</span></span> <span data-ttu-id="ec6c9-215">`ProductName`は必要に応じて、ただし、必要があります。 場合単位価格を確認する入力対応する製品名の値が提供されることをプログラムで確認します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-215">Since `ProductName` is required, however, we will need to programmatically check to ensure that if a unit price is entered that a corresponding product name value is provided.</span></span> <span data-ttu-id="ec6c9-216">このチェック手順 4. で取り上げます。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-216">We'll tackle this check in Step 4.</span></span>


<span data-ttu-id="ec6c9-217">ユーザーの入力を検証するには、値には、通貨記号が含まれている場合に、CompareValidator が無効なデータを報告します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-217">When validating the user s input, the CompareValidator reports invalid data if the value contains a currency symbol.</span></span> <span data-ttu-id="ec6c9-218">各ユニットの価格の価格を入力するときに、通貨記号を省略する場合、ユーザーに指示する視覚的な合図として機能するテキスト ボックスの前に、$ を追加します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-218">Add a $ in front of each of the unit price TextBoxes to serve as a visual cue that instructs the user to omit the currency symbol when entering the price.</span></span>

<span data-ttu-id="ec6c9-219">ValidationSummary コントロール内の最後に、追加、`InsertingInterface`パネルで、設定、`ShowMessageBox`プロパティを`true`とその`ShowSummary`プロパティを`false`します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-219">Lastly, add a ValidationSummary control within the `InsertingInterface` Panel, settings its `ShowMessageBox` property to `true` and its `ShowSummary` property to `false`.</span></span> <span data-ttu-id="ec6c9-220">これらの設定で無効な単位価格の値を入力すると、問題のある TextBox コントロールの横にアスタリスクが表示し、ValidationSummary 以前指定したエラー メッセージを表示するクライアント側のメッセージ ボックスが表示されます。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-220">With these settings, if the user enters an invalid unit price value, an asterisk will appear next to the offending TextBox controls and the ValidationSummary will display a client-side messagebox that shows the error message we specified earlier.</span></span>

<span data-ttu-id="ec6c9-221">この時点で、画面は図 10 のようなはずです。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-221">At this point, your screen should look similar to Figure 10.</span></span>


<span data-ttu-id="ec6c9-222">[![挿入のインターフェイス、製品のテキスト ボックスは、名前と価格](batch-inserting-cs/_static/image29.png)](batch-inserting-cs/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="ec6c9-222">[![The Inserting Interface Now Includes TextBoxes for the Products Names and Prices](batch-inserting-cs/_static/image29.png)](batch-inserting-cs/_static/image28.png)</span></span>

<span data-ttu-id="ec6c9-223">**図 10**: The 挿入インターフェイスようになりましたが含まれていますテキスト ボックス製品の名前と価格 ([フルサイズの画像を表示する をクリックします](batch-inserting-cs/_static/image30.png))。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-223">**Figure 10**: The Inserting Interface Now Includes TextBoxes for the Products Names and Prices ([Click to view full-size image](batch-inserting-cs/_static/image30.png))</span></span>


<span data-ttu-id="ec6c9-224">次に、追加製品を出荷し、[キャンセル] ボタンからフッター行に追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-224">Next we need to add the Add Products from Shipment and Cancel buttons to the footer row.</span></span> <span data-ttu-id="ec6c9-225">ドラッグ 2 ボタン コントロールをツールボックスから挿入のインターフェイスのフッターに、ボタンの設定`ID`プロパティ`AddProducts`と`CancelButton`と`Text`出荷し、[キャンセル] から製品をそれぞれ追加するプロパティ。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-225">Drag two Button controls from the Toolbox into the footer of the inserting interface, setting the Buttons `ID` properties to `AddProducts` and `CancelButton` and `Text` properties to Add Products from Shipment and Cancel, respectively.</span></span> <span data-ttu-id="ec6c9-226">さらに、設定、`CancelButton`コントロール s`CausesValidation`プロパティを`false`します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-226">In addition, set the `CancelButton` control s `CausesValidation` property to `false`.</span></span>

<span data-ttu-id="ec6c9-227">最後に、2 つのインターフェイスのステータス メッセージを表示するラベル Web コントロールを追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-227">Finally, we need to add a Label Web control that will display status messages for the two interfaces.</span></span> <span data-ttu-id="ec6c9-228">たとえば、ユーザーは、新しい製品の出荷を正常に追加、する表示インターフェイスに戻るし、確認メッセージを表示します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-228">For example, when a user successfully adds a new shipment of products, we want to return to the display interface and display a confirmation message.</span></span> <span data-ttu-id="ec6c9-229">ただし、ユーザーは、新しい製品では、製品名をオフのままの価格を提供する場合は、以降の警告メッセージを表示する必要があります、`ProductName`フィールドは必須です。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-229">If, however, the user provides a price for a new product but leaves off the product name, we need to display a warning message since the `ProductName` field is required.</span></span> <span data-ttu-id="ec6c9-230">このメッセージの両方のインターフェイスを表示する必要があります、ため、パネルの外部でページの上部に配置します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-230">Since we need this message to display for both interfaces, place it at the top of the page outside of the Panels.</span></span>

<span data-ttu-id="ec6c9-231">Label Web コントロールをツールボックスからデザイナーでページの上部にドラッグします。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-231">Drag a Label Web control from the Toolbox to the top of the page in the Designer.</span></span> <span data-ttu-id="ec6c9-232">設定、`ID`プロパティを`StatusLabel`チェック ボックスをオフに、`Text`プロパティ、およびセット、`Visible`と`EnableViewState`プロパティ`false`します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-232">Set the `ID` property to `StatusLabel`, clear out the `Text` property, and set the `Visible` and `EnableViewState` properties to `false`.</span></span> <span data-ttu-id="ec6c9-233">前のチュートリアルで述べたように、設定、`EnableViewState`プロパティを`false`により、プログラムでラベルのプロパティの値を変更し、それ以降のポストバック時に既定値に自動的に戻すもらいます。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-233">As we have seen in previous tutorials, setting the `EnableViewState` property to `false` allows us to programmatically change the Label s property values and have them automatically revert back to their defaults on the subsequent postback.</span></span> <span data-ttu-id="ec6c9-234">これには、以降のポストバック時に表示されなくなります。 一部のユーザーの操作への応答で状態メッセージを表示するためのコードが簡略化します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-234">This simplifies the code for showing a status message in response to some user action that disappears on the subsequent postback.</span></span> <span data-ttu-id="ec6c9-235">最後に、設定、`StatusLabel`コントロール s`CssClass`で警告で、CSS クラスの名前を指定するプロパティが定義されている`Styles.css`大きな、斜体、太字、赤いフォントでテキストを表示します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-235">Finally, set the `StatusLabel` control s `CssClass` property to Warning, which is the name of a CSS class defined in `Styles.css` that displays text in a large, italic, bold, red font.</span></span>

<span data-ttu-id="ec6c9-236">図 11 は、ラベルを追加し、構成した後、Visual Studio デザイナーを示します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-236">Figure 11 shows the Visual Studio Designer after the Label has been added and configured.</span></span>


<span data-ttu-id="ec6c9-237">[![2 つのパネル コントロール上には、ある StatusLabel コントロールの配置します。](batch-inserting-cs/_static/image32.png)](batch-inserting-cs/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="ec6c9-237">[![Place the StatusLabel Control Above the Two Panel Controls](batch-inserting-cs/_static/image32.png)](batch-inserting-cs/_static/image31.png)</span></span>

<span data-ttu-id="ec6c9-238">**図 11**: の場所、`StatusLabel`コントロール上の 2 つパネル コントロール ([フルサイズの画像を表示する をクリックします](batch-inserting-cs/_static/image33.png))。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-238">**Figure 11**: Place the `StatusLabel` Control Above the Two Panel Controls ([Click to view full-size image](batch-inserting-cs/_static/image33.png))</span></span>


## <a name="step-3-switching-between-the-display-and-inserting-interfaces"></a><span data-ttu-id="ec6c9-239">手順 3: 表示の切り替えおよび挿入インターフェイス</span><span class="sxs-lookup"><span data-stu-id="ec6c9-239">Step 3: Switching Between the Display and Inserting Interfaces</span></span>

<span data-ttu-id="ec6c9-240">この時点で、表示したり、2 つのタスクのままに、インターフェイスが再挿入するため、マークアップを実施してきました。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-240">At this point we have completed the markup for our display and inserting interfaces, but we re still left with two tasks:</span></span>

- <span data-ttu-id="ec6c9-241">表示の切り替えおよび挿入インターフェイス</span><span class="sxs-lookup"><span data-stu-id="ec6c9-241">Switching between the display and inserting interfaces</span></span>
- <span data-ttu-id="ec6c9-242">データベースに発送、製品の追加</span><span class="sxs-lookup"><span data-stu-id="ec6c9-242">Adding the products in the shipment to the database</span></span>

<span data-ttu-id="ec6c9-243">現時点では、表示インターフェイスが表示されるが、挿入のインターフェイスは表示されません。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-243">Currently, the display interface is visible but the inserting interface is hidden.</span></span> <span data-ttu-id="ec6c9-244">これは、ため、`DisplayInterface`パネル s`Visible`プロパティに設定されて`true`(既定値) の場合は、中に、`InsertingInterface`パネル s`Visible`プロパティに設定されて`false`。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-244">This is because the `DisplayInterface` Panel s `Visible` property is set to `true` (the default value), while the `InsertingInterface` Panel s `Visible` property is set to `false`.</span></span> <span data-ttu-id="ec6c9-245">単に s の各コントロールに切り替える必要があります、2 つのインターフェイス間で切り替え`Visible`プロパティの値。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-245">To switch between the two interfaces we simply need to toggle each control s `Visible` property value.</span></span>

<span data-ttu-id="ec6c9-246">製品出荷を処理するボタンがクリックされたときに、表示インターフェイスから挿入インターフェイスに移動します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-246">We want to move from the display interface to the inserting interface when the Process Product Shipment button is clicked.</span></span> <span data-ttu-id="ec6c9-247">そのため、このボタンのイベント ハンドラーを作成`Click`イベントを次のコードが含まれています。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-247">Therefore, create an event handler for this Button s `Click` event that contains the following code:</span></span>


[!code-csharp[Main](batch-inserting-cs/samples/sample4.cs)]

<span data-ttu-id="ec6c9-248">このコードは単に非表示に、`DisplayInterface`パネルと示しています、`InsertingInterface`パネル。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-248">This code simply hides the `DisplayInterface` Panel and shows the `InsertingInterface` Panel.</span></span>

<span data-ttu-id="ec6c9-249">次に、製品出荷し、[キャンセル] ボタンの挿入のインターフェイス コントロールからの追加のイベント ハンドラーを作成します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-249">Next, create event handlers for the Add Products from Shipment and Cancel Button controls in the inserting interface.</span></span> <span data-ttu-id="ec6c9-250">いずれかのボタンをクリックすると表示のインターフェイスに戻す必要があります。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-250">When either of these Buttons is clicked, we need to revert back to the display interface.</span></span> <span data-ttu-id="ec6c9-251">作成`Click`両方のイベント ハンドラー ボタン コントロールを呼び出すことができるように`ReturnToDisplayInterface`メソッドを一時的に追加します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-251">Create `Click` event handlers for both Button controls so that they call `ReturnToDisplayInterface`, a method we will add momentarily.</span></span> <span data-ttu-id="ec6c9-252">非表示に加え、`InsertingInterface`パネルと表示されている、`DisplayInterface`パネル、`ReturnToDisplayInterface`メソッドは、編集済みの状態に Web コントロールを返す必要があります。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-252">In addition to hiding the `InsertingInterface` Panel and showing the `DisplayInterface` Panel, the `ReturnToDisplayInterface` method needs to return the Web controls to their pre-editing state.</span></span> <span data-ttu-id="ec6c9-253">これには、Dropdownlist の設定が含まれます`SelectedIndex`0 およびを消去するプロパティを`Text`の TextBox コントロールのプロパティ。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-253">This involves setting the DropDownLists `SelectedIndex` properties to 0 and clearing out the `Text` properties of the TextBox controls.</span></span>

> [!NOTE]
> <span data-ttu-id="ec6c9-254">何が起こりうるを検討してください場合私たちでした t が編集済みの状態に表示インターフェイスに戻る前にコントロールを返します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-254">Consider what might happen if we didn t return the controls to their pre-editing state before returning to the display interface.</span></span> <span data-ttu-id="ec6c9-255">ユーザーは、製品出荷を処理する ボタンをクリックして、出荷から製品を入力および製品出荷の追加 をクリックし、可能性があります。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-255">A user might click the Process Product Shipment button, enter the products from the shipment, and then click Add Products from Shipment.</span></span> <span data-ttu-id="ec6c9-256">製品を追加して、ユーザー表示インターフェイスを返すこのは。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-256">This would add the products and return the user to the display interface.</span></span> <span data-ttu-id="ec6c9-257">この時点で、ユーザーは別の出荷を追加する場合があります。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-257">At this point the user might want to add another shipment.</span></span> <span data-ttu-id="ec6c9-258">挿入のインターフェイスが、DropDownList に戻ると、製品出荷を処理するボタンをクリックすると選択、およびテキスト ボックスの値が引き続き反映されます。 して以前の値。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-258">Upon clicking the Process Product Shipment button they would return to the inserting interface but the DropDownList selections and TextBox values would still be populated with their previous values.</span></span>


[!code-csharp[Main](batch-inserting-cs/samples/sample5.cs)]

<span data-ttu-id="ec6c9-259">両方`Click`イベント ハンドラーを呼び出すだけ、`ReturnToDisplayInterface`メソッド、出荷の追加の製品に戻ってが`Click`内のイベント ハンドラーは、手順 4 と製品を保存するコードを追加します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-259">Both `Click` event handlers simply call the `ReturnToDisplayInterface` method, although we'll return to the Add Products from Shipment `Click` event handler in Step 4 and add code to save the products.</span></span> <span data-ttu-id="ec6c9-260">`ReturnToDisplayInterface` 返すことによって開始、`Suppliers`と`Categories`Dropdownlist の最初のオプションにします。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-260">`ReturnToDisplayInterface` starts by returning the `Suppliers` and `Categories` DropDownLists to their first options.</span></span> <span data-ttu-id="ec6c9-261">2 つの定数`firstControlID`と`lastControlID`マーク開始と終了 挿入するテキスト ボックスのインターフェイスし、の境界で使用される製品名および単価を名前付けで使用されるコントロールのインデックス値、`for`設定、ループ`Text`の TextBox コントロールのプロパティが空の文字列にバックアップします。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-261">The two constants `firstControlID` and `lastControlID` mark the starting and ending control index values used in naming the product name and unit price TextBoxes in the inserting interface and are used in the bounds of the `for` loop that sets the `Text` properties of the TextBox controls back to an empty string.</span></span> <span data-ttu-id="ec6c9-262">最後に、パネル`Visible`挿入のインターフェイスは非表示にするためと示されている表示インターフェイスのプロパティをリセットします。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-262">Finally, the Panels `Visible` properties are reset so that the inserting interface is hidden and the display interface shown.</span></span>

<span data-ttu-id="ec6c9-263">このページで、ブラウザーでテストする時間がかかります。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-263">Take a moment to test out this page in a browser.</span></span> <span data-ttu-id="ec6c9-264">最初のページにアクセスすると、図 5 のように、表示インターフェイスが表示されます。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-264">When first visiting the page you should see the display interface as was shown in Figure 5.</span></span> <span data-ttu-id="ec6c9-265">製品出荷を処理するボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-265">Click the Process Product Shipment button.</span></span> <span data-ttu-id="ec6c9-266">ページがポストバックし、図 12 に示すようにインターフェイスを挿入することがわかります。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-266">The page will postback and you should now see the inserting interface as shown in Figure 12.</span></span> <span data-ttu-id="ec6c9-267">いずれかの追加からの製品出荷または [キャンセル] ボタンをクリックすると、表示のインターフェイスを返します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-267">Clicking either the Add Products from Shipment or Cancel buttons returns you to the display interface.</span></span>

> [!NOTE]
> <span data-ttu-id="ec6c9-268">挿入のインターフェイスを表示するには、中に少しテキスト ボックスの単価で CompareValidators してテストします。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-268">While viewing the inserting interface, take a moment to test out the CompareValidators on the unit price TextBoxes.</span></span> <span data-ttu-id="ec6c9-269">クライアント側のメッセージ ボックスから無効な通貨の値を持つ Shipment ボタンまたは 0 より小さい値での価格の製品の追加 をクリックすると警告が表示されます。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-269">You should see a client-side messagebox warning when clicking the Add Products from Shipment button with invalid currency values or prices with a value less than zero.</span></span>


<span data-ttu-id="ec6c9-270">[![製品出荷のプロセス ボタンをクリックした後、挿入するインターフェイスが表示されます。](batch-inserting-cs/_static/image35.png)](batch-inserting-cs/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="ec6c9-270">[![The Inserting Interface is Displayed After Clicking the Process Product Shipment Button](batch-inserting-cs/_static/image35.png)](batch-inserting-cs/_static/image34.png)</span></span>

<span data-ttu-id="ec6c9-271">**図 12**: プロセスの製品出荷のボタンをクリックした後、挿入のインターフェイスが表示されます ([フルサイズの画像を表示する をクリックします](batch-inserting-cs/_static/image36.png))。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-271">**Figure 12**: The Inserting Interface is Displayed After Clicking the Process Product Shipment Button ([Click to view full-size image](batch-inserting-cs/_static/image36.png))</span></span>


## <a name="step-4-adding-the-products"></a><span data-ttu-id="ec6c9-272">手順 4: 製品の追加</span><span class="sxs-lookup"><span data-stu-id="ec6c9-272">Step 4: Adding the Products</span></span>

<span data-ttu-id="ec6c9-273">このチュートリアルは、出荷ボタン s から、追加の製品内のデータベースに製品を保存するのに残っているすべて`Click`イベント ハンドラー。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-273">All that remains for this tutorial is to save the products to the database in the Add Products from Shipment Button s `Click` event handler.</span></span> <span data-ttu-id="ec6c9-274">これは、作成して実行できます、`ProductsDataTable`を追加して、`ProductsRow`指定された製品名の各インスタンス。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-274">This can be accomplished by creating a `ProductsDataTable` and adding a `ProductsRow` instance for each of the product names supplied.</span></span> <span data-ttu-id="ec6c9-275">これらは 1 回`ProductsRow`への呼び出しを行います s が追加されています、`ProductsBLL`クラス s`UpdateWithTransaction`メソッドに渡して、 `ProductsDataTable`。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-275">Once these `ProductsRow` s have been added we will make a call to the `ProductsBLL` class s `UpdateWithTransaction` method passing in the `ProductsDataTable`.</span></span> <span data-ttu-id="ec6c9-276">いることを思い出してください、`UpdateWithTransaction`メソッドで、バックアップで作成された、[トランザクション内のデータベース変更のラッピング](wrapping-database-modifications-within-a-transaction-cs.md)チュートリアル、パス、`ProductsDataTable`を`ProductsTableAdapter`s`UpdateWithTransaction`メソッド。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-276">Recall that the `UpdateWithTransaction` method, which was created back in the [Wrapping Database Modifications within a Transaction](wrapping-database-modifications-within-a-transaction-cs.md) tutorial, passes the `ProductsDataTable` to the `ProductsTableAdapter` s `UpdateWithTransaction` method.</span></span> <span data-ttu-id="ec6c9-277">ADO.NET トランザクションの開始から、および TableAdatper 問題、`INSERT`ステートメントに追加された各データベースに`ProductsRow`DataTable にします。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-277">From there, an ADO.NET transaction is started and the TableAdatper issues an `INSERT` statement to the database for each added `ProductsRow` in the DataTable.</span></span> <span data-ttu-id="ec6c9-278">すべての製品がエラーを発生させず追加は、トランザクションがコミットされたと仮定すると、それ以外の場合はロールバックされます。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-278">Assuming all products are added without error, the transaction is committed, otherwise it is rolled back.</span></span>

<span data-ttu-id="ec6c9-279">製品出荷ボタン %s からの追加のコード`Click`イベント ハンドラーも少しエラー チェックを実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-279">The code for the Add Products from Shipment Button s `Click` event handler also needs to perform a bit of error checking.</span></span> <span data-ttu-id="ec6c9-280">挿入のインターフェイスで使用される RequiredFieldValidators がないので、ユーザーでした価格を入力の製品の中に、その名前を省略するとします。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-280">Since there are no RequiredFieldValidators used in the inserting interface, a user could enter a price for a product while omitting its name.</span></span> <span data-ttu-id="ec6c9-281">S を製品名は必須であるため、ユーザーにアラートを生成し、挿入を続行する場合は、このような条件で色付けされていく様子する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-281">Since the product s name is required, if such a condition unfolds we need to alert the user and not proceed with the inserts.</span></span> <span data-ttu-id="ec6c9-282">完全な`Click`イベント ハンドラーのコードに従います。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-282">The complete `Click` event handler code follows:</span></span>


[!code-csharp[Main](batch-inserting-cs/samples/sample6.cs)]

<span data-ttu-id="ec6c9-283">イベント ハンドラーを開始することを確認して、`Page.IsValid`プロパティの値を返します`true`します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-283">The event handler starts by ensuring that the `Page.IsValid` property returns a value of `true`.</span></span> <span data-ttu-id="ec6c9-284">返された場合`false`、つまり、1 つまたは無効なデータを報告、CompareValidators の; ようたくない、入力した製品を挿入しようとするまたはため例外と、ユーザーが入力した単価を割り当てようとしました値を`ProductsRow`s`UnitPrice`プロパティ。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-284">If it returns `false`, then that means one or more of the CompareValidators are reporting invalid data; in such a case we do not want to attempt to insert the entered products or we'll end up with an exception when attempting to assign the user-entered unit price value to the `ProductsRow` s `UnitPrice` property.</span></span>

<span data-ttu-id="ec6c9-285">次に、新しい`ProductsDataTable`インスタンスが作成されます (`products`)。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-285">Next, a new `ProductsDataTable` instance is created (`products`).</span></span> <span data-ttu-id="ec6c9-286">A`for`製品名および単価テキスト ボックスを反復処理するループを使用し、`Text`プロパティは、ローカル変数に読み取られる`productName`と`unitPrice`します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-286">A `for` loop is used to iterate through the product name and unit price TextBoxes and the `Text` properties are read into the local variables `productName` and `unitPrice`.</span></span> <span data-ttu-id="ec6c9-287">単価の対応する、製品名ではなく、ユーザーの値が入力する場合、`StatusLabel`単位の価格を提供する場合は、メッセージにもする必要がありますが表示されますが、製品の名前を含めるし、イベント ハンドラーが終了しました。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-287">If the user has entered a value for the unit price but not for the corresponding product name, the `StatusLabel` displays the message If you provide a unit price you must also include the name of the product and the event handler is exited.</span></span>

<span data-ttu-id="ec6c9-288">製品名が提供されている場合、新しい`ProductsRow`を使用してインスタンスを作成、 `ProductsDataTable` s`NewProductsRow`メソッド。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-288">If a product name has been provided, a new `ProductsRow` instance is created using the `ProductsDataTable` s `NewProductsRow` method.</span></span> <span data-ttu-id="ec6c9-289">この新しい`ProductsRow`インスタンス`ProductName`プロパティが、現在の製品に設定中にテキスト ボックスの名前、`SupplierID`と`CategoryID`に割り当てられているプロパティ、`SelectedValue`挿入インターフェイスのヘッダーで Dropdownlist のプロパティ。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-289">This new `ProductsRow` instance s `ProductName` property is set to the current product name TextBox while the `SupplierID` and `CategoryID` properties are assigned to the `SelectedValue` properties of the DropDownLists in the inserting interface s header.</span></span> <span data-ttu-id="ec6c9-290">割り当てられている場合は、ユーザーが製品の価格の値を入力、`ProductsRow`インスタンス`UnitPrice`プロパティ、プロパティは、それ以外の場合になりますが、割り当てられていない左、`NULL`値`UnitPrice`データベース内。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-290">If the user entered a value for the product s price, it is assigned to the `ProductsRow` instance s `UnitPrice` property; otherwise, the property is left unassigned, which will result in a `NULL` value for `UnitPrice` in the database.</span></span> <span data-ttu-id="ec6c9-291">最後に、`Discontinued`と`UnitsOnOrder`プロパティは、ハード コーディングされた値に割り当てられている`false`と 0 で、それぞれします。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-291">Finally, the `Discontinued` and `UnitsOnOrder` properties are assigned to the hard-coded values `false` and 0, respectively.</span></span>

<span data-ttu-id="ec6c9-292">プロパティに割り当てられた後、`ProductsRow`インスタンスに追加されて、`ProductsDataTable`します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-292">After the properties have been assigned to the `ProductsRow` instance it is added to the `ProductsDataTable`.</span></span>

<span data-ttu-id="ec6c9-293">完了時に、`for`製品が追加されているかどうかを確認しましたループします。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-293">At the completion of the `for` loop, we check whether any products have been added.</span></span> <span data-ttu-id="ec6c9-294">ユーザーは、結局のところ、製品任意の製品名または価格を入力する前に、出荷からの追加をクリックしている可能性があります。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-294">The user may, after all, have clicked the Add Products from Shipment before entering any product names or prices.</span></span> <span data-ttu-id="ec6c9-295">少なくとも 1 つの製品がある場合、 `ProductsDataTable`、`ProductsBLL`クラスの`UpdateWithTransaction`メソッドが呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-295">If there is at least one product in the `ProductsDataTable`, the `ProductsBLL` class s `UpdateWithTransaction` method is called.</span></span> <span data-ttu-id="ec6c9-296">データが次に、再バインド、 `ProductsGrid` GridView 表示インターフェイスで新しく追加された製品が表示されるようにします。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-296">Next, the data is rebound to the `ProductsGrid` GridView so that the newly added products will appear in the display interface.</span></span> <span data-ttu-id="ec6c9-297">`StatusLabel`が更新され、確認メッセージを表示し、`ReturnToDisplayInterface`呼び出されると、インターフェイスを挿入して表示のインターフェイスを表示の非表示します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-297">The `StatusLabel` is updated to display a confirmation message and the `ReturnToDisplayInterface` is invoked, hiding the inserting interface and showing the display interface.</span></span>

<span data-ttu-id="ec6c9-298">製品が入力されていない場合、挿入のインターフェイスは製品が追加されていないメッセージが表示されているままです。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-298">If no products were entered, the inserting interface remains displayed but the message No products were added.</span></span> <span data-ttu-id="ec6c9-299">製品名を入力してください、テキスト ボックスにユニットの料金が表示されます。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-299">Please enter the product names and unit prices in the textboxes is displayed.</span></span>

<span data-ttu-id="ec6c9-300">図の 13、14、および 15 では、表示、挿入し、アクションにインターフェイスを表示します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-300">Figure s 13, 14, and 15 show the inserting and display interfaces in action.</span></span> <span data-ttu-id="ec6c9-301">図 13 に、ユーザーが対応する製品名のない単位価格の値を入力します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-301">In Figure 13, the user has entered a unit price value without a corresponding product name.</span></span> <span data-ttu-id="ec6c9-302">図 14 インターフェイスを示します、表示後に 3 つの新しい図 15 が表示されますが、新しく追加された製品の 2 つ (3 つ目は、前のページでは)、gridview に製品を正常に追加されています。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-302">Figure 14 shows the display interface after three new products have been added successfully, while Figure 15 shows two of the newly added products in the GridView (the third one is on the previous page).</span></span>


<span data-ttu-id="ec6c9-303">[![製品名が必要なときに入力 Unit Price です。](batch-inserting-cs/_static/image38.png)](batch-inserting-cs/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="ec6c9-303">[![A Product Name is Required When Entering a Unit Price](batch-inserting-cs/_static/image38.png)](batch-inserting-cs/_static/image37.png)</span></span>

<span data-ttu-id="ec6c9-304">**図 13**: A 製品名が必要なときに入力 Unit Price ([フルサイズの画像を表示する をクリックします](batch-inserting-cs/_static/image39.png))。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-304">**Figure 13**: A Product Name is Required When Entering a Unit Price ([Click to view full-size image](batch-inserting-cs/_static/image39.png))</span></span>


<span data-ttu-id="ec6c9-305">[![供給業者に追加された 3 つの新しい Veggies Mayumi s](batch-inserting-cs/_static/image41.png)](batch-inserting-cs/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="ec6c9-305">[![Three New Veggies Have Been Added for the Supplier Mayumi s](batch-inserting-cs/_static/image41.png)](batch-inserting-cs/_static/image40.png)</span></span>

<span data-ttu-id="ec6c9-306">**図 14**: 次の 3 つ新しい Veggies に追加された業者 Mayumi s ([フルサイズの画像を表示する をクリックします](batch-inserting-cs/_static/image42.png))。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-306">**Figure 14**: Three New Veggies Have Been Added for the Supplier Mayumi s ([Click to view full-size image](batch-inserting-cs/_static/image42.png))</span></span>


<span data-ttu-id="ec6c9-307">[![GridView の最後のページで、新しい製品が見つかりません](batch-inserting-cs/_static/image44.png)](batch-inserting-cs/_static/image43.png)</span><span class="sxs-lookup"><span data-stu-id="ec6c9-307">[![The New Products Can Be Found in the Last Page of the GridView](batch-inserting-cs/_static/image44.png)](batch-inserting-cs/_static/image43.png)</span></span>

<span data-ttu-id="ec6c9-308">**図 15**:、新しい製品で見つかる GridView の最後のページ ([フルサイズの画像を表示する をクリックします](batch-inserting-cs/_static/image45.png))。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-308">**Figure 15**: The New Products Can Be Found in the Last Page of the GridView ([Click to view full-size image](batch-inserting-cs/_static/image45.png))</span></span>


> [!NOTE]
> <span data-ttu-id="ec6c9-309">このチュートリアルで使用されるロジックを挿入バッチでは、トランザクションのスコープ内で、挿入をラップします。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-309">The batch inserting logic used in this tutorial wraps the inserts within the scope of transaction.</span></span> <span data-ttu-id="ec6c9-310">これを確認するには、データベース レベルのエラーを意図的紹介します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-310">To verify this, purposefully introduce a database-level error.</span></span> <span data-ttu-id="ec6c9-311">新しい割り当てではなく、たとえば、`ProductsRow`インスタンス`CategoryID`プロパティで選択した値を`Categories`DropDownList などの値を割り当てる`i * 5`します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-311">For example, rather than assigning the new `ProductsRow` instance s `CategoryID` property to the selected value in the `Categories` DropDownList, assign it to a value like `i * 5`.</span></span> <span data-ttu-id="ec6c9-312">ここで`i`ループ インデクサーは、1 から 5 までの値があります。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-312">Here `i` is the loop indexer and has values ranging from 1 to 5.</span></span> <span data-ttu-id="ec6c9-313">そのため、ときに最初の製品を挿入するバッチ内の 2 つ以上の製品を追加する必要があります、有効な`CategoryID`値 (5) が、それ以降の製品が`CategoryID`最大と一致しない値`CategoryID`値、`Categories`テーブル。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-313">Therefore, when adding two or more products in batch insert the first product will have a valid `CategoryID` value (5), but subsequent products will have `CategoryID` values that do not match up to `CategoryID` values in the `Categories` table.</span></span> <span data-ttu-id="ec6c9-314">実際の効果は、最初の中に`INSERT`は成功しますが、以降は外部キー制約違反で失敗します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-314">The net effect is that while the first `INSERT` will succeed, subsequent ones will fail with a foreign key constraint violation.</span></span> <span data-ttu-id="ec6c9-315">一括挿入はアトミックであるため、最初`INSERT`はロールバックされますを返すバッチ挿入処理前に、の状態にデータベースを開始します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-315">Since the batch insert is atomic, the first `INSERT` will be rolled back, returning the database to its state before the batch insert process began.</span></span>


## <a name="summary"></a><span data-ttu-id="ec6c9-316">まとめ</span><span class="sxs-lookup"><span data-stu-id="ec6c9-316">Summary</span></span>

<span data-ttu-id="ec6c9-317">これと前の 2 つのチュートリアルは、削除、更新、実現するインターフェイスを作成したし、のデータ アクセス層に追加されたトランザクション サポートを使用データのバッチを挿入するには、これらはすべて、[ラッピング データベースの変更トランザクション内で](wrapping-database-modifications-within-a-transaction-cs.md)チュートリアル。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-317">Over this and the previous two tutorials we have created interfaces that allow for updating, deleting, and inserting batches of data, all of which used the transaction support we added to the Data Access Layer in the [Wrapping Database Modifications within a Transaction](wrapping-database-modifications-within-a-transaction-cs.md) tutorial.</span></span> <span data-ttu-id="ec6c9-318">特定のシナリオでは、このようなバッチ処理のユーザー インターフェイスを大幅に改善エンドユーザーの効率性を削減して数回のクリックの数、ポストバック、キーボードのマウスのコンテキスト スイッチの場合は、基になるデータの整合性を維持しながらします。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-318">For certain scenarios, such batch processing user interfaces greatly improve end user efficiency by cutting down on the number of clicks, postbacks, and keyboard-to-mouse context switches, while also maintaining the integrity of the underlying data.</span></span>

<span data-ttu-id="ec6c9-319">このチュートリアルでは、バッチ化されたデータの使用方法、外観を完了します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-319">This tutorial completes our look at working with batched data.</span></span> <span data-ttu-id="ec6c9-320">次の一連のチュートリアルでは、DAL、暗号化の接続文字列などの接続とコマンド レベルの設定の構成、TableAdapter のメソッドでストアド プロシージャの使用など、データ アクセス層の高度なシナリオのさまざまなについて説明します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-320">The next set of tutorials explores a variety of advanced Data Access Layer scenarios, including using stored procedures in the TableAdapter s methods, configuring connection- and command-level settings in the DAL, encrypting connection strings, and more!</span></span>

<span data-ttu-id="ec6c9-321">満足のプログラミングです。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-321">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="ec6c9-322">執筆者紹介</span><span class="sxs-lookup"><span data-stu-id="ec6c9-322">About the Author</span></span>

<span data-ttu-id="ec6c9-323">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)、7 つ受け取りますブックおよびの創設者の著者[4GuysFromRolla.com](http://www.4guysfromrolla.com)、Microsoft Web テクノロジと 1998 年から携わっています。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-323">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="ec6c9-324">Scott は、フリーのコンサルタント、トレーナー、およびライターとして動作します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-324">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="ec6c9-325">最新の著書は[ *Sams 教える自分で ASP.NET 2.0 24 時間以内に*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-325">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="ec6c9-326">彼に到達できる[mitchell@4GuysFromRolla.comします。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="ec6c9-326">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="ec6c9-327">彼のブログにあるでまたは[ http://ScottOnWriting.NET](http://ScottOnWriting.NET)します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-327">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="ec6c9-328">特別なに感謝します。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-328">Special Thanks To</span></span>

<span data-ttu-id="ec6c9-329">このチュートリアル シリーズは、多くの便利なレビュー担当者によってレビューされました。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-329">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="ec6c9-330">レビュー担当者を潜在顧客、Hilton Giesenow と S ren Jacob Lauritsen がこのチュートリアルでは。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-330">Lead reviewers for this tutorial were Hilton Giesenow and S ren Jacob Lauritsen.</span></span> <span data-ttu-id="ec6c9-331">今後、MSDN の記事を確認したいですか。</span><span class="sxs-lookup"><span data-stu-id="ec6c9-331">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="ec6c9-332">場合は、筆者に[mitchell@4GuysFromRolla.comします。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="ec6c9-332">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="ec6c9-333">[前へ](batch-deleting-cs.md)
> [次へ](wrapping-database-modifications-within-a-transaction-vb.md)</span><span class="sxs-lookup"><span data-stu-id="ec6c9-333">[Previous](batch-deleting-cs.md)
[Next](wrapping-database-modifications-within-a-transaction-vb.md)</span></span>
