---
uid: web-pages/overview/data/working-with-files
title: ASP.NET Web Pages (Razor) サイトでファイルを扱う |Microsoft Docs
author: tfitzmac
description: この章では、読み取り、書き込み、追加、削除、およびファイルをアップロードする方法について説明します。
ms.author: aspnetcontent
ms.date: 02/20/2014
ms.assetid: eee916e4-ba4c-439a-a24e-68df7d45a569
msc.legacyurl: /web-pages/overview/data/working-with-files
msc.type: authoredcontent
ms.openlocfilehash: 3778bc0041c56fe7164265fe565996aea5564bdf
ms.sourcegitcommit: b28cd0313af316c051c2ff8549865bff67f2fbb4
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/05/2018
ms.locfileid: "37841605"
---
<a name="working-with-files-in-an-aspnet-web-pages-razor-site"></a>ASP.NET Web ページ (Razor) サイトでファイルの使用
====================
によって[Tom FitzMacken](https://github.com/tfitzmac)

> この記事では、読み取り、書き込み、追加、削除、および ASP.NET Web Pages (Razor) サイトでファイルをアップロードする方法について説明します。
> 
> > [!NOTE]
> > イメージをアップロードし、それらを操作する場合 (反転またはサイズ変更など) を参照してください[ASP.NET Web ページ サイトでのイメージを操作](https://go.microsoft.com/fwlink/?LinkId=202897)します。
> 
> 
> **学習内容。** 
> 
> - テキスト ファイルを作成し、データを書き込む方法。
> - 既存のファイルにデータを追加する方法。
> - ファイルを読み取り、そこから表示する方法。
> - Web サイトからファイルを削除する方法。
> - ユーザーが 1 つまたは複数のファイルをアップロードできるようにする方法。
> 
> この記事で導入された機能のプログラミング、ASP.NET を次に示します。
> 
> - `File`オブジェクトで、ファイルを管理する方法を提供します。
> - `FileUpload`ヘルパー。
> - `Path`オブジェクトで、パスとファイル名を操作できるメソッドを提供します。
>   
> 
> ## <a name="software-versions-used-in-the-tutorial"></a>このチュートリアルで使用されるソフトウェアのバージョン
> 
> 
> - ASP.NET Web Pages (Razor) 2
> - WebMatrix 2
>   
> 
> このチュートリアルは、WebMatrix 3 でも機能します。


<a id="Creating_a_Text_File"></a>
## <a name="creating-a-text-file-and-writing-data-to-it"></a>テキスト ファイルを作成し、データを書き込む

に加えて、web サイトのデータベースを使用して、ファイルを操作する可能性があります。 たとえば、サイトのデータを格納する簡単な方法としてテキスト ファイルを使用する可能性があります。 (データの格納に使用されるテキスト ファイルとも呼ばれます、*フラット ファイル*)。テキスト ファイルがなどのさまざまな形式であることができます *.txt*、 *.xml*、または *.csv* (コンマ区切り値)。

テキスト ファイルにデータを格納する場合は、使用、`File.WriteAllText`メソッドを作成するファイルを指定して、データへの書き込みをします。 この手順では、3 つの単純なフォームを含むページを作成します`input`要素 (名、姓、名、および電子メール アドレス) と**送信**ボタンをクリックします。 ユーザーがフォームを送信するときにテキスト ファイルに、ユーザーの入力を格納します。

1. という名前の新しいフォルダーを作成する*アプリ\_データ*が既に存在しない場合、します。
2. という名前の新しいファイルを作成、web サイトのルート ディレクトリにある*UserData.cshtml*します。
3. 次のように、既存のコンテンツを置き換えます。 

    [!code-cshtml[Main](working-with-files/samples/sample1.cshtml)]

    HTML マークアップでは、3 つのテキスト ボックスで、フォームを作成します。 コードを使用して、`IsPost`処理を開始する前に、ページが送信されたかどうかを決定するプロパティ。

    最初のタスクが、ユーザー入力を取得し、変数に割り当てます。 次に、コードは 1 つコンマで区切られた文字列は、別の変数に格納されます別個の変数の値を連結します。 コンマ区切り記号が引用符内に含まれる文字列 (「,」)、コンマを作成している大きな文字列に埋め込む文字どおりためです。 連結するデータの最後で追加する`Environment.NewLine`します。 これには、改行 (改行文字) が追加されます。 このすべての連結で作成しているは、次のような文字列です。

    [!code-css[Main](working-with-files/samples/sample2.css)]

    (Break を使用する非表示の行、最後にします。)

    変数を作成し (`dataFile`) 内のデータを格納するファイルの名前と場所を格納しています。 場所の設定には、いくつかの特別な処理が必要です。 ような絶対パスをコードで参照する不適切な手法は、web サイトで*C:\Folder\File.txt* web サーバー上のファイル。 Web サイトを移動すると、絶対パスは問題になります。 さらに、ホストされているサイトの (、お使いコンピューターではなく) 通常もわからない、正しいパスが、コードを記述するときに。

    場合によっては (現時点では、ファイルを書き込むため) などは、完全なパスする必要があります。 ソリューションは、使用する、`MapPath`のメソッド、`Server`オブジェクト。 これは、web サイトへの完全なパスを返します。 ユーザーが、web サイトのルートのパスを取得する、`~`演算子 (represen には、サイトの仮想ルート) に`MapPath`します。 (など、サブフォルダー名を渡すこともできます *~/App\_データ/*、そのサブフォルダーのパスを取得します)。完全なパスを作成するにはどのようなメソッドを返します上に追加の情報を連結できます。 この例では、ファイル名を追加します。 (詳細でファイルとフォルダーのパスを操作する方法について[ASP.NET Web ページは、Razor 構文を使用プログラミングの概要について](https://go.microsoft.com/fwlink/?LinkId=195205#ID_WorkingWithFileAndFolderPaths))。

    ファイルを保存、*アプリ\_データ*フォルダー。 このフォルダーは」の説明に従って、データ ファイルの格納に使用する asp.net の特別なフォルダー [ASP.NET Web Pages サイトでのデータベース操作の概要](https://go.microsoft.com/fwlink/?LinkId=195209)します。

    `WriteAllText`のメソッド、`File`オブジェクトは、データをファイルに書き込みます。 このメソッドは 2 つのパラメーターを受け取ります。 書き込み、ファイルと書き込む実際のデータの名前 (パス) を使用します。 最初のパラメーターの名前に注意してください、`@`をプレフィックスとして文字。 これは verbatim 文字列リテラルを提供しているなどの文字を ASP.NET に指示「/」を特別な方法で解釈する必要があります。 (詳細については、次を参照してください[Web プログラミングを使用して ASP.NET Razor 構文の概要](https://go.microsoft.com/fwlink/?LinkId=195205#ID_WorkingWithFileAndFolderPaths)。)。

    > [!NOTE]
    > コード内のファイルを保存するために、*アプリ\_データ*フォルダー、アプリケーション必要がある読み取り/書き込みフォルダーのアクセスを許可します。 開発用コンピューターにこれは通常、問題ありません。 ただし、ホスティング プロバイダーの web サーバーにサイトを発行するときは、これらのアクセス許可を明示的に設定する必要があります。 ホスティング プロバイダーのサーバーでこのコードを実行し、エラーが発生する場合は、これらのアクセス許可を設定する方法を確認するホスティング プロバイダーを確認します。

- ブラウザーでページを実行します。 

    ![](working-with-files/_static/image1.jpg)
- フィールドに値を入力し、クリックして**送信**します。
- ブラウザーを閉じます。
- プロジェクトに戻り、表示を更新します。
- 開く、 *data.txt*ファイル。 形式で送信されたデータは、ファイルです。 

    ![[イメージ]](working-with-files/_static/image2.jpg)
- 閉じる、 *data.txt*ファイル。

<a id="Appending_Data"></a>
## <a name="appending-data-to-an-existing-file"></a>既存のファイルにデータを追加します。

前の例では使用して`WriteAllText`が 1 つだけのデータを取得するテキスト ファイルを作成します。 メソッドをもう一度呼び出しし、同じファイル名を渡して、既存のファイルは完全に上書きされます。 ただし、ファイルを作成した後に多くの場合するファイルの末尾に新しいデータを追加します。 使用して行うことができます、`AppendAllText`のメソッド、`File`オブジェクト。

1. Web サイトでのコピーを作成、 *UserData.cshtml*ファイルを開き、コピーを名前*UserDataMultiple.cshtml*します。
2. 開始する前に、コード ブロックを置き換える`<!DOCTYPE html>`次のコード ブロックを持つタグ。 

    [!code-cshtml[Main](working-with-files/samples/sample3.cshtml)]

    このコードでは、前の例では、1 つの変更を持っています。 使用する代わりに`WriteAllText`を使用して`the AppendAllText`メソッド。 メソッドは、のようなことを除いて`AppendAllText`ファイルの末尾にデータを追加します。 同様`WriteAllText`、`AppendAllText`存在しない場合は、ファイルを作成します。
3. ブラウザーでページを実行します。
4. フィールドの値を入力し、クリックして**送信**します。
5. 多くのデータを追加し、もう一度、フォームを送信します。
6. プロジェクトに戻ります、プロジェクト フォルダーを右クリックし、クリックして**更新**します。
7. 開く、 *data.txt*ファイル。 これで、入力した新しいデータが含まれています。 

    ![[イメージ]](working-with-files/_static/image3.jpg)

<a id="Reading_and_Displaying_Data"></a>
## <a name="reading-and-displaying-data-from-a-file"></a>読み取りとファイルからデータを表示します。

場合でも、テキスト ファイルにデータを記述する必要はありません、いずれかからデータを読み取るする必要がありますをおそらく場合があります。 これを行うには、もう一度使用できます、`File`オブジェクト。 使用することができます、`File`各行を個別に読み取るオブジェクト (改行で区切られた) や、それらの区切る方法に関係なく、個々 の項目の読み取り。

この手順では、読み取り、前の例で作成したデータを表示する方法を示します。

1. という名前の新しいファイルを作成、web サイトのルート ディレクトリにある*DisplayData.cshtml*します。
2. 次のように、既存のコンテンツを置き換えます。 

    [!code-cshtml[Main](working-with-files/samples/sample4.cshtml)]

    という名前の変数に、前の例で作成したファイルを読み取ることによって、コードの先頭`userData`、このメソッドの呼び出しを使用します。

    [!code-css[Main](working-with-files/samples/sample5.css)]

    これを行うコードが内部では、`if`ステートメント。 使用することをお勧めはファイルを確認するには、ときに、`File.Exists`最初に、ファイルが使用できるかどうかを確認するメソッド。 コードでは、ファイルが空かどうかも確認します。

    ページの本文には 2 つ`foreach`ループ、他の内部で入れ子になった 1 つ。 外側`foreach`ループは、データ ファイルから一度に 1 つの行を取得します。 ファイル内の改行で行を定義するこの例では、&#8212;これは、データ項目ごとに独自の行があります。 外側のループが新しい項目を作成します (`<li>`要素)、順序付きリスト内で (`<ol>`要素)。

    内側のループでは、区切り記号としてコンマを使用して項目 (フィールド) に各データ行を分割します。 (前の例に基づいて、つまり、行ごとに 3 つのフィールドが含まれている&#8212;をコンマで区切られた各名、姓、名、および電子メール アドレス、.)内側のループを作成も、`<ul>`データ行の各フィールドの項目のリストと 1 つの一覧を表示します。

    コードでは、2 つのデータ型、配列を使用する方法を示しています。 および`char`データ型。 配列が必要な`File.ReadAllLines`メソッドは配列としてデータを返します。 `char`ため、データ型が必要ですが、`Split`メソッドを返します。、`array`型の各要素が`char`します。 (配列については、次を参照してください[Web プログラミングを使用して ASP.NET Razor 構文の概要](https://go.microsoft.com/fwlink/?LinkId=202890#ID_CollectionsAndObjects)。)。
3. ブラウザーでページを実行します。 前の例については、入力したデータが表示されます。 

    ![[イメージ]](working-with-files/_static/image4.jpg)

> [!TIP] 
> 
> **Microsoft Excel のコンマ区切りファイルからデータを表示します。**
> 
> Microsoft Excel を使用して、コンマ区切りファイルとしてのスプレッドシートに含まれるデータを保存することができます (*.csv*ファイル)。 この場合、Excel 形式ではなく、プレーン テキストで、ファイルが保存されます。 スプレッドシート内の各行は、テキスト ファイル内での改行で区切られます、各データ項目はコンマで区切られます。 コード内で、データ ファイルの名前を変更するだけで、Excel のコンマ区切りファイルを読み取るには、前の例に示すようにコードを使用できます。


<a id="Deleting_Files"></a>
## <a name="deleting-files"></a>ファイルを削除します。

使用することができます、web サイトからファイルを削除する、`File.Delete`メソッド。 この手順は、ユーザーがイメージを削除できるようにする方法を示します (*.jpg*ファイル) から、*イメージ*フォルダー、ファイルの名前がわかっている場合。

> [!NOTE] 
> 
> **重要な**を運用環境の web サイトを通常できるユーザーを制限、データを変更します。 サイトのタスクを実行するユーザーを承認する方法についてとメンバーシップを設定する方法については、次を参照してください。[追加のセキュリティと ASP.NET Web ページ サイトには、メンバーシップ](https://go.microsoft.com/fwlink/?LinkId=202904)します。


1. という名前のサブフォルダーを作成、web サイトで*イメージ*します。
2. 1 つまたは複数のコピー *.jpg*へのファイル、*イメージ*フォルダー。
3. という名前の新しいファイルを作成、web サイトのルートに*FileDelete.cshtml*します。
4. 次のように、既存のコンテンツを置き換えます。 

    [!code-cshtml[Main](working-with-files/samples/sample6.cshtml)]

    このページには、イメージ ファイルの名前を入力できるフォームが含まれています。 入力がない、 *.jpg*ファイル名拡張子。 このようなファイル名を制限することでサイト上の任意のファイルを削除していますからユーザーを回避するヘルプ。

    コードでは、ユーザーが入力したし、完全なパスを構築し、ファイル名を読み取ります。 コードをパスを作成するには、現在の web サイトのパスを使用して (によって返される、`Server.MapPath`メソッド)、*イメージ*フォルダー名、ユーザーが指定すると、名前、およびリテラル文字列として".jpg"。

    コードでは、ファイルを削除する、`File.Delete`メソッドを作成した完全なパスを渡します。 マークアップの末尾には、コードには、ファイルが削除されたことの確認メッセージが表示されます。
5. ブラウザーでページを実行します。 

    ![[イメージ]](working-with-files/_static/image5.jpg)
6. 削除し、をクリックし、ファイルの名前を入力**送信**します。 ファイルが削除された場合は、ページの下部にあるファイルの名前が表示されます。

<a id="Letting_Users_Upload_a_File"></a>
## <a name="letting-users-upload-a-file"></a>ファイルをできるようにするためのユーザーのアップロード

`FileUpload`ヘルパーにより、ユーザーが自分の web サイトにファイルをアップロードします。 次の手順では、ユーザーが 1 つのファイルをアップロードできるようにする方法を示します。

1. 」の説明に従って、web サイトに、ASP.NET Web Helpers Library を追加[ASP.NET Web ページ サイトでインストールするヘルパー](https://go.microsoft.com/fwlink/?LinkId=252372)以前追加しなかった場合、します。
2. *アプリ\_データ*フォルダーは、新しいフォルダーを作成し、名前を付けます*UploadedFiles*します。
3. という名前の新しいファイルの作成のルートに*FileUpload.cshtml*します。
4. 次のように、ページで、既存のコンテンツを置き換えます。 

    [!code-cshtml[Main](working-with-files/samples/sample7.cshtml)]

    ページの本文部分を使用して、`FileUpload`アップロード ボックスとおそらく慣れているボタンを作成するヘルパー。

    ![[イメージ]](working-with-files/_static/image6.jpg)

    設定したプロパティ、`FileUpload`ヘルパーは、アップロードするファイルの 1 つの箱をして送信 ボタンの読み取りをすることを指定**アップロード**します。 (ボックスの詳細については、記事の後半で追加します)。

    ユーザーがクリックすると**アップロード**ページの上部にあるコード ファイルを取得および保存します。 `Request`フォームのフィールドから値を取得するために通常使用オブジェクトがあります、`Files`ファイル (またはファイル) を含む配列がアップロードされています。 配列内の特定の位置から、個々 のファイルを取得できます&#8212;取得する最初のアップロードされたファイルを取得するには、たとえば、 `Request.Files[0]`2 番目のファイルを取得するには、取得する`Request.Files[1]`など。 (プログラミングでは、通常はカウントが開始されるゼロに注意してください)。

    変数に格納するアップロードされたファイルをフェッチするとき (ここでは、 `uploadedFile`) それを操作することです。 取得するだけのアップロードされたファイルの名前を判断するには、その`FileName`プロパティ。 ただし、ユーザーが、ファイルをアップロードすると`FileName`パス全体を含む、ユーザーの元名が含まれています。 次のようになります。

    *C:\Users\Public\Sample.txt*

    ただし、サーバーではなく、ユーザーのコンピューター上のパスであるためです、すべてのパス情報は必要ありません。 実際のファイル名 (*Sample.txt*)。 パスからのファイルだけを除去するを使用して、`Path.GetFileName`メソッドは、次のようにします。

    [!code-csharp[Main](working-with-files/samples/sample8.cs)]

    `Path`オブジェクトは、ユーティリティがいくつかのパスを削除、パスを結合およびなどに使用できる次のようなメソッドです。

    アップロードされたファイルの名前を取得した後は、web サイトにアップロードされたファイルを格納する新しいパスを構築できます。 この場合、結合する`Server.MapPath`、フォルダー名 (*アプリ\_データ/UploadedFiles*)、および新しいパスを作成する新しく削除されたファイル名。 呼び出して、アップロードされたファイルの`SaveAs`メソッドを実際には、ファイルを保存します。
5. ブラウザーでページを実行します。 

    ![[イメージ]](working-with-files/_static/image7.jpg)
6. クリックして**参照**しアップロードするファイルを選択します。 

    ![[イメージ]](working-with-files/_static/image8.jpg)

    横にあるテキスト ボックス、**参照**ボタンは、パスとファイルの場所が含まれます。

    ![[イメージ]](working-with-files/_static/image9.jpg)
7. **[アップロード]** をクリックします。
8. Web サイトで、プロジェクト フォルダーを右クリックしをクリックして**更新**します。
9. 開く、 *UploadedFiles*フォルダー。 アップロードしたファイルは、フォルダーです。 

    ![[イメージ]](working-with-files/_static/image10.jpg)

<a id="Letting_Users_Upload_Multiple_Files"></a>
## <a name="letting-users-upload-multiple-files"></a>通知ユーザーは、複数のファイルをアップロードします。

前の例では、ユーザーが 1 つのファイルのアップロードができるようにします。 使用することができますが、`FileUpload`一度に 1 つ以上のファイルをアップロードするヘルパー。 これは、一度に 1 つのファイルのアップロードは面倒な写真をアップロードするようなシナリオに便利です。 (で写真のアップロードについて[ASP.NET Web ページ サイトでのイメージを操作](https://go.microsoft.com/fwlink/?LinkId=202897))。この例では、アップロードしたものを同じ手法を使用できますが、アップロード時、2 つのユーザーをできるようにする方法を示します。

1. 」の説明に従って、web サイトに、ASP.NET Web Helpers Library を追加[ASP.NET Web ページ サイトでインストールするヘルパー](https://go.microsoft.com/fwlink/?LinkId=252372)まだ行っていない場合は、します。
2. という名前の新しいページを作成する*FileUploadMultiple.cshtml*します。
3. 次のように、ページで、既存のコンテンツを置き換えます。  

    [!code-cshtml[Main](working-with-files/samples/sample9.cshtml)]

    この例で、`FileUpload`ヘルパー ページの本文には、既定で 2 つのファイルをアップロードしてもらうために構成されます。 `allowMoreFilesToBeAdded`に設定されている`true`ヘルパーがユーザーのアップロードを追加できるリンクをレンダリングします。

    ![[イメージ]](working-with-files/_static/image11.jpg)

    コードをユーザーにアップロードするファイルを処理するには、前の例で使用したのと同じ基本的なテクニックを使用して&#8212;からファイルを取得`Request.Files`し保存します。 (さまざまな考慮事項を含む必要が適切なファイル名とパスを取得するため)。イノベーションこの時間は、ユーザーが複数のファイルをアップロードする場合があります多くが不明です。 取得することができますを確認する、`Request.Files.Count`します。

    この番号を入手したら、使用してをループすることができます`Request.Files`、さらに、各ファイルのフェッチおよび保存します。 コレクションを既知回数をループするときに使用できます、`for`ループは、次のようにします。

    [!code-csharp[Main](working-with-files/samples/sample10.cs)]

    変数`i`はどのような上限を設定するには 0 から、ある一時カウンターだけです。 この場合、上限値には、ファイル数です。 1 つ未満のファイルの数に上限を実際には、カウンターは、0 の場合は、ASP.NET のシナリオのカウントの一般的なから開始するためです。 (3 つのファイルがアップロードされている場合、カウントがゼロを 2 にします。)

    `uploadedCount`変数が正常にアップロードおよび保存されるすべてのファイルを合計します。 このコードは、必要なファイルをアップロードすることができない可能性がある可能性をアカウントします。
4. ブラウザーでページを実行します。 ブラウザーでは、ページと 2 つのアップロード ボックスが表示されます。
5. アップロードする 2 つのファイルを選択します。
6. クリックして**別のファイルを追加**します。 ページには、新しいアップロードのボックスが表示されます。 

    ![[イメージ]](working-with-files/_static/image12.jpg)
7. **[アップロード]** をクリックします。
8. Web サイトで、プロジェクト フォルダーを右クリックしをクリックして**更新**します。
9. 開く、 *UploadedFiles*フォルダーに正常にアップロードしたファイルを参照してください。

<a id="Additional_Resources"></a>
## <a name="additional-resources"></a>その他のリソース


[ASP.NET Web ページ サイトでの画像の操作](https://go.microsoft.com/fwlink/?LinkId=202897)

[CSV ファイルにエクスポートします。](https://msdn.microsoft.com/library/ms155919.aspx)
